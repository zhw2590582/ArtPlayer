
/*!
 * artplayer-proxy-mediabunny.js v1.0.0
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2026 Harvey Zack
 * Released under the MIT License.
 */
!function(e,t,r,n,a,i,s,o){var c="u">typeof globalThis?globalThis:"u">typeof self?self:"u">typeof window?window:"u">typeof global?global:{},u="function"==typeof c[n]&&c[n],l=u.i||{},d=u.cache||{},f="u">typeof module&&"function"==typeof module.require&&module.require.bind(module);function h(t,r){if(!d[t]){if(!e[t]){if(a[t])return a[t];var i="function"==typeof c[n]&&c[n];if(!r&&i)return i(t,!0);if(u)return u(t,!0);if(f&&"string"==typeof t)return f(t);var s=Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}l.resolve=function(r){var n=e[t][1][r];return null!=n?n:r},l.cache={};var o=d[t]=new h.Module(t);e[t][0].call(o.exports,l,o,o.exports,c)}return d[t].exports;function l(e){var t=l.resolve(e);if(!1===t)return{};if(Array.isArray(t)){var r={__esModule:!0};return t.forEach(function(e){var t=e[0],n=e[1],a=e[2]||e[0],i=h(n);"*"===t?Object.keys(i).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})}):"*"===a?Object.defineProperty(r,t,{enumerable:!0,value:i}):Object.defineProperty(r,t,{enumerable:!0,get:function(){return"default"===a?i.__esModule?i.default:i:i[a]}})}),r}return h(t)}}h.isParcelRequire=!0,h.Module=function(e){this.id=e,this.bundle=h,this.require=f,this.exports={}},h.modules=e,h.cache=d,h.parent=u,h.distDir=void 0,h.publicUrl=void 0,h.devServer=void 0,h.i=l,h.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]},Object.defineProperty(h,"root",{get:function(){return c[n]}}),c[n]=h;for(var m=0;m<t.length;m++)h(t[m]);if(r){var p=h(r);"object"==typeof exports&&"u">typeof module?module.exports=p:"function"==typeof define&&define.amd&&define(function(){return p})}}({OIaIB:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"default",function(){return c});var i=e("@swc/helpers/cjs/_to_consumable_array.cjs"),s=e("./VideoShim.js"),o=a.interopDefault(s);function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t){var r=function(e){n[e]=function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return c[e].apply(c,(0,i._)(r))}},n=(0,t.constructor.utils.createElement)("canvas"),a=n.getContext("2d"),s=new(0,o.default)({art:t,canvas:n,ctx:a,option:e}),c={};for(var u in n)"function"==typeof n[u]&&(c[u]=n[u].bind(n));var l=new Set((0,i._)(Object.getOwnPropertyNames(s)).concat((0,i._)(Object.getOwnPropertyNames(Object.getPrototypeOf(s))))),d=!0,f=!1,h=void 0;try{for(var m,p=l[Symbol.iterator]();!(d=(m=p.next()).done);d=!0)!function(){var e=m.value;"constructor"===e||e in n||Object.defineProperty(n,e,{get:function(){var t=s[e];return"function"==typeof t?t.bind(s):t},set:function(t){s[e]=t},configurable:!0,enumerable:!0})}()}catch(e){f=!0,h=e}finally{try{d||null==p.return||p.return()}finally{if(f)throw h}}for(var g in c)r(g);function v(){var e;(null==(e=t.template)?void 0:e.$player)&&!t.option.autoSize&&Object.assign(n.style,{width:"100%",height:"100%",objectFit:"contain"})}return t.on("resize",v),t.on("video:loadedmetadata",v),t.on("destroy",function(){s.destroy()}),n}}"u">typeof window&&(window.artplayerProxyMediabunny=c)},{"@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","./VideoShim.js":"45n2R","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],i81N6:[function(e,t,r,n){"use strict";var a=e("d402183024004bc7"),i=e("3209e2b12672cd18"),s=e("fc58adb8f1bff142"),o=e("5e213dc122a10171");r._=function(e){return a._(e)||i._(e)||o._(e)||s._()}},{d402183024004bc7:"hfQG0","3209e2b12672cd18":"fQrlQ",fc58adb8f1bff142:"fWabh","5e213dc122a10171":"fh7mx"}],hfQG0:[function(e,t,r,n){"use strict";var a=e("5bd5b10bf87fc8e");r._=function(e){if(Array.isArray(e))return a._(e)}},{"5bd5b10bf87fc8e":"1WOAB"}],"1WOAB":[function(e,t,r,n){"use strict";r._=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}},{}],fQrlQ:[function(e,t,r,n){"use strict";r._=function(e){if("u">typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}},{}],fWabh:[function(e,t,r,n){"use strict";r._=function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},{}],fh7mx:[function(e,t,r,n){"use strict";var a=e("3ee51b7dc02d0c44");r._=function(e,t){if(e){if("string"==typeof e)return a._(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a._(e,t)}}},{"3ee51b7dc02d0c44":"1WOAB"}],"45n2R":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"default",function(){return d});var i=e("@swc/helpers/cjs/_class_call_check.cjs"),s=e("@swc/helpers/cjs/_create_class.cjs"),o=e("./EventTarget.js"),c=a.interopDefault(o),u=e("./MediaBunnyEngine.js"),l=a.interopDefault(u),d=function(){"use strict";function e(t){var r,n,a=t.art,s=t.canvas,o=t.ctx,u=t.option;(0,i._)(this,e),this.art=a,this.canvas=s,this.option=u,this.events=new(0,c.default),this.engine=new(0,l.default)({canvas:s,ctx:o,events:this.events,option:u}),this._src=null,this._volume=null!=(n=u.volume)?n:.7,this._muted=!!u.muted,this._playbackRate=1,this.engine.setVolume(this._volume,this._muted),this.setupEventForwarding(),u.source?this.src=u.source:(null==(r=a.option)?void 0:r.url)&&(this.src=a.option.url)}return(0,s._)(e,[{key:"setupEventForwarding",value:function(){var e=this;this.art.constructor.config.events.forEach(function(t){e.events.addEventListener(t,function(t){e.art.emit("video:".concat(t.type),t)})})}},{key:"addEventListener",value:function(e,t){this.events.addEventListener(e,t)}},{key:"removeEventListener",value:function(e,t){this.events.removeEventListener(e,t)}},{key:"src",get:function(){return this._src},set:function(e){this._src=e,e&&this.engine.load(e)}},{key:"currentSrc",get:function(){return this._src}},{key:"currentTime",get:function(){return this.engine.currentTime},set:function(e){this.engine.seek(Number(e)||0)}},{key:"duration",get:function(){return this.engine.duration}},{key:"buffered",get:function(){return this.createTimeRanges(0,this.engine.duration)}},{key:"played",get:function(){return this.createTimeRanges(0,this.engine.currentTime)}},{key:"seekable",get:function(){return this.createTimeRanges(0,this.engine.duration)}},{key:"createTimeRanges",value:function(e,t){var r=this.engine.duration;return!r||Number.isNaN(r)||t<=0?{length:0,start:function(){return 0},end:function(){return 0}}:{length:1,start:function(){return e},end:function(){return t}}}},{key:"paused",get:function(){return this.engine.paused}},{key:"playing",get:function(){return!this.engine.paused&&!this.engine.ended}},{key:"ended",get:function(){return this.engine.ended}},{key:"seeking",get:function(){return this.engine.seeking}},{key:"readyState",get:function(){return this.engine.readyState}},{key:"networkState",get:function(){return this.engine.networkState}},{key:"error",get:function(){return this.engine.error}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){var t=Number(e);Number.isNaN(t)||t<=0||(this._playbackRate=t,this.engine.setPlaybackRate(t),this.events.emit("ratechange"))}},{key:"volume",get:function(){return this._volume},set:function(e){this._volume=Math.max(0,Math.min(1,Number(e)||0)),this._muted=!1,this.engine.setVolume(this._volume,this._muted),this.events.emit("volumechange")}},{key:"muted",get:function(){return this._muted},set:function(e){this._muted=!!e,this.engine.setVolume(this._volume,this._muted),this.events.emit("volumechange")}},{key:"play",value:function(){return this.engine.play()}},{key:"pause",value:function(){this.engine.pause()}},{key:"load",value:function(){this._src&&this.engine.load(this._src)}},{key:"videoWidth",get:function(){return this.engine.videoWidth}},{key:"videoHeight",get:function(){return this.engine.videoHeight}},{key:"poster",get:function(){return this.option.poster||""},set:function(e){this.option.poster=e}},{key:"autoplay",get:function(){return this.option.autoplay||!1},set:function(e){}},{key:"loop",get:function(){return this.option.loop||!1},set:function(e){}},{key:"controls",get:function(){return!1},set:function(e){}},{key:"playsInline",get:function(){return!0},set:function(e){}},{key:"crossOrigin",get:function(){return this.option.crossOrigin||""},set:function(e){}},{key:"preload",get:function(){return"auto"},set:function(e){}},{key:"defaultMuted",get:function(){return!1},set:function(e){}},{key:"defaultPlaybackRate",get:function(){return 1},set:function(e){}},{key:"canPlayType",value:function(e){return"maybe"}},{key:"getBoundingClientRect",value:function(){return this.canvas.getBoundingClientRect()}},{key:"requestVideoFrameCallback",value:function(e){var t=this;return requestAnimationFrame(function(r){e(r,{presentationTime:t.engine.currentTime,expectedDisplayTime:r+16.6,width:t.engine.videoWidth,height:t.engine.videoHeight,mediaTime:t.engine.currentTime,presentedFrames:0,processingDuration:0,captureTime:r,receiveTime:r,rtpTimestamp:0})})}},{key:"cancelVideoFrameCallback",value:function(e){cancelAnimationFrame(e)}},{key:"setAttribute",value:function(e,t){"src"===e?this.src=t:"autoplay"===e?this.autoplay=t:"loop"===e?this.loop=t:"muted"===e?this.muted=!0:this.canvas.setAttribute(e,t)}},{key:"destroy",value:function(){this.engine.destroy()}}]),e}()},{"@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","./EventTarget.js":"ibx9b","./MediaBunnyEngine.js":"2KRD3","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"4Uf9M":[function(e,t,r,n){"use strict";r._=function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}},{}],igUuK:[function(e,t,r,n){"use strict";function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}r._=function(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}},{}],ibx9b:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"default",function(){return o});var i=e("@swc/helpers/cjs/_class_call_check.cjs"),s=e("@swc/helpers/cjs/_create_class.cjs"),o=function(){"use strict";function e(){(0,i._)(this,e),this.listeners=new Map}return(0,s._)(e,[{key:"addEventListener",value:function(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}},{key:"removeEventListener",value:function(e,t){var r=this.listeners.get(e);if(r){var n=r.indexOf(t);n>=0&&r.splice(n,1)}}},{key:"emit",value:function(e,t){var r=new Event(e);r.detail=t;var n=this.listeners.get(e);n&&n.forEach(function(e){return e(r)})}}]),e}()},{"@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],qpMMf:[function(e,t,r,n){r.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},r.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.exportAll=function(e,t){return Object.keys(e).forEach(function(r){"default"===r||"__esModule"===r||Object.prototype.hasOwnProperty.call(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[r]}})}),t},r.export=function(e,t,r){Object.defineProperty(e,t,{enumerable:!0,get:r})}},{}],"2KRD3":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"default",function(){return h});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_class_call_check.cjs"),o=e("@swc/helpers/cjs/_create_class.cjs"),c=e("@swc/helpers/cjs/_ts_generator.cjs"),u=e("./AudioEngine.js"),l=a.interopDefault(u),d=e("./VideoEngine.js"),f=a.interopDefault(d),h=function(){"use strict";function e(t){var r,n,a,i,o,c,u=this,d=t.canvas,h=t.ctx,m=t.events,p=t.option,g=void 0===p?{}:p;(0,s._)(this,e),this.events=m,this.option=g,this.audio=new(0,l.default)(m),this.video=new(0,f.default)({canvas:d,ctx:h,events:m,timeupdateInterval:null!=(n=g.timeupdateInterval)?n:250,avSyncTolerance:null!=(a=g.avSyncTolerance)?a:.12,dropLateFrames:null!=(i=g.dropLateFrames)&&i,poster:null!=(o=g.poster)?o:"",preflightRange:null!=(c=g.preflightRange)&&c}),this.paused=!0,this.ended=!1,this.readyState=0,this.networkState=0,this.error=null,this.seeking=!1,this.loadSeq=0,null==(r=m.addEventListener)||r.call(m,"ended",function(){u.ended=!0,u.paused=!0})}return(0,o._)(e,[{key:"load",value:function(e){return(0,i._)(function(){var t,r,n,a;return(0,c._)(this,function(i){switch(i.label){case 0:t=this,r=++this.loadSeq,this.pause(),this.ended=!1,this.error=null,this.networkState=2,this.readyState=0,setTimeout(function(){return t.events.emit("waiting")},0),setTimeout(function(){return t.events.emit("loadstart")},0),n=Number.isFinite(this.option.loadTimeout)?this.option.loadTimeout:0,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,Promise.race([this.performLoad(e,r),n>0?this.createTimeout(n):new Promise(function(){})])];case 2:return i.sent(),[3,4];case 3:if(a=i.sent(),r!==this.loadSeq)return[2];return this.loadSeq++,this.error={code:4,message:a.message},this.networkState=3,this.events.emit("error"),[3,4];case 4:return[2]}})}).call(this)}},{key:"performLoad",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s;return(0,c._)(this,function(o){switch(o.label){case 0:r=this,n=!1,a=!1,i=function(){n&&a&&(r.readyState=1,r.events.emit("loadedmetadata"),r.events.emit("durationchange"),r.events.emit("progress"))},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Promise.all([this.video.load(e,function(){t===r.loadSeq&&(n=!0,i())}),this.audio.load(e,function(){t===r.loadSeq&&(a=!0,i())})])];case 2:if(o.sent(),t!==this.loadSeq)return[2];return this.readyState=4,this.networkState=1,this.events.emit("loadeddata"),this.events.emit("canplay"),this.events.emit("canplaythrough"),this.events.emit("progress"),[3,4];case 3:if(s=o.sent(),t!==this.loadSeq)return[2];return this.error={code:4,message:s.message},this.networkState=3,this.events.emit("error"),console.error("MediaBunny load error:",s),[3,4];case 4:return[2]}})}).call(this)}},{key:"createTimeout",value:function(e){return new Promise(function(t,r){setTimeout(function(){return r(Error("Load timeout"))},e)})}},{key:"play",value:function(){return(0,i._)(function(){return(0,c._)(this,function(e){switch(e.label){case 0:if(!this.paused)return[2];if(!this.ended)return[3,2];return this.ended=!1,[4,this.seek(0)];case 1:e.sent(),e.label=2;case 2:return this.paused=!1,[4,this.audio.play()];case 3:return e.sent(),this.video.start(this.audio),this.events.emit("play"),this.events.emit("playing"),[2]}})}).call(this)}},{key:"pause",value:function(){this.paused||(this.paused=!0,this.audio.pause(),this.video.stop(),this.events.emit("pause"))}},{key:"seek",value:function(e){return(0,i._)(function(){var t;return(0,c._)(this,function(r){switch(r.label){case 0:return t=!this.paused,this.ended=!1,this.seeking=!0,this.events.emit("seeking"),this.events.emit("waiting"),this.pause(),[4,Promise.all([this.audio.seek(e),this.video.seek(e)])];case 1:if(r.sent(),this.seeking=!1,this.events.emit("seeked"),!(t&&!this.ended))return[3,3];return[4,this.play()];case 2:r.sent(),r.label=3;case 3:return[2]}})}).call(this)}},{key:"setVolume",value:function(e,t){this.audio.setVolume(e,t)}},{key:"setPlaybackRate",value:function(e){this.audio.setPlaybackRate(e),this.video.setPlaybackRate(e)}},{key:"destroy",value:function(){this.pause(),this.audio.destroy(),this.video.destroy()}},{key:"currentTime",get:function(){return this.audio.currentTime}},{key:"duration",get:function(){return this.audio.duration||this.video.duration}},{key:"videoWidth",get:function(){return this.video.width}},{key:"videoHeight",get:function(){return this.video.height}}]),e}()},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","./AudioEngine.js":"6MNeG","./VideoEngine.js":"952uz","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],cZn0e:[function(e,t,r,n){"use strict";function a(e,t,r,n,a,i,s){try{var o=e[i](s),c=o.value}catch(e){r(e);return}o.done?t(c):Promise.resolve(c).then(n,a)}r._=function(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var s=e.apply(t,r);function o(e){a(s,n,i,o,c,"next",e)}function c(e){a(s,n,i,o,c,"throw",e)}o(void 0)})}}},{}],eltGh:[function(e,t,r,n){"use strict";r._=function(e,t){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype),o=Object.defineProperty;return o(s,"next",{value:c(0)}),o(s,"throw",{value:c(1)}),o(s,"return",{value:c(2)}),"function"==typeof Symbol&&o(s,Symbol.iterator,{value:function(){return this}}),s;function c(o){return function(c){var u=[o,c];if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&u[0]?n.return:u[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,u[1])).done)return a;switch(n=0,a&&(u=[2&u[0],a.value]),u[0]){case 0:case 1:a=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){i.label=u[1];break}if(6===u[0]&&i.label<a[1]){i.label=a[1],a=u;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(u);break}a[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(e){u=[6,e],n=0}finally{r=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}},{}],"6MNeG":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"default",function(){return f});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_class_call_check.cjs"),o=e("@swc/helpers/cjs/_create_class.cjs"),c=e("@swc/helpers/cjs/_type_of.cjs"),u=e("@swc/helpers/cjs/_ts_generator.cjs"),l=e("@swc/helpers/cjs/_ts_values.cjs"),d=e("mediabunny"),f=function(){"use strict";function e(t){(0,s._)(this,e),this.events=t,this.input=null,this.audioSink=null,this.audioIterator=null,this.audioContext=null,this.gainNode=null,this.audioContextStartTime=0,this.playbackTimeAtStart=0,this.latestScheduledEndTime=0,this.duration=NaN,this.paused=!0,this.volume=.7,this.muted=!1,this.playbackRate=1,this.asyncId=0,this.queuedNodes=new Set}return(0,o._)(e,[{key:"currentTime",get:function(){return this.paused?this.playbackTimeAtStart:(this.audioContext.currentTime-this.audioContextStartTime)*this.playbackRate+this.playbackTimeAtStart}},{key:"normalizeSource",value:function(e){return"string"==typeof e?new(0,d.UrlSource)(e):e instanceof Blob?new(0,d.BlobSource)(e):"u">typeof ReadableStream&&e instanceof ReadableStream?new(0,d.ReadableStreamSource)(e):e}},{key:"ensureAudioContext",value:function(e){if(!this.audioContext){var t=window.AudioContext||window.webkitAudioContext;try{this.audioContext=new t({sampleRate:e})}catch(e){this.audioContext=new t}this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination),this.updateGain()}}},{key:"updateGain",value:function(){if(this.gainNode){var e=this.muted?0:this.volume;this.gainNode.gain.value=e*e}}},{key:"stopQueuedNodes",value:function(){this.queuedNodes.forEach(function(e){return e.stop()}),this.queuedNodes.clear()}},{key:"stopIterator",value:function(){return(0,i._)(function(){var e;return(0,u._)(this,function(t){switch(t.label){case 0:return[4,null==(e=this.audioIterator)?void 0:e.return()];case 1:return t.sent(),this.audioIterator=null,[2]}})}).call(this)}},{key:"load",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s;return(0,u._)(this,function(o){switch(o.label){case 0:return r=++this.asyncId,[4,this.stopIterator()];case 1:if(o.sent(),this.stopQueuedNodes(),this.paused=!0,this.playbackTimeAtStart=0,this.audioContextStartTime=0,!(n=this.normalizeSource(e)))return[2];return this.input=new(0,d.Input)({source:n,formats:d.ALL_FORMATS}),a=this,[4,this.input.computeDuration()];case 2:if(a.duration=o.sent(),r!==this.asyncId)return[2];return[4,this.input.getPrimaryAudioTrack()];case 3:if(!(i=o.sent()))return this.audioSink=null,this.ensureAudioContext(),null==t||t(),[2];if(s=null===i.codec)return[3,5];return[4,i.canDecode()];case 4:s=!o.sent(),o.label=5;case 5:if(s)return this.audioSink=null,this.ensureAudioContext(),null==t||t(),[2];return this.ensureAudioContext(i.sampleRate),this.audioSink=new(0,d.AudioBufferSink)(i),null==t||t(),[2]}})}).call(this)}},{key:"runIterator",value:function(e){return(0,i._)(function(){var t,r,n,a;return(0,u._)(this,function(i){switch(i.label){case 0:if(r=function(){var r,a,i,s,o,c,l,d,f;return(0,u._)(this,function(u){switch(u.label){case 0:if(e!==t.asyncId||t.paused)return[2,{v:void 0}];r=t.audioIterator.next(),a=setInterval(function(){e!==n.asyncId||n.paused?clearInterval(a):"running"===n.audioContext.state&&n.audioContext.currentTime>=n.latestScheduledEndTime-.2&&(n.audioContext.suspend(),n.events.emit("waiting"))},50),i=void 0,u.label=1;case 1:return u.trys.push([1,3,4,5]),[4,r];case 2:return i=u.sent(),[3,5];case 3:return console.error("Audio iterator error:",u.sent()),[2,"break"];case 4:return clearInterval(a),[7];case 5:if(e!==t.asyncId||t.paused)return[2,{v:void 0}];if("suspended"!==t.audioContext.state)return[3,7];return[4,t.audioContext.resume()];case 6:u.sent(),t.events.emit("canplay"),t.events.emit("playing"),u.label=7;case 7:if(i.done)return[2,"break"];return o=(s=i.value).buffer,c=s.timestamp,(l=t.audioContext.createBufferSource()).buffer=o,l.connect(t.gainNode),l.playbackRate.value=t.playbackRate,(f=(d=t.audioContextStartTime+(c-t.playbackTimeAtStart)/t.playbackRate)+o.duration/t.playbackRate)>t.latestScheduledEndTime&&(t.latestScheduledEndTime=f),d>=t.audioContext.currentTime?l.start(d):l.start(t.audioContext.currentTime,(t.audioContext.currentTime-d)*t.playbackRate),t.queuedNodes.add(l),l.onended=function(){return n.queuedNodes.delete(l)},[2]}})},n=this,!this.audioSink)return[2];return[4,this.stopIterator()];case 1:i.sent(),this.audioIterator=this.audioSink.buffers(this.currentTime),i.label=2;case 2:return t=this,[5,(0,l._)(r())];case 3:if(a=i.sent(),"object"===(0,c._)(a))return[2,a.v];if("break"===a)return[3,4];return[3,2];case 4:return[2]}})}).call(this)}},{key:"play",value:function(){return(0,i._)(function(){var e;return(0,u._)(this,function(t){switch(t.label){case 0:if(!this.paused)return[2];if(this.audioContext||this.ensureAudioContext(),"suspended"!==this.audioContext.state)return[3,2];return[4,this.audioContext.resume()];case 1:t.sent(),t.label=2;case 2:return this.audioContextStartTime=this.audioContext.currentTime,this.latestScheduledEndTime=this.audioContextStartTime,this.paused=!1,e=++this.asyncId,this.runIterator(e),[2]}})}).call(this)}},{key:"pause",value:function(){this.paused||(this.playbackTimeAtStart=this.currentTime,this.paused=!0,this.stopIterator(),this.stopQueuedNodes())}},{key:"seek",value:function(e){return(0,i._)(function(){var t;return(0,u._)(this,function(r){return this.playbackTimeAtStart=Math.max(0,e),this.audioContextStartTime=this.audioContext.currentTime,this.latestScheduledEndTime=this.audioContextStartTime,t=++this.asyncId,this.paused||this.runIterator(t),[2]})}).call(this)}},{key:"setVolume",value:function(e,t){this.volume=e,this.muted=t,this.updateGain()}},{key:"setPlaybackRate",value:function(e){if(e!==this.playbackRate&&(this.paused||(this.playbackTimeAtStart=this.currentTime,this.audioContextStartTime=this.audioContext.currentTime),this.playbackRate=e,!this.paused)){var t=++this.asyncId;this.runIterator(t)}}},{key:"destroy",value:function(){var e;this.asyncId++,this.pause(),null==(e=this.audioContext)||e.close(),this.audioContext=null,this.input=null,this.audioSink=null}}]),e}()},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_type_of.cjs":"iXhRw","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","@swc/helpers/cjs/_ts_values.cjs":"94P5Q",mediabunny:[["ALL_FORMATS","1jhAI"],["AudioBufferSink","k0V9R"],["BlobSource","7vKle"],["ReadableStreamSource","7vKle"],["UrlSource","7vKle"],["Input","3sapy"]],"@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],iXhRw:[function(e,t,r,n){"use strict";r._=function(e){return e&&"u">typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}},{}],"94P5Q":[function(e,t,r,n){"use strict";r._=e("2ed00358a4809745").__values},{"2ed00358a4809745":"6yrAu"}],"6yrAu":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"__extends",function(){return o}),a.export(r,"__assign",function(){return c}),a.export(r,"__rest",function(){return u}),a.export(r,"__decorate",function(){return l}),a.export(r,"__param",function(){return d}),a.export(r,"__esDecorate",function(){return f}),a.export(r,"__runInitializers",function(){return h}),a.export(r,"__propKey",function(){return m}),a.export(r,"__setFunctionName",function(){return p}),a.export(r,"__metadata",function(){return g}),a.export(r,"__awaiter",function(){return v}),a.export(r,"__generator",function(){return b}),a.export(r,"__createBinding",function(){return y}),a.export(r,"__exportStar",function(){return k}),a.export(r,"__values",function(){return _}),a.export(r,"__read",function(){return w}),a.export(r,"__spread",function(){return S}),a.export(r,"__spreadArrays",function(){return T}),a.export(r,"__spreadArray",function(){return x}),a.export(r,"__await",function(){return I}),a.export(r,"__asyncGenerator",function(){return E}),a.export(r,"__asyncDelegator",function(){return j}),a.export(r,"__asyncValues",function(){return P}),a.export(r,"__makeTemplateObject",function(){return C}),a.export(r,"__importStar",function(){return M}),a.export(r,"__importDefault",function(){return D}),a.export(r,"__classPrivateFieldGet",function(){return F}),a.export(r,"__classPrivateFieldSet",function(){return R}),a.export(r,"__classPrivateFieldIn",function(){return U}),a.export(r,"__addDisposableResource",function(){return O}),a.export(r,"__disposeResources",function(){return L}),a.export(r,"__rewriteRelativeImportExtension",function(){return z});var i=e("@swc/helpers/cjs/_type_of.cjs"),s=function(e,t){return(s=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var c=function(){return(c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function u(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)0>t.indexOf(n[a])&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r}function l(e,t,r,n){var a,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if(("u"<typeof Reflect?"undefined":(0,i._)(Reflect))==="object"&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var c=e.length-1;c>=0;c--)(a=e[c])&&(o=(s<3?a(o):s>3?a(t,r,o):a(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function d(e,t){return function(r,n){t(r,n,e)}}function f(e,t,r,n,a,s){function o(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var c,u=n.kind,l="getter"===u?"get":"setter"===u?"set":"value",d=!t&&e?n.static?e:e.prototype:null,f=t||(d?Object.getOwnPropertyDescriptor(d,n.name):{}),h=!1,m=r.length-1;m>=0;m--){var p={};for(var g in n)p[g]="access"===g?{}:n[g];for(var g in n.access)p.access[g]=n.access[g];p.addInitializer=function(e){if(h)throw TypeError("Cannot add initializers after decoration has completed");s.push(o(e||null))};var v=(0,r[m])("accessor"===u?{get:f.get,set:f.set}:f[l],p);if("accessor"===u){if(void 0===v)continue;if(null===v||(void 0===v?"undefined":(0,i._)(v))!=="object")throw TypeError("Object expected");(c=o(v.get))&&(f.get=c),(c=o(v.set))&&(f.set=c),(c=o(v.init))&&a.unshift(c)}else(c=o(v))&&("field"===u?a.unshift(c):f[l]=c)}d&&Object.defineProperty(d,n.name,f),h=!0}function h(e,t,r){for(var n=arguments.length>2,a=0;a<t.length;a++)r=n?t[a].call(e,r):t[a].call(e);return n?r:void 0}function m(e){return(void 0===e?"undefined":(0,i._)(e))==="symbol"?e:"".concat(e)}function p(e,t,r){return(void 0===t?"undefined":(0,i._)(t))==="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function g(e,t){if(("u"<typeof Reflect?"undefined":(0,i._)(Reflect))==="object"&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function v(e,t,r,n){return new(r||(r=Promise))(function(a,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function o(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(s,o)}c((n=n.apply(e,t||[])).next())})}function b(e,t){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=o(0),s.throw=o(1),s.return=o(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(o){return function(c){var u=[o,c];if(r)throw TypeError("Generator is already executing.");for(;s&&(s=0,u[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&u[0]?n.return:u[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,u[1])).done)return a;switch(n=0,a&&(u=[2&u[0],a.value]),u[0]){case 0:case 1:a=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,n=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){i.label=u[1];break}if(6===u[0]&&i.label<a[1]){i.label=a[1],a=u;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(u);break}a[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(e){u=[6,e],n=0}finally{r=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}var y=Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function k(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||y(t,e,r)}function _(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,a,i=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function S(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(w(arguments[t]));return e}function T(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),a=0,t=0;t<r;t++)for(var i=arguments[t],s=0,o=i.length;s<o;s++,a++)n[a]=i[s];return n}function x(e,t,r){if(r||2==arguments.length)for(var n,a=0,i=t.length;a<i;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}function I(e){return this instanceof I?(this.v=e,this):new I(e)}function E(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),i=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),n[Symbol.asyncIterator]=function(){return this},n;function s(e,t){a[e]&&(n[e]=function(t){return new Promise(function(r,n){i.push([e,t,r,n])>1||o(e,t)})},t&&(n[e]=t(n[e])))}function o(e,t){try{var r;(r=a[e](t)).value instanceof I?Promise.resolve(r.value.v).then(c,u):l(i[0][2],r)}catch(e){l(i[0][3],e)}}function c(e){o("next",e)}function u(e){o("throw",e)}function l(e,t){e(t),i.shift(),i.length&&o(i[0][0],i[0][1])}}function j(e){var t,r;return t={},n("next"),n("throw",function(e){throw e}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,a){t[n]=e[n]?function(t){return(r=!r)?{value:I(e[n](t)),done:!1}:a?a(t):t}:a}}function P(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=_(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,a){var i,s,o;i=n,s=a,o=(t=e[r](t)).done,Promise.resolve(t.value).then(function(e){i({value:e,done:o})},s)})}}}function C(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var A=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},B=function(e){return(B=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)};function M(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=B(e),n=0;n<r.length;n++)"default"!==r[n]&&y(t,e,r[n]);return A(t,e),t}function D(e){return e&&e.__esModule?e:{default:e}}function F(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}function R(e,t,r,n,a){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,r):a?a.value=r:t.set(e,r),r}function U(e,t){if(null===t||(void 0===t?"undefined":(0,i._)(t))!=="object"&&"function"!=typeof t)throw TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function O(e,t,r){if(null!=t){var n,a;if((void 0===t?"undefined":(0,i._)(t))!=="object"&&"function"!=typeof t)throw TypeError("Object expected.");if(r){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");n=t[Symbol.asyncDispose]}if(void 0===n){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");n=t[Symbol.dispose],r&&(a=n)}if("function"!=typeof n)throw TypeError("Object not disposable.");a&&(n=function(){try{a.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:n,async:r})}else r&&e.stack.push({async:!0});return t}var N="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var n=Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function L(e){function t(t){e.error=e.hasError?new N(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,n=0;return function a(){for(;r=e.stack.pop();)try{if(!r.async&&1===n)return n=0,e.stack.push(r),Promise.resolve().then(a);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return n|=2,Promise.resolve(i).then(a,function(e){return t(e),a()})}else n|=1}catch(e){t(e)}if(1===n)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function z(e,t){return"string"==typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(e,r,n,a,i){return r?t?".jsx":".js":!n||a&&i?n+a+"."+i.toLowerCase()+"js":e}):e}r.default={__extends:o,__assign:c,__rest:u,__decorate:l,__param:d,__esDecorate:f,__runInitializers:h,__propKey:m,__setFunctionName:p,__metadata:g,__awaiter:v,__generator:b,__createBinding:y,__exportStar:k,__values:_,__read:w,__spread:S,__spreadArrays:T,__spreadArray:x,__await:I,__asyncGenerator:E,__asyncDelegator:j,__asyncValues:P,__makeTemplateObject:C,__importStar:M,__importDefault:D,__classPrivateFieldGet:F,__classPrivateFieldSet:R,__classPrivateFieldIn:U,__addDisposableResource:O,__disposeResources:L,__rewriteRelativeImportExtension:z}},{"@swc/helpers/cjs/_type_of.cjs":"iXhRw","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"1jhAI":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"InputFormat",function(){return T}),a.export(r,"IsobmffInputFormat",function(){return x}),a.export(r,"Mp4InputFormat",function(){return I}),a.export(r,"QuickTimeInputFormat",function(){return E}),a.export(r,"MatroskaInputFormat",function(){return j}),a.export(r,"WebMInputFormat",function(){return P}),a.export(r,"Mp3InputFormat",function(){return C}),a.export(r,"WaveInputFormat",function(){return A}),a.export(r,"OggInputFormat",function(){return B}),a.export(r,"FlacInputFormat",function(){return M}),a.export(r,"AdtsInputFormat",function(){return D}),a.export(r,"MP4",function(){return F}),a.export(r,"QTFF",function(){return R}),a.export(r,"MATROSKA",function(){return U}),a.export(r,"WEBM",function(){return O}),a.export(r,"MP3",function(){return N}),a.export(r,"WAVE",function(){return L}),a.export(r,"OGG",function(){return z}),a.export(r,"ADTS",function(){return V}),a.export(r,"FLAC",function(){return H}),a.export(r,"ALL_FORMATS",function(){return G});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_call_super.cjs"),o=e("@swc/helpers/cjs/_class_call_check.cjs"),c=e("@swc/helpers/cjs/_create_class.cjs"),u=e("@swc/helpers/cjs/_inherits.cjs"),l=e("@swc/helpers/cjs/_ts_generator.cjs"),d=e("./isobmff/isobmff-demuxer.js"),f=e("./matroska/ebml.js"),h=e("./matroska/matroska-demuxer.js"),m=e("./mp3/mp3-demuxer.js"),p=e("../shared/mp3-misc.js"),g=e("./id3.js"),v=e("./mp3/mp3-reader.js"),b=e("./ogg/ogg-demuxer.js"),y=e("./wave/wave-demuxer.js"),k=e("./adts/adts-reader.js"),_=e("./adts/adts-demuxer.js"),w=e("./reader.js"),S=e("./flac/flac-demuxer.js"),T=function e(){"use strict";(0,o._)(this,e)},x=function(e){"use strict";function t(){return(0,o._)(this,t),(0,s._)(this,t,arguments)}return(0,u._)(t,e),(0,c._)(t,[{key:"_getMajorBrand",value:function(e){return(0,i._)(function(){var t;return(0,l._)(this,function(r){switch(r.label){case 0:if(!((t=e._reader.requestSlice(0,12))instanceof Promise))return[3,2];return[4,t];case 1:t=r.sent(),r.label=2;case 2:if(!t||(t.skip(4),"ftyp"!==(0,w.readAscii)(t,4)))return[2,null];return[2,(0,w.readAscii)(t,4)]}})})()}},{key:"_createDemuxer",value:function(e){return new(0,d.IsobmffDemuxer)(e)}}]),t}(T),I=function(e){"use strict";function t(){return(0,o._)(this,t),(0,s._)(this,t,arguments)}return(0,u._)(t,e),(0,c._)(t,[{key:"_canReadInput",value:function(e){return(0,i._)(function(){var t;return(0,l._)(this,function(r){switch(r.label){case 0:return[4,this._getMajorBrand(e)];case 1:return[2,!!(t=r.sent())&&"qt "!==t]}})}).call(this)}},{key:"name",get:function(){return"MP4"}},{key:"mimeType",get:function(){return"video/mp4"}}]),t}(x),E=function(e){"use strict";function t(){return(0,o._)(this,t),(0,s._)(this,t,arguments)}return(0,u._)(t,e),(0,c._)(t,[{key:"_canReadInput",value:function(e){return(0,i._)(function(){return(0,l._)(this,function(t){switch(t.label){case 0:return[4,this._getMajorBrand(e)];case 1:return[2,"qt "===t.sent()]}})}).call(this)}},{key:"name",get:function(){return"QuickTime File Format"}},{key:"mimeType",get:function(){return"video/quicktime"}}]),t}(x),j=function(e){"use strict";function t(){return(0,o._)(this,t),(0,s._)(this,t,arguments)}return(0,u._)(t,e),(0,c._)(t,[{key:"isSupportedEBMLOfDocType",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s,o,c,u,d;return(0,l._)(this,function(l){switch(l.label){case 0:if(!((r=e._reader.requestSlice(0,f.MAX_HEADER_SIZE))instanceof Promise))return[3,2];return[4,r];case 1:r=l.sent(),l.label=2;case 2:if(!r||null===(n=(0,f.readVarIntSize)(r))||n<1||n>8||(0,f.readUnsignedInt)(r,n)!==f.EBMLId.EBML||null===(a=(0,f.readElementSize)(r)))return[2,!1];if(!((i=e._reader.requestSlice(r.filePos,a))instanceof Promise))return[3,4];return[4,i];case 3:i=l.sent(),l.label=4;case 4:if(!i)return[2,!1];for(s=r.filePos;i.filePos<=s+a-f.MIN_HEADER_SIZE&&(o=(0,f.readElementHeader)(i));){if(c=o.id,u=o.size,d=i.filePos,null===u)return[2,!1];switch(c){case f.EBMLId.EBMLVersion:case f.EBMLId.EBMLReadVersion:if(1!==(0,f.readUnsignedInt)(i,u))return[2,!1];break;case f.EBMLId.DocType:if((0,f.readAsciiString)(i,u)!==t)return[2,!1];break;case f.EBMLId.DocTypeVersion:if((0,f.readUnsignedInt)(i,u)>4)return[2,!1]}i.filePos=d+u}return[2,!0]}})})()}},{key:"_canReadInput",value:function(e){return this.isSupportedEBMLOfDocType(e,"matroska")}},{key:"_createDemuxer",value:function(e){return new(0,h.MatroskaDemuxer)(e)}},{key:"name",get:function(){return"Matroska"}},{key:"mimeType",get:function(){return"video/x-matroska"}}]),t}(T),P=function(e){"use strict";function t(){return(0,o._)(this,t),(0,s._)(this,t,arguments)}return(0,u._)(t,e),(0,c._)(t,[{key:"_canReadInput",value:function(e){return this.isSupportedEBMLOfDocType(e,"webm")}},{key:"name",get:function(){return"WebM"}},{key:"mimeType",get:function(){return"video/webm"}}]),t}(j),C=function(e){"use strict";function t(){return(0,o._)(this,t),(0,s._)(this,t,arguments)}return(0,u._)(t,e),(0,c._)(t,[{key:"_canReadInput",value:function(e){return(0,i._)(function(){var t,r,n,a,i,s,o,c,u;return(0,l._)(this,function(l){switch(l.label){case 0:if(!((t=e._reader.requestSlice(0,10))instanceof Promise))return[3,2];return[4,t];case 1:t=l.sent(),l.label=2;case 2:if(!t)return[2,!1];r=0,n=!1,l.label=3;case 3:if(!((a=e._reader.requestSlice(r,g.ID3_V2_HEADER_SIZE))instanceof Promise))return[3,5];return[4,a];case 4:a=l.sent(),l.label=5;case 5:if(!a||!(i=(0,g.readId3V2Header)(a)))return[3,6];return n=!0,r=a.filePos+i.size,[3,3];case 6:return[4,(0,v.readNextFrameHeader)(e._reader,r,r+4096)];case 7:if(!(s=l.sent()))return[2,!1];if(n)return[2,!0];return r=s.startPos+s.header.totalSize,[4,(0,v.readNextFrameHeader)(e._reader,r,r+p.FRAME_HEADER_SIZE)];case 8:if(!(o=l.sent())||(c=s.header,u=o.header,c.channel!==u.channel||c.sampleRate!==u.sampleRate))return[2,!1];return[2,!0]}})})()}},{key:"_createDemuxer",value:function(e){return new(0,m.Mp3Demuxer)(e)}},{key:"name",get:function(){return"MP3"}},{key:"mimeType",get:function(){return"audio/mpeg"}}]),t}(T),A=function(e){"use strict";function t(){return(0,o._)(this,t),(0,s._)(this,t,arguments)}return(0,u._)(t,e),(0,c._)(t,[{key:"_canReadInput",value:function(e){return(0,i._)(function(){var t,r;return(0,l._)(this,function(n){switch(n.label){case 0:if(!((t=e._reader.requestSlice(0,12))instanceof Promise))return[3,2];return[4,t];case 1:t=n.sent(),n.label=2;case 2:if(!t||"RIFF"!==(r=(0,w.readAscii)(t,4))&&"RIFX"!==r&&"RF64"!==r)return[2,!1];return t.skip(4),[2,"WAVE"===(0,w.readAscii)(t,4)]}})})()}},{key:"_createDemuxer",value:function(e){return new(0,y.WaveDemuxer)(e)}},{key:"name",get:function(){return"WAVE"}},{key:"mimeType",get:function(){return"audio/wav"}}]),t}(T),B=function(e){"use strict";function t(){return(0,o._)(this,t),(0,s._)(this,t,arguments)}return(0,u._)(t,e),(0,c._)(t,[{key:"_canReadInput",value:function(e){return(0,i._)(function(){var t;return(0,l._)(this,function(r){switch(r.label){case 0:if(!((t=e._reader.requestSlice(0,4))instanceof Promise))return[3,2];return[4,t];case 1:t=r.sent(),r.label=2;case 2:if(!t)return[2,!1];return[2,"OggS"===(0,w.readAscii)(t,4)]}})})()}},{key:"_createDemuxer",value:function(e){return new(0,b.OggDemuxer)(e)}},{key:"name",get:function(){return"Ogg"}},{key:"mimeType",get:function(){return"application/ogg"}}]),t}(T),M=function(e){"use strict";function t(){return(0,o._)(this,t),(0,s._)(this,t,arguments)}return(0,u._)(t,e),(0,c._)(t,[{key:"_canReadInput",value:function(e){return(0,i._)(function(){var t;return(0,l._)(this,function(r){switch(r.label){case 0:if(!((t=e._reader.requestSlice(0,4))instanceof Promise))return[3,2];return[4,t];case 1:t=r.sent(),r.label=2;case 2:if(!t)return[2,!1];return[2,"fLaC"===(0,w.readAscii)(t,4)]}})})()}},{key:"name",get:function(){return"FLAC"}},{key:"mimeType",get:function(){return"audio/flac"}},{key:"_createDemuxer",value:function(e){return new(0,S.FlacDemuxer)(e)}}]),t}(T),D=function(e){"use strict";function t(){return(0,o._)(this,t),(0,s._)(this,t,arguments)}return(0,u._)(t,e),(0,c._)(t,[{key:"_canReadInput",value:function(e){return(0,i._)(function(){var t,r,n;return(0,l._)(this,function(a){switch(a.label){case 0:if(!((t=e._reader.requestSliceRange(0,k.MIN_FRAME_HEADER_SIZE,k.MAX_FRAME_HEADER_SIZE))instanceof Promise))return[3,2];return[4,t];case 1:t=a.sent(),a.label=2;case 2:if(!t||!(r=(0,k.readFrameHeader)(t)))return[2,!1];if(!((t=e._reader.requestSliceRange(r.frameLength,k.MIN_FRAME_HEADER_SIZE,k.MAX_FRAME_HEADER_SIZE))instanceof Promise))return[3,4];return[4,t];case 3:t=a.sent(),a.label=4;case 4:if(!t||!(n=(0,k.readFrameHeader)(t)))return[2,!1];return[2,r.objectType===n.objectType&&r.samplingFrequencyIndex===n.samplingFrequencyIndex&&r.channelConfiguration===n.channelConfiguration]}})})()}},{key:"_createDemuxer",value:function(e){return new(0,_.AdtsDemuxer)(e)}},{key:"name",get:function(){return"ADTS"}},{key:"mimeType",get:function(){return"audio/aac"}}]),t}(T),F=new I,R=new E,U=new j,O=new P,N=new C,L=new A,z=new B,V=new D,H=new M,G=[F,R,U,O,L,z,H,N,V]},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","./isobmff/isobmff-demuxer.js":"1Dw1A","./matroska/ebml.js":"fq2QE","./matroska/matroska-demuxer.js":"kY1ME","./mp3/mp3-demuxer.js":"ifShX","../shared/mp3-misc.js":"gcure","./id3.js":"42Y2c","./mp3/mp3-reader.js":"gFWvE","./ogg/ogg-demuxer.js":"hRJRs","./wave/wave-demuxer.js":"cokSU","./adts/adts-reader.js":"5AUBv","./adts/adts-demuxer.js":"3t0bF","./reader.js":"8KRfO","./flac/flac-demuxer.js":"e0w8C","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],clpdF:[function(e,t,r,n){"use strict";var a=e("feddc910f69a01a6"),i=e("b644f6b72647b399"),s=e("ba991daace2b8ed9");r._=function(e,t,r){return t=a._(t),s._(e,i._()?Reflect.construct(t,r||[],a._(e).constructor):t.apply(e,r))}},{feddc910f69a01a6:"NOGHw",b644f6b72647b399:"83nDe",ba991daace2b8ed9:"hd12h"}],NOGHw:[function(e,t,r,n){"use strict";function a(e){return r._=a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}r._=a},{}],"83nDe":[function(e,t,r,n){"use strict";function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(r._=a=function(){return!!e})()}r._=a},{}],hd12h:[function(e,t,r,n){"use strict";var a=e("f7151fe13994d2aa"),i=e("f18e81760bb14899");r._=function(e,t){return t&&("object"===i._(t)||"function"==typeof t)?t:a._(e)}},{f7151fe13994d2aa:"1tlYe",f18e81760bb14899:"iXhRw"}],"1tlYe":[function(e,t,r,n){"use strict";r._=function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},{}],jtSwf:[function(e,t,r,n){"use strict";var a=e("b9db138b859a042c");r._=function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a._(e,t)}},{b9db138b859a042c:"7ubVA"}],"7ubVA":[function(e,t,r,n){"use strict";function a(e,t){return r._=a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}r._=a},{}],"1Dw1A":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"IsobmffDemuxer",function(){return T});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_call_super.cjs"),o=e("@swc/helpers/cjs/_class_call_check.cjs"),c=e("@swc/helpers/cjs/_create_class.cjs"),u=e("@swc/helpers/cjs/_inherits.cjs"),l=e("@swc/helpers/cjs/_object_spread.cjs"),d=e("@swc/helpers/cjs/_sliced_to_array.cjs"),f=e("@swc/helpers/cjs/_to_consumable_array.cjs"),h=e("@swc/helpers/cjs/_ts_generator.cjs"),m=e("../codec.js"),p=e("../codec-data.js"),g=e("../demuxer.js"),v=e("../input-track.js"),b=e("../misc.js"),y=e("../packet.js"),k=e("./isobmff-misc.js"),_=e("./isobmff-reader.js"),w=e("../reader.js"),S=e("../metadata.js"),T=function(e){"use strict";function t(e){var r;return(0,o._)(this,t),(r=(0,s._)(this,t,[e])).moovSlice=null,r.currentTrack=null,r.tracks=[],r.metadataPromise=null,r.movieTimescale=-1,r.movieDurationInTimescale=-1,r.isQuickTime=!1,r.metadataTags={},r.currentMetadataKeys=null,r.isFragmented=!1,r.fragmentTrackDefaults=[],r.currentFragment=null,r.lastReadFragment=null,r.reader=e._reader,r}return(0,u._)(t,e),(0,c._)(t,[{key:"computeDuration",value:function(){return(0,i._)(function(){var e,t;return(0,h._)(this,function(r){switch(r.label){case 0:return[4,this.getTracks()];case 1:return[4,Promise.all(r.sent().map(function(e){return e.computeDuration()}))];case 2:return t=r.sent(),[2,(e=Math).max.apply(e,[0].concat((0,f._)(t)))]}})}).call(this)}},{key:"getTracks",value:function(){return(0,i._)(function(){return(0,h._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),[2,this.tracks.map(function(e){return e.inputTrack})]}})}).call(this)}},{key:"getMimeType",value:function(){return(0,i._)(function(){var e;return(0,h._)(this,function(t){switch(t.label){case 0:return[4,this.readMetadata()];case 1:return t.sent(),[4,Promise.all(this.tracks.map(function(e){return e.inputTrack.getCodecParameterString()}))];case 2:return e=t.sent(),[2,(0,k.buildIsobmffMimeType)({isQuickTime:this.isQuickTime,hasVideo:this.tracks.some(function(e){var t;return(null==(t=e.info)?void 0:t.type)==="video"}),hasAudio:this.tracks.some(function(e){var t;return(null==(t=e.info)?void 0:t.type)==="audio"}),codecStrings:e.filter(Boolean)})]}})}).call(this)}},{key:"getMetadataTags",value:function(){return(0,i._)(function(){return(0,h._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),[2,this.metadataTags]}})}).call(this)}},{key:"readMetadata",value:function(){var e;return null!=(e=this.metadataPromise)?e:this.metadataPromise=(0,i._)(function(){var e,t,r,n,a,i,s,o,c,u,l,d,f,m,p,g,v,y,k;return(0,h._)(this,function(h){switch(h.label){case 0:e=0,h.label=1;case 1:if(!((t=this.reader.requestSliceRange(e,_.MIN_BOX_HEADER_SIZE,_.MAX_BOX_HEADER_SIZE))instanceof Promise))return[3,3];return[4,t];case 2:t=h.sent(),h.label=3;case 3:if(!t||(r=e,!(n=(0,_.readBoxHeader)(t))))return[3,8];if("ftyp"!==n.name)return[3,4];return a=(0,w.readAscii)(t,4),this.isQuickTime="qt "===a,[3,7];case 4:if("moov"!==n.name)return[3,7];if(!((i=this.reader.requestSlice(t.filePos,n.contentSize))instanceof Promise))return[3,6];return[4,i];case 5:i=h.sent(),h.label=6;case 6:if(!i)return[3,8];this.moovSlice=i,this.readContiguousBoxes(this.moovSlice),this.tracks.sort(function(e,t){return Number(t.disposition.default)-Number(e.disposition.default)}),s=!0,o=!1,c=void 0;try{for(u=this.tracks[Symbol.iterator]();!(s=(l=u.next()).done);s=!0)f=(d=l.value).editListPreviousSegmentDurations/this.movieTimescale,d.editListOffset-=Math.round(f*d.timescale)}catch(e){o=!0,c=e}finally{try{s||null==u.return||u.return()}finally{if(o)throw c}}return[3,8];case 7:return e=r+n.totalSize,[3,1];case 8:if(!(this.isFragmented&&null!==this.reader.fileSize))return[3,15];if(!((m=this.reader.requestSlice(this.reader.fileSize-4,4))instanceof Promise))return[3,10];return[4,m];case 9:m=h.sent(),h.label=10;case 10:if((0,b.assert)(m),p=(0,w.readU32Be)(m),!((g=this.reader.fileSize-p)>=0&&g<=this.reader.fileSize-_.MAX_BOX_HEADER_SIZE))return[3,15];if(!((v=this.reader.requestSliceRange(g,_.MIN_BOX_HEADER_SIZE,_.MAX_BOX_HEADER_SIZE))instanceof Promise))return[3,12];return[4,v];case 11:v=h.sent(),h.label=12;case 12:if(!v||!((y=(0,_.readBoxHeader)(v))&&"mfra"===y.name))return[3,15];if(!((k=this.reader.requestSlice(v.filePos,y.contentSize))instanceof Promise))return[3,14];return[4,k];case 13:k=h.sent(),h.label=14;case 14:k&&this.readContiguousBoxes(k),h.label=15;case 15:return[2]}})}).call(this)}},{key:"getSampleTableForTrack",value:function(e){if(e.sampleTable)return e.sampleTable;var t={sampleTimingEntries:[],sampleCompositionTimeOffsets:[],sampleSizes:[],keySampleIndices:null,chunkOffsets:[],sampleToChunk:[],presentationTimestamps:null,presentationTimestampIndexMap:null};e.sampleTable=t,(0,b.assert)(this.moovSlice);var r=this.moovSlice.slice(e.sampleTableByteOffset);if(this.currentTrack=e,this.traverseBox(r),this.currentTrack=null,(null==(n=e.info)?void 0:n.type)==="audio"&&e.info.codec&&m.PCM_AUDIO_CODECS.includes(e.info.codec)&&0===t.sampleCompositionTimeOffsets.length){(0,b.assert)((null==(a=e.info)?void 0:a.type)==="audio");for(var n,a,i=(0,m.parsePcmCodec)(e.info.codec),s=[],o=[],c=0;c<t.sampleToChunk.length;c++){for(var u=t.sampleToChunk[c],l=t.sampleToChunk[c+1],d=(l?l.startChunkIndex:t.chunkOffsets.length)-u.startChunkIndex,f=0;f<d;f++){var h=u.startSampleIndex+f*u.samplesPerChunk,p=h+u.samplesPerChunk,g=(0,b.binarySearchLessOrEqual)(t.sampleTimingEntries,h,function(e){return e.startIndex}),v=t.sampleTimingEntries[g],y=(0,b.binarySearchLessOrEqual)(t.sampleTimingEntries,p,function(e){return e.startIndex}),k=t.sampleTimingEntries[y],_=v.startDecodeTimestamp+(h-v.startIndex)*v.delta,w=k.startDecodeTimestamp+(p-k.startIndex)*k.delta-_,S=(0,b.last)(s);S&&S.delta===w?S.count++:s.push({startIndex:u.startChunkIndex+f,startDecodeTimestamp:_,count:1,delta:w});var T=u.samplesPerChunk*i.sampleSize*e.info.numberOfChannels;o.push(T)}u.startSampleIndex=u.startChunkIndex,u.samplesPerChunk=1}t.sampleTimingEntries=s,t.sampleSizes=o}if(t.sampleCompositionTimeOffsets.length>0){t.presentationTimestamps=[];var x=!0,I=!1,E=void 0;try{for(var j,P=t.sampleTimingEntries[Symbol.iterator]();!(x=(j=P.next()).done);x=!0)for(var C=j.value,A=0;A<C.count;A++)t.presentationTimestamps.push({presentationTimestamp:C.startDecodeTimestamp+A*C.delta,sampleIndex:C.startIndex+A})}catch(e){I=!0,E=e}finally{try{x||null==P.return||P.return()}finally{if(I)throw E}}var B=!0,M=!1,D=void 0;try{for(var F,R=t.sampleCompositionTimeOffsets[Symbol.iterator]();!(B=(F=R.next()).done);B=!0)for(var U=F.value,O=0;O<U.count;O++){var N=U.startIndex+O,L=t.presentationTimestamps[N];L&&(L.presentationTimestamp+=U.offset)}}catch(e){M=!0,D=e}finally{try{B||null==R.return||R.return()}finally{if(M)throw D}}t.presentationTimestamps.sort(function(e,t){return e.presentationTimestamp-t.presentationTimestamp}),t.presentationTimestampIndexMap=Array(t.presentationTimestamps.length).fill(-1);for(var z=0;z<t.presentationTimestamps.length;z++)t.presentationTimestampIndexMap[t.presentationTimestamps[z].sampleIndex]=z}return t}},{key:"readFragment",value:function(e){return(0,i._)(function(){var t,r,n,a,i,s,o,c,u,l,f,m,p,g,v,y,k;return(0,h._)(this,function(h){switch(h.label){case 0:if((null==(t=this.lastReadFragment)?void 0:t.moofOffset)===e)return[2,this.lastReadFragment];if(!((r=this.reader.requestSliceRange(e,_.MIN_BOX_HEADER_SIZE,_.MAX_BOX_HEADER_SIZE))instanceof Promise))return[3,2];return[4,r];case 1:r=h.sent(),h.label=2;case 2:if((0,b.assert)(r),n=(0,_.readBoxHeader)(r),(0,b.assert)((null==n?void 0:n.name)==="moof"),!((a=this.reader.requestSlice(e,n.totalSize))instanceof Promise))return[3,4];return[4,a];case 3:a=h.sent(),h.label=4;case 4:(0,b.assert)(a),this.traverseBox(a),i=this.lastReadFragment,(0,b.assert)(i&&i.moofOffset===e),s=!0,o=!1,c=void 0;try{for(u=i.trackData[Symbol.iterator]();!(s=(l=u.next()).done);s=!0)p=(m=(f=(0,d._)(l.value,2)[1]).track).fragmentPositionCache,f.startTimestampIsFinal||((g=m.fragmentLookupTable.find(function(e){return e.moofOffset===i.moofOffset}))?B(f,g.timestamp):(v=(0,b.binarySearchLessOrEqual)(p,i.moofOffset-1,function(e){return e.moofOffset}),-1!==v&&(y=p[v],B(f,y.endTimestamp))),f.startTimestampIsFinal=!0),k=(0,b.binarySearchLessOrEqual)(p,f.startTimestamp,function(e){return e.startTimestamp}),(-1===k||p[k].moofOffset!==i.moofOffset)&&p.splice(k+1,0,{moofOffset:i.moofOffset,startTimestamp:f.startTimestamp,endTimestamp:f.endTimestamp})}catch(e){o=!0,c=e}finally{try{s||null==u.return||u.return()}finally{if(o)throw c}}return[2,i]}})}).call(this)}},{key:"readContiguousBoxes",value:function(e){for(var t=e.filePos;e.filePos-t<=e.length-_.MIN_BOX_HEADER_SIZE&&this.traverseBox(e););}},{key:"iterateContiguousBoxes",value:function(e){var t,r,n;return(0,h._)(this,function(a){switch(a.label){case 0:t=e.filePos,a.label=1;case 1:if(!(e.filePos-t<=e.length-_.MIN_BOX_HEADER_SIZE)||(r=e.filePos,!(n=(0,_.readBoxHeader)(e))))return[3,3];return[4,{boxInfo:n,slice:e}];case 2:return a.sent(),e.filePos=r+n.totalSize,[3,1];case 3:return[2]}})}},{key:"traverseBox",value:function(e){var t=e.filePos,r=(0,_.readBoxHeader)(e);if(!r)return!1;var n=e.filePos,a=t+r.totalSize;switch(r.name){case"mdia":case"minf":case"dinf":case"mfra":case"edts":case"wave":this.readContiguousBoxes(e.slice(n,r.contentSize));break;case"mvhd":var i=(0,w.readU8)(e);e.skip(3),1===i?(e.skip(16),this.movieTimescale=(0,w.readU32Be)(e),this.movieDurationInTimescale=(0,w.readU64Be)(e)):(e.skip(8),this.movieTimescale=(0,w.readU32Be)(e),this.movieDurationInTimescale=(0,w.readU32Be)(e));break;case"trak":var s={id:-1,demuxer:this,inputTrack:null,disposition:(0,l._)({},S.DEFAULT_TRACK_DISPOSITION),info:null,timescale:-1,durationInMovieTimescale:-1,durationInMediaTimescale:-1,rotation:0,internalCodecId:null,name:null,languageCode:b.UNDETERMINED_LANGUAGE,sampleTableByteOffset:-1,sampleTable:null,fragmentLookupTable:[],currentFragmentState:null,fragmentPositionCache:[],editListPreviousSegmentDurations:0,editListOffset:0};this.currentTrack=s,this.readContiguousBoxes(e.slice(n,r.contentSize)),-1!==s.id&&-1!==s.timescale&&null!==s.info&&("video"===s.info.type&&-1!==s.info.width?(s.inputTrack=new(0,v.InputVideoTrack)(this.input,new I(s)),this.tracks.push(s)):"audio"===s.info.type&&-1!==s.info.numberOfChannels&&(s.inputTrack=new(0,v.InputAudioTrack)(this.input,new E(s)),this.tracks.push(s))),this.currentTrack=null;break;case"tkhd":var o=this.currentTrack;if(!o)break;var c=(0,w.readU8)(e),u=(0,w.readU24Be)(e);if(o.disposition.default=!!(1&u),0===c)e.skip(8),o.id=(0,w.readU32Be)(e),e.skip(4),o.durationInMovieTimescale=(0,w.readU32Be)(e);else if(1===c)e.skip(16),o.id=(0,w.readU32Be)(e),e.skip(4),o.durationInMovieTimescale=(0,w.readU64Be)(e);else throw Error("Incorrect track header version ".concat(c,"."));e.skip(16);var d=[(0,_.readFixed_16_16)(e),(0,_.readFixed_16_16)(e),(0,_.readFixed_2_30)(e),(0,_.readFixed_16_16)(e),(0,_.readFixed_16_16)(e),(0,_.readFixed_2_30)(e),(0,_.readFixed_16_16)(e),(0,_.readFixed_16_16)(e),(0,_.readFixed_2_30)(e)],f=(0,b.normalizeRotation)((0,b.roundToMultiple)(M(d),90));(0,b.assert)(0===f||90===f||180===f||270===f),o.rotation=f;break;case"elst":var h=this.currentTrack;if(!h)break;var g=(0,w.readU8)(e);e.skip(3);for(var y=!1,k=0,T=(0,w.readU32Be)(e),x=0;x<T;x++){var j=1===g?(0,w.readU64Be)(e):(0,w.readU32Be)(e),P=1===g?(0,w.readI64Be)(e):(0,w.readI32Be)(e),C=(0,_.readFixed_16_16)(e);if(0!==j){if(y){console.warn("Unsupported edit list: multiple edits are not currently supported. Only using first edit.");break}if(-1===P){k+=j;continue}if(1!==C){console.warn("Unsupported edit list entry: media rate must be 1.");break}h.editListPreviousSegmentDurations=k,h.editListOffset=P,y=!0}}break;case"mdhd":var A=this.currentTrack;if(!A)break;var D=(0,w.readU8)(e);e.skip(3),0===D?(e.skip(8),A.timescale=(0,w.readU32Be)(e),A.durationInMediaTimescale=(0,w.readU32Be)(e)):1===D&&(e.skip(16),A.timescale=(0,w.readU32Be)(e),A.durationInMediaTimescale=(0,w.readU64Be)(e));var F=(0,w.readU16Be)(e);if(F>0){A.languageCode="";for(var R=0;R<3;R++)A.languageCode=String.fromCharCode(96+(31&F))+A.languageCode,F>>=5;(0,b.isIso639Dash2LanguageCode)(A.languageCode)||(A.languageCode=b.UNDETERMINED_LANGUAGE)}break;case"hdlr":var U=this.currentTrack;if(!U)break;e.skip(8);var O=(0,w.readAscii)(e,4);"vide"===O?U.info={type:"video",width:-1,height:-1,codec:null,codecDescription:null,colorSpace:null,avcType:null,avcCodecInfo:null,hevcCodecInfo:null,vp9CodecInfo:null,av1CodecInfo:null}:"soun"===O&&(U.info={type:"audio",numberOfChannels:-1,sampleRate:-1,codec:null,codecDescription:null,aacCodecInfo:null});break;case"stbl":var N=this.currentTrack;if(!N)break;N.sampleTableByteOffset=t,this.readContiguousBoxes(e.slice(n,r.contentSize));break;case"stsd":var L=this.currentTrack;if(!L||null===L.info||L.sampleTable)break;var z=(0,w.readU8)(e);e.skip(3);for(var V=(0,w.readU32Be)(e),H=0;H<V;H++){var G=e.filePos,q=(0,_.readBoxHeader)(e);if(!q)break;L.internalCodecId=q.name;var W=q.name.toLowerCase();if("video"===L.info.type)"avc1"===W||"avc3"===W?(L.info.codec="avc",L.info.avcType="avc1"===W?1:3):"hvc1"===W||"hev1"===W?L.info.codec="hevc":"vp08"===W?L.info.codec="vp8":"vp09"===W?L.info.codec="vp9":"av01"===W?L.info.codec="av1":console.warn("Unsupported video codec (sample entry type '".concat(q.name,"').")),e.skip(24),L.info.width=(0,w.readU16Be)(e),L.info.height=(0,w.readU16Be)(e),e.skip(50),this.readContiguousBoxes(e.slice(e.filePos,G+q.totalSize-e.filePos));else{"mp4a"===W||("opus"===W?L.info.codec="opus":"flac"===W?L.info.codec="flac":"twos"===W||"sowt"===W||"raw "===W||"in24"===W||"in32"===W||"fl32"===W||"fl64"===W||"lpcm"===W||"ipcm"===W||"fpcm"===W||("ulaw"===W?L.info.codec="ulaw":"alaw"===W?L.info.codec="alaw":console.warn("Unsupported audio codec (sample entry type '".concat(q.name,"').")))),e.skip(8);var K=(0,w.readU16Be)(e);e.skip(6);var X=(0,w.readU16Be)(e),Q=(0,w.readU16Be)(e);e.skip(4);var Z=(0,w.readU32Be)(e)/65536;if(0===z&&K>0){if(1===K)e.skip(4),Q=8*(0,w.readU32Be)(e),e.skip(8);else if(2===K){e.skip(4),Z=(0,w.readF64Be)(e),X=(0,w.readU32Be)(e),e.skip(4),Q=(0,w.readU32Be)(e);var Y=(0,w.readU32Be)(e);if(e.skip(8),"lpcm"===W){var J=Q+7>>3,$=!!(1&Y),ee=!!(2&Y),et=4&Y?-1:0;Q>0&&Q<=64&&($?32===Q&&(L.info.codec=ee?"pcm-f32be":"pcm-f32"):et&1<<J-1?1===J?L.info.codec="pcm-s8":2===J?L.info.codec=ee?"pcm-s16be":"pcm-s16":3===J?L.info.codec=ee?"pcm-s24be":"pcm-s24":4===J&&(L.info.codec=ee?"pcm-s32be":"pcm-s32"):1===J&&(L.info.codec="pcm-u8")),null===L.info.codec&&console.warn("Unsupported PCM format.")}}}"opus"===L.info.codec&&(Z=m.OPUS_SAMPLE_RATE),L.info.numberOfChannels=X,L.info.sampleRate=Z,"twos"===W?8===Q?L.info.codec="pcm-s8":16===Q?L.info.codec="pcm-s16be":(console.warn("Unsupported sample size ".concat(Q," for codec 'twos'.")),L.info.codec=null):"sowt"===W?8===Q?L.info.codec="pcm-s8":16===Q?L.info.codec="pcm-s16":(console.warn("Unsupported sample size ".concat(Q," for codec 'sowt'.")),L.info.codec=null):"raw "===W?L.info.codec="pcm-u8":"in24"===W?L.info.codec="pcm-s24be":"in32"===W?L.info.codec="pcm-s32be":"fl32"===W?L.info.codec="pcm-f32be":"fl64"===W?L.info.codec="pcm-f64be":"ipcm"===W?L.info.codec="pcm-s16be":"fpcm"===W&&(L.info.codec="pcm-f32be"),this.readContiguousBoxes(e.slice(e.filePos,G+q.totalSize-e.filePos))}}break;case"avcC":var er=this.currentTrack;if(!er)break;(0,b.assert)(er.info),er.info.codecDescription=(0,w.readBytes)(e,r.contentSize);break;case"hvcC":var en=this.currentTrack;if(!en)break;(0,b.assert)(en.info),en.info.codecDescription=(0,w.readBytes)(e,r.contentSize);break;case"vpcC":var ea,ei=this.currentTrack;if(!ei)break;(0,b.assert)((null==(ea=ei.info)?void 0:ea.type)==="video"),e.skip(4);var es=(0,w.readU8)(e),eo=(0,w.readU8)(e),ec=(0,w.readU8)(e),eu=(0,w.readU8)(e),el=(0,w.readU8)(e),ed=(0,w.readU8)(e);ei.info.vp9CodecInfo={profile:es,level:eo,bitDepth:ec>>4,chromaSubsampling:ec>>1&7,videoFullRangeFlag:1&ec,colourPrimaries:eu,transferCharacteristics:el,matrixCoefficients:ed};break;case"av1C":var ef,eh=this.currentTrack;if(!eh)break;(0,b.assert)((null==(ef=eh.info)?void 0:ef.type)==="video"),e.skip(1);var em=(0,w.readU8)(e),ep=em>>5,eg=(0,w.readU8)(e),ev=eg>>6&1;eh.info.av1CodecInfo={profile:ep,level:31&em,tier:eg>>7,bitDepth:2===ep&&ev?eg>>5&1?12:10:ev?10:8,monochrome:eg>>4&1,chromaSubsamplingX:eg>>3&1,chromaSubsamplingY:eg>>2&1,chromaSamplePosition:3&eg};break;case"colr":var eb,ey=this.currentTrack;if(!ey||((0,b.assert)((null==(eb=ey.info)?void 0:eb.type)==="video"),"nclx"!==(0,w.readAscii)(e,4)))break;var ek=(0,w.readU16Be)(e),e_=(0,w.readU16Be)(e),ew=(0,w.readU16Be)(e),eS=!!(128&(0,w.readU8)(e));ey.info.colorSpace={primaries:b.COLOR_PRIMARIES_MAP_INVERSE[ek],transfer:b.TRANSFER_CHARACTERISTICS_MAP_INVERSE[e_],matrix:b.MATRIX_COEFFICIENTS_MAP_INVERSE[ew],fullRange:eS};break;case"esds":var eT,ex=this.currentTrack;if(!ex)break;(0,b.assert)((null==(eT=ex.info)?void 0:eT.type)==="audio"),e.skip(4);var eI=(0,w.readU8)(e);(0,b.assert)(3===eI),(0,_.readIsomVariableInteger)(e),e.skip(2);var eE=(0,w.readU8)(e);if((128&eE)!=0&&e.skip(2),(64&eE)!=0){var ej=(0,w.readU8)(e);e.skip(ej)}(32&eE)!=0&&e.skip(2);var eP=(0,w.readU8)(e);(0,b.assert)(4===eP);var eC=(0,_.readIsomVariableInteger)(e),eA=e.filePos,eB=(0,w.readU8)(e);if(64===eB||103===eB?(ex.info.codec="aac",ex.info.aacCodecInfo={isMpeg2:103===eB}):105===eB||107===eB?ex.info.codec="mp3":221===eB?ex.info.codec="vorbis":console.warn("Unsupported audio codec (objectTypeIndication ".concat(eB,") - discarding track.")),e.skip(12),eC>e.filePos-eA){var eM=(0,w.readU8)(e);(0,b.assert)(5===eM);var eD=(0,_.readIsomVariableInteger)(e);if(ex.info.codecDescription=(0,w.readBytes)(e,eD),"aac"===ex.info.codec){var eF=(0,m.parseAacAudioSpecificConfig)(ex.info.codecDescription);null!==eF.numberOfChannels&&(ex.info.numberOfChannels=eF.numberOfChannels),null!==eF.sampleRate&&(ex.info.sampleRate=eF.sampleRate)}}break;case"enda":var eR,eU=this.currentTrack;if(!eU)break;(0,b.assert)((null==(eR=eU.info)?void 0:eR.type)==="audio"),255&(0,w.readU16Be)(e)&&("pcm-s16be"===eU.info.codec?eU.info.codec="pcm-s16":"pcm-s24be"===eU.info.codec?eU.info.codec="pcm-s24":"pcm-s32be"===eU.info.codec?eU.info.codec="pcm-s32":"pcm-f32be"===eU.info.codec?eU.info.codec="pcm-f32":"pcm-f64be"===eU.info.codec&&(eU.info.codec="pcm-f64"));break;case"pcmC":var eO,eN=this.currentTrack;if(!eN)break;(0,b.assert)((null==(eO=eN.info)?void 0:eO.type)==="audio"),e.skip(4);var eL=!!(1&(0,w.readU8)(e)),ez=(0,w.readU8)(e);"pcm-s16be"===eN.info.codec?eL?16===ez?eN.info.codec="pcm-s16":24===ez?eN.info.codec="pcm-s24":32===ez?eN.info.codec="pcm-s32":(console.warn("Invalid ipcm sample size ".concat(ez,".")),eN.info.codec=null):16===ez?eN.info.codec="pcm-s16be":24===ez?eN.info.codec="pcm-s24be":32===ez?eN.info.codec="pcm-s32be":(console.warn("Invalid ipcm sample size ".concat(ez,".")),eN.info.codec=null):"pcm-f32be"===eN.info.codec&&(eL?32===ez?eN.info.codec="pcm-f32":64===ez?eN.info.codec="pcm-f64":(console.warn("Invalid fpcm sample size ".concat(ez,".")),eN.info.codec=null):32===ez?eN.info.codec="pcm-f32be":64===ez?eN.info.codec="pcm-f64be":(console.warn("Invalid fpcm sample size ".concat(ez,".")),eN.info.codec=null));break;case"dOps":var eV,eH,eG=this.currentTrack;if(!eG)break;(0,b.assert)((null==(eV=eG.info)?void 0:eV.type)==="audio"),e.skip(1);var eq=(0,w.readU8)(e),eW=(0,w.readU16Be)(e),eK=(0,w.readU32Be)(e),eX=(0,w.readI16Be)(e),eQ=(0,w.readU8)(e);eH=0!==eQ?(0,w.readBytes)(e,2+eq):new Uint8Array(0);var eZ=new Uint8Array(19+eH.byteLength),eY=new DataView(eZ.buffer);eY.setUint32(0,0x4f707573,!1),eY.setUint32(4,0x48656164,!1),eY.setUint8(8,1),eY.setUint8(9,eq),eY.setUint16(10,eW,!0),eY.setUint32(12,eK,!0),eY.setInt16(16,eX,!0),eY.setUint8(18,eQ),eZ.set(eH,19),eG.info.codecDescription=eZ,eG.info.numberOfChannels=eq;break;case"dfLa":var eJ,e$=this.currentTrack;if(!e$)break;(0,b.assert)((null==(eJ=e$.info)?void 0:eJ.type)==="audio"),e.skip(4);for(var e0=e.filePos;e.filePos<a;){var e1=(0,w.readU8)(e),e2=(0,w.readU24Be)(e);if((127&e1)===p.FlacBlockType.STREAMINFO){e.skip(10);var e3=(0,w.readU32Be)(e),e4=e3>>>12,e8=(e3>>9&7)+1;e$.info.sampleRate=e4,e$.info.numberOfChannels=e8,e.skip(20)}else e.skip(e2);if(128&e1)break}var e6=e.filePos;e.filePos=e0;var e5=(0,w.readBytes)(e,e6-e0),e7=new Uint8Array(4+e5.byteLength);new DataView(e7.buffer).setUint32(0,0x664c6143,!1),e7.set(e5,4),e$.info.codecDescription=e7;break;case"stts":var e9=this.currentTrack;if(!e9||!e9.sampleTable)break;e.skip(4);for(var te=(0,w.readU32Be)(e),tt=0,tr=0,tn=0;tn<te;tn++){var ta=(0,w.readU32Be)(e),ti=(0,w.readU32Be)(e);e9.sampleTable.sampleTimingEntries.push({startIndex:tt,startDecodeTimestamp:tr,count:ta,delta:ti}),tt+=ta,tr+=ta*ti}break;case"ctts":var ts=this.currentTrack;if(!ts||!ts.sampleTable)break;e.skip(4);for(var to=(0,w.readU32Be)(e),tc=0,tu=0;tu<to;tu++){var tl=(0,w.readU32Be)(e),td=(0,w.readI32Be)(e);ts.sampleTable.sampleCompositionTimeOffsets.push({startIndex:tc,count:tl,offset:td}),tc+=tl}break;case"stsz":var tf=this.currentTrack;if(!tf||!tf.sampleTable)break;e.skip(4);var th=(0,w.readU32Be)(e),tm=(0,w.readU32Be)(e);if(0===th)for(var tp=0;tp<tm;tp++){var tg=(0,w.readU32Be)(e);tf.sampleTable.sampleSizes.push(tg)}else tf.sampleTable.sampleSizes.push(th);break;case"stz2":var tv=this.currentTrack;if(!tv||!tv.sampleTable)break;e.skip(4),e.skip(3);for(var tb=(0,w.readU8)(e),ty=(0,w.readU32Be)(e),tk=(0,w.readBytes)(e,Math.ceil(ty*tb/8)),t_=new(0,b.Bitstream)(tk),tw=0;tw<ty;tw++){var tS=t_.readBits(tb);tv.sampleTable.sampleSizes.push(tS)}break;case"stss":var tT=this.currentTrack;if(!tT||!tT.sampleTable)break;e.skip(4),tT.sampleTable.keySampleIndices=[];for(var tx=(0,w.readU32Be)(e),tI=0;tI<tx;tI++){var tE=(0,w.readU32Be)(e)-1;tT.sampleTable.keySampleIndices.push(tE)}0!==tT.sampleTable.keySampleIndices[0]&&tT.sampleTable.keySampleIndices.unshift(0);break;case"stsc":var tj=this.currentTrack;if(!tj||!tj.sampleTable)break;e.skip(4);for(var tP=(0,w.readU32Be)(e),tC=0;tC<tP;tC++){var tA=(0,w.readU32Be)(e)-1,tB=(0,w.readU32Be)(e),tM=(0,w.readU32Be)(e);tj.sampleTable.sampleToChunk.push({startSampleIndex:-1,startChunkIndex:tA,samplesPerChunk:tB,sampleDescriptionIndex:tM})}for(var tD=0,tF=0;tF<tj.sampleTable.sampleToChunk.length;tF++)tj.sampleTable.sampleToChunk[tF].startSampleIndex=tD,tF<tj.sampleTable.sampleToChunk.length-1&&(tD+=(tj.sampleTable.sampleToChunk[tF+1].startChunkIndex-tj.sampleTable.sampleToChunk[tF].startChunkIndex)*tj.sampleTable.sampleToChunk[tF].samplesPerChunk);break;case"stco":var tR=this.currentTrack;if(!tR||!tR.sampleTable)break;e.skip(4);for(var tU=(0,w.readU32Be)(e),tO=0;tO<tU;tO++){var tN=(0,w.readU32Be)(e);tR.sampleTable.chunkOffsets.push(tN)}break;case"co64":var tL=this.currentTrack;if(!tL||!tL.sampleTable)break;e.skip(4);for(var tz=(0,w.readU32Be)(e),tV=0;tV<tz;tV++){var tH=(0,w.readU64Be)(e);tL.sampleTable.chunkOffsets.push(tH)}break;case"mvex":this.isFragmented=!0,this.readContiguousBoxes(e.slice(n,r.contentSize));break;case"mehd":var tG=(0,w.readU8)(e);e.skip(3);var tq=1===tG?(0,w.readU64Be)(e):(0,w.readU32Be)(e);this.movieDurationInTimescale=tq;break;case"trex":e.skip(4);var tW=(0,w.readU32Be)(e),tK=(0,w.readU32Be)(e),tX=(0,w.readU32Be)(e),tQ=(0,w.readU32Be)(e),tZ=(0,w.readU32Be)(e);this.fragmentTrackDefaults.push({trackId:tW,defaultSampleDescriptionIndex:tK,defaultSampleDuration:tX,defaultSampleSize:tQ,defaultSampleFlags:tZ});break;case"tfra":var tY=(0,w.readU8)(e);e.skip(3);var tJ=(0,w.readU32Be)(e),t$=this.tracks.find(function(e){return e.id===tJ});if(!t$)break;for(var t0=(0,w.readU32Be)(e),t1=[w.readU8,w.readU16Be,w.readU24Be,w.readU32Be],t2=t1[(48&t0)>>4],t3=t1[(12&t0)>>2],t4=t1[3&t0],t8=(0,w.readU32Be)(e),t6=0;t6<t8;t6++){var t5=1===tY?(0,w.readU64Be)(e):(0,w.readU32Be)(e),t7=1===tY?(0,w.readU64Be)(e):(0,w.readU32Be)(e);t2(e),t3(e),t4(e),t$.fragmentLookupTable.push({timestamp:t5,moofOffset:t7})}t$.fragmentLookupTable.sort(function(e,t){return e.timestamp-t.timestamp});for(var t9=0;t9<t$.fragmentLookupTable.length-1;t9++){var re=t$.fragmentLookupTable[t9],rt=t$.fragmentLookupTable[t9+1];re.timestamp===rt.timestamp&&(t$.fragmentLookupTable.splice(t9+1,1),t9--)}break;case"moof":this.currentFragment={moofOffset:t,moofSize:r.totalSize,implicitBaseDataOffset:t,trackData:new Map},this.readContiguousBoxes(e.slice(n,r.contentSize)),this.lastReadFragment=this.currentFragment,this.currentFragment=null;break;case"traf":if((0,b.assert)(this.currentFragment),this.readContiguousBoxes(e.slice(n,r.contentSize)),this.currentTrack){var rr=this.currentFragment.trackData.get(this.currentTrack.id);if(rr){var rn=this.currentTrack.currentFragmentState;(0,b.assert)(rn),null!==rn.startTimestamp&&(B(rr,rn.startTimestamp),rr.startTimestampIsFinal=!0)}this.currentTrack.currentFragmentState=null,this.currentTrack=null}break;case"tfhd":(0,b.assert)(this.currentFragment),e.skip(1);var ra,ri,rs,ro,rc=(0,w.readU24Be)(e),ru=(0,w.readU32Be)(e),rl=this.tracks.find(function(e){return e.id===ru});if(!rl)break;var rd=this.fragmentTrackDefaults.find(function(e){return e.trackId===ru});this.currentTrack=rl,rl.currentFragmentState={baseDataOffset:this.currentFragment.implicitBaseDataOffset,sampleDescriptionIndex:null!=(ra=null==rd?void 0:rd.defaultSampleDescriptionIndex)?ra:null,defaultSampleDuration:null!=(ri=null==rd?void 0:rd.defaultSampleDuration)?ri:null,defaultSampleSize:null!=(rs=null==rd?void 0:rd.defaultSampleSize)?rs:null,defaultSampleFlags:null!=(ro=null==rd?void 0:rd.defaultSampleFlags)?ro:null,startTimestamp:null},1&rc?rl.currentFragmentState.baseDataOffset=(0,w.readU64Be)(e):131072&rc&&(rl.currentFragmentState.baseDataOffset=this.currentFragment.moofOffset),2&rc&&(rl.currentFragmentState.sampleDescriptionIndex=(0,w.readU32Be)(e)),8&rc&&(rl.currentFragmentState.defaultSampleDuration=(0,w.readU32Be)(e)),16&rc&&(rl.currentFragmentState.defaultSampleSize=(0,w.readU32Be)(e)),32&rc&&(rl.currentFragmentState.defaultSampleFlags=(0,w.readU32Be)(e)),65536&rc&&(rl.currentFragmentState.defaultSampleDuration=0);break;case"tfdt":var rf=this.currentTrack;if(!rf)break;(0,b.assert)(rf.currentFragmentState);var rh=(0,w.readU8)(e);e.skip(3);var rm=0===rh?(0,w.readU32Be)(e):(0,w.readU64Be)(e);rf.currentFragmentState.startTimestamp=rm;break;case"trun":var rp=this.currentTrack;if(!rp)break;if((0,b.assert)(this.currentFragment),(0,b.assert)(rp.currentFragmentState),this.currentFragment.trackData.has(rp.id)){console.warn("Can't have two trun boxes for the same track in one fragment. Ignoring...");break}var rg=(0,w.readU8)(e),rv=(0,w.readU24Be)(e),rb=!!(256&rv),ry=!!(512&rv),rk=!!(1024&rv),r_=!!(2048&rv),rw=(0,w.readU32Be)(e),rS=rp.currentFragmentState.baseDataOffset;1&rv&&(rS+=(0,w.readI32Be)(e));var rT=null;4&rv&&(rT=(0,w.readU32Be)(e));var rx=rS;if(0===rw){this.currentFragment.implicitBaseDataOffset=rx;break}var rI=0,rE={track:rp,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,samples:[],presentationTimestamps:[],startTimestampIsFinal:!1};this.currentFragment.trackData.set(rp.id,rE);for(var rj=0;rj<rw;rj++){var rP=void 0;rb?rP=(0,w.readU32Be)(e):((0,b.assert)(null!==rp.currentFragmentState.defaultSampleDuration),rP=rp.currentFragmentState.defaultSampleDuration);var rC=void 0;ry?rC=(0,w.readU32Be)(e):((0,b.assert)(null!==rp.currentFragmentState.defaultSampleSize),rC=rp.currentFragmentState.defaultSampleSize);var rA=void 0;rk?rA=(0,w.readU32Be)(e):((0,b.assert)(null!==rp.currentFragmentState.defaultSampleFlags),rA=rp.currentFragmentState.defaultSampleFlags),0===rj&&null!==rT&&(rA=rT);var rB=0;r_&&(rB=0===rg?(0,w.readU32Be)(e):(0,w.readI32Be)(e));var rM=!(65536&rA);rE.samples.push({presentationTimestamp:rI+rB,duration:rP,byteOffset:rx,byteSize:rC,isKeyFrame:rM}),rx+=rC,rI+=rP}rE.presentationTimestamps=rE.samples.map(function(e,t){return{presentationTimestamp:e.presentationTimestamp,sampleIndex:t}}).sort(function(e,t){return e.presentationTimestamp-t.presentationTimestamp});for(var rD=0;rD<rE.presentationTimestamps.length;rD++){var rF=rE.presentationTimestamps[rD],rR=rE.samples[rF.sampleIndex];null===rE.firstKeyFrameTimestamp&&rR.isKeyFrame&&(rE.firstKeyFrameTimestamp=rR.presentationTimestamp),rD<rE.presentationTimestamps.length-1&&(rR.duration=rE.presentationTimestamps[rD+1].presentationTimestamp-rF.presentationTimestamp)}var rU=rE.samples[rE.presentationTimestamps[0].sampleIndex],rO=rE.samples[(0,b.last)(rE.presentationTimestamps).sampleIndex];rE.startTimestamp=rU.presentationTimestamp,rE.endTimestamp=rO.presentationTimestamp+rO.duration,this.currentFragment.implicitBaseDataOffset=rx;break;case"udta":var rN=this.iterateContiguousBoxes(e.slice(n,r.contentSize)),rL=!0,rz=!1,rV=void 0;try{for(var rH,rG=rN[Symbol.iterator]();!(rL=(rH=rG.next()).done);rL=!0){var rq,rW,rK=rH.value,rX=rK.boxInfo,rQ=rK.slice;if("meta"!==rX.name&&!this.currentTrack){var rZ,rY,rJ,r$,r0,r1=rQ.filePos;null!=(rZ=this.metadataTags).raw||(rZ.raw={}),""===rX.name[0]?null!=(rY=this.metadataTags.raw)[rJ=rX.name]||(rY[rJ]=(0,_.readMetadataStringShort)(rQ)):null!=(r$=this.metadataTags.raw)[r0=rX.name]||(r$[r0]=(0,w.readBytes)(rQ,rX.contentSize)),rQ.filePos=r1}switch(rX.name){case"meta":rQ.skip(-rX.headerSize),this.traverseBox(rQ);break;case"nam":case"name":this.currentTrack?this.currentTrack.name=b.textDecoder.decode((0,w.readBytes)(rQ,rX.contentSize)):null!=(r2=this.metadataTags).title||(r2.title=(0,_.readMetadataStringShort)(rQ));break;case"des":this.currentTrack||null!=(r3=this.metadataTags).description||(r3.description=(0,_.readMetadataStringShort)(rQ));break;case"ART":this.currentTrack||null!=(r4=this.metadataTags).artist||(r4.artist=(0,_.readMetadataStringShort)(rQ));break;case"alb":this.currentTrack||null!=(r8=this.metadataTags).album||(r8.album=(0,_.readMetadataStringShort)(rQ));break;case"albr":this.currentTrack||null!=(r6=this.metadataTags).albumArtist||(r6.albumArtist=(0,_.readMetadataStringShort)(rQ));break;case"gen":this.currentTrack||null!=(r5=this.metadataTags).genre||(r5.genre=(0,_.readMetadataStringShort)(rQ));break;case"day":if(!this.currentTrack){var r2,r3,r4,r8,r6,r5,r7,r9=new Date((0,_.readMetadataStringShort)(rQ));Number.isNaN(r9.getTime())||null!=(r7=this.metadataTags).date||(r7.date=r9)}break;case"cmt":this.currentTrack||null!=(rq=this.metadataTags).comment||(rq.comment=(0,_.readMetadataStringShort)(rQ));break;case"lyr":this.currentTrack||null!=(rW=this.metadataTags).lyrics||(rW.lyrics=(0,_.readMetadataStringShort)(rQ))}}}catch(e){rz=!0,rV=e}finally{try{rL||null==rG.return||rG.return()}finally{if(rz)throw rV}}break;case"meta":if(this.currentTrack)break;var ne=(0,w.readU32Be)(e);this.currentMetadataKeys=new Map,0!==ne?this.readContiguousBoxes(e.slice(n,r.contentSize)):this.readContiguousBoxes(e.slice(n+4,r.contentSize-4)),this.currentMetadataKeys=null;break;case"keys":if(!this.currentMetadataKeys)break;e.skip(4);for(var nt=(0,w.readU32Be)(e),nr=0;nr<nt;nr++){var nn=(0,w.readU32Be)(e);e.skip(4);var na=b.textDecoder.decode((0,w.readBytes)(e,nn-8));this.currentMetadataKeys.set(nr+1,na)}break;case"ilst":if(!this.currentMetadataKeys)break;var ni=this.iterateContiguousBoxes(e.slice(n,r.contentSize)),ns=!0,no=!1,nc=void 0;try{for(var nu,nl=ni[Symbol.iterator]();!(ns=(nu=nl.next()).done);ns=!0){var nd=nu.value,nf=nd.boxInfo,nh=nd.slice,nm=nf.name,np=(nm.charCodeAt(0)<<24)+(nm.charCodeAt(1)<<16)+(nm.charCodeAt(2)<<8)+nm.charCodeAt(3);this.currentMetadataKeys.has(np)&&(nm=this.currentMetadataKeys.get(np));var ng=(0,_.readDataBox)(nh);switch(null!=(nv=this.metadataTags).raw||(nv.raw={}),null!=(nb=this.metadataTags.raw)[ny=nm]||(nb[ny]=ng),nm){case"nam":case"titl":case"com.apple.quicktime.title":case"title":"string"==typeof ng&&(null!=(nk=this.metadataTags).title||(nk.title=ng));break;case"des":case"desc":case"dscp":case"com.apple.quicktime.description":case"description":"string"==typeof ng&&(null!=(n_=this.metadataTags).description||(n_.description=ng));break;case"ART":case"com.apple.quicktime.artist":case"artist":"string"==typeof ng&&(null!=(nw=this.metadataTags).artist||(nw.artist=ng));break;case"alb":case"albm":case"com.apple.quicktime.album":case"album":"string"==typeof ng&&(null!=(nS=this.metadataTags).album||(nS.album=ng));break;case"aART":case"album_artist":"string"==typeof ng&&(null!=(nT=this.metadataTags).albumArtist||(nT.albumArtist=ng));break;case"cmt":case"com.apple.quicktime.comment":case"comment":"string"==typeof ng&&(null!=(nx=this.metadataTags).comment||(nx.comment=ng));break;case"gen":case"gnre":case"com.apple.quicktime.genre":case"genre":"string"==typeof ng&&(null!=(nI=this.metadataTags).genre||(nI.genre=ng));break;case"lyr":case"lyrics":"string"==typeof ng&&(null!=(nE=this.metadataTags).lyrics||(nE.lyrics=ng));break;case"day":case"rldt":case"com.apple.quicktime.creationdate":case"date":if("string"==typeof ng){var nv,nb,ny,nk,n_,nw,nS,nT,nx,nI,nE,nj,nP=new Date(ng);Number.isNaN(nP.getTime())||null!=(nj=this.metadataTags).date||(nj.date=nP)}break;case"covr":case"com.apple.quicktime.artwork":ng instanceof S.RichImageData?(null!=(nC=this.metadataTags).images||(nC.images=[]),this.metadataTags.images.push({data:ng.data,kind:"coverFront",mimeType:ng.mimeType})):ng instanceof Uint8Array&&(null!=(nA=this.metadataTags).images||(nA.images=[]),this.metadataTags.images.push({data:ng,kind:"coverFront",mimeType:"image/*"}));break;case"track":if("string"==typeof ng){var nC,nA,nB,nM,nD=ng.split("/"),nF=Number.parseInt(nD[0],10),nR=nD[1]&&Number.parseInt(nD[1],10);Number.isInteger(nF)&&nF>0&&(null!=(nB=this.metadataTags).trackNumber||(nB.trackNumber=nF)),nR&&Number.isInteger(nR)&&nR>0&&(null!=(nM=this.metadataTags).tracksTotal||(nM.tracksTotal=nR))}break;case"trkn":if(ng instanceof Uint8Array&&ng.length>=6){var nU,nO,nN=(0,b.toDataView)(ng),nL=nN.getUint16(2,!1),nz=nN.getUint16(4,!1);nL>0&&(null!=(nU=this.metadataTags).trackNumber||(nU.trackNumber=nL)),nz>0&&(null!=(nO=this.metadataTags).tracksTotal||(nO.tracksTotal=nz))}break;case"disc":case"disk":if(ng instanceof Uint8Array&&ng.length>=6){var nV,nH,nG=(0,b.toDataView)(ng),nq=nG.getUint16(2,!1),nW=nG.getUint16(4,!1);nq>0&&(null!=(nV=this.metadataTags).discNumber||(nV.discNumber=nq)),nW>0&&(null!=(nH=this.metadataTags).discsTotal||(nH.discsTotal=nW))}}}}catch(e){no=!0,nc=e}finally{try{ns||null==nl.return||nl.return()}finally{if(no)throw nc}}}return e.filePos=a,!0}}]),t}(g.Demuxer),x=function(){"use strict";function e(t){(0,o._)(this,e),this.internalTrack=t,this.packetToSampleIndex=new WeakMap,this.packetToFragmentLocation=new WeakMap}return(0,c._)(e,[{key:"getId",value:function(){return this.internalTrack.id}},{key:"getCodec",value:function(){throw Error("Not implemented on base class.")}},{key:"getInternalCodecId",value:function(){return this.internalTrack.internalCodecId}},{key:"getName",value:function(){return this.internalTrack.name}},{key:"getLanguageCode",value:function(){return this.internalTrack.languageCode}},{key:"getTimeResolution",value:function(){return this.internalTrack.timescale}},{key:"getDisposition",value:function(){return this.internalTrack.disposition}},{key:"computeDuration",value:function(){return(0,i._)(function(){var e,t,r;return(0,h._)(this,function(n){switch(n.label){case 0:return[4,this.getPacket(1/0,{metadataOnly:!0})];case 1:return[2,(null!=(t=null==(e=n.sent())?void 0:e.timestamp)?t:0)+(null!=(r=null==e?void 0:e.duration)?r:0)]}})}).call(this)}},{key:"getFirstTimestamp",value:function(){return(0,i._)(function(){var e,t;return(0,h._)(this,function(r){switch(r.label){case 0:return[4,this.getFirstPacket({metadataOnly:!0})];case 1:return[2,null!=(t=null==(e=r.sent())?void 0:e.timestamp)?t:0]}})}).call(this)}},{key:"getFirstPacket",value:function(e){return(0,i._)(function(){var t,r;return(0,h._)(this,function(n){switch(n.label){case 0:return t=this,[4,this.fetchPacketForSampleIndex(0,e)];case 1:if((r=n.sent())||!this.internalTrack.demuxer.isFragmented)return[2,r];return[2,this.performFragmentedLookup(null,function(e){return e.trackData.get(t.internalTrack.id)?{sampleIndex:0,correctSampleFound:!0}:{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,e)]}})}).call(this)}},{key:"mapTimestampIntoTimescale",value:function(e){return(0,b.roundIfAlmostInteger)(e*this.internalTrack.timescale)+this.internalTrack.editListOffset}},{key:"getPacket",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s;return(0,h._)(this,function(o){switch(o.label){case 0:return r=this,n=this.mapTimestampIntoTimescale(e),i=j(a=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),n),[4,this.fetchPacketForSampleIndex(i,t)];case 1:if(s=o.sent(),!D(a)||!this.internalTrack.demuxer.isFragmented)return[2,s];return[2,this.performFragmentedLookup(null,function(e){var t=e.trackData.get(r.internalTrack.id);if(!t)return{sampleIndex:-1,correctSampleFound:!1};var a=(0,b.binarySearchLessOrEqual)(t.presentationTimestamps,n,function(e){return e.presentationTimestamp});return{sampleIndex:-1!==a?t.presentationTimestamps[a].sampleIndex:-1,correctSampleFound:-1!==a&&n<t.endTimestamp}},n,n,t)]}})}).call(this)}},{key:"getNextPacket",value:function(e,t){return(0,i._)(function(){var r,n,a;return(0,h._)(this,function(i){if(r=this,void 0!==(n=this.packetToSampleIndex.get(e)))return[2,this.fetchPacketForSampleIndex(n+1,t)];if(void 0===(a=this.packetToFragmentLocation.get(e)))throw Error("Packet was not created from this track.");return[2,this.performFragmentedLookup(a.fragment,function(e){if(e===a.fragment){var t=e.trackData.get(r.internalTrack.id);if(a.sampleIndex+1<t.samples.length)return{sampleIndex:a.sampleIndex+1,correctSampleFound:!0}}else if(e.trackData.get(r.internalTrack.id))return{sampleIndex:0,correctSampleFound:!0};return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,t)]})}).call(this)}},{key:"getKeyPacket",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s;return(0,h._)(this,function(o){switch(o.label){case 0:return r=this,n=this.mapTimestampIntoTimescale(e),i=P(a=this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),n),[4,this.fetchPacketForSampleIndex(i,t)];case 1:if(s=o.sent(),!D(a)||!this.internalTrack.demuxer.isFragmented)return[2,s];return[2,this.performFragmentedLookup(null,function(e){var t=e.trackData.get(r.internalTrack.id);if(!t)return{sampleIndex:-1,correctSampleFound:!1};var a=(0,b.findLastIndex)(t.presentationTimestamps,function(e){return t.samples[e.sampleIndex].isKeyFrame&&e.presentationTimestamp<=n});return{sampleIndex:-1!==a?t.presentationTimestamps[a].sampleIndex:-1,correctSampleFound:-1!==a&&n<t.endTimestamp}},n,n,t)]}})}).call(this)}},{key:"getNextKeyPacket",value:function(e,t){return(0,i._)(function(){var r,n,a,i;return(0,h._)(this,function(s){if(r=this,void 0!==(n=this.packetToSampleIndex.get(e)))return a=A(this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),n),[2,this.fetchPacketForSampleIndex(a,t)];if(void 0===(i=this.packetToFragmentLocation.get(e)))throw Error("Packet was not created from this track.");return[2,this.performFragmentedLookup(i.fragment,function(e){if(e===i.fragment){var t=e.trackData.get(r.internalTrack.id).samples.findIndex(function(e,t){return e.isKeyFrame&&t>i.sampleIndex});if(-1!==t)return{sampleIndex:t,correctSampleFound:!0}}else{var n=e.trackData.get(r.internalTrack.id);if(n&&null!==n.firstKeyFrameTimestamp){var a=n.samples.findIndex(function(e){return e.isKeyFrame});return(0,b.assert)(-1!==a),{sampleIndex:a,correctSampleFound:!0}}}return{sampleIndex:-1,correctSampleFound:!1}},-1/0,1/0,t)]})}).call(this)}},{key:"fetchPacketForSampleIndex",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s,o;return(0,h._)(this,function(c){switch(c.label){case 0:if(-1===e||!(r=C(this.internalTrack.demuxer.getSampleTableForTrack(this.internalTrack),e)))return[2,null];if(!t.metadataOnly)return[3,1];return n=y.PLACEHOLDER_DATA,[3,4];case 1:if(!((a=this.internalTrack.demuxer.reader.requestSlice(r.sampleOffset,r.sampleSize))instanceof Promise))return[3,3];return[4,a];case 2:a=c.sent(),c.label=3;case 3:(0,b.assert)(a),n=(0,w.readBytes)(a,r.sampleSize),c.label=4;case 4:return i=(r.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,s=r.duration/this.internalTrack.timescale,o=new(0,y.EncodedPacket)(n,r.isKeyFrame?"key":"delta",i,s,e,r.sampleSize),this.packetToSampleIndex.set(o,e),[2,o]}})}).call(this)}},{key:"fetchPacketInFragment",value:function(e,t,r){return(0,i._)(function(){var n,a,i,s,o,c;return(0,h._)(this,function(u){switch(u.label){case 0:if(-1===t)return[2,null];if(n=e.trackData.get(this.internalTrack.id).samples[t],(0,b.assert)(n),!r.metadataOnly)return[3,1];return a=y.PLACEHOLDER_DATA,[3,4];case 1:if(!((i=this.internalTrack.demuxer.reader.requestSlice(n.byteOffset,n.byteSize))instanceof Promise))return[3,3];return[4,i];case 2:i=u.sent(),u.label=3;case 3:(0,b.assert)(i),a=(0,w.readBytes)(i,n.byteSize),u.label=4;case 4:return s=(n.presentationTimestamp-this.internalTrack.editListOffset)/this.internalTrack.timescale,o=n.duration/this.internalTrack.timescale,c=new(0,y.EncodedPacket)(a,n.isKeyFrame?"key":"delta",s,o,e.moofOffset+t,n.byteSize),this.packetToFragmentLocation.set(c,{fragment:e,sampleIndex:t}),[2,c]}})}).call(this)}},{key:"performFragmentedLookup",value:function(e,t,r,n,a){return(0,i._)(function(){var i,s,o,c,u,l,d,f,m,p,g,v,y,k,w,S,T,x,I,E,j,P,C;return(0,h._)(this,function(h){switch(h.label){case 0:if(i=this.internalTrack.demuxer,s=null,o=null,c=-1,e){if(l=(u=t(e)).sampleIndex,u.correctSampleFound)return[2,this.fetchPacketInFragment(e,l,a)];-1!==l&&(o=e,c=l)}f=-1!==(d=(0,b.binarySearchLessOrEqual)(this.internalTrack.fragmentLookupTable,r,function(e){return e.timestamp}))?this.internalTrack.fragmentLookupTable[d]:null,p=-1!==(m=(0,b.binarySearchLessOrEqual)(this.internalTrack.fragmentPositionCache,r,function(e){return e.startTimestamp}))?this.internalTrack.fragmentPositionCache[m]:null,y=Math.max(null!=(g=null==f?void 0:f.moofOffset)?g:0,null!=(v=null==p?void 0:p.moofOffset)?v:0)||null,e?null===y||e.moofOffset>=y?(k=e.moofOffset+e.moofSize,s=e):k=y:k=null!=y?y:0,h.label=1;case 1:if(s&&(w=s.trackData.get(this.internalTrack.id))&&w.startTimestamp>n)return[3,6];if(!((S=i.reader.requestSliceRange(k,_.MIN_BOX_HEADER_SIZE,_.MAX_BOX_HEADER_SIZE))instanceof Promise))return[3,3];return[4,S];case 2:S=h.sent(),h.label=3;case 3:if(!S||(T=k,!(x=(0,_.readBoxHeader)(S))))return[3,6];if("moof"!==x.name)return[3,5];return[4,i.readFragment(T)];case 4:if(E=(I=t(s=h.sent())).sampleIndex,I.correctSampleFound)return[2,this.fetchPacketInFragment(s,E,a)];-1!==E&&(o=s,c=E),h.label=5;case 5:return k=T+x.totalSize,[3,1];case 6:if(f&&(!o||o.moofOffset<f.moofOffset))return j=this.internalTrack.fragmentLookupTable[d-1],(0,b.assert)(!j||j.timestamp<f.timestamp),C=null!=(P=null==j?void 0:j.timestamp)?P:-1/0,[2,this.performFragmentedLookup(null,t,C,n,a)];if(o)return[2,this.fetchPacketInFragment(o,c,a)];return[2,null]}})}).call(this)}}]),e}(),I=function(e){"use strict";function t(e){var r;return(0,o._)(this,t),(r=(0,s._)(this,t,[e])).decoderConfigPromise=null,r.internalTrack=e,r}return(0,u._)(t,e),(0,c._)(t,[{key:"getCodec",value:function(){return this.internalTrack.info.codec}},{key:"getCodedWidth",value:function(){return this.internalTrack.info.width}},{key:"getCodedHeight",value:function(){return this.internalTrack.info.height}},{key:"getRotation",value:function(){return this.internalTrack.rotation}},{key:"getColorSpace",value:function(){return(0,i._)(function(){var e,t,r,n;return(0,h._)(this,function(a){return[2,{primaries:null==(e=this.internalTrack.info.colorSpace)?void 0:e.primaries,transfer:null==(t=this.internalTrack.info.colorSpace)?void 0:t.transfer,matrix:null==(r=this.internalTrack.info.colorSpace)?void 0:r.matrix,fullRange:null==(n=this.internalTrack.info.colorSpace)?void 0:n.fullRange}]})}).call(this)}},{key:"canBeTransparent",value:function(){return(0,i._)(function(){return(0,h._)(this,function(e){return[2,!1]})})()}},{key:"getDecoderConfig",value:function(){return(0,i._)(function(){var e,t;return(0,h._)(this,function(r){return(e=this,this.internalTrack.info.codec)?[2,null!=(t=this.decoderConfigPromise)?t:this.decoderConfigPromise=(0,i._)(function(){var e,t,r,n;return(0,h._)(this,function(a){switch(a.label){case 0:if(!("vp9"===this.internalTrack.info.codec&&!this.internalTrack.info.vp9CodecInfo))return[3,2];return[4,this.getFirstPacket({})];case 1:return e=a.sent(),this.internalTrack.info.vp9CodecInfo=e&&(0,p.extractVp9CodecInfoFromPacket)(e.data),[3,4];case 2:if(!("av1"===this.internalTrack.info.codec&&!this.internalTrack.info.av1CodecInfo))return[3,4];return[4,this.getFirstPacket({})];case 3:t=a.sent(),this.internalTrack.info.av1CodecInfo=t&&(0,p.extractAv1CodecInfoFromPacket)(t.data),a.label=4;case 4:return[2,{codec:(0,m.extractVideoCodecString)(this.internalTrack.info),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:null!=(r=this.internalTrack.info.codecDescription)?r:void 0,colorSpace:null!=(n=this.internalTrack.info.colorSpace)?n:void 0}]}})}).call(e)]:[2,null]})}).call(this)}}]),t}(x),E=function(e){"use strict";function t(e){var r;return(0,o._)(this,t),(r=(0,s._)(this,t,[e])).decoderConfig=null,r.internalTrack=e,r}return(0,u._)(t,e),(0,c._)(t,[{key:"getCodec",value:function(){return this.internalTrack.info.codec}},{key:"getNumberOfChannels",value:function(){return this.internalTrack.info.numberOfChannels}},{key:"getSampleRate",value:function(){return this.internalTrack.info.sampleRate}},{key:"getDecoderConfig",value:function(){return(0,i._)(function(){var e,t;return(0,h._)(this,function(r){return this.internalTrack.info.codec?[2,null!=(t=this.decoderConfig)?t:this.decoderConfig={codec:(0,m.extractAudioCodecString)(this.internalTrack.info),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:null!=(e=this.internalTrack.info.codecDescription)?e:void 0}]:[2,null]})}).call(this)}}]),t}(x),j=function(e,t){if(e.presentationTimestamps){var r=(0,b.binarySearchLessOrEqual)(e.presentationTimestamps,t,function(e){return e.presentationTimestamp});return -1===r?-1:e.presentationTimestamps[r].sampleIndex}var n=(0,b.binarySearchLessOrEqual)(e.sampleTimingEntries,t,function(e){return e.startDecodeTimestamp});if(-1===n)return -1;var a=e.sampleTimingEntries[n];return a.startIndex+Math.min(Math.floor((t-a.startDecodeTimestamp)/a.delta),a.count-1)},P=function(e,t){if(!e.keySampleIndices)return j(e,t);if(e.presentationTimestamps){var r=(0,b.binarySearchLessOrEqual)(e.presentationTimestamps,t,function(e){return e.presentationTimestamp});if(-1===r)return -1;for(var n=r;n>=0;n--){var a=e.presentationTimestamps[n].sampleIndex;if(-1!==(0,b.binarySearchExact)(e.keySampleIndices,a,function(e){return e}))return a}return -1}var i,s=j(e,t),o=(0,b.binarySearchLessOrEqual)(e.keySampleIndices,s,function(e){return e});return null!=(i=e.keySampleIndices[o])?i:-1},C=function(e,t){var r=(0,b.binarySearchLessOrEqual)(e.sampleTimingEntries,t,function(e){return e.startIndex}),n=e.sampleTimingEntries[r];if(!n||n.startIndex+n.count<=t)return null;var a=n.startDecodeTimestamp+(t-n.startIndex)*n.delta,i=(0,b.binarySearchLessOrEqual)(e.sampleCompositionTimeOffsets,t,function(e){return e.startIndex}),s=e.sampleCompositionTimeOffsets[i];s&&t-s.startIndex<s.count&&(a+=s.offset);var o=e.sampleSizes[Math.min(t,e.sampleSizes.length-1)],c=(0,b.binarySearchLessOrEqual)(e.sampleToChunk,t,function(e){return e.startSampleIndex}),u=e.sampleToChunk[c];(0,b.assert)(u);var l=u.startChunkIndex+Math.floor((t-u.startSampleIndex)/u.samplesPerChunk),d=e.chunkOffsets[l],f=u.startSampleIndex+(l-u.startChunkIndex)*u.samplesPerChunk,h=0,m=d;if(1===e.sampleSizes.length)m+=o*(t-f),h+=o*u.samplesPerChunk;else for(var p=f;p<f+u.samplesPerChunk;p++){var g=e.sampleSizes[p];p<t&&(m+=g),h+=g}var v=n.delta;if(e.presentationTimestamps){var y=e.presentationTimestampIndexMap[t];(0,b.assert)(void 0!==y),y<e.presentationTimestamps.length-1&&(v=e.presentationTimestamps[y+1].presentationTimestamp-a)}return{presentationTimestamp:a,duration:v,sampleOffset:m,sampleSize:o,chunkOffset:d,chunkSize:h,isKeyFrame:!e.keySampleIndices||-1!==(0,b.binarySearchExact)(e.keySampleIndices,t,function(e){return e})}},A=function(e,t){if(!e.keySampleIndices)return t+1;var r,n=(0,b.binarySearchLessOrEqual)(e.keySampleIndices,t,function(e){return e});return null!=(r=e.keySampleIndices[n+1])?r:-1},B=function(e,t){e.startTimestamp+=t,e.endTimestamp+=t;var r=!0,n=!1,a=void 0;try{for(var i,s=e.samples[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value;o.presentationTimestamp+=t}}catch(e){n=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}var c=!0,u=!1,l=void 0;try{for(var d,f=e.presentationTimestamps[Symbol.iterator]();!(c=(d=f.next()).done);c=!0){var h=d.value;h.presentationTimestamp+=t}}catch(e){u=!0,l=e}finally{try{c||null==f.return||f.return()}finally{if(u)throw l}}},M=function(e){var t=(0,d._)(e,4),r=t[0],n=t[3],a=Math.hypot(r,n),i=-(180/Math.PI*Math.atan2(n/a,r/a));return Number.isFinite(i)?i:0},D=function(e){return 0===e.sampleSizes.length}},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_object_spread.cjs":"kyoEj","@swc/helpers/cjs/_sliced_to_array.cjs":"gIQTH","@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","../codec.js":"fXWqW","../codec-data.js":"kWTYV","../demuxer.js":"d4thC","../input-track.js":"b22CJ","../misc.js":"j7iGm","../packet.js":"QfqGG","./isobmff-misc.js":"gw3Ca","./isobmff-reader.js":"fSW0K","../reader.js":"8KRfO","../metadata.js":"eSjom","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],kyoEj:[function(e,t,r,n){"use strict";var a=e("9f9b8a24218ee51e");r._=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){a._(e,t,r[t])})}return e}},{"9f9b8a24218ee51e":"ltU3W"}],ltU3W:[function(e,t,r,n){"use strict";r._=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}},{}],gIQTH:[function(e,t,r,n){"use strict";var a=e("d7c30a5ae0c1ab2"),i=e("3aacfce52f67defd"),s=e("f0dae09a1a08b16a"),o=e("83f3648e614d0830");r._=function(e,t){return a._(e)||i._(e,t)||o._(e,t)||s._()}},{d7c30a5ae0c1ab2:"3QSPl","3aacfce52f67defd":"5SSeo",f0dae09a1a08b16a:"heYSj","83f3648e614d0830":"fh7mx"}],"3QSPl":[function(e,t,r,n){"use strict";r._=function(e){if(Array.isArray(e))return e}},{}],"5SSeo":[function(e,t,r,n){"use strict";r._=function(e,t){var r,n,a=null==e?null:"u">typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var i=[],s=!0,o=!1;try{for(a=a.call(e);!(s=(r=a.next()).done)&&(i.push(r.value),!t||i.length!==t);s=!0);}catch(e){o=!0,n=e}finally{try{s||null==a.return||a.return()}finally{if(o)throw n}}return i}}},{}],heYSj:[function(e,t,r,n){"use strict";r._=function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},{}],fXWqW:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"VIDEO_CODECS",function(){return c}),a.export(r,"PCM_AUDIO_CODECS",function(){return u}),a.export(r,"NON_PCM_AUDIO_CODECS",function(){return l}),a.export(r,"AUDIO_CODECS",function(){return d}),a.export(r,"SUBTITLE_CODECS",function(){return f}),a.export(r,"VP9_LEVEL_TABLE",function(){return p}),a.export(r,"buildVideoCodecString",function(){return y}),a.export(r,"generateVp9CodecConfigurationFromCodecString",function(){return k}),a.export(r,"generateAv1CodecConfigurationFromCodecString",function(){return _}),a.export(r,"extractVideoCodecString",function(){return w}),a.export(r,"buildAudioCodecString",function(){return S}),a.export(r,"extractAudioCodecString",function(){return T}),a.export(r,"aacFrequencyTable",function(){return x}),a.export(r,"aacChannelMap",function(){return I}),a.export(r,"parseAacAudioSpecificConfig",function(){return E}),a.export(r,"buildAacAudioSpecificConfig",function(){return j}),a.export(r,"OPUS_SAMPLE_RATE",function(){return P}),a.export(r,"parsePcmCodec",function(){return A}),a.export(r,"inferCodecFromCodecString",function(){return B}),a.export(r,"getVideoEncoderConfigExtension",function(){return M}),a.export(r,"getAudioEncoderConfigExtension",function(){return D}),a.export(r,"validateVideoChunkMetadata",function(){return L}),a.export(r,"validateAudioChunkMetadata",function(){return V}),a.export(r,"validateSubtitleMetadata",function(){return H});var i=e("@swc/helpers/cjs/_to_consumable_array.cjs"),s=e("@swc/helpers/cjs/_type_of.cjs"),o=e("./misc.js"),c=["avc","hevc","vp9","av1","vp8"],u=["pcm-s16","pcm-s16be","pcm-s24","pcm-s24be","pcm-s32","pcm-s32be","pcm-f32","pcm-f32be","pcm-f64","pcm-f64be","pcm-u8","pcm-s8","ulaw","alaw"],l=["aac","opus","mp3","vorbis","flac"],d=(0,i._)(l).concat((0,i._)(u)),f=["webvtt"],h=[{maxMacroblocks:99,maxBitrate:64e3,level:10},{maxMacroblocks:396,maxBitrate:192e3,level:11},{maxMacroblocks:396,maxBitrate:384e3,level:12},{maxMacroblocks:396,maxBitrate:768e3,level:13},{maxMacroblocks:396,maxBitrate:2e6,level:20},{maxMacroblocks:792,maxBitrate:4e6,level:21},{maxMacroblocks:1620,maxBitrate:4e6,level:22},{maxMacroblocks:1620,maxBitrate:1e7,level:30},{maxMacroblocks:3600,maxBitrate:14e6,level:31},{maxMacroblocks:5120,maxBitrate:2e7,level:32},{maxMacroblocks:8192,maxBitrate:2e7,level:40},{maxMacroblocks:8192,maxBitrate:5e7,level:41},{maxMacroblocks:8704,maxBitrate:5e7,level:42},{maxMacroblocks:22080,maxBitrate:135e6,level:50},{maxMacroblocks:36864,maxBitrate:24e7,level:51},{maxMacroblocks:36864,maxBitrate:24e7,level:52},{maxMacroblocks:139264,maxBitrate:24e7,level:60},{maxMacroblocks:139264,maxBitrate:48e7,level:61},{maxMacroblocks:139264,maxBitrate:8e8,level:62}],m=[{maxPictureSize:36864,maxBitrate:128e3,tier:"L",level:30},{maxPictureSize:122880,maxBitrate:15e5,tier:"L",level:60},{maxPictureSize:245760,maxBitrate:3e6,tier:"L",level:63},{maxPictureSize:552960,maxBitrate:6e6,tier:"L",level:90},{maxPictureSize:983040,maxBitrate:1e7,tier:"L",level:93},{maxPictureSize:2228224,maxBitrate:12e6,tier:"L",level:120},{maxPictureSize:2228224,maxBitrate:3e7,tier:"H",level:120},{maxPictureSize:2228224,maxBitrate:2e7,tier:"L",level:123},{maxPictureSize:2228224,maxBitrate:5e7,tier:"H",level:123},{maxPictureSize:8912896,maxBitrate:25e6,tier:"L",level:150},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:150},{maxPictureSize:8912896,maxBitrate:4e7,tier:"L",level:153},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:153},{maxPictureSize:8912896,maxBitrate:6e7,tier:"L",level:156},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:156},{maxPictureSize:0x2200000,maxBitrate:6e7,tier:"L",level:180},{maxPictureSize:0x2200000,maxBitrate:24e7,tier:"H",level:180},{maxPictureSize:0x2200000,maxBitrate:12e7,tier:"L",level:183},{maxPictureSize:0x2200000,maxBitrate:48e7,tier:"H",level:183},{maxPictureSize:0x2200000,maxBitrate:24e7,tier:"L",level:186},{maxPictureSize:0x2200000,maxBitrate:8e8,tier:"H",level:186}],p=[{maxPictureSize:36864,maxBitrate:2e5,level:10},{maxPictureSize:73728,maxBitrate:8e5,level:11},{maxPictureSize:122880,maxBitrate:18e5,level:20},{maxPictureSize:245760,maxBitrate:36e5,level:21},{maxPictureSize:552960,maxBitrate:72e5,level:30},{maxPictureSize:983040,maxBitrate:12e6,level:31},{maxPictureSize:2228224,maxBitrate:18e6,level:40},{maxPictureSize:2228224,maxBitrate:3e7,level:41},{maxPictureSize:8912896,maxBitrate:6e7,level:50},{maxPictureSize:8912896,maxBitrate:12e7,level:51},{maxPictureSize:8912896,maxBitrate:18e7,level:52},{maxPictureSize:0x2200000,maxBitrate:18e7,level:60},{maxPictureSize:0x2200000,maxBitrate:24e7,level:61},{maxPictureSize:0x2200000,maxBitrate:48e7,level:62}],g=[{maxPictureSize:147456,maxBitrate:15e5,tier:"M",level:0},{maxPictureSize:278784,maxBitrate:3e6,tier:"M",level:1},{maxPictureSize:665856,maxBitrate:6e6,tier:"M",level:4},{maxPictureSize:1065024,maxBitrate:1e7,tier:"M",level:5},{maxPictureSize:2359296,maxBitrate:12e6,tier:"M",level:8},{maxPictureSize:2359296,maxBitrate:3e7,tier:"H",level:8},{maxPictureSize:2359296,maxBitrate:2e7,tier:"M",level:9},{maxPictureSize:2359296,maxBitrate:5e7,tier:"H",level:9},{maxPictureSize:8912896,maxBitrate:3e7,tier:"M",level:12},{maxPictureSize:8912896,maxBitrate:1e8,tier:"H",level:12},{maxPictureSize:8912896,maxBitrate:4e7,tier:"M",level:13},{maxPictureSize:8912896,maxBitrate:16e7,tier:"H",level:13},{maxPictureSize:8912896,maxBitrate:6e7,tier:"M",level:14},{maxPictureSize:8912896,maxBitrate:24e7,tier:"H",level:14},{maxPictureSize:0x2200000,maxBitrate:6e7,tier:"M",level:15},{maxPictureSize:0x2200000,maxBitrate:24e7,tier:"H",level:15},{maxPictureSize:0x2200000,maxBitrate:6e7,tier:"M",level:16},{maxPictureSize:0x2200000,maxBitrate:24e7,tier:"H",level:16},{maxPictureSize:0x2200000,maxBitrate:1e8,tier:"M",level:17},{maxPictureSize:0x2200000,maxBitrate:48e7,tier:"H",level:17},{maxPictureSize:0x2200000,maxBitrate:16e7,tier:"M",level:18},{maxPictureSize:0x2200000,maxBitrate:8e8,tier:"H",level:18},{maxPictureSize:0x2200000,maxBitrate:16e7,tier:"M",level:19},{maxPictureSize:0x2200000,maxBitrate:8e8,tier:"H",level:19}],v=".01.01.01.01.00",b=".0.110.01.01.01.0",y=function(e,t,r,n){if("avc"===e){var a,i=Math.ceil(t/16)*Math.ceil(r/16),s=null!=(a=h.find(function(e){return i<=e.maxMacroblocks&&n<=e.maxBitrate}))?a:(0,o.last)(h),c=s?s.level:0,u="64".padStart(2,"0"),l=c.toString(16).padStart(2,"0");return"avc1.".concat(u).concat("00").concat(l)}if("hevc"===e){var d,f=t*r,v=null!=(d=m.find(function(e){return f<=e.maxPictureSize&&n<=e.maxBitrate}))?d:(0,o.last)(m);return"hev1."+"".concat("").concat(1,".")+"".concat("6",".")+"".concat(v.tier).concat(v.level,".")+"".concat("B0")}if("vp8"===e)return"vp8";if("vp9"===e){var b,y=t*r,k=null!=(b=p.find(function(e){return y<=e.maxPictureSize&&n<=e.maxBitrate}))?b:(0,o.last)(p);return"vp09.".concat("00",".").concat(k.level.toString().padStart(2,"0"),".").concat("08")}if("av1"===e){var _,w=t*r,S=null!=(_=g.find(function(e){return w<=e.maxPictureSize&&n<=e.maxBitrate}))?_:(0,o.last)(g),T=S.level.toString().padStart(2,"0");return"av01.".concat(0,".").concat(T).concat(S.tier,".").concat("08")}throw TypeError("Unhandled codec '".concat(e,"'."))},k=function(e){var t=e.split(".");return[1,1,Number(t[1]),2,1,Number(t[2]),3,1,Number(t[3]),4,1,t[4]?Number(t[4]):1]},_=function(e){var t=e.split("."),r=Number(t[1]),n=t[2];return[129,(r<<5)+Number(n.slice(0,-1)),(("H"===n.slice(-1))<<7)+((8!==Number(t[3]))<<6)+0+((t[4]?Number(t[4]):0)<<4)+((t[5]?Number(t[5][0]):1)<<3)+((t[5]?Number(t[5][1]):1)<<2)+(t[5]?Number(t[5][2]):0),0]},w=function(e){var t=e.codec,r=e.codecDescription,n=e.colorSpace,a=e.avcCodecInfo,s=e.hevcCodecInfo,c=e.vp9CodecInfo,u=e.av1CodecInfo;if("avc"===t){if((0,o.assert)(null!==e.avcType),a){var l=new Uint8Array([a.avcProfileIndication,a.profileCompatibility,a.avcLevelIndication]);return"avc".concat(e.avcType,".").concat((0,o.bytesToHexString)(l))}if(!r||r.byteLength<4)throw TypeError("AVC decoder description is not provided or is not at least 4 bytes long.");return"avc".concat(e.avcType,".").concat((0,o.bytesToHexString)(r.subarray(1,4)))}if("hevc"===t){if(s)d=s.generalProfileSpace,f=s.generalProfileIdc,h=(0,o.reverseBitsU32)(s.generalProfileCompatibilityFlags),m=s.generalTierFlag,g=s.generalLevelIdc,y=(0,i._)(s.generalConstraintIndicatorFlags);else{if(!r||r.byteLength<23)throw TypeError("HEVC decoder description is not provided or is not at least 23 bytes long.");var d,f,h,m,g,y,k=(0,o.toDataView)(r),_=k.getUint8(1);d=_>>6&3,f=31&_,h=(0,o.reverseBitsU32)(k.getUint32(2)),m=_>>5&1,g=k.getUint8(12),y=[];for(var w=0;w<6;w++)y.push(k.getUint8(6+w))}var S="hev1.";for(S+=["","A","B","C"][d]+f,S+=".",S+=h.toString(16).toUpperCase(),S+=".",S+=0===m?"L":"H",S+=g;y.length>0&&0===y[y.length-1];)y.pop();return y.length>0&&(S+=".",S+=y.map(function(e){return e.toString(16).toUpperCase()}).join(".")),S}if("vp8"===t)return"vp8";if("vp9"===t){if(!c){var T=e.width*e.height,x=(0,o.last)(p).level,I=!0,E=!1,j=void 0;try{for(var P,C=p[Symbol.iterator]();!(I=(P=C.next()).done);I=!0){var A=P.value;if(T<=A.maxPictureSize){x=A.level;break}}}catch(e){E=!0,j=e}finally{try{I||null==C.return||C.return()}finally{if(E)throw j}}return"vp09.00.".concat(x.toString().padStart(2,"0"),".08")}var B=c.profile.toString().padStart(2,"0"),M=c.level.toString().padStart(2,"0"),D=c.bitDepth.toString().padStart(2,"0"),F=c.chromaSubsampling.toString().padStart(2,"0"),R=c.colourPrimaries.toString().padStart(2,"0"),U=c.transferCharacteristics.toString().padStart(2,"0"),O=c.matrixCoefficients.toString().padStart(2,"0"),N=c.videoFullRangeFlag.toString().padStart(2,"0"),L="vp09.".concat(B,".").concat(M,".").concat(D,".").concat(F);return(L+=".".concat(R,".").concat(U,".").concat(O,".").concat(N)).endsWith(v)&&(L=L.slice(0,-v.length)),L}if("av1"===t){if(!u){var z=e.width*e.height,V=(0,o.last)(p).level,H=!0,G=!1,q=void 0;try{for(var W,K=p[Symbol.iterator]();!(H=(W=K.next()).done);H=!0){var X=W.value;if(z<=X.maxPictureSize){V=X.level;break}}}catch(e){G=!0,q=e}finally{try{H||null==K.return||K.return()}finally{if(G)throw q}}return"av01.0.".concat(V.toString().padStart(2,"0"),"M.08")}var Q=u.profile,Z=u.level.toString().padStart(2,"0"),Y=u.tier?"H":"M",J=u.bitDepth.toString().padStart(2,"0"),$=u.monochrome?"1":"0",ee=100*u.chromaSubsamplingX+10*u.chromaSubsamplingY+ +(u.chromaSubsamplingX&&u.chromaSubsamplingY?u.chromaSamplePosition:0),et=(null==n?void 0:n.primaries)?o.COLOR_PRIMARIES_MAP[n.primaries]:1,er=(null==n?void 0:n.transfer)?o.TRANSFER_CHARACTERISTICS_MAP[n.transfer]:1,en=(null==n?void 0:n.matrix)?o.MATRIX_COEFFICIENTS_MAP[n.matrix]:1,ea=+(null!=n&&!!n.fullRange),ei="av01.".concat(Q,".").concat(Z).concat(Y,".").concat(J);return ei+=".".concat($,".").concat(ee.toString().padStart(3,"0")),ei+=".".concat(et.toString().padStart(2,"0")),ei+=".".concat(er.toString().padStart(2,"0")),ei+=".".concat(en.toString().padStart(2,"0")),(ei+=".".concat(ea)).endsWith(b)&&(ei=ei.slice(0,-b.length)),ei}throw TypeError("Unhandled codec '".concat(t,"'."))},S=function(e,t,r){if("aac"===e)return t>=2&&r<=24e3?"mp4a.40.29":r<=24e3?"mp4a.40.5":"mp4a.40.2";if("mp3"===e)return"mp3";if("opus"===e)return"opus";if("vorbis"===e)return"vorbis";if("flac"===e)return"flac";else if(u.includes(e))return e;throw TypeError("Unhandled codec '".concat(e,"'."))},T=function(e){var t=e.codec,r=e.codecDescription,n=e.aacCodecInfo;if("aac"===t){if(!n)throw TypeError("AAC codec info must be provided.");if(n.isMpeg2)return"mp4a.67";var a=E(r);return"mp4a.40.".concat(a.objectType)}if("mp3"===t)return"mp3";if("opus"===t)return"opus";if("vorbis"===t)return"vorbis";if("flac"===t)return"flac";else if(t&&u.includes(t))return t;throw TypeError("Unhandled codec '".concat(t,"'."))},x=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],I=[-1,1,2,3,4,5,6,8],E=function(e){if(!e||e.byteLength<2)throw TypeError("AAC description must be at least 2 bytes long.");var t=new(0,o.Bitstream)(e),r=t.readBits(5);31===r&&(r=32+t.readBits(6));var n=t.readBits(4),a=null;15===n?a=t.readBits(24):n<x.length&&(a=x[n]);var i=t.readBits(4),s=null;return i>=1&&i<=7&&(s=I[i]),{objectType:r,frequencyIndex:n,sampleRate:a,channelConfiguration:i,numberOfChannels:s}},j=function(e){var t=x.indexOf(e.sampleRate),r=null;-1===t&&(t=15,r=e.sampleRate);var n=I.indexOf(e.numberOfChannels);if(-1===n)throw TypeError("Unsupported number of channels: ".concat(e.numberOfChannels));var a=13;e.objectType>=32&&(a+=6),15===t&&(a+=24);var i=new Uint8Array(Math.ceil(a/8)),s=new(0,o.Bitstream)(i);return e.objectType<32?s.writeBits(5,e.objectType):(s.writeBits(5,31),s.writeBits(6,e.objectType-32)),s.writeBits(4,t),15===t&&s.writeBits(24,r),s.writeBits(4,n),i},P=48e3,C=/^pcm-([usf])(\d+)+(be)?$/,A=function(e){if((0,o.assert)(u.includes(e)),"ulaw"===e)return{dataType:"ulaw",sampleSize:1,littleEndian:!0,silentValue:255};if("alaw"===e)return{dataType:"alaw",sampleSize:1,littleEndian:!0,silentValue:213};var t=C.exec(e);return(0,o.assert)(t),{dataType:"u"===t[1]?"unsigned":"s"===t[1]?"signed":"float",sampleSize:Number(t[2])/8,littleEndian:"be"!==t[3],silentValue:128*("pcm-u8"===e)}},B=function(e){if(e.startsWith("avc1")||e.startsWith("avc3"))return"avc";if(e.startsWith("hev1")||e.startsWith("hvc1"))return"hevc";if("vp8"===e)return"vp8";if(e.startsWith("vp09"))return"vp9";if(e.startsWith("av01"))return"av1";if(e.startsWith("mp4a.40")||"mp4a.67"===e)return"aac";if("mp3"===e||"mp4a.69"===e||"mp4a.6B"===e||"mp4a.6b"===e)return"mp3";if("opus"===e)return"opus";if("vorbis"===e)return"vorbis";if("flac"===e)return"flac";else if("ulaw"===e)return"ulaw";else if("alaw"===e)return"alaw";else if(C.test(e))return e;return"webvtt"===e?"webvtt":null},M=function(e){return"avc"===e?{avc:{format:"avc"}}:"hevc"===e?{hevc:{format:"hevc"}}:{}},D=function(e){return"aac"===e?{aac:{format:"aac"}}:"opus"===e?{opus:{format:"opus"}}:{}},F=["avc1","avc3","hev1","hvc1","vp8","vp09","av01"],R=/^(avc1|avc3)\.[0-9a-fA-F]{6}$/,U=/^(hev1|hvc1)\.(?:[ABC]?\d+)\.[0-9a-fA-F]{1,8}\.[LH]\d+(?:\.[0-9a-fA-F]{1,2}){0,6}$/,O=/^vp09(?:\.\d{2}){3}(?:(?:\.\d{2}){5})?$/,N=/^av01\.\d\.\d{2}[MH]\.\d{2}(?:\.\d\.\d{3}\.\d{2}\.\d{2}\.\d{2}\.\d)?$/,L=function(e){if(!e)throw TypeError("Video chunk metadata must be provided.");if((void 0===e?"undefined":(0,s._)(e))!=="object")throw TypeError("Video chunk metadata must be an object.");if(!e.decoderConfig)throw TypeError("Video chunk metadata must include a decoder configuration.");if("object"!==(0,s._)(e.decoderConfig))throw TypeError("Video chunk metadata decoder configuration must be an object.");if("string"!=typeof e.decoderConfig.codec)throw TypeError("Video chunk metadata decoder configuration must specify a codec string.");if(!F.some(function(t){return e.decoderConfig.codec.startsWith(t)}))throw TypeError("Video chunk metadata decoder configuration codec string must be a valid video codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(e.decoderConfig.codedWidth)||e.decoderConfig.codedWidth<=0)throw TypeError("Video chunk metadata decoder configuration must specify a valid codedWidth (positive integer).");if(!Number.isInteger(e.decoderConfig.codedHeight)||e.decoderConfig.codedHeight<=0)throw TypeError("Video chunk metadata decoder configuration must specify a valid codedHeight (positive integer).");if(void 0!==e.decoderConfig.description&&!(0,o.isAllowSharedBufferSource)(e.decoderConfig.description))throw TypeError("Video chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(void 0!==e.decoderConfig.colorSpace){var t=e.decoderConfig.colorSpace;if((void 0===t?"undefined":(0,s._)(t))!=="object")throw TypeError("Video chunk metadata decoder configuration colorSpace, when provided, must be an object.");var r=Object.keys(o.COLOR_PRIMARIES_MAP);if(null!=t.primaries&&!r.includes(t.primaries))throw TypeError("Video chunk metadata decoder configuration colorSpace primaries, when defined, must be one of"+" ".concat(r.join(", "),"."));var n=Object.keys(o.TRANSFER_CHARACTERISTICS_MAP);if(null!=t.transfer&&!n.includes(t.transfer))throw TypeError("Video chunk metadata decoder configuration colorSpace transfer, when defined, must be one of"+" ".concat(n.join(", "),"."));var a=Object.keys(o.MATRIX_COEFFICIENTS_MAP);if(null!=t.matrix&&!a.includes(t.matrix))throw TypeError("Video chunk metadata decoder configuration colorSpace matrix, when defined, must be one of"+" ".concat(a.join(", "),"."));if(null!=t.fullRange&&"boolean"!=typeof t.fullRange)throw TypeError("Video chunk metadata decoder configuration colorSpace fullRange, when defined, must be a boolean.")}if(e.decoderConfig.codec.startsWith("avc1")||e.decoderConfig.codec.startsWith("avc3")){if(!R.test(e.decoderConfig.codec))throw TypeError("Video chunk metadata decoder configuration codec string for AVC must be a valid AVC codec string as specified in Section 3.4 of RFC 6381.")}else if(e.decoderConfig.codec.startsWith("hev1")||e.decoderConfig.codec.startsWith("hvc1")){if(!U.test(e.decoderConfig.codec))throw TypeError("Video chunk metadata decoder configuration codec string for HEVC must be a valid HEVC codec string as specified in Section E.3 of ISO 14496-15.")}else if(e.decoderConfig.codec.startsWith("vp8")){if("vp8"!==e.decoderConfig.codec)throw TypeError('Video chunk metadata decoder configuration codec string for VP8 must be "vp8".')}else if(e.decoderConfig.codec.startsWith("vp09")){if(!O.test(e.decoderConfig.codec))throw TypeError('Video chunk metadata decoder configuration codec string for VP9 must be a valid VP9 codec string as specified in Section "Codecs Parameter String" of https://www.webmproject.org/vp9/mp4/.')}else if(e.decoderConfig.codec.startsWith("av01")&&!N.test(e.decoderConfig.codec))throw TypeError('Video chunk metadata decoder configuration codec string for AV1 must be a valid AV1 codec string as specified in Section "Codecs Parameter String" of https://aomediacodec.github.io/av1-isobmff/.')},z=["mp4a","mp3","opus","vorbis","flac","ulaw","alaw","pcm"],V=function(e){if(!e)throw TypeError("Audio chunk metadata must be provided.");if((void 0===e?"undefined":(0,s._)(e))!=="object")throw TypeError("Audio chunk metadata must be an object.");if(!e.decoderConfig)throw TypeError("Audio chunk metadata must include a decoder configuration.");if("object"!==(0,s._)(e.decoderConfig))throw TypeError("Audio chunk metadata decoder configuration must be an object.");if("string"!=typeof e.decoderConfig.codec)throw TypeError("Audio chunk metadata decoder configuration must specify a codec string.");if(!z.some(function(t){return e.decoderConfig.codec.startsWith(t)}))throw TypeError("Audio chunk metadata decoder configuration codec string must be a valid audio codec string as specified in the WebCodecs Codec Registry.");if(!Number.isInteger(e.decoderConfig.sampleRate)||e.decoderConfig.sampleRate<=0)throw TypeError("Audio chunk metadata decoder configuration must specify a valid sampleRate (positive integer).");if(!Number.isInteger(e.decoderConfig.numberOfChannels)||e.decoderConfig.numberOfChannels<=0)throw TypeError("Audio chunk metadata decoder configuration must specify a valid numberOfChannels (positive integer).");if(void 0!==e.decoderConfig.description&&!(0,o.isAllowSharedBufferSource)(e.decoderConfig.description))throw TypeError("Audio chunk metadata decoder configuration description, when defined, must be an ArrayBuffer or an ArrayBuffer view.");if(e.decoderConfig.codec.startsWith("mp4a")&&"mp4a.69"!==e.decoderConfig.codec&&"mp4a.6B"!==e.decoderConfig.codec&&"mp4a.6b"!==e.decoderConfig.codec){if(!["mp4a.40.2","mp4a.40.02","mp4a.40.5","mp4a.40.05","mp4a.40.29","mp4a.67"].includes(e.decoderConfig.codec))throw TypeError("Audio chunk metadata decoder configuration codec string for AAC must be a valid AAC codec string as specified in https://www.w3.org/TR/webcodecs-aac-codec-registration/.");if(!e.decoderConfig.description)throw TypeError("Audio chunk metadata decoder configuration for AAC must include a description, which is expected to be an AudioSpecificConfig as specified in ISO 14496-3.")}else if(e.decoderConfig.codec.startsWith("mp3")||e.decoderConfig.codec.startsWith("mp4a")){if("mp3"!==e.decoderConfig.codec&&"mp4a.69"!==e.decoderConfig.codec&&"mp4a.6B"!==e.decoderConfig.codec&&"mp4a.6b"!==e.decoderConfig.codec)throw TypeError('Audio chunk metadata decoder configuration codec string for MP3 must be "mp3", "mp4a.69" or "mp4a.6B".')}else if(e.decoderConfig.codec.startsWith("opus")){if("opus"!==e.decoderConfig.codec)throw TypeError('Audio chunk metadata decoder configuration codec string for Opus must be "opus".');if(e.decoderConfig.description&&e.decoderConfig.description.byteLength<18)throw TypeError("Audio chunk metadata decoder configuration description, when specified, is expected to be an Identification Header as specified in Section 5.1 of RFC 7845.")}else if(e.decoderConfig.codec.startsWith("vorbis")){if("vorbis"!==e.decoderConfig.codec)throw TypeError('Audio chunk metadata decoder configuration codec string for Vorbis must be "vorbis".');if(!e.decoderConfig.description)throw TypeError("Audio chunk metadata decoder configuration for Vorbis must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-vorbis-codec-registration/.")}else if(e.decoderConfig.codec.startsWith("flac")){if("flac"!==e.decoderConfig.codec)throw TypeError('Audio chunk metadata decoder configuration codec string for FLAC must be "flac".');if(!e.decoderConfig.description||e.decoderConfig.description.byteLength<42)throw TypeError("Audio chunk metadata decoder configuration for FLAC must include a description, which is expected to adhere to the format described in https://www.w3.org/TR/webcodecs-flac-codec-registration/.")}else if((e.decoderConfig.codec.startsWith("pcm")||e.decoderConfig.codec.startsWith("ulaw")||e.decoderConfig.codec.startsWith("alaw"))&&!u.includes(e.decoderConfig.codec))throw TypeError("Audio chunk metadata decoder configuration codec string for PCM must be one of the supported PCM"+" codecs (".concat(u.join(", "),")."))},H=function(e){if(!e)throw TypeError("Subtitle metadata must be provided.");if((void 0===e?"undefined":(0,s._)(e))!=="object")throw TypeError("Subtitle metadata must be an object.");if(!e.config)throw TypeError("Subtitle metadata must include a config object.");if("object"!==(0,s._)(e.config))throw TypeError("Subtitle metadata config must be an object.");if("string"!=typeof e.config.description)throw TypeError("Subtitle metadata config description must be a string.")}},{"@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","@swc/helpers/cjs/_type_of.cjs":"iXhRw","./misc.js":"j7iGm","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],j7iGm:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"assert",function(){return b}),a.export(r,"normalizeRotation",function(){return y}),a.export(r,"last",function(){return k}),a.export(r,"isU32",function(){return _}),a.export(r,"Bitstream",function(){return w}),a.export(r,"readExpGolomb",function(){return S}),a.export(r,"readSignedExpGolomb",function(){return T}),a.export(r,"writeBits",function(){return x}),a.export(r,"toUint8Array",function(){return I}),a.export(r,"toDataView",function(){return E}),a.export(r,"textDecoder",function(){return j}),a.export(r,"textEncoder",function(){return P}),a.export(r,"isIso88591Compatible",function(){return C}),a.export(r,"COLOR_PRIMARIES_MAP",function(){return B}),a.export(r,"COLOR_PRIMARIES_MAP_INVERSE",function(){return M}),a.export(r,"TRANSFER_CHARACTERISTICS_MAP",function(){return D}),a.export(r,"TRANSFER_CHARACTERISTICS_MAP_INVERSE",function(){return F}),a.export(r,"MATRIX_COEFFICIENTS_MAP",function(){return R}),a.export(r,"MATRIX_COEFFICIENTS_MAP_INVERSE",function(){return U}),a.export(r,"colorSpaceIsComplete",function(){return O}),a.export(r,"isAllowSharedBufferSource",function(){return N}),a.export(r,"AsyncMutex",function(){return L}),a.export(r,"bytesToHexString",function(){return z}),a.export(r,"reverseBitsU32",function(){return V}),a.export(r,"binarySearchExact",function(){return H}),a.export(r,"binarySearchLessOrEqual",function(){return G}),a.export(r,"insertSorted",function(){return q}),a.export(r,"promiseWithResolvers",function(){return W}),a.export(r,"removeItem",function(){return K}),a.export(r,"findLast",function(){return X}),a.export(r,"findLastIndex",function(){return Q}),a.export(r,"toAsyncIterator",function(){return Z}),a.export(r,"validateAnyIterable",function(){return Y}),a.export(r,"assertNever",function(){return J}),a.export(r,"getUint24",function(){return $}),a.export(r,"getInt24",function(){return ee}),a.export(r,"setUint24",function(){return et}),a.export(r,"setInt24",function(){return er}),a.export(r,"setInt64",function(){return en}),a.export(r,"mapAsyncGenerator",function(){return ea}),a.export(r,"clamp",function(){return ei}),a.export(r,"UNDETERMINED_LANGUAGE",function(){return es}),a.export(r,"roundIfAlmostInteger",function(){return eo}),a.export(r,"roundToMultiple",function(){return ec}),a.export(r,"ilog",function(){return eu}),a.export(r,"isIso639Dash2LanguageCode",function(){return ed}),a.export(r,"SECOND_TO_MICROSECOND_FACTOR",function(){return ef}),a.export(r,"mergeRequestInit",function(){return eh}),a.export(r,"retriedFetch",function(){return ep}),a.export(r,"computeRationalApproximation",function(){return eg}),a.export(r,"CallSerializer",function(){return ev}),a.export(r,"isWebKit",function(){return ey}),a.export(r,"isFirefox",function(){return e_}),a.export(r,"isChromium",function(){return eS}),a.export(r,"getChromiumVersion",function(){return ex}),a.export(r,"coalesceIndex",function(){return eI}),a.export(r,"closedIntervalsOverlap",function(){return eE}),a.export(r,"keyValueIterator",function(){return ej}),a.export(r,"imageMimeTypeToExtension",function(){return eP}),a.export(r,"base64ToBytes",function(){return eC}),a.export(r,"bytesToBase64",function(){return eA}),a.export(r,"uint8ArraysAreEqual",function(){return eB}),a.export(r,"polyfillSymbolDispose",function(){return eM}),a.export(r,"isNumber",function(){return eD});var i=e("@swc/helpers/cjs/_async_generator_delegate.cjs"),s=e("@swc/helpers/cjs/_async_iterator.cjs"),o=e("@swc/helpers/cjs/_async_to_generator.cjs"),c=e("@swc/helpers/cjs/_class_call_check.cjs"),u=e("@swc/helpers/cjs/_create_class.cjs"),l=e("@swc/helpers/cjs/_define_property.cjs"),d=e("@swc/helpers/cjs/_object_spread.cjs"),f=e("@swc/helpers/cjs/_sliced_to_array.cjs"),h=e("@swc/helpers/cjs/_to_consumable_array.cjs"),m=e("@swc/helpers/cjs/_type_of.cjs"),p=e("@swc/helpers/cjs/_wrap_async_generator.cjs"),g=e("@swc/helpers/cjs/_ts_generator.cjs"),v=e("@swc/helpers/cjs/_ts_values.cjs");function b(e){if(!e)throw Error("Assertion failed.")}var y=function(e){var t=(e%360+360)%360;if(0===t||90===t||180===t||270===t)return t;throw Error("Invalid rotation ".concat(e,"."))},k=function(e){return e&&e[e.length-1]},_=function(e){return e>=0&&e<0x100000000},w=function(){"use strict";function e(t){(0,c._)(this,e),this.bytes=t,this.pos=0}return(0,u._)(e,[{key:"seekToByte",value:function(e){this.pos=8*e}},{key:"readBit",value:function(){var e,t=Math.floor(this.pos/8),r=null!=(e=this.bytes[t])?e:0,n=7-(7&this.pos);return this.pos++,(r&1<<n)>>n}},{key:"readBits",value:function(e){if(1===e)return this.readBit();for(var t=0,r=0;r<e;r++)t<<=1,t|=this.readBit();return t}},{key:"writeBits",value:function(e,t){for(var r=this.pos+e,n=this.pos;n<r;n++){var a=Math.floor(n/8),i=this.bytes[a],s=7-(7&n);i&=~(1<<s),i|=(t&1<<r-n-1)>>r-n-1<<s,this.bytes[a]=i}this.pos=r}},{key:"readAlignedByte",value:function(){if(this.pos%8!=0)throw Error("Bitstream is not byte-aligned.");var e,t=this.pos/8,r=null!=(e=this.bytes[t])?e:0;return this.pos+=8,r}},{key:"skipBits",value:function(e){this.pos+=e}},{key:"getBitsLeft",value:function(){return 8*this.bytes.length-this.pos}},{key:"clone",value:function(){var t=new e(this.bytes);return t.pos=this.pos,t}}]),e}(),S=function(e){for(var t=0;0===e.readBits(1)&&t<32;)t++;if(t>=32)throw Error("Invalid exponential-Golomb code.");return(1<<t)-1+e.readBits(t)},T=function(e){var t=S(e);return(1&t)==0?-(t>>1):t+1>>1},x=function(e,t,r,n){for(var a=t;a<r;a++){var i=Math.floor(a/8),s=e[i],o=7-(7&a);s&=~(1<<o),s|=(n&1<<r-a-1)>>r-a-1<<o,e[i]=s}},I=function(e){return e.constructor===Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)},E=function(e){return e.constructor===DataView?e:ArrayBuffer.isView(e)?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(e)},j=new TextDecoder,P=new TextEncoder,C=function(e){for(var t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0},A=function(e){return Object.fromEntries(Object.entries(e).map(function(e){var t=(0,f._)(e,2),r=t[0];return[t[1],r]}))},B={bt709:1,bt470bg:5,smpte170m:6,bt2020:9,smpte432:12},M=A(B),D={bt709:1,smpte170m:6,linear:8,"iec61966-2-1":13,pq:16,hlg:18},F=A(D),R={rgb:0,bt709:1,bt470bg:5,smpte170m:6,"bt2020-ncl":9},U=A(R),O=function(e){return!!e&&!!e.primaries&&!!e.transfer&&!!e.matrix&&void 0!==e.fullRange},N=function(e){return e instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer||ArrayBuffer.isView(e)},L=function(){"use strict";function e(){(0,c._)(this,e),this.currentPromise=Promise.resolve()}return(0,u._)(e,[{key:"acquire",value:function(){return(0,o._)(function(){var e,t,r;return(0,g._)(this,function(n){switch(n.label){case 0:return t=new Promise(function(t){e=t}),r=this.currentPromise,this.currentPromise=t,[4,r];case 1:return n.sent(),[2,e]}})}).call(this)}}]),e}(),z=function(e){return(0,h._)(e).map(function(e){return e.toString(16).padStart(2,"0")}).join("")},V=function(e){return(e=(e=(e=(e=(e=e>>1&0x55555555|(0x55555555&e)<<1)>>2&0x33333333|(0x33333333&e)<<2)>>4&0xf0f0f0f|(0xf0f0f0f&e)<<4)>>8&0xff00ff|(0xff00ff&e)<<8)>>16&65535|(65535&e)<<16)>>>0},H=function(e,t,r){for(var n=0,a=e.length-1,i=-1;n<=a;){var s=n+a>>1,o=r(e[s]);o===t?(i=s,a=s-1):o<t?n=s+1:a=s-1}return i},G=function(e,t,r){for(var n=0,a=e.length-1,i=-1;n<=a;){var s=n+(a-n+1)/2|0;r(e[s])<=t?(i=s,n=s+1):a=s-1}return i},q=function(e,t,r){var n=G(e,r(t),r);e.splice(n+1,0,t)},W=function(){var e,t;return{promise:new Promise(function(r,n){e=r,t=n}),resolve:e,reject:t}},K=function(e,t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)},X=function(e,t){for(var r=e.length-1;r>=0;r--)if(t(e[r]))return e[r]},Q=function(e,t){for(var r=e.length-1;r>=0;r--)if(t(e[r]))return r;return -1},Z=function(e){return(0,p._)(function(){return(0,g._)(this,function(t){switch(t.label){case 0:if(!(Symbol.iterator in e))return[3,2];return[5,(0,v._)((0,i._)((0,s._)(e[Symbol.iterator]())))];case 1:return t.sent(),[3,4];case 2:return[5,(0,v._)((0,i._)((0,s._)(e[Symbol.asyncIterator]())))];case 3:t.sent(),t.label=4;case 4:return[2]}})})()},Y=function(e){if(!(Symbol.iterator in e)&&!(Symbol.asyncIterator in e))throw TypeError("Argument must be an iterable or async iterable.")},J=function(e){throw Error("Unexpected value: ".concat(e))},$=function(e,t,r){var n=e.getUint8(t),a=e.getUint8(t+1),i=e.getUint8(t+2);return r?n|a<<8|i<<16:n<<16|a<<8|i},ee=function(e,t,r){return $(e,t,r)<<8>>8},et=function(e,t,r,n){r>>>=0,r&=0xffffff,n?(e.setUint8(t,255&r),e.setUint8(t+1,r>>>8&255),e.setUint8(t+2,r>>>16&255)):(e.setUint8(t,r>>>16&255),e.setUint8(t+1,r>>>8&255),e.setUint8(t+2,255&r))},er=function(e,t,r,n){(r=ei(r,-8388608,8388607))<0&&(r=r+0x1000000&0xffffff),et(e,t,r,n)},en=function(e,t,r,n){n?(e.setUint32(t+0,r,!0),e.setInt32(t+4,Math.floor(r/0x100000000),!0)):(e.setInt32(t+0,Math.floor(r/0x100000000),!0),e.setUint32(t+4,r,!0))},ea=function(e,t){return(0,l._)({next:function(){return(0,o._)(function(){var r;return(0,g._)(this,function(n){switch(n.label){case 0:return[4,e.next()];case 1:if((r=n.sent()).done)return[2,{value:void 0,done:!0}];return[2,{value:t(r.value),done:!1}]}})})()},return:function(){return e.return()},throw:function(t){return e.throw(t)}},Symbol.asyncIterator,function(){return this})},ei=function(e,t,r){return Math.max(t,Math.min(r,e))},es="und",eo=function(e){var t=Math.round(e);return Math.abs(e/t-1)<10*Number.EPSILON?t:e},ec=function(e,t){return Math.round(e/t)*t},eu=function(e){for(var t=0;e;)t++,e>>=1;return t},el=/^[a-z]{3}$/,ed=function(e){return el.test(e)},ef=1e6*(1+Number.EPSILON),eh=function(e,t){var r=(0,d._)({},e,t);if(e.headers||t.headers){var n=e.headers?em(e.headers):{},a=t.headers?em(t.headers):{},i=(0,d._)({},n);Object.entries(a).forEach(function(e){var t=(0,f._)(e,2),r=t[0],n=t[1],a=Object.keys(i).find(function(e){return e.toLowerCase()===r.toLowerCase()});a&&delete i[a],i[r]=n}),r.headers=i}return r},em=function(e){if(e instanceof Headers){var t={};return e.forEach(function(e,r){t[r]=e}),t}if(Array.isArray(e)){var r={};return e.forEach(function(e){var t=(0,f._)(e,2),n=t[0],a=t[1];r[n]=a}),r}return e},ep=function(e,t,r,n,a){return(0,o._)(function(){var i,s,o;return(0,g._)(this,function(c){switch(c.label){case 0:i=function(){var i,o,c;return(0,g._)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,5]),i={},[4,e(t,r)];case 1:return[2,(i.v=u.sent(),i)];case 2:if(o=u.sent(),a()||null===(c=n(++s,o,t)))throw o;if(console.error("Retrying failed fetch. Error:",o),!Number.isFinite(c)||c<0)throw TypeError("Retry delay must be a non-negative finite number.");if(!(c>0))return[3,4];return[4,new Promise(function(e){return setTimeout(e,1e3*c)})];case 3:u.sent(),u.label=4;case 4:if(a())throw o;return[3,5];case 5:return[2]}})},s=0,c.label=1;case 1:return[5,(0,v._)(i())];case 2:if(o=c.sent(),"object"===(0,m._)(o))return[2,o.v];return[3,1];case 3:return[2]}})})()},eg=function(e,t){for(var r=e<0?-1:1,n=0,a=1,i=1,s=0,o=e=Math.abs(e);;){var c=Math.floor(o),u=c*i+n,l=c*s+a;if(l>t||(n=i,a=s,i=u,s=l,!isFinite(o=1/(o-c))))break}return{numerator:r*i,denominator:s}},ev=function(){"use strict";function e(){(0,c._)(this,e),this.currentPromise=Promise.resolve()}return(0,u._)(e,[{key:"call",value:function(e){return this.currentPromise=this.currentPromise.then(e)}}]),e}(),eb=null,ey=function(){var e;return null!==eb?eb:eb=!!("u">typeof navigator&&((null==(e=navigator.vendor)?void 0:e.match(/apple/i))||/AppleWebKit/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)||/\b(iPad|iPhone|iPod)\b/.test(navigator.userAgent)))},ek=null,e_=function(){var e;return null!==ek?ek:ek="u">typeof navigator&&(null==(e=navigator.userAgent)?void 0:e.includes("Firefox"))},ew=null,eS=function(){var e;return null!==ew?ew:ew=!!("u">typeof navigator&&((null==(e=navigator.vendor)?void 0:e.includes("Google Inc"))||/Chrome/.test(navigator.userAgent)))},eT=null,ex=function(){if(null!==eT)return eT;if("u"<typeof navigator)return null;var e=/\bChrome\/(\d+)/.exec(navigator.userAgent);return e?eT=Number(e[1]):null},eI=function(e,t){return -1!==e?e:t},eE=function(e,t,r,n){return e<=n&&r<=t},ej=function(e){var t,r,n,a,i;return(0,g._)(this,function(s){switch(s.label){case 0:for(r in t=[],e)t.push(r);n=0,s.label=1;case 1:if(!(n<t.length))return[3,4];if(void 0===(i=e[a=t[n]]))return[3,3];return[4,{key:a,value:i}];case 2:s.sent(),s.label=3;case 3:return n++,[3,1];case 4:return[2]}})},eP=function(e){switch(e.toLowerCase()){case"image/jpeg":case"image/jpg":return".jpg";case"image/png":return".png";case"image/gif":return".gif";case"image/webp":return".webp";case"image/bmp":return".bmp";case"image/svg+xml":return".svg";case"image/tiff":return".tiff";case"image/avif":return".avif";case"image/x-icon":case"image/vnd.microsoft.icon":return".ico";default:return null}},eC=function(e){for(var t=atob(e),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r},eA=function(e){for(var t="",r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return btoa(t)},eB=function(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},eM=function(){var e;null!=(e=Symbol).dispose||(e.dispose=Symbol("Symbol.dispose"))},eD=function(e){return"number"==typeof e&&!Number.isNaN(e)}},{"@swc/helpers/cjs/_async_generator_delegate.cjs":"cj5hX","@swc/helpers/cjs/_async_iterator.cjs":"f3IhJ","@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_define_property.cjs":"ltU3W","@swc/helpers/cjs/_object_spread.cjs":"kyoEj","@swc/helpers/cjs/_sliced_to_array.cjs":"gIQTH","@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","@swc/helpers/cjs/_type_of.cjs":"iXhRw","@swc/helpers/cjs/_wrap_async_generator.cjs":"jAJTq","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","@swc/helpers/cjs/_ts_values.cjs":"94P5Q","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],cj5hX:[function(e,t,r,n){"use strict";var a=e("76fcdd7f180a7e89");r._=function(e){var t={},r=!1;function n(t,n){return r=!0,n=new Promise(function(r){r(e[t](n))}),{done:!1,value:new a._(n,1)}}return t["u">typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return r?(r=!1,e):n("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(r)throw r=!1,e;return n("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return r?(r=!1,e):n("return",e)}),t}},{"76fcdd7f180a7e89":"6nOfv"}],"6nOfv":[function(e,t,r,n){"use strict";r._=function(e,t){this.v=e,this.k=t}},{}],f3IhJ:[function(e,t,r,n){"use strict";function a(e){function t(e){if(Object(e)!==e)return Promise.reject(TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return(a=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new a(e)}r._=function(e){var t,r,n,i=2;for("u">typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new a(t.call(e));r="@@asyncIterator",n="@@iterator"}throw TypeError("Object is not async iterable")}},{}],jAJTq:[function(e,t,r,n){"use strict";var a=e("daf10f6c5064dcd0");r._=function(e){return function(){return new a._(e.apply(this,arguments))}}},{daf10f6c5064dcd0:"jrb7J"}],jrb7J:[function(e,t,r,n){"use strict";var a=e("b1fa00dbb84c97b3");function i(e){var t,r;function n(t,r){try{var s=e[t](r),o=s.value,c=o instanceof a._;Promise.resolve(c?o.v:o).then(function(r){if(c){var a="return"===t?"return":"next";if(!o.k||r.done)return n(a,r);r=e[a](r).value}i(s.done?"return":"normal",r)},function(e){n("throw",e)})}catch(e){i("throw",e)}}function i(e,a){switch(e){case"return":t.resolve({value:a,done:!0});break;case"throw":t.reject(a);break;default:t.resolve({value:a,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,a){return new Promise(function(i,s){var o={key:e,arg:a,resolve:i,reject:s,next:null};r?r=r.next=o:(t=r=o,n(e,a))})},"function"!=typeof e.return&&(this.return=void 0)}i.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},i.prototype.next=function(e){return this._invoke("next",e)},i.prototype.throw=function(e){return this._invoke("throw",e)},i.prototype.return=function(e){return this._invoke("return",e)},r._=i},{b1fa00dbb84c97b3:"6nOfv"}],kWTYV:[function(e,t,r,n){var a,i,s,o,c,u,l=e("@parcel/transformer-js/src/esmodule-helpers.js");l.defineInteropFlag(r),l.export(r,"AvcNalUnitType",function(){return o}),l.export(r,"HevcNalUnitType",function(){return c}),l.export(r,"findNalUnitsInAnnexB",function(){return p}),l.export(r,"concatNalUnitsInAnnexB",function(){return y}),l.export(r,"concatNalUnitsInLengthPrefixed",function(){return k}),l.export(r,"extractAvcNalUnits",function(){return _}),l.export(r,"concatAvcNalUnits",function(){return w}),l.export(r,"extractNalUnitTypeForAvc",function(){return S}),l.export(r,"extractAvcDecoderConfigurationRecord",function(){return T}),l.export(r,"serializeAvcDecoderConfigurationRecord",function(){return x}),l.export(r,"deserializeAvcDecoderConfigurationRecord",function(){return I}),l.export(r,"parseAvcSps",function(){return E}),l.export(r,"extractHevcNalUnits",function(){return j}),l.export(r,"extractNalUnitTypeForHevc",function(){return P}),l.export(r,"extractHevcDecoderConfigurationRecord",function(){return C}),l.export(r,"serializeHevcDecoderConfigurationRecord",function(){return O}),l.export(r,"extractVp9CodecInfoFromPacket",function(){return N}),l.export(r,"iterateAv1PacketObus",function(){return L}),l.export(r,"extractAv1CodecInfoFromPacket",function(){return z}),l.export(r,"parseOpusIdentificationHeader",function(){return V}),l.export(r,"parseOpusTocByte",function(){return G}),l.export(r,"parseModesFromVorbisSetupPacket",function(){return q}),l.export(r,"determineVideoPacketType",function(){return W}),l.export(r,"FlacBlockType",function(){return u}),l.export(r,"readVorbisComments",function(){return K}),l.export(r,"createVorbisComments",function(){return X});var d=e("@swc/helpers/cjs/_to_consumable_array.cjs"),f=e("@swc/helpers/cjs/_ts_generator.cjs"),h=e("./codec.js"),m=e("./misc.js");(a=o||(o={}))[a.IDR=5]="IDR",a[a.SEI=6]="SEI",a[a.SPS=7]="SPS",a[a.PPS=8]="PPS",a[a.SPS_EXT=13]="SPS_EXT",(i=c||(c={}))[i.RASL_N=8]="RASL_N",i[i.RASL_R=9]="RASL_R",i[i.BLA_W_LP=16]="BLA_W_LP",i[i.RSV_IRAP_VCL23=23]="RSV_IRAP_VCL23",i[i.VPS_NUT=32]="VPS_NUT",i[i.SPS_NUT=33]="SPS_NUT",i[i.PPS_NUT=34]="PPS_NUT",i[i.PREFIX_SEI_NUT=39]="PREFIX_SEI_NUT",i[i.SUFFIX_SEI_NUT=40]="SUFFIX_SEI_NUT";var p=function(e){for(var t=[],r=0;r<e.length;){for(var n=-1,a=0,i=r;i<e.length-3;i++){if(0===e[i]&&0===e[i+1]&&1===e[i+2]){n=i,a=3;break}if(i<e.length-4&&0===e[i]&&0===e[i+1]&&0===e[i+2]&&1===e[i+3]){n=i,a=4;break}}if(-1===n)break;if(r>0&&n>r){var s=e.subarray(r,n);s.length>0&&t.push(s)}r=n+a}if(r<e.length){var o=e.subarray(r);o.length>0&&t.push(o)}return t},g=function(e,t){for(var r=[],n=0,a=new DataView(e.buffer,e.byteOffset,e.byteLength);n+t<=e.length;){var i=void 0;1===t?i=a.getUint8(n):2===t?i=a.getUint16(n,!1):3===t?i=(0,m.getUint24)(a,n,!1):4===t?i=a.getUint32(n,!1):((0,m.assertNever)(t),(0,m.assert)(!1)),n+=t;var s=e.subarray(n,n+i);r.push(s),n+=i}return r},v=function(e){for(var t=[],r=e.length,n=0;n<r;n++)n+2<r&&0===e[n]&&0===e[n+1]&&3===e[n+2]?(t.push(0,0),n+=2):t.push(e[n]);return new Uint8Array(t)},b=new Uint8Array([0,0,0,1]),y=function(e){var t=new Uint8Array(e.reduce(function(e,t){return e+b.byteLength+t.byteLength},0)),r=0,n=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var c=s.value;t.set(b,r),r+=b.byteLength,t.set(c,r),r+=c.byteLength}}catch(e){a=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}return t},k=function(e,t){var r=new Uint8Array(e.reduce(function(e,r){return e+t+r.byteLength},0)),n=0,a=!0,i=!1,s=void 0;try{for(var o,c=e[Symbol.iterator]();!(a=(o=c.next()).done);a=!0){var u=o.value,l=new DataView(r.buffer,r.byteOffset,r.byteLength);switch(t){case 1:l.setUint8(n,u.byteLength);break;case 2:l.setUint16(n,u.byteLength,!1);break;case 3:(0,m.setUint24)(l,n,u.byteLength,!1);break;case 4:l.setUint32(n,u.byteLength,!1)}n+=t,r.set(u,n),n+=u.byteLength}}catch(e){i=!0,s=e}finally{try{a||null==c.return||c.return()}finally{if(i)throw s}}return r},_=function(e,t){return t.description?g(e,(3&(0,m.toUint8Array)(t.description)[4])+1):p(e)},w=function(e,t){return t.description?k(e,(3&(0,m.toUint8Array)(t.description)[4])+1):y(e)},S=function(e){return 31&e[0]},T=function(e){try{var t=p(e),r=t.filter(function(e){return S(e)===o.SPS}),n=t.filter(function(e){return S(e)===o.PPS}),a=t.filter(function(e){return S(e)===o.SPS_EXT});if(0===r.length||0===n.length)return null;var i=r[0],s=E(i);(0,m.assert)(null!==s);var c=100===s.profileIdc||110===s.profileIdc||122===s.profileIdc||144===s.profileIdc;return{configurationVersion:1,avcProfileIndication:s.profileIdc,profileCompatibility:s.constraintFlags,avcLevelIndication:s.levelIdc,lengthSizeMinusOne:3,sequenceParameterSets:r,pictureParameterSets:n,chromaFormat:c?s.chromaFormatIdc:null,bitDepthLumaMinus8:c?s.bitDepthLumaMinus8:null,bitDepthChromaMinus8:c?s.bitDepthChromaMinus8:null,sequenceParameterSetExt:c?a:null}}catch(e){return console.error("Error building AVC Decoder Configuration Record:",e),null}},x=function(e){var t=[];t.push(e.configurationVersion),t.push(e.avcProfileIndication),t.push(e.profileCompatibility),t.push(e.avcLevelIndication),t.push(252|3&e.lengthSizeMinusOne),t.push(224|31&e.sequenceParameterSets.length);var r=!0,n=!1,a=void 0;try{for(var i,s=e.sequenceParameterSets[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value,c=o.byteLength;t.push(c>>8),t.push(255&c);for(var u=0;u<c;u++)t.push(o[u])}}catch(e){n=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}t.push(e.pictureParameterSets.length);var l=!0,d=!1,f=void 0;try{for(var h,p=e.pictureParameterSets[Symbol.iterator]();!(l=(h=p.next()).done);l=!0){var g=h.value,v=g.byteLength;t.push(v>>8),t.push(255&v);for(var b=0;b<v;b++)t.push(g[b])}}catch(e){d=!0,f=e}finally{try{l||null==p.return||p.return()}finally{if(d)throw f}}if(100===e.avcProfileIndication||110===e.avcProfileIndication||122===e.avcProfileIndication||144===e.avcProfileIndication){(0,m.assert)(null!==e.chromaFormat),(0,m.assert)(null!==e.bitDepthLumaMinus8),(0,m.assert)(null!==e.bitDepthChromaMinus8),(0,m.assert)(null!==e.sequenceParameterSetExt),t.push(252|3&e.chromaFormat),t.push(248|7&e.bitDepthLumaMinus8),t.push(248|7&e.bitDepthChromaMinus8),t.push(e.sequenceParameterSetExt.length);var y=!0,k=!1,_=void 0;try{for(var w,S=e.sequenceParameterSetExt[Symbol.iterator]();!(y=(w=S.next()).done);y=!0){var T=w.value,x=T.byteLength;t.push(x>>8),t.push(255&x);for(var I=0;I<x;I++)t.push(T[I])}}catch(e){k=!0,_=e}finally{try{y||null==S.return||S.return()}finally{if(k)throw _}}}return new Uint8Array(t)},I=function(e){try{for(var t=(0,m.toDataView)(e),r=0,n=t.getUint8(r++),a=t.getUint8(r++),i=t.getUint8(r++),s=t.getUint8(r++),o=3&t.getUint8(r++),c=31&t.getUint8(r++),u=[],l=0;l<c;l++){var d=t.getUint16(r,!1);r+=2,u.push(e.subarray(r,r+d)),r+=d}for(var f=t.getUint8(r++),h=[],p=0;p<f;p++){var g=t.getUint16(r,!1);r+=2,h.push(e.subarray(r,r+g)),r+=g}var v={configurationVersion:n,avcProfileIndication:a,profileCompatibility:i,avcLevelIndication:s,lengthSizeMinusOne:o,sequenceParameterSets:u,pictureParameterSets:h,chromaFormat:null,bitDepthLumaMinus8:null,bitDepthChromaMinus8:null,sequenceParameterSetExt:null};if((100===a||110===a||122===a||144===a)&&r+4<=e.length){var b=3&t.getUint8(r++),y=7&t.getUint8(r++),k=7&t.getUint8(r++),_=t.getUint8(r++);v.chromaFormat=b,v.bitDepthLumaMinus8=y,v.bitDepthChromaMinus8=k;for(var w=[],S=0;S<_;S++){var T=t.getUint16(r,!1);r+=2,w.push(e.subarray(r,r+T)),r+=T}v.sequenceParameterSetExt=w}return v}catch(e){return console.error("Error deserializing AVC Decoder Configuration Record:",e),null}},E=function(e){try{var t=new(0,m.Bitstream)(v(e));t.skipBits(1),t.skipBits(2);var r=t.readBits(5);if(7!==r)return null;var n=t.readAlignedByte(),a=t.readAlignedByte(),i=t.readAlignedByte();(0,m.readExpGolomb)(t);var s=null,o=null,c=null;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n)&&(s=(0,m.readExpGolomb)(t),3===s&&t.skipBits(1),o=(0,m.readExpGolomb)(t),c=(0,m.readExpGolomb)(t),t.skipBits(1),t.readBits(1))){for(var u=0;u<(3!==s?8:12);u++)if(t.readBits(1))for(var l=u<6?16:64,d=8,f=8,h=0;h<l;h++){if(0!==f){var p=(0,m.readSignedExpGolomb)(t);f=(d+p+256)%256}d=0===f?d:f}}(0,m.readExpGolomb)(t);var g=(0,m.readExpGolomb)(t);if(0===g)(0,m.readExpGolomb)(t);else if(1===g){t.skipBits(1),(0,m.readSignedExpGolomb)(t),(0,m.readSignedExpGolomb)(t);for(var b=(0,m.readExpGolomb)(t),y=0;y<b;y++)(0,m.readSignedExpGolomb)(t)}(0,m.readExpGolomb)(t),t.skipBits(1),(0,m.readExpGolomb)(t),(0,m.readExpGolomb)(t);var k=t.readBits(1);return{profileIdc:n,constraintFlags:a,levelIdc:i,frameMbsOnlyFlag:k,chromaFormatIdc:s,bitDepthLumaMinus8:o,bitDepthChromaMinus8:c}}catch(e){return console.error("Error parsing AVC SPS:",e),null}},j=function(e,t){return t.description?g(e,(3&(0,m.toUint8Array)(t.description)[21])+1):p(e)},P=function(e){return e[0]>>1&63},C=function(e){try{var t=p(e),r=t.filter(function(e){return P(e)===c.VPS_NUT}),n=t.filter(function(e){return P(e)===c.SPS_NUT}),a=t.filter(function(e){return P(e)===c.PPS_NUT}),i=t.filter(function(e){return P(e)===c.PREFIX_SEI_NUT||P(e)===c.SUFFIX_SEI_NUT});if(0===n.length||0===a.length)return null;var s=n[0],o=new(0,m.Bitstream)(v(s));o.skipBits(16),o.readBits(4);var u=o.readBits(3),l=o.readBits(1),f=A(o,u),h=f.general_profile_space,g=f.general_tier_flag,b=f.general_profile_idc,y=f.general_profile_compatibility_flags,k=f.general_constraint_indicator_flags,_=f.general_level_idc;(0,m.readExpGolomb)(o);var w=(0,m.readExpGolomb)(o);3===w&&o.skipBits(1),(0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o),o.readBits(1)&&((0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o));var S=(0,m.readExpGolomb)(o),T=(0,m.readExpGolomb)(o);(0,m.readExpGolomb)(o);for(var x=o.readBits(1)?0:u,I=x;I<=u;I++)(0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o);(0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o),o.readBits(1)&&o.readBits(1)&&B(o),o.skipBits(1),o.skipBits(1),o.readBits(1)&&(o.skipBits(4),o.skipBits(4),(0,m.readExpGolomb)(o),(0,m.readExpGolomb)(o),o.skipBits(1));var E=(0,m.readExpGolomb)(o);if(M(o,E),o.readBits(1))for(var j=(0,m.readExpGolomb)(o),C=0;C<j;C++)(0,m.readExpGolomb)(o),o.skipBits(1);o.skipBits(1),o.skipBits(1);var D=0;o.readBits(1)&&(D=F(o,u));var R=0;if(a.length>0){var U=a[0],O=new(0,m.Bitstream)(v(U));O.skipBits(16),(0,m.readExpGolomb)(O),(0,m.readExpGolomb)(O),O.skipBits(1),O.skipBits(1),O.skipBits(3),O.skipBits(1),O.skipBits(1),(0,m.readExpGolomb)(O),(0,m.readExpGolomb)(O),(0,m.readSignedExpGolomb)(O),O.skipBits(1),O.skipBits(1),O.readBits(1)&&(0,m.readExpGolomb)(O),(0,m.readSignedExpGolomb)(O),(0,m.readSignedExpGolomb)(O),O.skipBits(1),O.skipBits(1),O.skipBits(1),O.skipBits(1);var N=O.readBits(1),L=O.readBits(1);R=N||L?N&&!L?2:!N&&L?3:0:0}var z=(0,d._)(r.length?[{arrayCompleteness:1,nalUnitType:c.VPS_NUT,nalUnits:r}]:[]).concat((0,d._)(n.length?[{arrayCompleteness:1,nalUnitType:c.SPS_NUT,nalUnits:n}]:[]),(0,d._)(a.length?[{arrayCompleteness:1,nalUnitType:c.PPS_NUT,nalUnits:a}]:[]),(0,d._)(i.length?[{arrayCompleteness:1,nalUnitType:P(i[0]),nalUnits:i}]:[]));return{configurationVersion:1,generalProfileSpace:h,generalTierFlag:g,generalProfileIdc:b,generalProfileCompatibilityFlags:y,generalConstraintIndicatorFlags:k,generalLevelIdc:_,minSpatialSegmentationIdc:D,parallelismType:R,chromaFormatIdc:w,bitDepthLumaMinus8:S,bitDepthChromaMinus8:T,avgFrameRate:0,constantFrameRate:0,numTemporalLayers:u+1,temporalIdNested:l,lengthSizeMinusOne:3,arrays:z}}catch(e){return console.error("Error building HEVC Decoder Configuration Record:",e),null}},A=function(e,t){for(var r=e.readBits(2),n=e.readBits(1),a=e.readBits(5),i=0,s=0;s<32;s++)i=i<<1|e.readBits(1);for(var o=new Uint8Array(6),c=0;c<6;c++)o[c]=e.readBits(8);for(var u=e.readBits(8),l=[],d=[],f=0;f<t;f++)l.push(e.readBits(1)),d.push(e.readBits(1));if(t>0)for(var h=t;h<8;h++)e.skipBits(2);for(var m=0;m<t;m++)l[m]&&e.skipBits(88),d[m]&&e.skipBits(8);return{general_profile_space:r,general_tier_flag:n,general_profile_idc:a,general_profile_compatibility_flags:i,general_constraint_indicator_flags:o,general_level_idc:u}},B=function(e){for(var t=0;t<4;t++)for(var r=0;r<(3===t?2:6);r++)if(e.readBits(1)){var n=Math.min(64,1<<4+(t<<1));t>1&&(0,m.readSignedExpGolomb)(e);for(var a=0;a<n;a++)(0,m.readSignedExpGolomb)(e)}else(0,m.readExpGolomb)(e)},M=function(e,t){for(var r=[],n=0;n<t;n++)r[n]=D(e,n,t,r)},D=function(e,t,r,n){var a,i=0,s=0,o=0;if(0!==t&&(s=e.readBits(1)),s){o=t===r?t-((0,m.readExpGolomb)(e)+1):t-1,e.readBits(1),(0,m.readExpGolomb)(e);for(var c=null!=(a=n[o])?a:0,u=0;u<=c;u++)e.readBits(1)||e.readBits(1);i=n[o]}else{for(var l=(0,m.readExpGolomb)(e),d=(0,m.readExpGolomb)(e),f=0;f<l;f++)(0,m.readExpGolomb)(e),e.readBits(1);for(var h=0;h<d;h++)(0,m.readExpGolomb)(e),e.readBits(1);i=l+d}return i},F=function(e,t){if(e.readBits(1)&&255===e.readBits(8)&&(e.readBits(16),e.readBits(16)),e.readBits(1)&&e.readBits(1),e.readBits(1)&&(e.readBits(3),e.readBits(1),e.readBits(1)&&(e.readBits(8),e.readBits(8),e.readBits(8))),e.readBits(1)&&((0,m.readExpGolomb)(e),(0,m.readExpGolomb)(e)),e.readBits(1),e.readBits(1),e.readBits(1),e.readBits(1)&&((0,m.readExpGolomb)(e),(0,m.readExpGolomb)(e),(0,m.readExpGolomb)(e),(0,m.readExpGolomb)(e)),e.readBits(1)&&(e.readBits(32),e.readBits(32),e.readBits(1)&&(0,m.readExpGolomb)(e),e.readBits(1)&&R(e,!0,t)),e.readBits(1)){e.readBits(1),e.readBits(1),e.readBits(1);var r=(0,m.readExpGolomb)(e);return(0,m.readExpGolomb)(e),(0,m.readExpGolomb)(e),(0,m.readExpGolomb)(e),(0,m.readExpGolomb)(e),r}return 0},R=function(e,t,r){var n=!1,a=!1,i=!1;t&&(n=1===e.readBits(1),a=1===e.readBits(1),(n||a)&&((i=1===e.readBits(1))&&(e.readBits(8),e.readBits(5),e.readBits(1),e.readBits(5)),e.readBits(4),e.readBits(4),i&&e.readBits(4),e.readBits(5),e.readBits(5),e.readBits(5)));for(var s=0;s<=r;s++){var o=1===e.readBits(1),c=!0;o||(c=1===e.readBits(1));var u=!1;c?(0,m.readExpGolomb)(e):u=1===e.readBits(1);var l=1;u||(l=(0,m.readExpGolomb)(e)+1),n&&U(e,l,i),a&&U(e,l,i)}},U=function(e,t,r){for(var n=0;n<t;n++)(0,m.readExpGolomb)(e),(0,m.readExpGolomb)(e),r&&((0,m.readExpGolomb)(e),(0,m.readExpGolomb)(e)),e.readBits(1)},O=function(e){var t=[];t.push(e.configurationVersion),t.push((3&e.generalProfileSpace)<<6|(1&e.generalTierFlag)<<5|31&e.generalProfileIdc),t.push(e.generalProfileCompatibilityFlags>>>24&255),t.push(e.generalProfileCompatibilityFlags>>>16&255),t.push(e.generalProfileCompatibilityFlags>>>8&255),t.push(255&e.generalProfileCompatibilityFlags),t.push.apply(t,(0,d._)(e.generalConstraintIndicatorFlags)),t.push(255&e.generalLevelIdc),t.push(240|e.minSpatialSegmentationIdc>>8&15),t.push(255&e.minSpatialSegmentationIdc),t.push(252|3&e.parallelismType),t.push(252|3&e.chromaFormatIdc),t.push(248|7&e.bitDepthLumaMinus8),t.push(248|7&e.bitDepthChromaMinus8),t.push(e.avgFrameRate>>8&255),t.push(255&e.avgFrameRate),t.push((3&e.constantFrameRate)<<6|(7&e.numTemporalLayers)<<3|(1&e.temporalIdNested)<<2|3&e.lengthSizeMinusOne),t.push(255&e.arrays.length);var r=!0,n=!1,a=void 0;try{for(var i,s=e.arrays[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value;t.push((1&o.arrayCompleteness)<<7|63&o.nalUnitType),t.push(o.nalUnits.length>>8&255),t.push(255&o.nalUnits.length);var c=!0,u=!1,l=void 0;try{for(var f,h=o.nalUnits[Symbol.iterator]();!(c=(f=h.next()).done);c=!0){var m=f.value;t.push(m.length>>8&255),t.push(255&m.length);for(var p=0;p<m.length;p++)t.push(m[p])}}catch(e){u=!0,l=e}finally{try{c||null==h.return||h.return()}finally{if(u)throw l}}}}catch(e){n=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}return new Uint8Array(t)},N=function(e){var t=new(0,m.Bitstream)(e);if(2!==t.readBits(2))return null;var r=t.readBits(1),n=(t.readBits(1)<<1)+r;if(3===n&&t.skipBits(1),1===t.readBits(1)||0!==t.readBits(1)||(t.skipBits(2),4817730!==t.readBits(24)))return null;var a=8;n>=2&&(a=t.readBits(1)?12:10);var i=t.readBits(3),s=0,o=0;if(7!==i)if(o=t.readBits(1),1===n||3===n){var c=t.readBits(1),u=t.readBits(1);s=c||u?c&&!u?2:1:3,t.skipBits(1)}else s=1;else s=3,o=1;var l=(t.readBits(16)+1)*(t.readBits(16)+1),d=(0,m.last)(h.VP9_LEVEL_TABLE).level,f=!0,p=!1,g=void 0;try{for(var v,b=h.VP9_LEVEL_TABLE[Symbol.iterator]();!(f=(v=b.next()).done);f=!0){var y=v.value;if(l<=y.maxPictureSize){d=y.level;break}}}catch(e){p=!0,g=e}finally{try{f||null==b.return||b.return()}finally{if(p)throw g}}return{profile:n,level:d,bitDepth:a,chromaSubsampling:s,videoFullRangeFlag:o,colourPrimaries:2===i?1:1===i?6:2,transferCharacteristics:2===i?1:1===i?6:2,matrixCoefficients:7===i?0:2===i?1:1===i?6:2}},L=function(e){var t,r,n,a,i,s,o;return(0,f._)(this,function(c){switch(c.label){case 0:t=new(0,m.Bitstream)(e),r=function(){for(var e=0,r=0;r<8;r++){var n=t.readAlignedByte();if(e|=(127&n)<<7*r,!(128&n))break;if(7===r&&128&n)return null}return e>=0xffffffff?null:e},c.label=1;case 1:if(!(t.getBitsLeft()>=8))return[3,3];if(t.skipBits(1),n=t.readBits(4),a=t.readBits(1),i=t.readBits(1),t.skipBits(1),a&&t.skipBits(8),s=void 0,i){if(null===(o=r()))return[2];s=o}else s=Math.floor(t.getBitsLeft()/8);return(0,m.assert)(t.pos%8==0),[4,{type:n,data:e.subarray(t.pos/8,t.pos/8+s)}];case 2:return c.sent(),t.skipBits(8*s),[3,1];case 3:return[2]}})},z=function(e){var t=!0,r=!1,n=void 0;try{for(var a,i=L(e)[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value,o=s.type,c=s.data;if(1===o){var u=new(0,m.Bitstream)(c),l=u.readBits(3);u.readBits(1);var d=u.readBits(1),f=0,h=0,p=0;if(d)f=u.readBits(5);else{if(u.readBits(1)&&(u.skipBits(32),u.skipBits(32),u.readBits(1)))return null;var g=u.readBits(1);g&&(p=u.readBits(5),u.skipBits(32),u.skipBits(5),u.skipBits(5));for(var v=u.readBits(5),b=0;b<=v;b++){u.skipBits(12);var y=u.readBits(5);if(0===b&&(f=y),y>7){var k=u.readBits(1);0===b&&(h=k)}if(g&&u.readBits(1)){var _=p+1;u.skipBits(_),u.skipBits(_),u.skipBits(1)}u.readBits(1)&&u.skipBits(4)}}var w=u.readBits(4),S=u.readBits(4),T=w+1;u.skipBits(T);var x=S+1;u.skipBits(x);if((d?0:u.readBits(1))&&(u.skipBits(4),u.skipBits(3)),u.skipBits(1),u.skipBits(1),u.skipBits(1),!d){u.skipBits(1),u.skipBits(1),u.skipBits(1),u.skipBits(1);var I=u.readBits(1);I&&(u.skipBits(1),u.skipBits(1));var E=u.readBits(1);(E?2:u.readBits(1))>0&&(u.readBits(1)||u.skipBits(1)),I&&u.skipBits(3)}u.skipBits(1),u.skipBits(1),u.skipBits(1);var j=u.readBits(1),P=8;2===l&&j?P=u.readBits(1)?12:10:l<=2&&(P=j?10:8);var C=0;1!==l&&(C=u.readBits(1));var A=1,B=1,M=0;return!C&&(0===l?(A=1,B=1):1===l?(A=0,B=0):12===P&&(A=u.readBits(1))&&(B=u.readBits(1)),A&&B&&(M=u.readBits(2))),{profile:l,level:f,tier:h,bitDepth:P,monochrome:C,chromaSubsamplingX:A,chromaSubsamplingY:B,chromaSamplePosition:M}}}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}return null},V=function(e){var t=(0,m.toDataView)(e),r=t.getUint8(9),n=t.getUint16(10,!0),a=t.getUint32(12,!0),i=t.getInt16(16,!0),s=t.getUint8(18),o=null;return s&&(o=e.subarray(19,21+r)),{outputChannelCount:r,preSkip:n,inputSampleRate:a,outputGain:i,channelMappingFamily:s,channelMappingTable:o}},H=[480,960,1920,2880,480,960,1920,2880,480,960,1920,2880,480,960,480,960,120,240,480,960,120,240,480,960,120,240,480,960,120,240,480,960],G=function(e){return{durationInSamples:H[e[0]>>3]}},q=function(e){if(e.length<7)throw Error("Setup header is too short.");if(5!==e[0])throw Error("Wrong packet type in Setup header.");if("vorbis"!==(t=String).fromCharCode.apply(t,(0,d._)(e.slice(1,7))))throw Error("Invalid packet signature in Setup header.");for(var t,r=e.length,n=new Uint8Array(r),a=0;a<r;a++)n[a]=e[r-1-a];for(var i=new(0,m.Bitstream)(n),s=0;i.getBitsLeft()>97;)if(1===i.readBits(1)){s=i.pos;break}if(0===s)throw Error("Invalid Setup header: framing bit not found.");for(var o=0,c=!1,u=0;i.getBitsLeft()>=97;){var l=i.pos,f=i.readBits(8),h=i.readBits(16),p=i.readBits(16);if(f>63||0!==h||0!==p){i.pos=l;break}if(i.skipBits(1),++o>64)break;i.clone().readBits(6)+1===o&&(c=!0,u=o)}if(!c)throw Error("Invalid Setup header: mode header not found.");if(u>63)throw Error("Unsupported mode count: ".concat(u,"."));var g=u;i.pos=0,i.skipBits(s);for(var v=Array(g).fill(0),b=g-1;b>=0;b--)i.skipBits(40),v[b]=i.readBits(1);return{modeBlockflags:v}},W=function(e,t,r){switch(e){case"avc":var n=_(r,t),a=n.some(function(e){return S(e)===o.IDR}),i=!0,s=!1,u=void 0;if(!a&&(!(0,m.isChromium)()||(0,m.getChromiumVersion)()>=144))try{for(var l,d=n[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var f=l.value;if(S(f)===o.SEI){var h=v(f),p=1;do{for(var g=0;;){var b=h[p++];if(void 0===b||(g+=b,b<255))break}for(var y=0;;){var k=h[p++];if(void 0===k||(y+=k,k<255))break}if(6===g){var w=new(0,m.Bitstream)(h);w.pos=8*p;var T=(0,m.readExpGolomb)(w),x=w.readBits(1);if(0===T&&1===x){a=!0;break}}p+=y}while(p<h.length-1)}}}catch(e){s=!0,u=e}finally{try{i||null==d.return||d.return()}finally{if(s)throw u}}return a?"key":"delta";case"hevc":return j(r,t).some(function(e){var t=P(e);return c.BLA_W_LP<=t&&t<=c.RSV_IRAP_VCL23})?"key":"delta";case"vp8":return 0==(1&r[0])?"key":"delta";case"vp9":var I=new(0,m.Bitstream)(r);if(2!==I.readBits(2))return null;var E=I.readBits(1);if(3===(I.readBits(1)<<1)+E&&I.skipBits(1),I.readBits(1))return null;return 0===I.readBits(1)?"key":"delta";case"av1":var C=!1,A=!0,B=!1,M=void 0;try{for(var D,F=L(r)[Symbol.iterator]();!(A=(D=F.next()).done);A=!0){var R=D.value,U=R.type,O=R.data;if(1===U){var N=new(0,m.Bitstream)(O);N.skipBits(4),C=!!N.readBits(1)}else if(3===U||6===U||7===U){if(C)return"key";var z=new(0,m.Bitstream)(O);if(z.readBits(1))return null;var V=z.readBits(2);return 0===V?"key":"delta"}}}catch(e){B=!0,M=e}finally{try{A||null==F.return||F.return()}finally{if(B)throw M}}return null;default:(0,m.assertNever)(e),(0,m.assert)(!1)}};(s=u||(u={}))[s.STREAMINFO=0]="STREAMINFO",s[s.VORBIS_COMMENT=4]="VORBIS_COMMENT",s[s.PICTURE=6]="PICTURE";var K=function(e,t){var r=(0,m.toDataView)(e),n=0,a=r.getUint32(n,!0);n+=4;var i=m.textDecoder.decode(e.subarray(n,n+a));n+=a,a>0&&(null!=t.raw||(t.raw={}),null!=(p=t.raw)[g="vendor"]||(p[g]=i));var s=r.getUint32(n,!0);n+=4;for(var o=0;o<s;o++){var c=r.getUint32(n,!0);n+=4;var u=m.textDecoder.decode(e.subarray(n,n+c));n+=c;var l=u.indexOf("=");if(-1!==l){var f=u.slice(0,l).toUpperCase(),h=u.slice(l+1);switch(null!=t.raw||(t.raw={}),null!=(v=t.raw)[f]||(v[f]=h),f){case"TITLE":null!=t.title||(t.title=h);break;case"DESCRIPTION":null!=t.description||(t.description=h);break;case"ARTIST":null!=t.artist||(t.artist=h);break;case"ALBUM":null!=t.album||(t.album=h);break;case"ALBUMARTIST":null!=t.albumArtist||(t.albumArtist=h);break;case"COMMENT":null!=t.comment||(t.comment=h);break;case"LYRICS":null!=t.lyrics||(t.lyrics=h);break;case"TRACKNUMBER":var p,g,v,b=h.split("/"),y=Number.parseInt(b[0],10),k=b[1]&&Number.parseInt(b[1],10);Number.isInteger(y)&&y>0&&(null!=t.trackNumber||(t.trackNumber=y)),k&&Number.isInteger(k)&&k>0&&(null!=t.tracksTotal||(t.tracksTotal=k));break;case"TRACKTOTAL":var _=Number.parseInt(h,10);Number.isInteger(_)&&_>0&&(null!=t.tracksTotal||(t.tracksTotal=_));break;case"DISCNUMBER":var w=h.split("/"),S=Number.parseInt(w[0],10),T=w[1]&&Number.parseInt(w[1],10);Number.isInteger(S)&&S>0&&(null!=t.discNumber||(t.discNumber=S)),T&&Number.isInteger(T)&&T>0&&(null!=t.discsTotal||(t.discsTotal=T));break;case"DISCTOTAL":var x=Number.parseInt(h,10);Number.isInteger(x)&&x>0&&(null!=t.discsTotal||(t.discsTotal=x));break;case"DATE":var I=new Date(h);Number.isNaN(I.getTime())||null!=t.date||(t.date=I);break;case"GENRE":null!=t.genre||(t.genre=h);break;case"METADATA_BLOCK_PICTURE":var E,j=(0,m.base64ToBytes)(h),P=(0,m.toDataView)(j),C=P.getUint32(0,!1),A=P.getUint32(4,!1),B=(E=String).fromCharCode.apply(E,(0,d._)(j.subarray(8,8+A))),M=P.getUint32(8+A,!1),D=m.textDecoder.decode(j.subarray(12+A,12+A+M)),F=P.getUint32(A+M+28),R=j.subarray(A+M+32,A+M+32+F);null!=t.images||(t.images=[]),t.images.push({data:R,mimeType:B,kind:3===C?"coverFront":4===C?"coverBack":"unknown",name:void 0,description:D||void 0})}}}},X=function(e,t,r){var n=[e],a=m.textEncoder.encode("Mediabunny"),i=new Uint8Array(4+a.length),s=new DataView(i.buffer);s.setUint32(0,a.length,!0),i.set(a,4),n.push(i);var o=new Set,c=function(e,t){var r="".concat(e,"=").concat(t),a=m.textEncoder.encode(r);(s=new DataView((i=new Uint8Array(4+a.length)).buffer)).setUint32(0,a.length,!0),i.set(a,4),n.push(i),o.add(e)},u=!0,l=!1,d=void 0;try{for(var f,h=(0,m.keyValueIterator)(t)[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var p=f.value,g=p.key,v=p.value;switch(g){case"title":c("TITLE",v);break;case"description":c("DESCRIPTION",v);break;case"artist":c("ARTIST",v);break;case"album":c("ALBUM",v);break;case"albumArtist":c("ALBUMARTIST",v);break;case"genre":c("GENRE",v);break;case"date":var b,y,k,_=null!=(k=null==(b=t.raw)?void 0:b.DATE)?k:null==(y=t.raw)?void 0:y.date;c("DATE",_&&"string"==typeof _?_:v.toISOString().slice(0,10));break;case"comment":c("COMMENT",v);break;case"lyrics":c("LYRICS",v);break;case"trackNumber":c("TRACKNUMBER",v.toString());break;case"tracksTotal":c("TRACKTOTAL",v.toString());break;case"discNumber":c("DISCNUMBER",v.toString());break;case"discsTotal":c("DISCTOTAL",v.toString());break;case"images":if(!r)break;var w=!0,S=!1,T=void 0;try{for(var x,I=v[Symbol.iterator]();!(w=(x=I.next()).done);w=!0){for(var E,j=x.value,P="coverFront"===j.kind?3:4*("coverBack"===j.kind),C=new Uint8Array(j.mimeType.length),A=0;A<j.mimeType.length;A++)C[A]=j.mimeType.charCodeAt(A);var B=m.textEncoder.encode(null!=(E=j.description)?E:""),M=new Uint8Array(8+C.length+4+B.length+16+4+j.data.length),D=(0,m.toDataView)(M);D.setUint32(0,P,!1),D.setUint32(4,C.length,!1),M.set(C,8),D.setUint32(8+C.length,B.length,!1),M.set(B,12+C.length),D.setUint32(28+C.length+B.length,j.data.length,!1),M.set(j.data,32+C.length+B.length);var F=(0,m.bytesToBase64)(M);c("METADATA_BLOCK_PICTURE",F)}}catch(e){S=!0,T=e}finally{try{w||null==I.return||I.return()}finally{if(S)throw T}}break;case"raw":break;default:(0,m.assertNever)(g)}}}catch(e){l=!0,d=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw d}}if(t.raw)for(var R in t.raw){var U,O=null!=(U=t.raw[R])?U:t.raw[R.toLowerCase()];"vendor"===R||null==O||o.has(R)||"string"==typeof O&&c(R,O)}var N=new Uint8Array(4);(0,m.toDataView)(N).setUint32(0,o.size,!0),n.splice(2,0,N);var L=new Uint8Array(n.reduce(function(e,t){return e+t.length},0)),z=0,V=!0,H=!1,G=void 0;try{for(var q,W=n[Symbol.iterator]();!(V=(q=W.next()).done);V=!0){var K=q.value;L.set(K,z),z+=K.length}}catch(e){H=!0,G=e}finally{try{V||null==W.return||W.return()}finally{if(H)throw G}}return L}},{"@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","./codec.js":"fXWqW","./misc.js":"j7iGm","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],d4thC:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Demuxer",function(){return s});var i=e("@swc/helpers/cjs/_class_call_check.cjs"),s=function e(t){"use strict";(0,i._)(this,e),this.input=t}},{"@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],b22CJ:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"InputTrack",function(){return v}),a.export(r,"InputVideoTrack",function(){return b}),a.export(r,"InputAudioTrack",function(){return y});var i=e("@swc/helpers/cjs/_async_iterator.cjs"),s=e("@swc/helpers/cjs/_async_to_generator.cjs"),o=e("@swc/helpers/cjs/_call_super.cjs"),c=e("@swc/helpers/cjs/_class_call_check.cjs"),u=e("@swc/helpers/cjs/_create_class.cjs"),l=e("@swc/helpers/cjs/_inherits.cjs"),d=e("@swc/helpers/cjs/_ts_generator.cjs"),f=e("./codec-data.js"),h=e("./custom-coder.js"),m=e("./media-sink.js"),p=e("./misc.js"),g=e("./packet.js"),v=function(){"use strict";function e(t,r){(0,c._)(this,e),this.input=t,this._backing=r}return(0,u._)(e,[{key:"isVideoTrack",value:function(){return this instanceof b}},{key:"isAudioTrack",value:function(){return this instanceof y}},{key:"id",get:function(){return this._backing.getId()}},{key:"internalCodecId",get:function(){return this._backing.getInternalCodecId()}},{key:"languageCode",get:function(){return this._backing.getLanguageCode()}},{key:"name",get:function(){return this._backing.getName()}},{key:"timeResolution",get:function(){return this._backing.getTimeResolution()}},{key:"disposition",get:function(){return this._backing.getDisposition()}},{key:"getFirstTimestamp",value:function(){return this._backing.getFirstTimestamp()}},{key:"computeDuration",value:function(){return this._backing.computeDuration()}},{key:"computePacketStats",value:function(){return(0,s._)(function(){var e,t,r,n,a,s,o,c,u,l,f,h,p,g=arguments;return(0,d._)(this,function(d){switch(d.label){case 0:e=g.length>0&&void 0!==g[0]?g[0]:1/0,t=new(0,m.EncodedPacketSink)(this),r=1/0,n=-1/0,a=0,s=0,o=!1,c=!1,d.label=1;case 1:d.trys.push([1,6,7,12]),l=(0,i._)(t.packets(void 0,void 0,{metadataOnly:!0})),d.label=2;case 2:return[4,l.next()];case 3:if(!(o=!(f=d.sent()).done)||(h=f.value,a>=e&&h.timestamp>=n))return[3,5];r=Math.min(r,h.timestamp),n=Math.max(n,h.timestamp+h.duration),a++,s+=h.byteLength,d.label=4;case 4:return o=!1,[3,2];case 5:return[3,12];case 6:return p=d.sent(),c=!0,u=p,[3,12];case 7:if(d.trys.push([7,,10,11]),!(o&&null!=l.return))return[3,9];return[4,l.return()];case 8:d.sent(),d.label=9;case 9:return[3,11];case 10:if(c)throw u;return[7];case 11:return[7];case 12:return[2,{packetCount:a,averagePacketRate:a?Number((a/(n-r)).toPrecision(16)):0,averageBitrate:a?Number((8*s/(n-r)).toPrecision(16)):0}]}})}).apply(this,arguments)}}]),e}(),b=function(e){"use strict";function t(e,r){var n;return(0,c._)(this,t),(n=(0,o._)(this,t,[e,r]))._backing=r,n}return(0,l._)(t,e),(0,u._)(t,[{key:"type",get:function(){return"video"}},{key:"codec",get:function(){return this._backing.getCodec()}},{key:"codedWidth",get:function(){return this._backing.getCodedWidth()}},{key:"codedHeight",get:function(){return this._backing.getCodedHeight()}},{key:"rotation",get:function(){return this._backing.getRotation()}},{key:"displayWidth",get:function(){return this._backing.getRotation()%180==0?this._backing.getCodedWidth():this._backing.getCodedHeight()}},{key:"displayHeight",get:function(){return this._backing.getRotation()%180==0?this._backing.getCodedHeight():this._backing.getCodedWidth()}},{key:"getColorSpace",value:function(){return this._backing.getColorSpace()}},{key:"hasHighDynamicRange",value:function(){return(0,s._)(function(){var e;return(0,d._)(this,function(t){switch(t.label){case 0:return[4,this._backing.getColorSpace()];case 1:return[2,"bt2020"===(e=t.sent()).primaries||"smpte432"===e.primaries||"pg"===e.transfer||"hlg"===e.transfer||"bt2020-ncl"===e.matrix]}})}).call(this)}},{key:"canBeTransparent",value:function(){return this._backing.canBeTransparent()}},{key:"getDecoderConfig",value:function(){return this._backing.getDecoderConfig()}},{key:"getCodecParameterString",value:function(){return(0,s._)(function(){var e,t;return(0,d._)(this,function(r){switch(r.label){case 0:return[4,this._backing.getDecoderConfig()];case 1:return[2,null!=(t=null==(e=r.sent())?void 0:e.codec)?t:null]}})}).call(this)}},{key:"canDecode",value:function(){return(0,s._)(function(){var e,t;return(0,d._)(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this._backing.getDecoderConfig()];case 1:if(!(e=r.sent()))return[2,!1];if(t=this._backing.getCodec(),(0,p.assert)(null!==t),h.customVideoDecoders.some(function(r){return r.supports(t,e)}))return[2,!0];if("u"<typeof VideoDecoder)return[2,!1];return[4,VideoDecoder.isConfigSupported(e)];case 2:return[2,!0===r.sent().supported];case 3:return console.error("Error during decodability check:",r.sent()),[2,!1];case 4:return[2]}})}).call(this)}},{key:"determinePacketType",value:function(e){return(0,s._)(function(){var t;return(0,d._)(this,function(r){switch(r.label){case 0:if(!(e instanceof g.EncodedPacket))throw TypeError("packet must be an EncodedPacket.");if(e.isMetadataOnly)throw TypeError("packet must not be metadata-only to determine its type.");if(null===this.codec)return[2,null];return[4,this.getDecoderConfig()];case 1:return t=r.sent(),(0,p.assert)(t),[2,(0,f.determineVideoPacketType)(this.codec,t,e.data)]}})}).call(this)}}]),t}(v),y=function(e){"use strict";function t(e,r){var n;return(0,c._)(this,t),(n=(0,o._)(this,t,[e,r]))._backing=r,n}return(0,l._)(t,e),(0,u._)(t,[{key:"type",get:function(){return"audio"}},{key:"codec",get:function(){return this._backing.getCodec()}},{key:"numberOfChannels",get:function(){return this._backing.getNumberOfChannels()}},{key:"sampleRate",get:function(){return this._backing.getSampleRate()}},{key:"getDecoderConfig",value:function(){return this._backing.getDecoderConfig()}},{key:"getCodecParameterString",value:function(){return(0,s._)(function(){var e,t;return(0,d._)(this,function(r){switch(r.label){case 0:return[4,this._backing.getDecoderConfig()];case 1:return[2,null!=(t=null==(e=r.sent())?void 0:e.codec)?t:null]}})}).call(this)}},{key:"canDecode",value:function(){return(0,s._)(function(){var e,t;return(0,d._)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),[4,this._backing.getDecoderConfig()];case 1:if(!(e=r.sent()))return[2,!1];if(t=this._backing.getCodec(),(0,p.assert)(null!==t),h.customAudioDecoders.some(function(r){return r.supports(t,e)}))return[2,!0];if(!e.codec.startsWith("pcm-"))return[3,2];return[2,!0];case 2:if("u"<typeof AudioDecoder)return[2,!1];return[4,AudioDecoder.isConfigSupported(e)];case 3:return[2,!0===r.sent().supported];case 4:return[3,6];case 5:return console.error("Error during decodability check:",r.sent()),[2,!1];case 6:return[2]}})}).call(this)}},{key:"determinePacketType",value:function(e){return(0,s._)(function(){return(0,d._)(this,function(t){if(!(e instanceof g.EncodedPacket))throw TypeError("packet must be an EncodedPacket.");return null===this.codec?[2,null]:[2,"key"]})}).call(this)}}]),t}(v)},{"@swc/helpers/cjs/_async_iterator.cjs":"f3IhJ","@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","./codec-data.js":"kWTYV","./custom-coder.js":"hAl48","./media-sink.js":"k0V9R","./misc.js":"j7iGm","./packet.js":"QfqGG","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],hAl48:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"CustomVideoDecoder",function(){return o}),a.export(r,"CustomAudioDecoder",function(){return c}),a.export(r,"CustomVideoEncoder",function(){return u}),a.export(r,"CustomAudioEncoder",function(){return l}),a.export(r,"customVideoDecoders",function(){return d}),a.export(r,"customAudioDecoders",function(){return f}),a.export(r,"customVideoEncoders",function(){return h}),a.export(r,"customAudioEncoders",function(){return m}),a.export(r,"registerDecoder",function(){return p}),a.export(r,"registerEncoder",function(){return g});var i=e("@swc/helpers/cjs/_class_call_check.cjs"),s=e("@swc/helpers/cjs/_create_class.cjs"),o=function(){"use strict";function e(){(0,i._)(this,e)}return(0,s._)(e,null,[{key:"supports",value:function(e,t){return!1}}]),e}(),c=function(){"use strict";function e(){(0,i._)(this,e)}return(0,s._)(e,null,[{key:"supports",value:function(e,t){return!1}}]),e}(),u=function(){"use strict";function e(){(0,i._)(this,e)}return(0,s._)(e,null,[{key:"supports",value:function(e,t){return!1}}]),e}(),l=function(){"use strict";function e(){(0,i._)(this,e)}return(0,s._)(e,null,[{key:"supports",value:function(e,t){return!1}}]),e}(),d=[],f=[],h=[],m=[],p=function(e){if(e.prototype instanceof o){if(d.includes(e))return void console.warn("Video decoder already registered.");d.push(e)}else if(e.prototype instanceof c){if(f.includes(e))return void console.warn("Audio decoder already registered.");f.push(e)}else throw TypeError("Decoder must be a CustomVideoDecoder or CustomAudioDecoder.")},g=function(e){if(e.prototype instanceof u){if(h.includes(e))return void console.warn("Video encoder already registered.");h.push(e)}else if(e.prototype instanceof l){if(m.includes(e))return void console.warn("Audio encoder already registered.");m.push(e)}else throw TypeError("Encoder must be a CustomVideoEncoder or CustomAudioEncoder.")}},{"@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],k0V9R:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"EncodedPacketSink",function(){return P}),a.export(r,"BaseMediaSampleSink",function(){return A}),a.export(r,"VideoSampleSink",function(){return F}),a.export(r,"CanvasSink",function(){return R}),a.export(r,"AudioSampleSink",function(){return N}),a.export(r,"AudioBufferSink",function(){return L});var i=e("@swc/helpers/cjs/_async_iterator.cjs"),s=e("@swc/helpers/cjs/_async_to_generator.cjs"),o=e("@swc/helpers/cjs/_call_super.cjs"),c=e("@swc/helpers/cjs/_class_call_check.cjs"),u=e("@swc/helpers/cjs/_create_class.cjs"),l=e("@swc/helpers/cjs/_define_property.cjs"),d=e("@swc/helpers/cjs/_inherits.cjs"),f=e("@swc/helpers/cjs/_object_spread.cjs"),h=e("@swc/helpers/cjs/_object_spread_props.cjs"),m=e("@swc/helpers/cjs/_sliced_to_array.cjs"),p=e("@swc/helpers/cjs/_type_of.cjs"),g=e("@swc/helpers/cjs/_ts_generator.cjs"),v=e("./codec.js"),b=e("./codec-data.js"),y=e("./custom-coder.js"),k=e("./input.js"),_=e("./input-track.js"),w=e("./misc.js"),S=e("./packet.js"),T=e("./pcm.js"),x=e("./sample.js"),I=function(e){if(!e||(void 0===e?"undefined":(0,p._)(e))!=="object")throw TypeError("options must be an object.");if(void 0!==e.metadataOnly&&"boolean"!=typeof e.metadataOnly)throw TypeError("options.metadataOnly, when defined, must be a boolean.");if(void 0!==e.verifyKeyPackets&&"boolean"!=typeof e.verifyKeyPackets)throw TypeError("options.verifyKeyPackets, when defined, must be a boolean.");if(e.verifyKeyPackets&&e.metadataOnly)throw TypeError("options.verifyKeyPackets and options.metadataOnly cannot be enabled together.")},E=function(e){if(!(0,w.isNumber)(e))throw TypeError("timestamp must be a number.")},j=function(e,t,r){return r.verifyKeyPackets?t.then(function(t){return(0,s._)(function(){var r;return(0,g._)(this,function(n){switch(n.label){case 0:if(!t||"delta"===t.type)return[2,t];return[4,e.determinePacketType(t)];case 1:return(r=n.sent())&&(t.type=r),[2,t]}})})()}):t},P=function(){"use strict";function e(t){if((0,c._)(this,e),!(t instanceof _.InputTrack))throw TypeError("track must be an InputTrack.");this._track=t}return(0,u._)(e,[{key:"getFirstPacket",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(I(e),this._track.input._disposed)throw new(0,k.InputDisposedError);return j(this._track,this._track._backing.getFirstPacket(e),e)}},{key:"getPacket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(E(e),I(t),this._track.input._disposed)throw new(0,k.InputDisposedError);return j(this._track,this._track._backing.getPacket(e,t),t)}},{key:"getNextPacket",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof S.EncodedPacket))throw TypeError("packet must be an EncodedPacket.");if(I(t),this._track.input._disposed)throw new(0,k.InputDisposedError);return j(this._track,this._track._backing.getNextPacket(e,t),t)}},{key:"getKeyPacket",value:function(e){return(0,s._)(function(e){var t,r,n=arguments;return(0,g._)(this,function(a){switch(a.label){case 0:if(t=n.length>1&&void 0!==n[1]?n[1]:{},E(e),I(t),this._track.input._disposed)throw new(0,k.InputDisposedError);if(!t.verifyKeyPackets)return[2,this._track._backing.getKeyPacket(e,t)];return[4,this._track._backing.getKeyPacket(e,t)];case 1:if(!(r=a.sent()))return[2,r];return(0,w.assert)("key"===r.type),[4,this._track.determinePacketType(r)];case 2:if("delta"===a.sent())return[2,this.getKeyPacket(r.timestamp-1/this._track.timeResolution,t)];return[2,r]}})}).apply(this,arguments)}},{key:"getNextKeyPacket",value:function(e){return(0,s._)(function(e){var t,r,n=arguments;return(0,g._)(this,function(a){switch(a.label){case 0:if(t=n.length>1&&void 0!==n[1]?n[1]:{},!(e instanceof S.EncodedPacket))throw TypeError("packet must be an EncodedPacket.");if(I(t),this._track.input._disposed)throw new(0,k.InputDisposedError);if(!t.verifyKeyPackets)return[2,this._track._backing.getNextKeyPacket(e,t)];return[4,this._track._backing.getNextKeyPacket(e,t)];case 1:if(!(r=a.sent()))return[2,r];return(0,w.assert)("key"===r.type),[4,this._track.determinePacketType(r)];case 2:if("delta"===a.sent())return[2,this.getNextKeyPacket(r,t)];return[2,r]}})}).apply(this,arguments)}},{key:"packets",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(void 0!==e&&!(e instanceof S.EncodedPacket))throw TypeError("startPacket must be an EncodedPacket.");if(void 0!==e&&e.isMetadataOnly&&!(null==r?void 0:r.metadataOnly))throw TypeError("startPacket can only be metadata-only if options.metadataOnly is enabled.");if(void 0!==t&&!(t instanceof S.EncodedPacket))throw TypeError("endPacket must be an EncodedPacket.");if(I(r),this._track.input._disposed)throw new(0,k.InputDisposedError);var n=[],a=(0,w.promiseWithResolvers)(),i=a.promise,o=a.resolve,c=(0,w.promiseWithResolvers)(),u=c.promise,d=c.resolve,f=!1,h=!1,m=null,p=[];(0,s._)(function(){var a,s,c,l;return(0,g._)(this,function(m){switch(m.label){case 0:if(null==e)return[3,1];return s=e,[3,3];case 1:return[4,this.getFirstPacket(r)];case 2:s=m.sent(),m.label=3;case 3:a=s,m.label=4;case 4:if(!(a&&!h&&!this._track.input._disposed)||t&&a.sequenceNumber>=(null==t?void 0:t.sequenceNumber))return[3,8];if(!(n.length>Math.max(2,p.length)))return[3,6];return u=(c=(0,w.promiseWithResolvers)()).promise,d=c.resolve,[4,u];case 5:return m.sent(),[3,4];case 6:return n.push(a),o(),i=(l=(0,w.promiseWithResolvers)()).promise,o=l.resolve,[4,this.getNextPacket(a,r)];case 7:return a=m.sent(),[3,4];case 8:return f=!0,o(),[2]}})}).call(this).catch(function(e){m||(m=e,o())});var v=this._track;return(0,l._)({next:function(){return(0,s._)(function(){var e,t;return(0,g._)(this,function(r){switch(r.label){case 0:if(!v.input._disposed)return[3,1];throw new(0,k.InputDisposedError);case 1:if(!h)return[3,2];return[2,{value:void 0,done:!0}];case 2:if(!m)return[3,3];throw m;case 3:if(!(n.length>0))return[3,4];for(e=n.shift(),t=performance.now(),p.push(t);p.length>0&&t-p[0]>=1e3;)p.shift();return d(),[2,{value:e,done:!1}];case 4:if(!f)return[3,5];return[2,{value:void 0,done:!0}];case 5:return[4,i];case 6:r.sent(),r.label=7;case 7:return[3,0];case 8:return[2]}})})()},return:function(){return(0,s._)(function(){return(0,g._)(this,function(e){return h=!0,d(),o(),[2,{value:void 0,done:!0}]})})()},throw:function(e){return(0,s._)(function(){return(0,g._)(this,function(t){throw e})})()}},Symbol.asyncIterator,function(){return this})}}]),e}(),C=function e(t,r){"use strict";(0,c._)(this,e),this.onSample=t,this.onError=r},A=function(){"use strict";function e(){(0,c._)(this,e)}return(0,u._)(e,[{key:"mediaSamplesInRange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;E(e),E(t);var r=[],n=!1,a=null,i=(0,w.promiseWithResolvers)(),o=i.promise,c=i.resolve,u=(0,w.promiseWithResolvers)(),d=u.promise,f=u.resolve,h=!1,m=!1,p=!1,v=null;(0,s._)(function(){var i,s,u,l,b,y,k,_,S,T,x,I,E,j,P;return(0,g._)(this,function(g){switch(g.label){case 0:return[4,this._createDecoder(function(i){if(f(),i.timestamp>=t&&(m=!0),m)return void i.close();if(a&&(i.timestamp>e?(r.push(a),n=!0):a.close()),i.timestamp>=e&&(r.push(i),n=!0),a=n?null:i,r.length>0){var s;c(),o=(s=(0,w.promiseWithResolvers)()).promise,c=s.resolve}},function(e){v||(v=e,c())})];case 1:return i=g.sent(),[4,(s=this._createPacketSink()).getKeyPacket(e,{verifyKeyPackets:!0})];case 2:if(null==(u=g.sent()))return[3,3];return b=u,[3,5];case 3:return[4,s.getFirstPacket()];case 4:b=g.sent(),g.label=5;case 5:if(y=l=b,k=void 0,!(t<1/0))return[3,12];return[4,s.getPacket(t)];case 6:if(_=g.sent())return[3,7];return T=null,[3,11];case 7:if("key"!==_.type||_.timestamp!==t)return[3,8];return x=_,[3,10];case 8:return[4,s.getNextKeyPacket(_,{verifyKeyPackets:!0})];case 9:x=g.sent(),g.label=10;case 10:T=x,g.label=11;case 11:(S=T)&&(k=S),g.label=12;case 12:return[4,(I=s.packets(null!=l?l:void 0,k)).next()];case 13:g.sent(),g.label=14;case 14:if(!(y&&!m&&!this._track.input._disposed))return[3,18];if(E=B(r.length),!(r.length+i.getDecodeQueueSize()>E))return[3,16];return d=(j=(0,w.promiseWithResolvers)()).promise,f=j.resolve,[4,d];case 15:return g.sent(),[3,14];case 16:return i.decode(y),[4,I.next()];case 17:if((P=g.sent()).done)return[3,18];return y=P.value,[3,14];case 18:return[4,I.return()];case 19:if(g.sent(),!(!p&&!this._track.input._disposed))return[3,21];return[4,i.flush()];case 20:g.sent(),g.label=21;case 21:return i.close(),!n&&a&&r.push(a),h=!0,c(),[2]}})}).call(this).catch(function(e){v||(v=e,c())});var b=this._track,y=function(){null==a||a.close();var e=!0,t=!1,n=void 0;try{for(var i,s=r[Symbol.iterator]();!(e=(i=s.next()).done);e=!0)i.value.close()}catch(e){t=!0,n=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}};return(0,l._)({next:function(){return(0,s._)(function(){var e;return(0,g._)(this,function(t){switch(t.label){case 0:if(!b.input._disposed)return[3,1];throw y(),new(0,k.InputDisposedError);case 1:if(!p)return[3,2];return[2,{value:void 0,done:!0}];case 2:if(!v)return[3,3];throw y(),v;case 3:if(!(r.length>0))return[3,4];return e=r.shift(),f(),[2,{value:e,done:!1}];case 4:if(h)return[3,6];return[4,o];case 5:return t.sent(),[3,7];case 6:return[2,{value:void 0,done:!0}];case 7:return[3,0];case 8:return[2]}})})()},return:function(){return(0,s._)(function(){return(0,g._)(this,function(e){return p=!0,m=!0,f(),c(),y(),[2,{value:void 0,done:!0}]})})()},throw:function(e){return(0,s._)(function(){return(0,g._)(this,function(t){throw e})})()}},Symbol.asyncIterator,function(){return this})}},{key:"mediaSamplesAtTimestamps",value:function(e){(0,w.validateAnyIterable)(e);var t=(0,w.toAsyncIterator)(e),r=[],n=[],a=(0,w.promiseWithResolvers)(),o=a.promise,c=a.resolve,u=(0,w.promiseWithResolvers)(),d=u.promise,f=u.resolve,h=!1,m=!1,p=null,v=function(e){var t;n.push(e),c(),o=(t=(0,w.promiseWithResolvers)()).promise,c=t.resolve};(0,s._)(function(){var e,a,o,u,l,b,y,k,_,S,T,x,I,j,P,C,A;return(0,g._)(this,function(M){switch(M.label){case 0:return[4,this._createDecoder(function(e){if(f(),m)return void e.close();for(var t=0;r.length>0&&e.timestamp-r[0]>-1e-10;)t++,r.shift();if(t>0)for(var n=0;n<t;n++)v(n<t-1?e.clone():e);else e.close()},function(e){p||(p=e,c())})];case 1:e=M.sent(),a=this._createPacketSink(),o=null,u=null,l=-1,b=function(){return(0,s._)(function(){var t,r,i,s;return(0,g._)(this,function(o){switch(o.label){case 0:(0,w.assert)(u),t=u,e.decode(t),o.label=1;case 1:if(!(t.sequenceNumber<l))return[3,6];r=B(n.length),o.label=2;case 2:if(!(n.length+e.getDecodeQueueSize()>r&&!m))return[3,4];return d=(i=(0,w.promiseWithResolvers)()).promise,f=i.resolve,[4,d];case 3:return o.sent(),[3,2];case 4:if(m)return[3,6];return[4,a.getNextPacket(t)];case 5:return s=o.sent(),(0,w.assert)(s),e.decode(s),t=s,[3,1];case 6:return l=-1,[2]}})})()},y=function(){return(0,s._)(function(){var t;return(0,g._)(this,function(n){switch(n.label){case 0:return[4,e.flush()];case 1:for(n.sent(),t=0;t<r.length;t++)v(null);return r.length=0,[2]}})})()},k=!1,_=!1,M.label=2;case 2:M.trys.push([2,17,18,23]),T=(0,i._)(t),M.label=3;case 3:return[4,T.next()];case 4:if(!(k=!(x=M.sent()).done)||(E(I=x.value),m||this._track.input._disposed))return[3,16];return[4,a.getPacket(I)];case 5:if(!(C=j=M.sent()))return[3,7];return[4,a.getKeyPacket(I,{verifyKeyPackets:!0})];case 6:C=M.sent(),M.label=7;case 7:if(P=C)return[3,11];if(-1===l)return[3,10];return[4,b()];case 8:return M.sent(),[4,y()];case 9:M.sent(),M.label=10;case 10:return v(null),o=null,[3,15];case 11:if(!(o&&(P.sequenceNumber!==u.sequenceNumber||j.timestamp<o.timestamp)))return[3,14];return[4,b()];case 12:return M.sent(),[4,y()];case 13:M.sent(),M.label=14;case 14:r.push(j.timestamp),l=Math.max(j.sequenceNumber,l),o=j,u=P,M.label=15;case 15:return k=!1,[3,3];case 16:return[3,23];case 17:return A=M.sent(),_=!0,S=A,[3,23];case 18:if(M.trys.push([18,,21,22]),!(k&&null!=T.return))return[3,20];return[4,T.return()];case 19:M.sent(),M.label=20;case 20:return[3,22];case 21:if(_)throw S;return[7];case 22:return[7];case 23:if(!(!m&&!this._track.input._disposed))return[3,27];if(-1===l)return[3,25];return[4,b()];case 24:M.sent(),M.label=25;case 25:return[4,y()];case 26:M.sent(),M.label=27;case 27:return e.close(),h=!0,c(),[2]}})}).call(this).catch(function(e){p||(p=e,c())});var b=this._track,y=function(){var e=!0,t=!1,r=void 0;try{for(var a,i=n[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var s=a.value;null==s||s.close()}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}};return(0,l._)({next:function(){return(0,s._)(function(){var e;return(0,g._)(this,function(t){switch(t.label){case 0:if(!b.input._disposed)return[3,1];throw y(),new(0,k.InputDisposedError);case 1:if(!m)return[3,2];return[2,{value:void 0,done:!0}];case 2:if(!p)return[3,3];throw y(),p;case 3:if(!(n.length>0))return[3,4];return e=n.shift(),(0,w.assert)(void 0!==e),f(),[2,{value:e,done:!1}];case 4:if(h)return[3,6];return[4,o];case 5:return t.sent(),[3,7];case 6:return[2,{value:void 0,done:!0}];case 7:return[3,0];case 8:return[2]}})})()},return:function(){return(0,s._)(function(){return(0,g._)(this,function(e){return m=!0,f(),c(),y(),[2,{value:void 0,done:!0}]})})()},throw:function(e){return(0,s._)(function(){return(0,g._)(this,function(t){throw e})})()}},Symbol.asyncIterator,function(){return this})}}]),e}(),B=function(e){return 0===e?40:8},M=function(e){"use strict";function t(e,r,n,a,i,s){(0,c._)(this,t),(u=(0,o._)(this,t,[e,r])).codec=n,u.decoderConfig=a,u.rotation=i,u.timeResolution=s,u.decoder=null,u.customDecoder=null,u.customDecoderCallSerializer=new(0,w.CallSerializer),u.customDecoderQueueSize=0,u.inputTimestamps=[],u.sampleQueue=[],u.currentPacketIndex=0,u.raslSkipped=!1,u.alphaDecoder=null,u.alphaHadKeyframe=!1,u.colorQueue=[],u.alphaQueue=[],u.merger=null,u.mergerCreationFailed=!1,u.decodedAlphaChunkCount=0,u.alphaDecoderQueueSize=0,u.nullAlphaFrameQueue=[],u.currentAlphaPacketIndex=0,u.alphaRaslSkipped=!1;var u,l=y.customVideoDecoders.find(function(e){return e.supports(n,a)});if(l)u.customDecoder=new l,u.customDecoder.codec=n,u.customDecoder.config=a,u.customDecoder.onSample=function(e){if(!(e instanceof x.VideoSample))throw TypeError("The argument passed to onSample must be a VideoSample.");u.finalizeAndEmitSample(e)},u.customDecoderCallSerializer.call(function(){return u.customDecoder.init()});else{var d=function(e){if(u.alphaQueue.length>0){var t=u.alphaQueue.shift();(0,w.assert)(void 0!==t),u.mergeAlpha(e,t)}else u.colorQueue.push(e)};if("avc"===n&&u.decoderConfig.description&&(0,w.isChromium)()){var m=(0,b.deserializeAvcDecoderConfigurationRecord)((0,w.toUint8Array)(u.decoderConfig.description));if(m&&m.sequenceParameterSets.length>0){var p=(0,b.parseAvcSps)(m.sequenceParameterSets[0]);p&&0===p.frameMbsOnlyFlag&&(u.decoderConfig=(0,h._)((0,f._)({},u.decoderConfig),{hardwareAcceleration:"prefer-software"}))}}var g=Error("Decoding error").stack;u.decoder=new VideoDecoder({output:function(e){try{d(e)}catch(e){u.onError(e)}},error:function(e){e.stack=g,u.onError(e)}}),u.decoder.configure(u.decoderConfig)}return u}return(0,d._)(t,e),(0,u._)(t,[{key:"getDecodeQueueSize",value:function(){var e,t;return this.customDecoder?this.customDecoderQueueSize:((0,w.assert)(this.decoder),Math.max(this.decoder.decodeQueueSize,null!=(t=null==(e=this.alphaDecoder)?void 0:e.decodeQueueSize)?t:0))}},{key:"decode",value:function(e){var t=this;if("hevc"===this.codec&&this.currentPacketIndex>0&&!this.raslSkipped){if(this.hasHevcRaslPicture(e.data))return;this.raslSkipped=!0}if(this.customDecoder)this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(function(){return t.customDecoder.decode(e)}).then(function(){return t.customDecoderQueueSize--});else{if((0,w.assert)(this.decoder),(0,w.isWebKit)()||(0,w.insertSorted)(this.inputTimestamps,e.timestamp,function(e){return e}),(0,w.isChromium)()&&0===this.currentPacketIndex&&"avc"===this.codec){var r=(0,b.extractAvcNalUnits)(e.data,this.decoderConfig).filter(function(e){var t=(0,b.extractNalUnitTypeForAvc)(e);return!(t>=20&&t<=31)}),n=(0,b.concatAvcNalUnits)(r,this.decoderConfig);e=new(0,S.EncodedPacket)(n,e.type,e.timestamp,e.duration)}this.decoder.decode(e.toEncodedVideoChunk()),this.decodeAlphaData(e)}this.currentPacketIndex++}},{key:"decodeAlphaData",value:function(e){var t=this;if(!e.sideData.alpha||this.mergerCreationFailed)return void this.pushNullAlphaFrame();if(!this.merger)try{this.merger=new D}catch(t){console.error("Due to an error, only color data will be decoded.",t),this.mergerCreationFailed=!0,this.decodeAlphaData(e);return}if(!this.alphaDecoder){var r=function(e){if(t.alphaDecoderQueueSize--,t.colorQueue.length>0){var r=t.colorQueue.shift();(0,w.assert)(void 0!==r),t.mergeAlpha(r,e)}else t.alphaQueue.push(e);for(t.decodedAlphaChunkCount++;t.nullAlphaFrameQueue.length>0&&t.nullAlphaFrameQueue[0]===t.decodedAlphaChunkCount;)if(t.nullAlphaFrameQueue.shift(),t.colorQueue.length>0){var n=t.colorQueue.shift();(0,w.assert)(void 0!==n),t.mergeAlpha(n,null)}else t.alphaQueue.push(null)},n=Error("Decoding error").stack;this.alphaDecoder=new VideoDecoder({output:function(e){try{r(e)}catch(e){t.onError(e)}},error:function(e){e.stack=n,t.onError(e)}}),this.alphaDecoder.configure(this.decoderConfig)}var a=(0,b.determineVideoPacketType)(this.codec,this.decoderConfig,e.sideData.alpha);if(this.alphaHadKeyframe||(this.alphaHadKeyframe="key"===a),this.alphaHadKeyframe){if("hevc"===this.codec&&this.currentAlphaPacketIndex>0&&!this.alphaRaslSkipped){if(this.hasHevcRaslPicture(e.sideData.alpha))return void this.pushNullAlphaFrame();this.alphaRaslSkipped=!0}this.currentAlphaPacketIndex++,this.alphaDecoder.decode(e.alphaToEncodedVideoChunk(null!=a?a:e.type)),this.alphaDecoderQueueSize++}else this.pushNullAlphaFrame()}},{key:"pushNullAlphaFrame",value:function(){0===this.alphaDecoderQueueSize?this.alphaQueue.push(null):this.nullAlphaFrameQueue.push(this.decodedAlphaChunkCount+this.alphaDecoderQueueSize)}},{key:"hasHevcRaslPicture",value:function(e){return(0,b.extractHevcNalUnits)(e,this.decoderConfig).some(function(e){var t=(0,b.extractNalUnitTypeForHevc)(e);return t===b.HevcNalUnitType.RASL_N||t===b.HevcNalUnitType.RASL_R})}},{key:"sampleHandler",value:function(e){if((0,w.isWebKit)()){if(this.sampleQueue.length>0&&e.timestamp>=(0,w.last)(this.sampleQueue).timestamp){var t=!0,r=!1,n=void 0;try{for(var a,i=this.sampleQueue[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;this.finalizeAndEmitSample(s)}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}this.sampleQueue.length=0}(0,w.insertSorted)(this.sampleQueue,e,function(e){return e.timestamp})}else{var o=this.inputTimestamps.shift();(0,w.assert)(void 0!==o),e.setTimestamp(o),this.finalizeAndEmitSample(e)}}},{key:"finalizeAndEmitSample",value:function(e){e.setTimestamp(Math.round(e.timestamp*this.timeResolution)/this.timeResolution),e.setDuration(Math.round(e.duration*this.timeResolution)/this.timeResolution),e.setRotation(this.rotation),this.onSample(e)}},{key:"mergeAlpha",value:function(e,t){if(!t){var r,n=new(0,x.VideoSample)(e);this.sampleHandler(n);return}(0,w.assert)(this.merger),this.merger.update(e,t),e.close(),t.close();var a=new VideoFrame(this.merger.canvas,{timestamp:e.timestamp,duration:null!=(r=e.duration)?r:void 0}),i=new(0,x.VideoSample)(a);this.sampleHandler(i)}},{key:"flush",value:function(){return(0,s._)(function(){var e,t,r,n,a,i,s,o;return(0,g._)(this,function(c){switch(c.label){case 0:if(e=this,!this.customDecoder)return[3,2];return[4,this.customDecoderCallSerializer.call(function(){return e.customDecoder.flush()})];case 1:return c.sent(),[3,4];case 2:return(0,w.assert)(this.decoder),[4,Promise.all([this.decoder.flush(),null==(t=this.alphaDecoder)?void 0:t.flush()])];case 3:c.sent(),this.colorQueue.forEach(function(e){return e.close()}),this.colorQueue.length=0,this.alphaQueue.forEach(function(e){return null==e?void 0:e.close()}),this.alphaQueue.length=0,this.alphaHadKeyframe=!1,this.decodedAlphaChunkCount=0,this.alphaDecoderQueueSize=0,this.nullAlphaFrameQueue.length=0,this.currentAlphaPacketIndex=0,this.alphaRaslSkipped=!1,c.label=4;case 4:if((0,w.isWebKit)()){r=!0,n=!1,a=void 0;try{for(i=this.sampleQueue[Symbol.iterator]();!(r=(s=i.next()).done);r=!0)o=s.value,this.finalizeAndEmitSample(o)}catch(e){n=!0,a=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}this.sampleQueue.length=0}return this.currentPacketIndex=0,this.raslSkipped=!1,[2]}})}).call(this)}},{key:"close",value:function(){var e=this;this.customDecoder?this.customDecoderCallSerializer.call(function(){return e.customDecoder.close()}):((0,w.assert)(this.decoder),this.decoder.close(),null==(a=this.alphaDecoder)||a.close(),this.colorQueue.forEach(function(e){return e.close()}),this.colorQueue.length=0,this.alphaQueue.forEach(function(e){return null==e?void 0:e.close()}),this.alphaQueue.length=0,null==(i=this.merger)||i.close());var t=!0,r=!1,n=void 0;try{for(var a,i,s,o=this.sampleQueue[Symbol.iterator]();!(t=(s=o.next()).done);t=!0)s.value.close()}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}this.sampleQueue.length=0}}]),t}(C),D=function(){"use strict";function e(){(0,c._)(this,e),"u">typeof OffscreenCanvas?this.canvas=new OffscreenCanvas(300,150):this.canvas=document.createElement("canvas");var t=this.canvas.getContext("webgl2",{premultipliedAlpha:!1});if(!t)throw Error("Couldn't acquire WebGL 2 context.");this.gl=t,this.program=this.createProgram(),this.vao=this.createVAO(),this.colorTexture=this.createTexture(),this.alphaTexture=this.createTexture(),this.gl.useProgram(this.program),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_colorTexture"),0),this.gl.uniform1i(this.gl.getUniformLocation(this.program,"u_alphaTexture"),1)}return(0,u._)(e,[{key:"createProgram",value:function(){var e=this.createShader(this.gl.VERTEX_SHADER,"#version 300 es\n in vec2 a_position;\n in vec2 a_texCoord;\n out vec2 v_texCoord;\n \n void main() {\n gl_Position = vec4(a_position, 0.0, 1.0);\n v_texCoord = a_texCoord;\n }\n "),t=this.createShader(this.gl.FRAGMENT_SHADER,"#version 300 es\n precision highp float;\n \n uniform sampler2D u_colorTexture;\n uniform sampler2D u_alphaTexture;\n in vec2 v_texCoord;\n out vec4 fragColor;\n \n void main() {\n vec3 color = texture(u_colorTexture, v_texCoord).rgb;\n float alpha = texture(u_alphaTexture, v_texCoord).r;\n fragColor = vec4(color, alpha);\n }\n "),r=this.gl.createProgram();return this.gl.attachShader(r,e),this.gl.attachShader(r,t),this.gl.linkProgram(r),r}},{key:"createShader",value:function(e,t){var r=this.gl.createShader(e);return this.gl.shaderSource(r,t),this.gl.compileShader(r),r}},{key:"createVAO",value:function(){var e=this.gl.createVertexArray();this.gl.bindVertexArray(e);var t=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),r=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,r),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW);var n=this.gl.getAttribLocation(this.program,"a_position"),a=this.gl.getAttribLocation(this.program,"a_texCoord");return this.gl.enableVertexAttribArray(n),this.gl.vertexAttribPointer(n,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(a),this.gl.vertexAttribPointer(a,2,this.gl.FLOAT,!1,16,8),e}},{key:"createTexture",value:function(){var e=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}},{key:"update",value:function(e,t){(e.displayWidth!==this.canvas.width||e.displayHeight!==this.canvas.height)&&(this.canvas.width=e.displayWidth,this.canvas.height=e.displayHeight),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colorTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.alphaTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.bindVertexArray(this.vao),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}},{key:"close",value:function(){var e;null==(e=this.gl.getExtension("WEBGL_lose_context"))||e.loseContext(),this.gl=null}}]),e}(),F=function(e){"use strict";function t(e){var r;if((0,c._)(this,t),!(e instanceof _.InputVideoTrack))throw TypeError("videoTrack must be an InputVideoTrack.");return(r=(0,o._)(this,t))._track=e,r}return(0,d._)(t,e),(0,u._)(t,[{key:"_createDecoder",value:function(e,t){return(0,s._)(function(){var r,n,a,i;return(0,g._)(this,function(s){switch(s.label){case 0:return[4,this._track.canDecode()];case 1:if(!s.sent())throw Error("This video track cannot be decoded by this browser. Make sure to check decodability before using a track.");return r=this._track.codec,n=this._track.rotation,[4,this._track.getDecoderConfig()];case 2:return a=s.sent(),i=this._track.timeResolution,(0,w.assert)(r&&a),[2,new M(e,t,r,a,n,i)]}})}).call(this)}},{key:"_createPacketSink",value:function(){return new P(this._track)}},{key:"getSample",value:function(e){return(0,s._)(function(){var t,r,n,a,s,o;return(0,g._)(this,function(c){switch(c.label){case 0:E(e),t=!1,r=!1,c.label=1;case 1:c.trys.push([1,6,7,12]),a=(0,i._)(this.mediaSamplesAtTimestamps([e])),c.label=2;case 2:return[4,a.next()];case 3:if(!(t=!(s=c.sent()).done))return[3,5];return[2,s.value];case 4:return t=!1,[3,2];case 5:return[3,12];case 6:return o=c.sent(),r=!0,n=o,[3,12];case 7:if(c.trys.push([7,,10,11]),!(t&&null!=a.return))return[3,9];return[4,a.return()];case 8:c.sent(),c.label=9;case 9:return[3,11];case 10:if(r)throw n;return[7];case 11:return[7];case 12:throw Error("Internal error: Iterator returned nothing.")}})}).call(this)}},{key:"samples",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;return this.mediaSamplesInRange(e,t)}},{key:"samplesAtTimestamps",value:function(e){return this.mediaSamplesAtTimestamps(e)}}]),t}(A),R=function(){"use strict";function e(t){var r,n,a,i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,c._)(this,e),this._nextCanvasIndex=0,!(t instanceof _.InputVideoTrack))throw TypeError("videoTrack must be an InputVideoTrack.");if(s&&(void 0===s?"undefined":(0,p._)(s))!=="object")throw TypeError("options must be an object.");if(void 0!==s.alpha&&"boolean"!=typeof s.alpha)throw TypeError("options.alpha, when provided, must be a boolean.");if(void 0!==s.width&&(!Number.isInteger(s.width)||s.width<=0))throw TypeError("options.width, when defined, must be a positive integer.");if(void 0!==s.height&&(!Number.isInteger(s.height)||s.height<=0))throw TypeError("options.height, when defined, must be a positive integer.");if(void 0!==s.fit&&!["fill","contain","cover"].includes(s.fit))throw TypeError('options.fit, when provided, must be one of "fill", "contain", or "cover".');if(void 0!==s.width&&void 0!==s.height&&void 0===s.fit)throw TypeError("When both options.width and options.height are provided, options.fit must also be provided.");if(void 0!==s.rotation&&![0,90,180,270].includes(s.rotation))throw TypeError("options.rotation, when provided, must be 0, 90, 180 or 270.");if(void 0!==s.crop&&(0,x.validateCropRectangle)(s.crop,"options."),void 0!==s.poolSize&&("number"!=typeof s.poolSize||!Number.isInteger(s.poolSize)||s.poolSize<0))throw TypeError("poolSize must be a non-negative integer.");var o=null!=(r=s.rotation)?r:t.rotation,u=(0,m._)(o%180==0?[t.codedWidth,t.codedHeight]:[t.codedHeight,t.codedWidth],2),l=u[0],d=u[1],f=s.crop;f&&(0,x.clampCropRectangle)(f,l,d);var h=(0,m._)(f?[f.width,f.height]:[l,d],2),g=h[0],v=h[1],b=g/v;void 0!==s.width&&void 0===s.height?v=Math.round((g=s.width)/b):void 0===s.width&&void 0!==s.height?g=Math.round((v=s.height)*b):void 0!==s.width&&void 0!==s.height&&(g=s.width,v=s.height),this._videoTrack=t,this._alpha=null!=(n=s.alpha)&&n,this._width=g,this._height=v,this._rotation=o,this._crop=f,this._fit=null!=(a=s.fit)?a:"fill",this._videoSampleSink=new F(t),this._canvasPool=Array.from({length:null!=(i=s.poolSize)?i:0},function(){return null})}return(0,u._)(e,[{key:"_videoSampleToWrappedCanvas",value:function(e){var t=this._canvasPool[this._nextCanvasIndex],r=!1;t||("u">typeof document?((t=document.createElement("canvas")).width=this._width,t.height=this._height):t=new OffscreenCanvas(this._width,this._height),this._canvasPool.length>0&&(this._canvasPool[this._nextCanvasIndex]=t),r=!0),this._canvasPool.length>0&&(this._nextCanvasIndex=(this._nextCanvasIndex+1)%this._canvasPool.length);var n=t.getContext("2d",{alpha:this._alpha||(0,w.isFirefox)()});(0,w.assert)(n),n.resetTransform(),r||(!this._alpha&&(0,w.isFirefox)()?(n.fillStyle="black",n.fillRect(0,0,this._width,this._height)):n.clearRect(0,0,this._width,this._height)),e.drawWithFit(n,{fit:this._fit,rotation:this._rotation,crop:this._crop});var a={canvas:t,timestamp:e.timestamp,duration:e.duration};return e.close(),a}},{key:"getCanvas",value:function(e){return(0,s._)(function(){var t;return(0,g._)(this,function(r){switch(r.label){case 0:return E(e),[4,this._videoSampleSink.getSample(e)];case 1:return[2,(t=r.sent())&&this._videoSampleToWrappedCanvas(t)]}})}).call(this)}},{key:"canvases",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;return(0,w.mapAsyncGenerator)(this._videoSampleSink.samples(t,r),function(t){return e._videoSampleToWrappedCanvas(t)})}},{key:"canvasesAtTimestamps",value:function(e){var t=this;return(0,w.mapAsyncGenerator)(this._videoSampleSink.samplesAtTimestamps(e),function(e){return e&&t._videoSampleToWrappedCanvas(e)})}}]),e}(),U=function(e){"use strict";function t(e,r,n,a){(0,c._)(this,t),(i=(0,o._)(this,t,[e,r])).decoder=null,i.customDecoder=null,i.customDecoderCallSerializer=new(0,w.CallSerializer),i.customDecoderQueueSize=0,i.currentTimestamp=null;var i,s=function(t){(null===i.currentTimestamp||Math.abs(t.timestamp-i.currentTimestamp)>=t.duration)&&(i.currentTimestamp=t.timestamp);var r=i.currentTimestamp;if(i.currentTimestamp+=t.duration,0===t.numberOfFrames)return void t.close();var n=a.sampleRate;t.setTimestamp(Math.round(r*n)/n),e(t)},u=y.customAudioDecoders.find(function(e){return e.supports(n,a)});if(u)i.customDecoder=new u,i.customDecoder.codec=n,i.customDecoder.config=a,i.customDecoder.onSample=function(e){if(!(e instanceof x.AudioSample))throw TypeError("The argument passed to onSample must be an AudioSample.");s(e)},i.customDecoderCallSerializer.call(function(){return i.customDecoder.init()});else{var l=Error("Decoding error").stack;i.decoder=new AudioDecoder({output:function(e){try{s(new(0,x.AudioSample)(e))}catch(e){i.onError(e)}},error:function(e){e.stack=l,i.onError(e)}}),i.decoder.configure(a)}return i}return(0,d._)(t,e),(0,u._)(t,[{key:"getDecodeQueueSize",value:function(){return this.customDecoder?this.customDecoderQueueSize:((0,w.assert)(this.decoder),this.decoder.decodeQueueSize)}},{key:"decode",value:function(e){var t=this;this.customDecoder?(this.customDecoderQueueSize++,this.customDecoderCallSerializer.call(function(){return t.customDecoder.decode(e)}).then(function(){return t.customDecoderQueueSize--})):((0,w.assert)(this.decoder),this.decoder.decode(e.toEncodedAudioChunk()))}},{key:"flush",value:function(){var e=this;return this.customDecoder?this.customDecoderCallSerializer.call(function(){return e.customDecoder.flush()}):((0,w.assert)(this.decoder),this.decoder.flush())}},{key:"close",value:function(){var e=this;this.customDecoder?this.customDecoderCallSerializer.call(function(){return e.customDecoder.close()}):((0,w.assert)(this.decoder),this.decoder.close())}}]),t}(C),O=function(e){"use strict";function t(e,r,n){(0,c._)(this,t),(a=(0,o._)(this,t,[e,r])).decoderConfig=n,a.currentTimestamp=null,(0,w.assert)(v.PCM_AUDIO_CODECS.includes(n.codec)),a.codec=n.codec;var a,i=(0,v.parsePcmCodec)(a.codec),s=i.dataType,u=i.sampleSize,l=i.littleEndian;switch(a.inputSampleSize=u,u){case 1:"unsigned"===s?a.readInputValue=function(e,t){return e.getUint8(t)-128}:"signed"===s?a.readInputValue=function(e,t){return e.getInt8(t)}:"ulaw"===s?a.readInputValue=function(e,t){return(0,T.fromUlaw)(e.getUint8(t))}:"alaw"===s?a.readInputValue=function(e,t){return(0,T.fromAlaw)(e.getUint8(t))}:(0,w.assert)(!1);break;case 2:"unsigned"===s?a.readInputValue=function(e,t){return e.getUint16(t,l)-32768}:"signed"===s?a.readInputValue=function(e,t){return e.getInt16(t,l)}:(0,w.assert)(!1);break;case 3:"unsigned"===s?a.readInputValue=function(e,t){return(0,w.getUint24)(e,t,l)-8388608}:"signed"===s?a.readInputValue=function(e,t){return(0,w.getInt24)(e,t,l)}:(0,w.assert)(!1);break;case 4:"unsigned"===s?a.readInputValue=function(e,t){return e.getUint32(t,l)-0x80000000}:"signed"===s?a.readInputValue=function(e,t){return e.getInt32(t,l)}:"float"===s?a.readInputValue=function(e,t){return e.getFloat32(t,l)}:(0,w.assert)(!1);break;case 8:"float"===s?a.readInputValue=function(e,t){return e.getFloat64(t,l)}:(0,w.assert)(!1);break;default:(0,w.assertNever)(u),(0,w.assert)(!1)}switch(u){case 1:"ulaw"===s||"alaw"===s?(a.outputSampleSize=2,a.outputFormat="s16",a.writeOutputValue=function(e,t,r){return e.setInt16(t,r,!0)}):(a.outputSampleSize=1,a.outputFormat="u8",a.writeOutputValue=function(e,t,r){return e.setUint8(t,r+128)});break;case 2:a.outputSampleSize=2,a.outputFormat="s16",a.writeOutputValue=function(e,t,r){return e.setInt16(t,r,!0)};break;case 3:a.outputSampleSize=4,a.outputFormat="s32",a.writeOutputValue=function(e,t,r){return e.setInt32(t,r<<8,!0)};break;case 4:a.outputSampleSize=4,"float"===s?(a.outputFormat="f32",a.writeOutputValue=function(e,t,r){return e.setFloat32(t,r,!0)}):(a.outputFormat="s32",a.writeOutputValue=function(e,t,r){return e.setInt32(t,r,!0)});break;case 8:a.outputSampleSize=4,a.outputFormat="f32",a.writeOutputValue=function(e,t,r){return e.setFloat32(t,r,!0)};break;default:(0,w.assertNever)(u),(0,w.assert)(!1)}return a}return(0,d._)(t,e),(0,u._)(t,[{key:"getDecodeQueueSize",value:function(){return 0}},{key:"decode",value:function(e){for(var t=(0,w.toDataView)(e.data),r=e.byteLength/this.decoderConfig.numberOfChannels/this.inputSampleSize,n=new ArrayBuffer(r*this.decoderConfig.numberOfChannels*this.outputSampleSize),a=new DataView(n),i=0;i<r*this.decoderConfig.numberOfChannels;i++){var s=i*this.inputSampleSize,o=i*this.outputSampleSize,c=this.readInputValue(t,s);this.writeOutputValue(a,o,c)}var u=r/this.decoderConfig.sampleRate;(null===this.currentTimestamp||Math.abs(e.timestamp-this.currentTimestamp)>=u)&&(this.currentTimestamp=e.timestamp);var l=this.currentTimestamp;this.currentTimestamp+=u;var d=new(0,x.AudioSample)({format:this.outputFormat,data:n,numberOfChannels:this.decoderConfig.numberOfChannels,sampleRate:this.decoderConfig.sampleRate,numberOfFrames:r,timestamp:l});this.onSample(d)}},{key:"flush",value:function(){return(0,s._)(function(){return(0,g._)(this,function(e){return[2]})})()}},{key:"close",value:function(){}}]),t}(C),N=function(e){"use strict";function t(e){var r;if((0,c._)(this,t),!(e instanceof _.InputAudioTrack))throw TypeError("audioTrack must be an InputAudioTrack.");return(r=(0,o._)(this,t))._track=e,r}return(0,d._)(t,e),(0,u._)(t,[{key:"_createDecoder",value:function(e,t){return(0,s._)(function(){var r,n;return(0,g._)(this,function(a){switch(a.label){case 0:return[4,this._track.canDecode()];case 1:if(!a.sent())throw Error("This audio track cannot be decoded by this browser. Make sure to check decodability before using a track.");return r=this._track.codec,[4,this._track.getDecoderConfig()];case 2:if(n=a.sent(),(0,w.assert)(r&&n),v.PCM_AUDIO_CODECS.includes(n.codec))return[2,new O(e,t,n)];return[2,new U(e,t,r,n)]}})}).call(this)}},{key:"_createPacketSink",value:function(){return new P(this._track)}},{key:"getSample",value:function(e){return(0,s._)(function(){var t,r,n,a,s,o;return(0,g._)(this,function(c){switch(c.label){case 0:E(e),t=!1,r=!1,c.label=1;case 1:c.trys.push([1,6,7,12]),a=(0,i._)(this.mediaSamplesAtTimestamps([e])),c.label=2;case 2:return[4,a.next()];case 3:if(!(t=!(s=c.sent()).done))return[3,5];return[2,s.value];case 4:return t=!1,[3,2];case 5:return[3,12];case 6:return o=c.sent(),r=!0,n=o,[3,12];case 7:if(c.trys.push([7,,10,11]),!(t&&null!=a.return))return[3,9];return[4,a.return()];case 8:c.sent(),c.label=9;case 9:return[3,11];case 10:if(r)throw n;return[7];case 11:return[7];case 12:throw Error("Internal error: Iterator returned nothing.")}})}).call(this)}},{key:"samples",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;return this.mediaSamplesInRange(e,t)}},{key:"samplesAtTimestamps",value:function(e){return this.mediaSamplesAtTimestamps(e)}}]),t}(A),L=function(){"use strict";function e(t){if((0,c._)(this,e),!(t instanceof _.InputAudioTrack))throw TypeError("audioTrack must be an InputAudioTrack.");this._audioSampleSink=new N(t)}return(0,u._)(e,[{key:"_audioSampleToWrappedArrayBuffer",value:function(e){var t={buffer:e.toAudioBuffer(),timestamp:e.timestamp,duration:e.duration};return e.close(),t}},{key:"getBuffer",value:function(e){return(0,s._)(function(){var t;return(0,g._)(this,function(r){switch(r.label){case 0:return E(e),[4,this._audioSampleSink.getSample(e)];case 1:return[2,(t=r.sent())&&this._audioSampleToWrappedArrayBuffer(t)]}})}).call(this)}},{key:"buffers",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;return(0,w.mapAsyncGenerator)(this._audioSampleSink.samples(t,r),function(t){return e._audioSampleToWrappedArrayBuffer(t)})}},{key:"buffersAtTimestamps",value:function(e){var t=this;return(0,w.mapAsyncGenerator)(this._audioSampleSink.samplesAtTimestamps(e),function(e){return e&&t._audioSampleToWrappedArrayBuffer(e)})}}]),e}()},{"@swc/helpers/cjs/_async_iterator.cjs":"f3IhJ","@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_define_property.cjs":"ltU3W","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_object_spread.cjs":"kyoEj","@swc/helpers/cjs/_object_spread_props.cjs":"3G1wX","@swc/helpers/cjs/_sliced_to_array.cjs":"gIQTH","@swc/helpers/cjs/_type_of.cjs":"iXhRw","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","./codec.js":"fXWqW","./codec-data.js":"kWTYV","./custom-coder.js":"hAl48","./input.js":"3sapy","./input-track.js":"b22CJ","./misc.js":"j7iGm","./packet.js":"QfqGG","./pcm.js":"501Zr","./sample.js":"1oMH7","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"3G1wX":[function(e,t,r,n){"use strict";r._=function(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r})(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}),e}},{}],"3sapy":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Input",function(){return v}),a.export(r,"InputDisposedError",function(){return b});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_call_super.cjs"),o=e("@swc/helpers/cjs/_class_call_check.cjs"),c=e("@swc/helpers/cjs/_create_class.cjs"),u=e("@swc/helpers/cjs/_inherits.cjs"),l=e("@swc/helpers/cjs/_type_of.cjs"),d=e("@swc/helpers/cjs/_wrap_native_super.cjs"),f=e("@swc/helpers/cjs/_ts_generator.cjs"),h=e("./input-format.js"),m=e("./misc.js"),p=e("./reader.js"),g=e("./source.js");(0,m.polyfillSymbolDispose)();var v=function(){"use strict";function e(t){if((0,o._)(this,e),this._demuxerPromise=null,this._format=null,this._disposed=!1,!t||(void 0===t?"undefined":(0,l._)(t))!=="object")throw TypeError("options must be an object.");if(!Array.isArray(t.formats)||t.formats.some(function(e){return!(e instanceof h.InputFormat)}))throw TypeError("options.formats must be an array of InputFormat.");if(!(t.source instanceof g.Source))throw TypeError("options.source must be a Source.");if(t.source._disposed)throw Error("options.source must not be disposed.");this._formats=t.formats,this._source=t.source,this._reader=new(0,p.Reader)(t.source)}return(0,c._)(e,[{key:"disposed",get:function(){return this._disposed}},{key:"_getDemuxer",value:function(){var e;return null!=(e=this._demuxerPromise)?e:this._demuxerPromise=(0,i._)(function(){var e,t,r,n,a,i,s,o;return(0,f._)(this,function(c){switch(c.label){case 0:return e=this._reader,[4,this._source.getSizeOrNull()];case 1:e.fileSize=c.sent(),t=!0,r=!1,n=void 0,c.label=2;case 2:c.trys.push([2,7,8,9]),a=this._formats[Symbol.iterator](),c.label=3;case 3:if(t=(i=a.next()).done)return[3,6];return[4,(s=i.value)._canReadInput(this)];case 4:if(c.sent())return this._format=s,[2,s._createDemuxer(this)];c.label=5;case 5:return t=!0,[3,3];case 6:return[3,9];case 7:return o=c.sent(),r=!0,n=o,[3,9];case 8:try{t||null==a.return||a.return()}finally{if(r)throw n}return[7];case 9:throw Error("Input has an unsupported or unrecognizable format.")}})}).call(this)}},{key:"source",get:function(){return this._source}},{key:"getFormat",value:function(){return(0,i._)(function(){return(0,f._)(this,function(e){switch(e.label){case 0:return[4,this._getDemuxer()];case 1:return e.sent(),(0,m.assert)(this._format),[2,this._format]}})}).call(this)}},{key:"computeDuration",value:function(){return(0,i._)(function(){return(0,f._)(this,function(e){switch(e.label){case 0:return[4,this._getDemuxer()];case 1:return[2,e.sent().computeDuration()]}})}).call(this)}},{key:"getTracks",value:function(){return(0,i._)(function(){return(0,f._)(this,function(e){switch(e.label){case 0:return[4,this._getDemuxer()];case 1:return[2,e.sent().getTracks()]}})}).call(this)}},{key:"getVideoTracks",value:function(){return(0,i._)(function(){return(0,f._)(this,function(e){switch(e.label){case 0:return[4,this.getTracks()];case 1:return[2,e.sent().filter(function(e){return e.isVideoTrack()})]}})}).call(this)}},{key:"getAudioTracks",value:function(){return(0,i._)(function(){return(0,f._)(this,function(e){switch(e.label){case 0:return[4,this.getTracks()];case 1:return[2,e.sent().filter(function(e){return e.isAudioTrack()})]}})}).call(this)}},{key:"getPrimaryVideoTrack",value:function(){return(0,i._)(function(){var e;return(0,f._)(this,function(t){switch(t.label){case 0:return[4,this.getTracks()];case 1:return[2,null!=(e=t.sent().find(function(e){return e.isVideoTrack()}))?e:null]}})}).call(this)}},{key:"getPrimaryAudioTrack",value:function(){return(0,i._)(function(){var e;return(0,f._)(this,function(t){switch(t.label){case 0:return[4,this.getTracks()];case 1:return[2,null!=(e=t.sent().find(function(e){return e.isAudioTrack()}))?e:null]}})}).call(this)}},{key:"getMimeType",value:function(){return(0,i._)(function(){return(0,f._)(this,function(e){switch(e.label){case 0:return[4,this._getDemuxer()];case 1:return[2,e.sent().getMimeType()]}})}).call(this)}},{key:"getMetadataTags",value:function(){return(0,i._)(function(){return(0,f._)(this,function(e){switch(e.label){case 0:return[4,this._getDemuxer()];case 1:return[2,e.sent().getMetadataTags()]}})}).call(this)}},{key:"dispose",value:function(){this._disposed||(this._disposed=!0,this._source._disposed=!0,this._source._dispose())}},{key:Symbol.dispose,value:function(){this.dispose()}}]),e}(),b=function(e){"use strict";function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Input has been disposed.";return(0,o._)(this,t),(e=(0,s._)(this,t,[r])).name="InputDisposedError",e}return(0,u._)(t,e),t}((0,d._)(Error))},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_type_of.cjs":"iXhRw","@swc/helpers/cjs/_wrap_native_super.cjs":"j8pRR","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","./input-format.js":"1jhAI","./misc.js":"j7iGm","./reader.js":"8KRfO","./source.js":"7vKle","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],j8pRR:[function(e,t,r,n){"use strict";var a=e("c8857d56f4968279"),i=e("2ed7bdf1701f2d07"),s=e("5c5ad8846076b9cd"),o=e("2db6fa09e8a5be4c");function c(e){var t="function"==typeof Map?new Map:void 0;return r._=c=function(e){if(null===e||!s._(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return a._(e,arguments,i._(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),o._(r,e)},c(e)}r._=c},{c8857d56f4968279:"bC52X","2ed7bdf1701f2d07":"NOGHw","5c5ad8846076b9cd":"1mpbk","2db6fa09e8a5be4c":"7ubVA"}],bC52X:[function(e,t,r,n){"use strict";var a=e("62fc231ae2e75266"),i=e("3f98bf9d4f706151");function s(e,t,n){return a._()?r._=s=Reflect.construct:r._=s=function(e,t,r){var n=[null];n.push.apply(n,t);var a=new(Function.bind.apply(e,n));return r&&i._(a,r.prototype),a},s.apply(null,arguments)}r._=s},{"62fc231ae2e75266":"83nDe","3f98bf9d4f706151":"7ubVA"}],"1mpbk":[function(e,t,r,n){"use strict";r._=function(e){return -1!==Function.toString.call(e).indexOf("[native code]")}},{}],"8KRfO":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Reader",function(){return u}),a.export(r,"FileSlice",function(){return l}),a.export(r,"readBytes",function(){return f}),a.export(r,"readU8",function(){return h}),a.export(r,"readU16",function(){return m}),a.export(r,"readU16Be",function(){return p}),a.export(r,"readU24Be",function(){return g}),a.export(r,"readI16Be",function(){return v}),a.export(r,"readU32",function(){return b}),a.export(r,"readU32Be",function(){return y}),a.export(r,"readU32Le",function(){return k}),a.export(r,"readI32Be",function(){return _}),a.export(r,"readI32Le",function(){return w}),a.export(r,"readU64",function(){return S}),a.export(r,"readU64Be",function(){return T}),a.export(r,"readI64Be",function(){return x}),a.export(r,"readI64Le",function(){return I}),a.export(r,"readF32Be",function(){return E}),a.export(r,"readF64Be",function(){return j}),a.export(r,"readAscii",function(){return P});var i=e("@swc/helpers/cjs/_class_call_check.cjs"),s=e("@swc/helpers/cjs/_create_class.cjs"),o=e("./input.js"),c=e("./misc.js"),u=function(){"use strict";function e(t){(0,i._)(this,e),this.source=t}return(0,s._)(e,[{key:"requestSlice",value:function(e,t){if(this.source._disposed)throw new(0,o.InputDisposedError);if(null!==this.fileSize&&e+t>this.fileSize)return null;var r=e+t,n=this.source._read(e,r);return n instanceof Promise?n.then(function(t){return t?new l(t.bytes,t.view,t.offset,e,r):null}):n?new l(n.bytes,n.view,n.offset,e,r):null}},{key:"requestSliceRange",value:function(e,t,r){var n=this;if(this.source._disposed)throw new(0,o.InputDisposedError);if(null!==this.fileSize)return this.requestSlice(e,(0,c.clamp)(this.fileSize-e,t,r));var a=this.requestSlice(e,r),i=function(a){if(a)return a;var i=function(a){return(0,c.assert)(null!==a),n.requestSlice(e,(0,c.clamp)(a-e,t,r))},s=n.source._retrieveSize();return s instanceof Promise?s.then(i):i(s)};return a instanceof Promise?a.then(i):i(a)}}]),e}(),l=function(){"use strict";function e(t,r,n,a,s){(0,i._)(this,e),this.bytes=t,this.view=r,this.offset=n,this.start=a,this.end=s,this.bufferPos=a-n}return(0,s._)(e,[{key:"length",get:function(){return this.end-this.start}},{key:"filePos",get:function(){return this.offset+this.bufferPos},set:function(e){this.bufferPos=e-this.offset}},{key:"remainingLength",get:function(){return Math.max(this.end-this.filePos,0)}},{key:"skip",value:function(e){this.bufferPos+=e}},{key:"slice",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.end-t;if(t<this.start||t+r>this.end)throw RangeError("Slicing outside of original slice.");return new e(this.bytes,this.view,this.offset,t,t+r)}}],[{key:"tempFromBytes",value:function(t){return new e(t,(0,c.toDataView)(t),0,0,t.length)}}]),e}(),d=function(e,t){if(e.filePos<e.start||e.filePos+t>e.end)throw RangeError("Tried reading [".concat(e.filePos,", ").concat(e.filePos+t,"), but slice is")+" [".concat(e.start,", ").concat(e.end,"). This is likely an internal error, please report it alongside the file")+" that caused it.")},f=function(e,t){d(e,t);var r=e.bytes.subarray(e.bufferPos,e.bufferPos+t);return e.bufferPos+=t,r},h=function(e){return d(e,1),e.view.getUint8(e.bufferPos++)},m=function(e,t){d(e,2);var r=e.view.getUint16(e.bufferPos,t);return e.bufferPos+=2,r},p=function(e){d(e,2);var t=e.view.getUint16(e.bufferPos,!1);return e.bufferPos+=2,t},g=function(e){d(e,3);var t=(0,c.getUint24)(e.view,e.bufferPos,!1);return e.bufferPos+=3,t},v=function(e){d(e,2);var t=e.view.getInt16(e.bufferPos,!1);return e.bufferPos+=2,t},b=function(e,t){d(e,4);var r=e.view.getUint32(e.bufferPos,t);return e.bufferPos+=4,r},y=function(e){d(e,4);var t=e.view.getUint32(e.bufferPos,!1);return e.bufferPos+=4,t},k=function(e){d(e,4);var t=e.view.getUint32(e.bufferPos,!0);return e.bufferPos+=4,t},_=function(e){d(e,4);var t=e.view.getInt32(e.bufferPos,!1);return e.bufferPos+=4,t},w=function(e){d(e,4);var t=e.view.getInt32(e.bufferPos,!0);return e.bufferPos+=4,t},S=function(e,t){var r,n;return t?(r=b(e,!0),n=b(e,!0)):(n=b(e,!1),r=b(e,!1)),0x100000000*n+r},T=function(e){return 0x100000000*y(e)+y(e)},x=function(e){return 0x100000000*_(e)+y(e)},I=function(e){var t=k(e);return 0x100000000*w(e)+t},E=function(e){d(e,4);var t=e.view.getFloat32(e.bufferPos,!1);return e.bufferPos+=4,t},j=function(e){d(e,8);var t=e.view.getFloat64(e.bufferPos,!1);return e.bufferPos+=8,t},P=function(e,t){d(e,t);for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e.bytes[e.bufferPos++]);return r}},{"@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","./input.js":"3sapy","./misc.js":"j7iGm","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"7vKle":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Source",function(){return v}),a.export(r,"BufferSource",function(){return b}),a.export(r,"BlobSource",function(){return y}),a.export(r,"UrlSource",function(){return _}),a.export(r,"FilePathSource",function(){return w}),a.export(r,"StreamSource",function(){return S}),a.export(r,"ReadableStreamSource",function(){return T});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_call_super.cjs"),o=e("@swc/helpers/cjs/_class_call_check.cjs"),c=e("@swc/helpers/cjs/_create_class.cjs"),u=e("@swc/helpers/cjs/_inherits.cjs"),l=e("@swc/helpers/cjs/_type_of.cjs"),d=e("@swc/helpers/cjs/_ts_generator.cjs"),f=e("@swc/helpers/cjs/_ts_values.cjs"),h=e("./misc.js"),m=e("./node.js"),p=e("./input.js"),g=void 0!==m?m:void 0,v=function(){"use strict";function e(){(0,o._)(this,e),this._disposed=!1,this._sizePromise=null,this.onread=null}return(0,c._)(e,[{key:"getSizeOrNull",value:function(){return(0,i._)(function(){var e;return(0,d._)(this,function(t){if(this._disposed)throw new(0,p.InputDisposedError);return[2,null!=(e=this._sizePromise)?e:this._sizePromise=Promise.resolve(this._retrieveSize())]})}).call(this)}},{key:"getSize",value:function(){return(0,i._)(function(){var e;return(0,d._)(this,function(t){switch(t.label){case 0:if(this._disposed)throw new(0,p.InputDisposedError);return[4,this.getSizeOrNull()];case 1:if(null===(e=t.sent()))throw Error("Cannot determine the size of an unsized source.");return[2,e]}})}).call(this)}}]),e}(),b=function(e){"use strict";function t(e){var r;if((0,o._)(this,t),!(e instanceof ArrayBuffer)&&!("u">typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)&&!ArrayBuffer.isView(e))throw TypeError("buffer must be an ArrayBuffer, SharedArrayBuffer, or ArrayBufferView.");return(r=(0,s._)(this,t))._onreadCalled=!1,r._bytes=(0,h.toUint8Array)(e),r._view=(0,h.toDataView)(e),r}return(0,u._)(t,e),(0,c._)(t,[{key:"_retrieveSize",value:function(){return this._bytes.byteLength}},{key:"_read",value:function(){if(!this._onreadCalled){var e;null==(e=this.onread)||e.call(this,0,this._bytes.byteLength),this._onreadCalled=!0}return{bytes:this._bytes,view:this._view,offset:0}}},{key:"_dispose",value:function(){}}]),t}(v),y=function(e){"use strict";function t(e){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,o._)(this,t),!(e instanceof Blob))throw TypeError("blob must be a Blob.");if(!a||(void 0===a?"undefined":(0,l._)(a))!=="object")throw TypeError("options must be an object.");if(void 0!==a.maxCacheSize&&(!(0,h.isNumber)(a.maxCacheSize)||a.maxCacheSize<0))throw TypeError("options.maxCacheSize, when provided, must be a non-negative number.");return(r=(0,s._)(this,t))._readers=new WeakMap,r._blob=e,r._orchestrator=new I({maxCacheSize:null!=(n=a.maxCacheSize)?n:8388608,maxWorkerCount:4,runWorker:r._runWorker.bind(r),prefetchProfile:x.fileSystem}),r}return(0,u._)(t,e),(0,c._)(t,[{key:"_retrieveSize",value:function(){var e=this._blob.size;return this._orchestrator.fileSize=e,e}},{key:"_read",value:function(e,t){return this._orchestrator.read(e,t)}},{key:"_runWorker",value:function(e){return(0,i._)(function(){var t,r,n,a,i,s,o,c,u;return(0,d._)(this,function(l){switch(l.label){case 0:void 0===(t=this._readers.get(e))&&(t="stream"in this._blob&&!(0,h.isWebKit)()?this._blob.slice(e.currentPos).stream().getReader():null,this._readers.set(e,t)),l.label=1;case 1:if(!(e.currentPos<e.targetPos&&!e.aborted))return[3,6];if(!t)return[3,3];return[4,t.read()];case 2:if(i=(a=l.sent()).done,s=a.value,i)throw this._orchestrator.forgetWorker(e),Error("Blob reader stopped unexpectedly before all requested data was read.");if(e.aborted)return[3,6];return null==(r=(n=this).onread)||r.call(n,e.currentPos,e.currentPos+s.length),this._orchestrator.supplyWorkerData(e,s),[3,5];case 3:return[4,this._blob.slice(e.currentPos,e.targetPos).arrayBuffer()];case 4:if(u=l.sent(),e.aborted)return[3,6];null==(o=(c=this).onread)||o.call(c,e.currentPos,e.currentPos+u.byteLength),this._orchestrator.supplyWorkerData(e,new Uint8Array(u)),l.label=5;case 5:return[3,1];case 6:if(e.running=!1,!e.aborted)return[3,8];return[4,null==t?void 0:t.cancel()];case 7:l.sent(),l.label=8;case 8:return[2]}})}).call(this)}},{key:"_dispose",value:function(){this._orchestrator.dispose()}}]),t}(v),k=function(e,t,r){if(t instanceof Error&&(t.message.includes("Failed to fetch")||t.message.includes("Load failed")||t.message.includes("NetworkError when attempting to fetch resource"))){var n=null;try{"u">typeof window&&void 0!==window.location&&(n=new URL(r instanceof Request?r.url:r,window.location.href).origin)}catch(e){}if(("u"<typeof navigator||"boolean"!=typeof navigator.onLine||navigator.onLine)&&null!==n&&n!==window.location.origin)return console.warn("Request will not be retried because a CORS error was suspected due to different origins. You can modify this behavior by providing your own function for the 'getRetryDelay' option."),null}return Math.min(Math.pow(2,e-2),16)},_=function(e){"use strict";function t(e){var r,n,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,o._)(this,t),"string"!=typeof e&&!(e instanceof URL)&&!("u">typeof Request&&e instanceof Request))throw TypeError("url must be a string, URL or Request.");if(!i||(void 0===i?"undefined":(0,l._)(i))!=="object")throw TypeError("options must be an object.");if(void 0!==i.requestInit&&(!i.requestInit||"object"!==(0,l._)(i.requestInit)))throw TypeError("options.requestInit, when provided, must be an object.");if(void 0!==i.getRetryDelay&&"function"!=typeof i.getRetryDelay)throw TypeError("options.getRetryDelay, when provided, must be a function.");if(void 0!==i.maxCacheSize&&(!(0,h.isNumber)(i.maxCacheSize)||i.maxCacheSize<0))throw TypeError("options.maxCacheSize, when provided, must be a non-negative number.");if(void 0!==i.fetchFn&&"function"!=typeof i.fetchFn)throw TypeError("options.fetchFn, when provided, must be a function.");return(r=(0,s._)(this,t))._existingResponses=new WeakMap,r._url=e,r._options=i,r._getRetryDelay=null!=(n=i.getRetryDelay)?n:k,r._orchestrator=new I({maxCacheSize:null!=(a=i.maxCacheSize)?a:0x4000000,maxWorkerCount:2,runWorker:r._runWorker.bind(r),prefetchProfile:x.network}),r}return(0,u._)(t,e),(0,c._)(t,[{key:"_retrieveSize",value:function(){return(0,i._)(function(){var e,t,r,n,a,i,s,o;return(0,d._)(this,function(c){switch(c.label){case 0:return e=this,t=new AbortController,[4,(0,h.retriedFetch)(null!=(r=this._options.fetchFn)?r:fetch,this._url,(0,h.mergeRequestInit)(null!=(n=this._options.requestInit)?n:{},{headers:{Range:"bytes=0-"},signal:t.signal}),this._getRetryDelay,function(){return e._disposed})];case 1:if(!(a=c.sent()).ok)throw Error("Error fetching ".concat(String(this._url),": ").concat(a.status," ").concat(a.statusText));if(206===a.status)s=this._getTotalLengthFromRangeResponse(a),i=this._orchestrator.createWorker(0,Math.min(s,524288));else if(o=a.headers.get("Content-Length"))s=Number(o),i=this._orchestrator.createWorker(0,s),this._orchestrator.options.maxCacheSize=1/0,console.warn("HTTP server did not respond with 206 Partial Content, meaning the entire remote resource now has to be downloaded. For efficient media file streaming across a network, please make sure your server supports range requests.");else throw Error("HTTP response (status ".concat(a.status,") must surface Content-Length header."));return this._orchestrator.fileSize=s,this._existingResponses.set(i,{response:a,abortController:t}),this._orchestrator.runWorker(i),[2,s]}})}).call(this)}},{key:"_read",value:function(e,t){return this._orchestrator.read(e,t)}},{key:"_runWorker",value:function(e){return(0,i._)(function(){var t,r,n,a,i,s,o,c,u,m;return(0,d._)(this,function(p){switch(p.label){case 0:t=this,p.label=1;case 1:if(n=function(){var t,n,a,s,o,c,l;return(0,d._)(this,function(d){switch(d.label){case 0:if(e.currentPos>=e.targetPos||e.aborted)return i.abort(),e.running=!1,[2,{v:void 0}];a=void 0,d.label=1;case 1:return d.trys.push([1,3,,7]),[4,u.read()];case 2:return a=d.sent(),[3,7];case 3:if(s=d.sent(),r._disposed)throw s;if(null===(o=r._getRetryDelay(1,s,r._url)))return[3,5];return console.error("Error while reading response stream. Attempting to resume.",s),[4,new Promise(function(e){return setTimeout(e,1e3*o)})];case 4:return d.sent(),[2,"break"];case 5:throw s;case 6:return[3,7];case 7:if(e.aborted)return[2,"continue"];if(c=a.done,l=a.value,c){if(e.currentPos>=e.targetPos)return r._orchestrator.forgetWorker(e),e.running=!1,[2,{v:void 0}];return[2,"break"]}return null==(t=(n=r).onread)||t.call(n,e.currentPos,e.currentPos+l.length),r._orchestrator.supplyWorkerData(e,l),[2]}})},a=this._existingResponses.get(e),this._existingResponses.delete(e),i=null==a?void 0:a.abortController,s=null==a?void 0:a.response,i)return[3,3];return i=new AbortController,[4,(0,h.retriedFetch)(null!=(o=this._options.fetchFn)?o:fetch,this._url,(0,h.mergeRequestInit)(null!=(c=this._options.requestInit)?c:{},{headers:{Range:"bytes=".concat(e.currentPos,"-")},signal:i.signal}),this._getRetryDelay,function(){return t._disposed})];case 2:s=p.sent(),p.label=3;case 3:if((0,h.assert)(s),!s.ok)throw Error("Error fetching ".concat(String(this._url),": ").concat(s.status," ").concat(s.statusText));if(e.currentPos>0&&206!==s.status)throw Error("HTTP server did not respond with 206 Partial Content to a range request. To enable efficient media file streaming across a network, please make sure your server supports range requests.");if(!s.body)throw Error("Missing HTTP response body stream. The used fetch function must provide the response body as a ReadableStream.");u=s.body.getReader(),p.label=4;case 4:return r=this,[5,(0,f._)(n())];case 5:if(m=p.sent(),"object"===(0,l._)(m))return[2,m.v];if("break"===m)return[3,6];return[3,4];case 6:return[3,1];case 7:return[2]}})}).call(this)}},{key:"_getTotalLengthFromRangeResponse",value:function(e){var t=e.headers.get("Content-Range");if(t){var r=/\/(\d+)/.exec(t);if(r)return Number(r[1])}var n=e.headers.get("Content-Length");if(n)return Number(n);throw Error("Partial HTTP response (status 206) must surface either Content-Range or Content-Length header.")}},{key:"_dispose",value:function(){this._orchestrator.dispose()}}]),t}(v),w=function(e){"use strict";function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,o._)(this,t),"string"!=typeof e)throw TypeError("filePath must be a string.");if(!n||(void 0===n?"undefined":(0,l._)(n))!=="object")throw TypeError("options must be an object.");if(void 0!==n.maxCacheSize&&(!(0,h.isNumber)(n.maxCacheSize)||n.maxCacheSize<0))throw TypeError("options.maxCacheSize, when provided, must be a non-negative number.");return(r=(0,s._)(this,t))._fileHandle=null,r._streamSource=new S({getSize:function(){return(0,i._)(function(){return(0,d._)(this,function(t){switch(t.label){case 0:return[4,g.fs.open(e,"r")];case 1:return r._fileHandle=t.sent(),[4,r._fileHandle.stat()];case 2:return[2,t.sent().size]}})})()},read:function(e,t){return(0,i._)(function(){var n;return(0,d._)(this,function(a){switch(a.label){case 0:return(0,h.assert)(r._fileHandle),n=new Uint8Array(t-e),[4,r._fileHandle.read(n,0,t-e,e)];case 1:return a.sent(),[2,n]}})})()},maxCacheSize:n.maxCacheSize,prefetchProfile:"fileSystem"}),r}return(0,u._)(t,e),(0,c._)(t,[{key:"_read",value:function(e,t){return this._streamSource._read(e,t)}},{key:"_retrieveSize",value:function(){return this._streamSource._retrieveSize()}},{key:"_dispose",value:function(){var e;this._streamSource._dispose(),null==(e=this._fileHandle)||e.close(),this._fileHandle=null}}]),t}(v),S=function(e){"use strict";function t(e){var r,n,a;if((0,o._)(this,t),!e||(void 0===e?"undefined":(0,l._)(e))!=="object")throw TypeError("options must be an object.");if("function"!=typeof e.getSize)throw TypeError("options.getSize must be a function.");if("function"!=typeof e.read)throw TypeError("options.read must be a function.");if(void 0!==e.dispose&&"function"!=typeof e.dispose)throw TypeError("options.dispose, when provided, must be a function.");if(void 0!==e.maxCacheSize&&(!(0,h.isNumber)(e.maxCacheSize)||e.maxCacheSize<0))throw TypeError("options.maxCacheSize, when provided, must be a non-negative number.");if(e.prefetchProfile&&!["none","fileSystem","network"].includes(e.prefetchProfile))throw TypeError("options.prefetchProfile, when provided, must be one of 'none', 'fileSystem' or 'network'.");return(r=(0,s._)(this,t))._options=e,r._orchestrator=new I({maxCacheSize:null!=(n=e.maxCacheSize)?n:8388608,maxWorkerCount:2,prefetchProfile:x[null!=(a=e.prefetchProfile)?a:"none"],runWorker:r._runWorker.bind(r)}),r}return(0,u._)(t,e),(0,c._)(t,[{key:"_retrieveSize",value:function(){var e=this,t=this._options.getSize();if(t instanceof Promise)return t.then(function(t){if(!Number.isInteger(t)||t<0)throw TypeError("options.getSize must return or resolve to a non-negative integer.");return e._orchestrator.fileSize=t,t});if(!Number.isInteger(t)||t<0)throw TypeError("options.getSize must return or resolve to a non-negative integer.");return this._orchestrator.fileSize=t,t}},{key:"_read",value:function(e,t){return this._orchestrator.read(e,t)}},{key:"_runWorker",value:function(e){return(0,i._)(function(){var t,r,n,a,i,s,o,c,u,l,f,m;return(0,d._)(this,function(d){switch(d.label){case 0:if(!(e.currentPos<e.targetPos&&!e.aborted))return[3,9];if(t=e.currentPos,r=e.targetPos,!((n=this._options.read(e.currentPos,r))instanceof Promise))return[3,2];return[4,n];case 1:n=d.sent(),d.label=2;case 2:if(e.aborted)return[3,9];if(!(n instanceof Uint8Array))return[3,3];if((n=(0,h.toUint8Array)(n)).length!==r-e.currentPos)throw Error("options.read returned a Uint8Array with unexpected length: Requested ".concat(r-e.currentPos," bytes, but got ").concat(n.length,"."));return null==(a=(i=this).onread)||a.call(i,e.currentPos,e.currentPos+n.length),this._orchestrator.supplyWorkerData(e,n),[3,8];case 3:if(!(n instanceof ReadableStream))return[3,7];s=n.getReader(),d.label=4;case 4:if(!(e.currentPos<r&&!e.aborted))return[3,6];return[4,s.read()];case 5:if(l=(u=d.sent()).done,f=u.value,l){if(e.currentPos<r)throw Error("ReadableStream returned by options.read ended before supplying enough data."+" Requested ".concat(r-t," bytes, but got ").concat(e.currentPos-t));return[3,6]}if(!(f instanceof Uint8Array))throw TypeError("ReadableStream returned by options.read must yield Uint8Array chunks.");if(e.aborted)return[3,6];return m=(0,h.toUint8Array)(f),null==(o=(c=this).onread)||o.call(c,e.currentPos,e.currentPos+m.length),this._orchestrator.supplyWorkerData(e,m),[3,4];case 6:return[3,8];case 7:throw TypeError("options.read must return or resolve to a Uint8Array or a ReadableStream.");case 8:return[3,0];case 9:return e.running=!1,[2]}})}).call(this)}},{key:"_dispose",value:function(){var e,t;this._orchestrator.dispose(),null==(e=(t=this._options).dispose)||e.call(t)}}]),t}(v),T=function(e){"use strict";function t(e){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,o._)(this,t),!(e instanceof ReadableStream))throw TypeError("stream must be a ReadableStream.");if(!a||(void 0===a?"undefined":(0,l._)(a))!=="object")throw TypeError("options must be an object.");if(void 0!==a.maxCacheSize&&(!(0,h.isNumber)(a.maxCacheSize)||a.maxCacheSize<0))throw TypeError("options.maxCacheSize, when provided, must be a non-negative number.");return(r=(0,s._)(this,t))._reader=null,r._cache=[],r._pendingSlices=[],r._currentIndex=0,r._targetIndex=0,r._maxRequestedIndex=0,r._endIndex=null,r._pulling=!1,r._stream=e,r._maxCacheSize=null!=(n=a.maxCacheSize)?n:0x1000000,r}return(0,u._)(t,e),(0,c._)(t,[{key:"_retrieveSize",value:function(){return this._endIndex}},{key:"_read",value:function(e,t){var r=this;if(null!==this._endIndex&&t>this._endIndex)return null;this._maxRequestedIndex=Math.max(this._maxRequestedIndex,t);var n=(0,h.binarySearchLessOrEqual)(this._cache,e,function(e){return e.start}),a=-1!==n?this._cache[n]:null;if(a&&a.start<=e&&t<=a.end)return{bytes:a.bytes,view:a.view,offset:a.start};var i=e,s=new Uint8Array(t-e);if(-1!==n)for(var o=n;o<this._cache.length;o++){var c=this._cache[o];if(c.start>=t)break;var u=Math.max(e,c.start);u>i&&this._throwDueToCacheMiss();var l=Math.min(t,c.end);u<l&&(s.set(c.bytes.subarray(u-c.start,l-c.start),u-e),i=l)}if(i===t)return{bytes:s,view:(0,h.toDataView)(s),offset:e};this._currentIndex>i&&this._throwDueToCacheMiss();var d=(0,h.promiseWithResolvers)(),f=d.promise,m=d.resolve,p=d.reject;return this._pendingSlices.push({start:e,end:t,bytes:s,resolve:m,reject:p}),this._targetIndex=Math.max(this._targetIndex,t),this._pulling||(this._pulling=!0,this._pull().catch(function(e){if(r._pulling=!1,r._pendingSlices.length>0)r._pendingSlices.forEach(function(t){return t.reject(e)}),r._pendingSlices.length=0;else throw e})),f}},{key:"_throwDueToCacheMiss",value:function(){throw Error("Read is before the cached region. With ReadableStreamSource, you must access the data more sequentially or increase the size of its cache.")}},{key:"_pull",value:function(){return(0,i._)(function(){var e,t,r,n,a,i,s,o,c,u,l,f,m,p,g;return(0,d._)(this,function(d){switch(d.label){case 0:null!=this._reader||(this._reader=this._stream.getReader()),d.label=1;case 1:if(!(this._currentIndex<this._targetIndex&&!this._disposed))return[3,3];return[4,this._reader.read()];case 2:if(t=(e=d.sent()).done,r=e.value,t){n=!0,a=!1,i=void 0;try{for(s=this._pendingSlices[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)o.value.resolve(null)}catch(e){a=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(a)throw i}}return this._pendingSlices.length=0,this._endIndex=this._currentIndex,[3,3]}for(l=0,c=this._currentIndex,u=this._currentIndex+r.byteLength;l<this._pendingSlices.length;l++)(m=Math.max(c,(f=this._pendingSlices[l]).start))<(p=Math.min(u,f.end))&&(f.bytes.set(r.subarray(m-c,p-c),m-f.start),p===f.end&&(f.resolve({bytes:f.bytes,view:(0,h.toDataView)(f.bytes),offset:f.start}),this._pendingSlices.splice(l,1),l--));for(this._cache.push({start:c,end:u,bytes:r,view:(0,h.toDataView)(r),age:0});this._cache.length>0&&(g=this._cache[0],!(this._maxRequestedIndex-g.end<=this._maxCacheSize));)this._cache.shift();return this._currentIndex+=r.byteLength,[3,1];case 3:return this._pulling=!1,[2]}})}).call(this)}},{key:"_dispose",value:function(){this._pendingSlices.length=0,this._cache.length=0}}]),t}(v),x={none:function(e,t){return{start:e,end:t}},fileSystem:function(e,t){return{start:e=65536*Math.floor((e-65536)/65536),end:t=65536*Math.ceil((t+65536)/65536)}},network:function(e,t,r){e=Math.max(0,65536*Math.floor((e-65536)/65536));var n=!0,a=!1,i=void 0;try{for(var s,o=r[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var c=s.value,u=Math.max((c.startPos+c.targetPos)/2,c.targetPos-8388608);if((0,h.closedIntervalsOverlap)(e,t,u,c.targetPos)){var l=c.targetPos-c.startPos,d=8388608*Math.ceil((l+1)/8388608),f=Math.pow(2,Math.ceil(Math.log2(l+1))),m=Math.min(f,d);t=Math.max(t,c.startPos+m)}}}catch(e){a=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}return t=Math.max(t,e+524288),{start:e,end:t}}},I=function(){"use strict";function e(t){(0,o._)(this,e),this.options=t,this.fileSize=null,this.nextAge=0,this.workers=[],this.cache=[],this.currentCacheSize=0,this.disposed=!1}return(0,c._)(e,[{key:"read",value:function(e,t){(0,h.assert)(null!==this.fileSize);var r=this.options.prefetchProfile(e,t,this.workers),n=Math.max(r.start,0),a=Math.min(r.end,this.fileSize);(0,h.assert)(n<=e&&t<=a);var i=null,s=(0,h.binarySearchLessOrEqual)(this.cache,e,function(e){return e.start}),o=-1!==s?this.cache[s]:null;o&&o.start<=e&&t<=o.end&&(o.age=this.nextAge++,i={bytes:o.bytes,view:o.view,offset:o.start});var c=(0,h.binarySearchLessOrEqual)(this.cache,n,function(e){return e.start}),u=i?null:new Uint8Array(t-e),l=0,d=n,f=[];if(-1!==c){for(var m=c;m<this.cache.length;m++){var p=this.cache[m];if(p.start>=a)break;if(!(p.end<=n)){var g=Math.max(n,p.start),v=Math.min(a,p.end);if((0,h.assert)(g<=v),d<g&&f.push({start:d,end:g}),d=v,u){var b=Math.max(e,p.start),y=Math.min(t,p.end);if(b<y){var k=b-e;u.set(p.bytes.subarray(b-p.start,y-p.start),k),k===l&&(l=y-e)}}p.age=this.nextAge++}}d<a&&f.push({start:d,end:a})}else f.push({start:n,end:a});if(u&&l>=u.length&&(i={bytes:u,view:(0,h.toDataView)(u),offset:e}),0===f.length)return(0,h.assert)(i),i;var _=(0,h.promiseWithResolvers)(),w=_.promise,S=_.resolve,T=_.reject,x=[],I=!0,E=!1,j=void 0;try{for(var P,C=f[Symbol.iterator]();!(I=(P=C.next()).done);I=!0){var A=P.value,B=Math.max(e,A.start),M=Math.min(t,A.end);B===A.start&&M===A.end?x.push(A):B<M&&x.push({start:B,end:M})}}catch(e){E=!0,j=e}finally{try{I||null==C.return||C.return()}finally{if(E)throw j}}var D=!0,F=!1,R=void 0;try{for(var U,O=f[Symbol.iterator]();!(D=(U=O.next()).done);D=!0){var N=U.value,L=u&&{start:e,bytes:u,holes:x,resolve:S,reject:T},z=!1,V=!0,H=!1,G=void 0;try{for(var q,W=this.workers[Symbol.iterator]();!(V=(q=W.next()).done);V=!0){var K=q.value;if((0,h.closedIntervalsOverlap)(N.start-131072,N.start,K.currentPos,K.targetPos)){K.targetPos=Math.max(K.targetPos,N.end),z=!0,L&&!K.pendingSlices.includes(L)&&K.pendingSlices.push(L),K.running||this.runWorker(K);break}}}catch(e){H=!0,G=e}finally{try{V||null==W.return||W.return()}finally{if(H)throw G}}if(!z){var X=this.createWorker(N.start,N.end);L&&(X.pendingSlices=[L]),this.runWorker(X)}}}catch(e){F=!0,R=e}finally{try{D||null==O.return||O.return()}finally{if(F)throw R}}return i||((0,h.assert)(u),i=w.then(function(t){return{bytes:t,view:(0,h.toDataView)(t),offset:e}})),i}},{key:"createWorker",value:function(e,t){var r={startPos:e,currentPos:e,targetPos:t,running:!1,aborted:this.disposed,pendingSlices:[],age:this.nextAge++};for(this.workers.push(r);this.workers.length>this.options.maxWorkerCount;){for(var n=0,a=this.workers[0],i=1;i<this.workers.length;i++){var s=this.workers[i];s.age<a.age&&(n=i,a=s)}if(a.running&&a.pendingSlices.length>0)break;a.aborted=!0,this.workers.splice(n,1)}return r}},{key:"runWorker",value:function(e){(0,h.assert)(!e.running),(0,h.assert)(e.currentPos<e.targetPos),e.running=!0,e.age=this.nextAge++,this.options.runWorker(e).catch(function(t){if(e.running=!1,e.pendingSlices.length>0)e.pendingSlices.forEach(function(e){return e.reject(t)}),e.pendingSlices.length=0;else throw t})}},{key:"supplyWorkerData",value:function(e,t){(0,h.assert)(!e.aborted);var r=e.currentPos,n=r+t.length;this.insertIntoCache({start:r,end:n,bytes:t,view:(0,h.toDataView)(t),age:this.nextAge++}),e.currentPos+=t.length,e.targetPos=Math.max(e.targetPos,e.currentPos);for(var a=0;a<e.pendingSlices.length;a++){var i=e.pendingSlices[a],s=Math.max(r,i.start),o=Math.min(n,i.start+i.bytes.length);s<o&&i.bytes.set(t.subarray(s-r,o-r),s-i.start);for(var c=0;c<i.holes.length;c++){var u=i.holes[c];r<=u.start&&n>u.start&&(u.start=n),u.end<=u.start&&(i.holes.splice(c,1),c--)}0===i.holes.length&&(i.resolve(i.bytes),e.pendingSlices.splice(a,1),a--)}for(var l=0;l<this.workers.length;l++){var d=this.workers[l];e!==d&&!d.running&&(0,h.closedIntervalsOverlap)(r,n,d.currentPos,d.targetPos)&&(this.workers.splice(l,1),l--)}}},{key:"forgetWorker",value:function(e){var t=this.workers.indexOf(e);(0,h.assert)(-1!==t),this.workers.splice(t,1)}},{key:"insertIntoCache",value:function(e){if(0!==this.options.maxCacheSize){var t=(0,h.binarySearchLessOrEqual)(this.cache,e.start,function(e){return e.start})+1;if(t>0){var r=this.cache[t-1];if(r.end>=e.end)return;if(r.end>e.start){var n=new Uint8Array(e.end-r.start);n.set(r.bytes,0),n.set(e.bytes,e.start-r.start),this.currentCacheSize+=e.end-r.end,r.bytes=n,r.view=(0,h.toDataView)(n),r.end=e.end,t--,e=r}else this.cache.splice(t,0,e),this.currentCacheSize+=e.bytes.length}else this.cache.splice(t,0,e),this.currentCacheSize+=e.bytes.length;for(var a=t+1;a<this.cache.length;a++){var i=this.cache[a];if(e.end<=i.start)break;if(e.end>=i.end){this.cache.splice(a,1),this.currentCacheSize-=i.bytes.length,a--;continue}var s=new Uint8Array(i.end-e.start);s.set(e.bytes,0),s.set(i.bytes,i.start-e.start),this.currentCacheSize-=e.end-i.start,e.bytes=s,e.view=(0,h.toDataView)(s),e.end=i.end,this.cache.splice(a,1);break}for(;this.currentCacheSize>this.options.maxCacheSize;){for(var o=0,c=this.cache[0],u=1;u<this.cache.length;u++){var l=this.cache[u];l.age<c.age&&(o=u,c=l)}if(this.currentCacheSize-c.bytes.length<=this.options.maxCacheSize)break;this.cache.splice(o,1),this.currentCacheSize-=c.bytes.length}}}},{key:"dispose",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,a=this.workers[Symbol.iterator]();!(e=(n=a.next()).done);e=!0)n.value.aborted=!0}catch(e){t=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}this.workers.length=0,this.cache.length=0,this.disposed=!0}}]),e}()},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_type_of.cjs":"iXhRw","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","@swc/helpers/cjs/_ts_values.cjs":"94P5Q","./misc.js":"j7iGm","./node.js":"5s8q3","./input.js":"3sapy","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"5s8q3":[function(e,t,r,n){},{}],QfqGG:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"PLACEHOLDER_DATA",function(){return u}),a.export(r,"EncodedPacket",function(){return l});var i=e("@swc/helpers/cjs/_class_call_check.cjs"),s=e("@swc/helpers/cjs/_create_class.cjs"),o=e("@swc/helpers/cjs/_type_of.cjs"),c=e("./misc.js"),u=new Uint8Array(0),l=function(){"use strict";function e(t,r,n,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:-1,c=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0;if((0,i._)(this,e),this.data=t,this.type=r,this.timestamp=n,this.duration=a,this.sequenceNumber=s,t===u&&void 0===c)throw Error("Internal error: byteLength must be explicitly provided when constructing metadata-only packets.");if(void 0===c&&(c=t.byteLength),!(t instanceof Uint8Array))throw TypeError("data must be a Uint8Array.");if("key"!==r&&"delta"!==r)throw TypeError('type must be either "key" or "delta".');if(!Number.isFinite(n))throw TypeError("timestamp must be a number.");if(!Number.isFinite(a)||a<0)throw TypeError("duration must be a non-negative number.");if(!Number.isFinite(s))throw TypeError("sequenceNumber must be a number.");if(!Number.isInteger(c)||c<0)throw TypeError("byteLength must be a non-negative integer.");if(void 0!==l&&((void 0===l?"undefined":(0,o._)(l))!=="object"||!l))throw TypeError("sideData, when provided, must be an object.");if((null==l?void 0:l.alpha)!==void 0&&!(l.alpha instanceof Uint8Array))throw TypeError("sideData.alpha, when provided, must be a Uint8Array.");if((null==l?void 0:l.alphaByteLength)!==void 0&&(!Number.isInteger(l.alphaByteLength)||l.alphaByteLength<0))throw TypeError("sideData.alphaByteLength, when provided, must be a non-negative integer.");this.byteLength=c,this.sideData=null!=l?l:{},this.sideData.alpha&&void 0===this.sideData.alphaByteLength&&(this.sideData.alphaByteLength=this.sideData.alpha.byteLength)}return(0,s._)(e,[{key:"isMetadataOnly",get:function(){return this.data===u}},{key:"microsecondTimestamp",get:function(){return Math.trunc(c.SECOND_TO_MICROSECOND_FACTOR*this.timestamp)}},{key:"microsecondDuration",get:function(){return Math.trunc(c.SECOND_TO_MICROSECOND_FACTOR*this.duration)}},{key:"toEncodedVideoChunk",value:function(){if(this.isMetadataOnly)throw TypeError("Metadata-only packets cannot be converted to a video chunk.");if("u"<typeof EncodedVideoChunk)throw Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}},{key:"alphaToEncodedVideoChunk",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.type;if(!this.sideData.alpha)throw TypeError("This packet does not contain alpha side data.");if(this.isMetadataOnly)throw TypeError("Metadata-only packets cannot be converted to a video chunk.");if("u"<typeof EncodedVideoChunk)throw Error("Your browser does not support EncodedVideoChunk.");return new EncodedVideoChunk({data:this.sideData.alpha,type:e,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}},{key:"toEncodedAudioChunk",value:function(){if(this.isMetadataOnly)throw TypeError("Metadata-only packets cannot be converted to an audio chunk.");if("u"<typeof EncodedAudioChunk)throw Error("Your browser does not support EncodedAudioChunk.");return new EncodedAudioChunk({data:this.data,type:this.type,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration})}},{key:"clone",value:function(t){var r,n;if(void 0!==t&&((void 0===t?"undefined":(0,o._)(t))!=="object"||null===t))throw TypeError("options, when provided, must be an object.");if((null==t?void 0:t.timestamp)!==void 0&&!Number.isFinite(t.timestamp))throw TypeError("options.timestamp, when provided, must be a number.");if((null==t?void 0:t.duration)!==void 0&&!Number.isFinite(t.duration))throw TypeError("options.duration, when provided, must be a number.");return new e(this.data,this.type,null!=(r=null==t?void 0:t.timestamp)?r:this.timestamp,null!=(n=null==t?void 0:t.duration)?n:this.duration,this.sequenceNumber,this.byteLength)}}],[{key:"fromEncodedChunk",value:function(t,r){if(!(t instanceof EncodedVideoChunk||t instanceof EncodedAudioChunk))throw TypeError("chunk must be an EncodedVideoChunk or EncodedAudioChunk.");var n,a=new Uint8Array(t.byteLength);return t.copyTo(a),new e(a,t.type,t.timestamp/1e6,(null!=(n=t.duration)?n:0)/1e6,void 0,void 0,r)}}]),e}()},{"@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_type_of.cjs":"iXhRw","./misc.js":"j7iGm","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"501Zr":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"toUlaw",function(){return i}),a.export(r,"fromUlaw",function(){return s}),a.export(r,"toAlaw",function(){return o}),a.export(r,"fromAlaw",function(){return c});var i=function(e){var t=e,r=4096,n=0,a=12,i=0;for(t<0&&(t=-t,n=128),(t+=33)>8191&&(t=8191);(t&r)!==r&&a>=5;)r>>=1,a--;return i=t>>a-4&15,255&~(n|a-5<<4|i)},s=function(e){var t=0,r=0,n=~e;128&n&&(n&=-129,t=-1);var a=(1<<(r=((240&n)>>4)+5)|(15&n)<<r-4|1<<r-5)-33;return 0===t?a:-a},o=function(e){var t=2048,r=0,n=11,a=0,i=e;for(i<0&&(i=-i,r=128),i>4095&&(i=4095);(i&t)!==t&&n>=5;)t>>=1,n--;return a=i>>(4===n?1:n-4)&15,(r|n-4<<4|a)^85},c=function(e){var t=0,r=0,n=85^e;128&n&&(n&=-129,t=-1);var a=0;return a=4!=(r=((240&n)>>4)+4)?1<<r|(15&n)<<r-4|1<<r-5:n<<1|1,0===t?a:-a}},{"@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"1oMH7":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"VIDEO_SAMPLE_PIXEL_FORMATS",function(){return p}),a.export(r,"VideoSample",function(){return v}),a.export(r,"VideoSampleColorSpace",function(){return b}),a.export(r,"clampCropRectangle",function(){return k}),a.export(r,"validateCropRectangle",function(){return _}),a.export(r,"AudioSample",function(){return I});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_class_call_check.cjs"),o=e("@swc/helpers/cjs/_create_class.cjs"),c=e("@swc/helpers/cjs/_sliced_to_array.cjs"),u=e("@swc/helpers/cjs/_type_of.cjs"),l=e("@swc/helpers/cjs/_ts_generator.cjs"),d=e("./misc.js");(0,d.polyfillSymbolDispose)();var f=-1/0,h=-1/0,m=null;"u">typeof FinalizationRegistry&&(m=new FinalizationRegistry(function(e){var t=Date.now();"video"===e.type?(t-f>=1e3&&(console.error("A VideoSample was garbage collected without first being closed. For proper resource management, make sure to call close() on all your VideoSamples as soon as you're done using them."),f=t),"u">typeof VideoFrame&&e.data instanceof VideoFrame&&e.data.close()):(t-h>=1e3&&(console.error("An AudioSample was garbage collected without first being closed. For proper resource management, make sure to call close() on all your AudioSamples as soon as you're done using them."),h=t),"u">typeof AudioData&&e.data instanceof AudioData&&e.data.close())}));var p=["I420","I420P10","I420P12","I420A","I420AP10","I420AP12","I422","I422P10","I422P12","I422A","I422AP10","I422AP12","I444","I444P10","I444P12","I444A","I444AP10","I444AP12","NV12","RGBA","RGBX","BGRA","BGRX"],g=new Set(p),v=function(){"use strict";function e(t,r){if((0,s._)(this,e),this._closed=!1,t instanceof ArrayBuffer||"u">typeof SharedArrayBuffer&&t instanceof SharedArrayBuffer||ArrayBuffer.isView(t)){if(!r||(void 0===r?"undefined":(0,u._)(r))!=="object")throw TypeError("init must be an object.");if(void 0===r.format||!g.has(r.format))throw TypeError("init.format must be one of: "+p.join(", "));if(!Number.isInteger(r.codedWidth)||r.codedWidth<=0)throw TypeError("init.codedWidth must be a positive integer.");if(!Number.isInteger(r.codedHeight)||r.codedHeight<=0)throw TypeError("init.codedHeight must be a positive integer.");if(void 0!==r.rotation&&![0,90,180,270].includes(r.rotation))throw TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(r.timestamp))throw TypeError("init.timestamp must be a number.");if(void 0!==r.duration&&(!Number.isFinite(r.duration)||r.duration<0))throw TypeError("init.duration, when provided, must be a non-negative number.");this._data=(0,d.toUint8Array)(t).slice(),this._layout=null!=(n=r.layout)?n:S(r.format,r.codedWidth,r.codedHeight),this.format=r.format,this.codedWidth=r.codedWidth,this.codedHeight=r.codedHeight,this.rotation=null!=(a=r.rotation)?a:0,this.timestamp=r.timestamp,this.duration=null!=(i=r.duration)?i:0,this.colorSpace=new b(r.colorSpace)}else if("u">typeof VideoFrame&&t instanceof VideoFrame){if((null==r?void 0:r.rotation)!==void 0&&![0,90,180,270].includes(r.rotation))throw TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if((null==r?void 0:r.timestamp)!==void 0&&!Number.isFinite(null==r?void 0:r.timestamp))throw TypeError("init.timestamp, when provided, must be a number.");if((null==r?void 0:r.duration)!==void 0&&(!Number.isFinite(r.duration)||r.duration<0))throw TypeError("init.duration, when provided, must be a non-negative number.");this._data=t,this._layout=null,this.format=t.format,this.codedWidth=t.displayWidth,this.codedHeight=t.displayHeight,this.rotation=null!=(o=null==r?void 0:r.rotation)?o:0,this.timestamp=null!=(c=null==r?void 0:r.timestamp)?c:t.timestamp/1e6,this.duration=null!=(f=null==r?void 0:r.duration)?f:(null!=(l=t.duration)?l:0)/1e6,this.colorSpace=new b(t.colorSpace)}else if("u">typeof HTMLImageElement&&t instanceof HTMLImageElement||"u">typeof SVGImageElement&&t instanceof SVGImageElement||"u">typeof ImageBitmap&&t instanceof ImageBitmap||"u">typeof HTMLVideoElement&&t instanceof HTMLVideoElement||"u">typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"u">typeof OffscreenCanvas&&t instanceof OffscreenCanvas){if(!r||(void 0===r?"undefined":(0,u._)(r))!=="object")throw TypeError("init must be an object.");if(void 0!==r.rotation&&![0,90,180,270].includes(r.rotation))throw TypeError("init.rotation, when provided, must be 0, 90, 180, or 270.");if(!Number.isFinite(r.timestamp))throw TypeError("init.timestamp must be a number.");if(void 0!==r.duration&&(!Number.isFinite(r.duration)||r.duration<0))throw TypeError("init.duration, when provided, must be a non-negative number.");if("u">typeof VideoFrame)return new e(new VideoFrame(t,{timestamp:Math.trunc(r.timestamp*d.SECOND_TO_MICROSECOND_FACTOR),duration:Math.trunc((null!=(h=r.duration)?h:0)*d.SECOND_TO_MICROSECOND_FACTOR)||void 0}),r);var n,a,i,o,c,l,f,h,v,y,k=0,_=0;if("naturalWidth"in t?(k=t.naturalWidth,_=t.naturalHeight):"videoWidth"in t?(k=t.videoWidth,_=t.videoHeight):"width"in t&&(k=Number(t.width),_=Number(t.height)),!k||!_)throw TypeError("Could not determine dimensions.");var w=new OffscreenCanvas(k,_),T=w.getContext("2d",{alpha:(0,d.isFirefox)(),willReadFrequently:!0});(0,d.assert)(T),T.drawImage(t,0,0),this._data=w,this._layout=null,this.format="RGBX",this.codedWidth=k,this.codedHeight=_,this.rotation=null!=(v=r.rotation)?v:0,this.timestamp=r.timestamp,this.duration=null!=(y=r.duration)?y:0,this.colorSpace=new b({matrix:"rgb",primaries:"bt709",transfer:"iec61966-2-1",fullRange:!0})}else throw TypeError("Invalid data type: Must be a BufferSource or CanvasImageSource.");null==m||m.register(this,{type:"video",data:this._data},this)}return(0,o._)(e,[{key:"displayWidth",get:function(){return this.rotation%180==0?this.codedWidth:this.codedHeight}},{key:"displayHeight",get:function(){return this.rotation%180==0?this.codedHeight:this.codedWidth}},{key:"microsecondTimestamp",get:function(){return Math.trunc(d.SECOND_TO_MICROSECOND_FACTOR*this.timestamp)}},{key:"microsecondDuration",get:function(){return Math.trunc(d.SECOND_TO_MICROSECOND_FACTOR*this.duration)}},{key:"hasAlpha",get:function(){return this.format&&this.format.includes("A")}},{key:"clone",value:function(){if(this._closed)throw Error("VideoSample is closed.");return((0,d.assert)(null!==this._data),y(this._data))?new e(this._data.clone(),{timestamp:this.timestamp,duration:this.duration,rotation:this.rotation}):this._data instanceof Uint8Array?((0,d.assert)(this._layout),new e(this._data,{format:this.format,layout:this._layout,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})):new e(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.timestamp,duration:this.duration,colorSpace:this.colorSpace,rotation:this.rotation})}},{key:"close",value:function(){this._closed||(null==m||m.unregister(this),y(this._data)?this._data.close():this._data=null,this._closed=!0)}},{key:"allocationSize",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(w(t),this._closed)throw Error("VideoSample is closed.");if((null!=(e=t.format)?e:this.format)===null)throw Error("Cannot get allocation size when format is null. Please manually provide an RGB pixel format in the options instead.");if((0,d.assert)(null!==this._data),!y(this._data)&&(t.colorSpace||t.format&&t.format!==this.format||t.layout||t.rect)){var r=this.toVideoFrame(),n=r.allocationSize(t);return r.close(),n}return y(this._data)?this._data.allocationSize(t):this._data instanceof Uint8Array?this._data.byteLength:this.codedWidth*this.codedHeight*4}},{key:"copyTo",value:function(e){return(0,i._)(function(e){var t,r,n,a,i,s,o=arguments;return(0,l._)(this,function(c){switch(c.label){case 0:if(t=o.length>1&&void 0!==o[1]?o[1]:{},!(0,d.isAllowSharedBufferSource)(e))throw TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(w(t),this._closed)throw Error("VideoSample is closed.");if((null!=(r=t.format)?r:this.format)===null)throw Error("Cannot copy video sample data when format is null. Please manually provide an RGB pixel format in the options instead.");if((0,d.assert)(null!==this._data),y(this._data)||!(t.colorSpace||t.format&&t.format!==this.format||t.layout||t.rect))return[3,2];return[4,(n=this.toVideoFrame()).copyTo(e,t)];case 1:return a=c.sent(),n.close(),[2,a];case 2:if(y(this._data))return[2,this._data.copyTo(e,t)];if(this._data instanceof Uint8Array)return(0,d.assert)(this._layout),(0,d.toUint8Array)(e).set(this._data),[2,this._layout];return i=this._data.getContext("2d"),(0,d.assert)(i),s=i.getImageData(0,0,this.codedWidth,this.codedHeight),(0,d.toUint8Array)(e).set(s.data),[2,[{offset:0,stride:4*this.codedWidth}]]}})}).apply(this,arguments)}},{key:"toVideoFrame",value:function(){if(this._closed)throw Error("VideoSample is closed.");return((0,d.assert)(null!==this._data),y(this._data))?new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0}):this._data instanceof Uint8Array?new VideoFrame(this._data,{format:this.format,codedWidth:this.codedWidth,codedHeight:this.codedHeight,timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0,colorSpace:this.colorSpace}):new VideoFrame(this._data,{timestamp:this.microsecondTimestamp,duration:this.microsecondDuration||void 0})}},{key:"draw",value:function(e,t,r,n,a,i,s,o,c){var u,l=0,d=0,f=this.displayWidth,h=this.displayHeight,m=0,p=0,g=this.displayWidth,v=this.displayHeight;if(void 0!==i?(l=t,d=r,f=n,h=a,m=i,p=s,void 0!==o?(g=o,v=c):(g=f,v=h)):(m=t,p=r,void 0!==n&&(g=n,v=a)),!("u">typeof CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"u">typeof OffscreenCanvasRenderingContext2D&&e instanceof OffscreenCanvasRenderingContext2D))throw TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!Number.isFinite(l))throw TypeError("sx must be a number.");if(!Number.isFinite(d))throw TypeError("sy must be a number.");if(!Number.isFinite(f)||f<0)throw TypeError("sWidth must be a non-negative number.");if(!Number.isFinite(h)||h<0)throw TypeError("sHeight must be a non-negative number.");if(!Number.isFinite(m))throw TypeError("dx must be a number.");if(!Number.isFinite(p))throw TypeError("dy must be a number.");if(!Number.isFinite(g)||g<0)throw TypeError("dWidth must be a non-negative number.");if(!Number.isFinite(v)||v<0)throw TypeError("dHeight must be a non-negative number.");if(this._closed)throw Error("VideoSample is closed.");l=(u=this._rotateSourceRegion(l,d,f,h,this.rotation)).sx,d=u.sy,f=u.sWidth,h=u.sHeight;var b=this.toCanvasImageSource();e.save();var y=m+g/2,k=p+v/2;e.translate(y,k),e.rotate(this.rotation*Math.PI/180);var _=this.rotation%180==0?1:g/v;e.scale(1/_,_),e.drawImage(b,l,d,f,h,-g/2,-v/2,g,v),e.restore()}},{key:"drawWithFit",value:function(e,t){if(!("u">typeof CanvasRenderingContext2D&&e instanceof CanvasRenderingContext2D||"u">typeof OffscreenCanvasRenderingContext2D&&e instanceof OffscreenCanvasRenderingContext2D))throw TypeError("context must be a CanvasRenderingContext2D or OffscreenCanvasRenderingContext2D.");if(!t||(void 0===t?"undefined":(0,u._)(t))!=="object")throw TypeError("options must be an object.");if(!["fill","contain","cover"].includes(t.fit))throw TypeError("options.fit must be 'fill', 'contain', or 'cover'.");if(void 0!==t.rotation&&![0,90,180,270].includes(t.rotation))throw TypeError("options.rotation, when provided, must be 0, 90, 180, or 270.");void 0!==t.crop&&_(t.crop,"options.");var r,n,a,i,s,o,l,d,f,h,m,p,g,v=e.canvas.width,b=e.canvas.height,y=null!=(s=t.rotation)?s:this.rotation,w=(0,c._)(y%180==0?[this.codedWidth,this.codedHeight]:[this.codedHeight,this.codedWidth],2),S=w[0],T=w[1];t.crop&&k(t.crop,S,T);var x=this._rotateSourceRegion(null!=(h=null==(r=t.crop)?void 0:r.left)?h:0,null!=(m=null==(n=t.crop)?void 0:n.top)?m:0,null!=(p=null==(a=t.crop)?void 0:a.width)?p:S,null!=(g=null==(i=t.crop)?void 0:i.height)?g:T,y),I=x.sx,E=x.sy,j=x.sWidth,P=x.sHeight;if("fill"===t.fit)o=0,l=0,d=v,f=b;else{var C=(0,c._)(t.crop?[t.crop.width,t.crop.height]:[S,T],2),A=C[0],B=C[1],M="contain"===t.fit?Math.min(v/A,b/B):Math.max(v/A,b/B);d=A*M,f=B*M,o=(v-d)/2,l=(b-f)/2}e.save();var D=y%180==0?1:d/f;e.translate(v/2,b/2),e.rotate(y*Math.PI/180),e.scale(1/D,D),e.translate(-v/2,-b/2),e.drawImage(this.toCanvasImageSource(),I,E,j,P,o,l,d,f),e.restore()}},{key:"_rotateSourceRegion",value:function(e,t,r,n,a){var i,s,o;return 90===a?(e=(i=[t,this.codedHeight-e-r,n,r])[0],t=i[1],r=i[2],n=i[3]):180===a?(e=(s=[this.codedWidth-e-r,this.codedHeight-t-n])[0],t=s[1]):270===a&&(e=(o=[this.codedWidth-t-n,e,n,r])[0],t=o[1],r=o[2],n=o[3]),{sx:e,sy:t,sWidth:r,sHeight:n}}},{key:"toCanvasImageSource",value:function(){if(this._closed)throw Error("VideoSample is closed.");if((0,d.assert)(null!==this._data),!(this._data instanceof Uint8Array))return this._data;var e=this.toVideoFrame();return queueMicrotask(function(){return e.close()}),e}},{key:"setRotation",value:function(e){if(![0,90,180,270].includes(e))throw TypeError("newRotation must be 0, 90, 180, or 270.");this.rotation=e}},{key:"setTimestamp",value:function(e){if(!Number.isFinite(e))throw TypeError("newTimestamp must be a number.");this.timestamp=e}},{key:"setDuration",value:function(e){if(!Number.isFinite(e)||e<0)throw TypeError("newDuration must be a non-negative number.");this.duration=e}},{key:Symbol.dispose,value:function(){this.close()}}]),e}(),b=function(){"use strict";function e(t){var r,n,a,i;(0,s._)(this,e),this.primaries=null!=(r=null==t?void 0:t.primaries)?r:null,this.transfer=null!=(n=null==t?void 0:t.transfer)?n:null,this.matrix=null!=(a=null==t?void 0:t.matrix)?a:null,this.fullRange=null!=(i=null==t?void 0:t.fullRange)?i:null}return(0,o._)(e,[{key:"toJSON",value:function(){return{primaries:this.primaries,transfer:this.transfer,matrix:this.matrix,fullRange:this.fullRange}}}]),e}(),y=function(e){return"u">typeof VideoFrame&&e instanceof VideoFrame},k=function(e,t,r){e.left=Math.min(e.left,t),e.top=Math.min(e.top,r),e.width=Math.min(e.width,t-e.left),e.height=Math.min(e.height,r-e.top),(0,d.assert)(e.width>=0),(0,d.assert)(e.height>=0)},_=function(e,t){if(!e||(void 0===e?"undefined":(0,u._)(e))!=="object")throw TypeError(t+"crop, when provided, must be an object.");if(!Number.isInteger(e.left)||e.left<0)throw TypeError(t+"crop.left must be a non-negative integer.");if(!Number.isInteger(e.top)||e.top<0)throw TypeError(t+"crop.top must be a non-negative integer.");if(!Number.isInteger(e.width)||e.width<0)throw TypeError(t+"crop.width must be a non-negative integer.");if(!Number.isInteger(e.height)||e.height<0)throw TypeError(t+"crop.height must be a non-negative integer.")},w=function(e){if(!e||(void 0===e?"undefined":(0,u._)(e))!=="object")throw TypeError("options must be an object.");if(void 0!==e.colorSpace&&!["display-p3","srgb"].includes(e.colorSpace))throw TypeError("options.colorSpace, when provided, must be 'display-p3' or 'srgb'.");if(void 0!==e.format&&"string"!=typeof e.format)throw TypeError("options.format, when provided, must be a string.");if(void 0!==e.layout){if(!Array.isArray(e.layout))throw TypeError("options.layout, when provided, must be an array.");var t=!0,r=!1,n=void 0;try{for(var a,i=e.layout[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;if(!s||(void 0===s?"undefined":(0,u._)(s))!=="object")throw TypeError("Each entry in options.layout must be an object.");if(!Number.isInteger(s.offset)||s.offset<0)throw TypeError("plane.offset must be a non-negative integer.");if(!Number.isInteger(s.stride)||s.stride<0)throw TypeError("plane.stride must be a non-negative integer.")}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}if(void 0!==e.rect){if(!e.rect||"object"!==(0,u._)(e.rect))throw TypeError("options.rect, when provided, must be an object.");if(void 0!==e.rect.x&&(!Number.isInteger(e.rect.x)||e.rect.x<0))throw TypeError("options.rect.x, when provided, must be a non-negative integer.");if(void 0!==e.rect.y&&(!Number.isInteger(e.rect.y)||e.rect.y<0))throw TypeError("options.rect.y, when provided, must be a non-negative integer.");if(void 0!==e.rect.width&&(!Number.isInteger(e.rect.width)||e.rect.width<0))throw TypeError("options.rect.width, when provided, must be a non-negative integer.");if(void 0!==e.rect.height&&(!Number.isInteger(e.rect.height)||e.rect.height<0))throw TypeError("options.rect.height, when provided, must be a non-negative integer.")}},S=function(e,t,r){var n=T(e),a=[],i=0,s=!0,o=!1,c=void 0;try{for(var u,l=n[Symbol.iterator]();!(s=(u=l.next()).done);s=!0){var d=u.value,f=Math.ceil(t/d.widthDivisor),h=Math.ceil(r/d.heightDivisor),m=f*d.sampleBytes,p=m*h;a.push({offset:i,stride:m}),i+=p}}catch(e){o=!0,c=e}finally{try{s||null==l.return||l.return()}finally{if(o)throw c}}return a},T=function(e){var t=function(e,t,r,n,a){var i=[{sampleBytes:e,widthDivisor:1,heightDivisor:1},{sampleBytes:t,widthDivisor:r,heightDivisor:n},{sampleBytes:t,widthDivisor:r,heightDivisor:n}];return a&&i.push({sampleBytes:e,widthDivisor:1,heightDivisor:1}),i};switch(e){case"I420":return t(1,1,2,2,!1);case"I420P10":case"I420P12":return t(2,2,2,2,!1);case"I420A":return t(1,1,2,2,!0);case"I420AP10":case"I420AP12":return t(2,2,2,2,!0);case"I422":return t(1,1,2,1,!1);case"I422P10":case"I422P12":return t(2,2,2,1,!1);case"I422A":return t(1,1,2,1,!0);case"I422AP10":case"I422AP12":return t(2,2,2,1,!0);case"I444":return t(1,1,1,1,!1);case"I444P10":case"I444P12":return t(2,2,1,1,!1);case"I444A":return t(1,1,1,1,!0);case"I444AP10":case"I444AP12":return t(2,2,1,1,!0);case"NV12":return[{sampleBytes:1,widthDivisor:1,heightDivisor:1},{sampleBytes:2,widthDivisor:2,heightDivisor:2}];case"RGBA":case"RGBX":case"BGRA":case"BGRX":return[{sampleBytes:4,widthDivisor:1,heightDivisor:1}];default:(0,d.assertNever)(e),(0,d.assert)(!1)}},x=new Set(["f32","f32-planar","s16","s16-planar","s32","s32-planar","u8","u8-planar"]),I=function(){"use strict";function e(t){if((0,s._)(this,e),this._closed=!1,A(t)){if(null===t.format)throw TypeError("AudioData with null format is not supported.");this._data=t,this.format=t.format,this.sampleRate=t.sampleRate,this.numberOfFrames=t.numberOfFrames,this.numberOfChannels=t.numberOfChannels,this.timestamp=t.timestamp/1e6,this.duration=t.numberOfFrames/t.sampleRate}else{if(!t||(void 0===t?"undefined":(0,u._)(t))!=="object")throw TypeError("Invalid AudioDataInit: must be an object.");if(!x.has(t.format))throw TypeError("Invalid AudioDataInit: invalid format.");if(!Number.isFinite(t.sampleRate)||t.sampleRate<=0)throw TypeError("Invalid AudioDataInit: sampleRate must be >0.");if(!Number.isInteger(t.numberOfChannels)||0===t.numberOfChannels)throw TypeError("Invalid AudioDataInit: numberOfChannels must be an integer > 0.");if(!Number.isFinite(null==t?void 0:t.timestamp))throw TypeError("init.timestamp must be a number.");var r,n=t.data.byteLength/(E(t.format)*t.numberOfChannels);if(!Number.isInteger(n))throw TypeError("Invalid AudioDataInit: data size is not a multiple of frame size.");if(this.format=t.format,this.sampleRate=t.sampleRate,this.numberOfFrames=n,this.numberOfChannels=t.numberOfChannels,this.timestamp=t.timestamp,this.duration=n/t.sampleRate,t.data instanceof ArrayBuffer)r=new Uint8Array(t.data);else if(ArrayBuffer.isView(t.data))r=new Uint8Array(t.data.buffer,t.data.byteOffset,t.data.byteLength);else throw TypeError("Invalid AudioDataInit: data is not a BufferSource.");var a=this.numberOfFrames*this.numberOfChannels*E(this.format);if(r.byteLength<a)throw TypeError("Invalid AudioDataInit: insufficient data size.");this._data=r}null==m||m.register(this,{type:"audio",data:this._data},this)}return(0,o._)(e,[{key:"microsecondTimestamp",get:function(){return Math.trunc(d.SECOND_TO_MICROSECOND_FACTOR*this.timestamp)}},{key:"microsecondDuration",get:function(){return Math.trunc(d.SECOND_TO_MICROSECOND_FACTOR*this.duration)}},{key:"allocationSize",value:function(e){if(!e||(void 0===e?"undefined":(0,u._)(e))!=="object")throw TypeError("options must be an object.");if(!Number.isInteger(e.planeIndex)||e.planeIndex<0)throw TypeError("planeIndex must be a non-negative integer.");if(void 0!==e.format&&!x.has(e.format))throw TypeError("Invalid format.");if(void 0!==e.frameOffset&&(!Number.isInteger(e.frameOffset)||e.frameOffset<0))throw TypeError("frameOffset must be a non-negative integer.");if(void 0!==e.frameCount&&(!Number.isInteger(e.frameCount)||e.frameCount<0))throw TypeError("frameCount must be a non-negative integer.");if(this._closed)throw Error("AudioSample is closed.");var t,r,n=null!=(t=e.format)?t:this.format,a=null!=(r=e.frameOffset)?r:0;if(a>=this.numberOfFrames)throw RangeError("frameOffset out of range");var i=void 0!==e.frameCount?e.frameCount:this.numberOfFrames-a;if(i>this.numberOfFrames-a)throw RangeError("frameCount out of range");var s=E(n),o=j(n);if(o&&e.planeIndex>=this.numberOfChannels||!o&&0!==e.planeIndex)throw RangeError("planeIndex out of range");return(o?i:i*this.numberOfChannels)*s}},{key:"copyTo",value:function(e,t){if(!(0,d.isAllowSharedBufferSource)(e))throw TypeError("destination must be an ArrayBuffer or an ArrayBuffer view.");if(!t||(void 0===t?"undefined":(0,u._)(t))!=="object")throw TypeError("options must be an object.");if(!Number.isInteger(t.planeIndex)||t.planeIndex<0)throw TypeError("planeIndex must be a non-negative integer.");if(void 0!==t.format&&!x.has(t.format))throw TypeError("Invalid format.");if(void 0!==t.frameOffset&&(!Number.isInteger(t.frameOffset)||t.frameOffset<0))throw TypeError("frameOffset must be a non-negative integer.");if(void 0!==t.frameCount&&(!Number.isInteger(t.frameCount)||t.frameCount<0))throw TypeError("frameCount must be a non-negative integer.");if(this._closed)throw Error("AudioSample is closed.");var r=t.planeIndex,n=t.format,a=t.frameCount,i=t.frameOffset,s=this.format,o=null!=n?n:this.format;if(!o)throw Error("Destination format not determined");var c=this.numberOfFrames,l=this.numberOfChannels,f=null!=i?i:0;if(f>=c)throw RangeError("frameOffset out of range");var h=void 0!==a?a:c-f;if(h>c-f)throw RangeError("frameCount out of range");var m=E(o),p=j(o);if(p&&r>=l||!p&&0!==r)throw RangeError("planeIndex out of range");var g=p?h:h*l;if(e.byteLength<g*m)throw RangeError("Destination buffer is too small");var v=(0,d.toDataView)(e),b=C(o);if(A(this._data))(0,d.isWebKit)()&&l>2&&o!==s?B(this._data,v,s,o,l,r,f,h):this._data.copyTo(e,{planeIndex:r,frameOffset:f,frameCount:h,format:o});else for(var y=this._data,k=(0,d.toDataView)(y),_=P(s),w=E(s),S=j(s),T=0;T<h;T++)if(p)b(v,T*m,_(k,S?(r*c+(T+f))*w:((T+f)*l+r)*w));else for(var I=0;I<l;I++)b(v,(T*l+I)*m,_(k,S?(I*c+(T+f))*w:((T+f)*l+I)*w))}},{key:"clone",value:function(){if(this._closed)throw Error("AudioSample is closed.");if(!A(this._data))return new e({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.timestamp,data:this._data});var t=new e(this._data.clone());return t.setTimestamp(this.timestamp),t}},{key:"close",value:function(){this._closed||(null==m||m.unregister(this),A(this._data)?this._data.close():this._data=new Uint8Array(0),this._closed=!0)}},{key:"toAudioData",value:function(){if(this._closed)throw Error("AudioSample is closed.");if(!A(this._data))return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:this._data.buffer instanceof ArrayBuffer?this._data.buffer:this._data.slice()});if(this._data.timestamp===this.microsecondTimestamp)return this._data.clone();if(j(this.format)){for(var e=this.allocationSize({planeIndex:0,format:this.format}),t=new ArrayBuffer(e*this.numberOfChannels),r=0;r<this.numberOfChannels;r++)this.copyTo(new Uint8Array(t,r*e,e),{planeIndex:r,format:this.format});return new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:t})}var n=new ArrayBuffer(this.allocationSize({planeIndex:0,format:this.format}));return this.copyTo(n,{planeIndex:0,format:this.format}),new AudioData({format:this.format,sampleRate:this.sampleRate,numberOfFrames:this.numberOfFrames,numberOfChannels:this.numberOfChannels,timestamp:this.microsecondTimestamp,data:n})}},{key:"toAudioBuffer",value:function(){if(this._closed)throw Error("AudioSample is closed.");for(var e=new AudioBuffer({numberOfChannels:this.numberOfChannels,length:this.numberOfFrames,sampleRate:this.sampleRate}),t=new Float32Array(this.allocationSize({planeIndex:0,format:"f32-planar"})/4),r=0;r<this.numberOfChannels;r++)this.copyTo(t,{planeIndex:r,format:"f32-planar"}),e.copyToChannel(t,r);return e}},{key:"setTimestamp",value:function(e){if(!Number.isFinite(e))throw TypeError("newTimestamp must be a number.");this.timestamp=e}},{key:Symbol.dispose,value:function(){this.close()}}],[{key:"_fromAudioBuffer",value:function(t,r){var n,a,i,s,o,c,u,d,f;return(0,l._)(this,function(l){switch(l.label){case 0:if(!(t instanceof AudioBuffer))throw TypeError("audioBuffer must be an AudioBuffer.");n=t.numberOfChannels,a=t.sampleRate,i=t.length,s=Math.floor(24e4/n),o=0,c=i,l.label=1;case 1:if(!(c>0))return[3,3];for(f=0,d=new Float32Array(n*(u=Math.min(s,c)));f<n;f++)t.copyFromChannel(d.subarray(f*u,(f+1)*u),f,o);return[4,new e({format:"f32-planar",sampleRate:a,numberOfFrames:u,numberOfChannels:n,timestamp:r+o/a,data:d})];case 2:return l.sent(),o+=u,c-=u,[3,1];case 3:return[2]}})}},{key:"fromAudioBuffer",value:function(t,r){if(!(t instanceof AudioBuffer))throw TypeError("audioBuffer must be an AudioBuffer.");for(var n=t.numberOfChannels,a=t.sampleRate,i=t.length,s=Math.floor(24e4/n),o=0,c=i,u=[];c>0;){for(var l=Math.min(s,c),d=new Float32Array(n*l),f=0;f<n;f++)t.copyFromChannel(d.subarray(f*l,(f+1)*l),f,o);var h=new e({format:"f32-planar",sampleRate:a,numberOfFrames:l,numberOfChannels:n,timestamp:r+o/a,data:d});u.push(h),o+=l,c-=l}return u}}]),e}(),E=function(e){switch(e){case"u8":case"u8-planar":return 1;case"s16":case"s16-planar":return 2;case"s32":case"s32-planar":case"f32":case"f32-planar":return 4;default:throw Error("Unknown AudioSampleFormat")}},j=function(e){switch(e){case"u8-planar":case"s16-planar":case"s32-planar":case"f32-planar":return!0;default:return!1}},P=function(e){switch(e){case"u8":case"u8-planar":return function(e,t){return(e.getUint8(t)-128)/128};case"s16":case"s16-planar":return function(e,t){return e.getInt16(t,!0)/32768};case"s32":case"s32-planar":return function(e,t){return e.getInt32(t,!0)/0x80000000};case"f32":case"f32-planar":return function(e,t){return e.getFloat32(t,!0)}}},C=function(e){switch(e){case"u8":case"u8-planar":return function(e,t,r){return e.setUint8(t,(0,d.clamp)((r+1)*127.5,0,255))};case"s16":case"s16-planar":return function(e,t,r){return e.setInt16(t,(0,d.clamp)(Math.round(32767*r),-32768,32767),!0)};case"s32":case"s32-planar":return function(e,t,r){return e.setInt32(t,(0,d.clamp)(Math.round(0x7fffffff*r),-0x80000000,0x7fffffff),!0)};case"f32":case"f32-planar":return function(e,t,r){return e.setFloat32(t,r,!0)}}},A=function(e){return"u">typeof AudioData&&e instanceof AudioData},B=function(e,t,r,n,a,i,s,o){var c=P(r),u=C(n),l=E(r),f=E(n),h=j(r);if(j(n))if(h){var m=new ArrayBuffer(o*l),p=(0,d.toDataView)(m);e.copyTo(m,{planeIndex:i,frameOffset:s,frameCount:o,format:r});for(var g=0;g<o;g++){var v=g*l;u(t,g*f,c(p,v))}}else{var b=new ArrayBuffer(o*a*l),y=(0,d.toDataView)(b);e.copyTo(b,{planeIndex:0,frameOffset:s,frameCount:o,format:r});for(var k=0;k<o;k++){var _=(k*a+i)*l;u(t,k*f,c(y,_))}}else if(h)for(var w=new ArrayBuffer(o*l),S=(0,d.toDataView)(w),T=0;T<a;T++){e.copyTo(w,{planeIndex:T,frameOffset:s,frameCount:o,format:r});for(var x=0;x<o;x++){var I=x*l;u(t,(x*a+T)*f,c(S,I))}}else{var A=new ArrayBuffer(o*a*l),B=(0,d.toDataView)(A);e.copyTo(A,{planeIndex:0,frameOffset:s,frameCount:o,format:r});for(var M=0;M<o;M++)for(var D=0;D<a;D++){var F=M*a+D,R=F*l;u(t,F*f,c(B,R))}}}},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_sliced_to_array.cjs":"gIQTH","@swc/helpers/cjs/_type_of.cjs":"iXhRw","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","./misc.js":"j7iGm","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],gw3Ca:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"buildIsobmffMimeType",function(){return s});var i=e("@swc/helpers/cjs/_to_consumable_array.cjs"),s=function(e){var t=(e.hasVideo?"video/":e.hasAudio?"audio/":"application/")+(e.isQuickTime?"quicktime":"mp4");if(e.codecStrings.length>0){var r=(0,i._)(new Set(e.codecStrings));t+='; codecs="'.concat(r.join(", "),'"')}return t}},{"@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],fSW0K:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"MIN_BOX_HEADER_SIZE",function(){return c}),a.export(r,"MAX_BOX_HEADER_SIZE",function(){return u}),a.export(r,"readBoxHeader",function(){return l}),a.export(r,"readFixed_16_16",function(){return d}),a.export(r,"readFixed_2_30",function(){return f}),a.export(r,"readIsomVariableInteger",function(){return h}),a.export(r,"readMetadataStringShort",function(){return m}),a.export(r,"readDataBox",function(){return p});var i=e("../metadata.js"),s=e("../misc.js"),o=e("../reader.js"),c=8,u=16,l=function(e){var t=(0,o.readU32Be)(e),r=(0,o.readAscii)(e,4),n=8;1===t&&(t=(0,o.readU64Be)(e),n=16);var a=t-n;return a<0?null:{name:r,totalSize:t,headerSize:n,contentSize:a}},d=function(e){return(0,o.readI32Be)(e)/65536},f=function(e){return(0,o.readI32Be)(e)/0x40000000},h=function(e){for(var t=0,r=0;r<4;r++){t<<=7;var n=(0,o.readU8)(e);if(t|=127&n,(128&n)==0)break}return t},m=function(e){var t=(0,o.readU16Be)(e);return e.skip(2),t=Math.min(t,e.remainingLength),s.textDecoder.decode((0,o.readBytes)(e,t))},p=function(e){var t=l(e);if(!t||"data"!==t.name||e.remainingLength<8)return null;var r=(0,o.readU32Be)(e);e.skip(4);var n=(0,o.readBytes)(e,t.contentSize-8);switch(r){case 1:return s.textDecoder.decode(n);case 2:return new TextDecoder("utf-16be").decode(n);case 13:return new(0,i.RichImageData)(n,"image/jpeg");case 14:return new(0,i.RichImageData)(n,"image/png");case 27:return new(0,i.RichImageData)(n,"image/bmp");default:return n}}},{"../metadata.js":"eSjom","../misc.js":"j7iGm","../reader.js":"8KRfO","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],eSjom:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"RichImageData",function(){return o}),a.export(r,"AttachedFile",function(){return c}),a.export(r,"validateMetadataTags",function(){return u}),a.export(r,"metadataTagsAreEmpty",function(){return l}),a.export(r,"DEFAULT_TRACK_DISPOSITION",function(){return d}),a.export(r,"validateTrackDisposition",function(){return f});var i=e("@swc/helpers/cjs/_class_call_check.cjs"),s=e("@swc/helpers/cjs/_type_of.cjs"),o=function e(t,r){"use strict";if((0,i._)(this,e),this.data=t,this.mimeType=r,!(t instanceof Uint8Array))throw TypeError("data must be a Uint8Array.");if("string"!=typeof r)throw TypeError("mimeType must be a string.")},c=function e(t,r,n,a){"use strict";if((0,i._)(this,e),this.data=t,this.mimeType=r,this.name=n,this.description=a,!(t instanceof Uint8Array))throw TypeError("data must be a Uint8Array.");if(void 0!==r&&"string"!=typeof r)throw TypeError("mimeType, when provided, must be a string.");if(void 0!==n&&"string"!=typeof n)throw TypeError("name, when provided, must be a string.");if(void 0!==a&&"string"!=typeof a)throw TypeError("description, when provided, must be a string.")},u=function(e){if(!e||(void 0===e?"undefined":(0,s._)(e))!=="object")throw TypeError("tags must be an object.");if(void 0!==e.title&&"string"!=typeof e.title)throw TypeError("tags.title, when provided, must be a string.");if(void 0!==e.description&&"string"!=typeof e.description)throw TypeError("tags.description, when provided, must be a string.");if(void 0!==e.artist&&"string"!=typeof e.artist)throw TypeError("tags.artist, when provided, must be a string.");if(void 0!==e.album&&"string"!=typeof e.album)throw TypeError("tags.album, when provided, must be a string.");if(void 0!==e.albumArtist&&"string"!=typeof e.albumArtist)throw TypeError("tags.albumArtist, when provided, must be a string.");if(void 0!==e.trackNumber&&(!Number.isInteger(e.trackNumber)||e.trackNumber<=0))throw TypeError("tags.trackNumber, when provided, must be a positive integer.");if(void 0!==e.tracksTotal&&(!Number.isInteger(e.tracksTotal)||e.tracksTotal<=0))throw TypeError("tags.tracksTotal, when provided, must be a positive integer.");if(void 0!==e.discNumber&&(!Number.isInteger(e.discNumber)||e.discNumber<=0))throw TypeError("tags.discNumber, when provided, must be a positive integer.");if(void 0!==e.discsTotal&&(!Number.isInteger(e.discsTotal)||e.discsTotal<=0))throw TypeError("tags.discsTotal, when provided, must be a positive integer.");if(void 0!==e.genre&&"string"!=typeof e.genre)throw TypeError("tags.genre, when provided, must be a string.");if(void 0!==e.date&&(!(e.date instanceof Date)||Number.isNaN(e.date.getTime())))throw TypeError("tags.date, when provided, must be a valid Date.");if(void 0!==e.lyrics&&"string"!=typeof e.lyrics)throw TypeError("tags.lyrics, when provided, must be a string.");if(void 0!==e.images){if(!Array.isArray(e.images))throw TypeError("tags.images, when provided, must be an array.");var t=!0,r=!1,n=void 0;try{for(var a,i=e.images[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var u=a.value;if(!u||(void 0===u?"undefined":(0,s._)(u))!=="object")throw TypeError("Each image in tags.images must be an object.");if(!(u.data instanceof Uint8Array))throw TypeError("Each image.data must be a Uint8Array.");if("string"!=typeof u.mimeType)throw TypeError("Each image.mimeType must be a string.");if(!["coverFront","coverBack","unknown"].includes(u.kind))throw TypeError("Each image.kind must be 'coverFront', 'coverBack', or 'unknown'.")}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}if(void 0!==e.comment&&"string"!=typeof e.comment)throw TypeError("tags.comment, when provided, must be a string.");if(void 0!==e.raw){if(!e.raw||"object"!==(0,s._)(e.raw))throw TypeError("tags.raw, when provided, must be an object.");var l=!0,d=!1,f=void 0;try{for(var h,m=Object.values(e.raw)[Symbol.iterator]();!(l=(h=m.next()).done);l=!0){var p=h.value;if(null!==p&&"string"!=typeof p&&!(p instanceof Uint8Array)&&!(p instanceof o)&&!(p instanceof c))throw TypeError("Each value in tags.raw must be a string, Uint8Array, RichImageData, AttachedFile, or null.")}}catch(e){d=!0,f=e}finally{try{l||null==m.return||m.return()}finally{if(d)throw f}}}},l=function(e){return void 0===e.title&&void 0===e.description&&void 0===e.artist&&void 0===e.album&&void 0===e.albumArtist&&void 0===e.trackNumber&&void 0===e.tracksTotal&&void 0===e.discNumber&&void 0===e.discsTotal&&void 0===e.genre&&void 0===e.date&&void 0===e.lyrics&&(!e.images||0===e.images.length)&&void 0===e.comment&&(void 0===e.raw||0===Object.keys(e.raw).length)},d={default:!0,forced:!1,original:!1,commentary:!1,hearingImpaired:!1,visuallyImpaired:!1},f=function(e){if(!e||(void 0===e?"undefined":(0,s._)(e))!=="object")throw TypeError("disposition must be an object.");if(void 0!==e.default&&"boolean"!=typeof e.default)throw TypeError("disposition.default must be a boolean.");if(void 0!==e.forced&&"boolean"!=typeof e.forced)throw TypeError("disposition.forced must be a boolean.");if(void 0!==e.original&&"boolean"!=typeof e.original)throw TypeError("disposition.original must be a boolean.");if(void 0!==e.commentary&&"boolean"!=typeof e.commentary)throw TypeError("disposition.commentary must be a boolean.");if(void 0!==e.hearingImpaired&&"boolean"!=typeof e.hearingImpaired)throw TypeError("disposition.hearingImpaired must be a boolean.");if(void 0!==e.visuallyImpaired&&"boolean"!=typeof e.visuallyImpaired)throw TypeError("disposition.visuallyImpaired must be a boolean.")}},{"@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_type_of.cjs":"iXhRw","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],fq2QE:[function(e,t,r,n){var a,i,s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"EBMLFloat32",function(){return p}),s.export(r,"EBMLFloat64",function(){return g}),s.export(r,"EBMLSignedInt",function(){return v}),s.export(r,"EBMLUnicodeString",function(){return b}),s.export(r,"EBMLId",function(){return i}),s.export(r,"LEVEL_0_EBML_IDS",function(){return y}),s.export(r,"LEVEL_1_EBML_IDS",function(){return k}),s.export(r,"LEVEL_0_AND_1_EBML_IDS",function(){return _}),s.export(r,"measureUnsignedInt",function(){return w}),s.export(r,"measureUnsignedBigInt",function(){return S}),s.export(r,"measureSignedInt",function(){return T}),s.export(r,"measureVarInt",function(){return x}),s.export(r,"EBMLWriter",function(){return I}),s.export(r,"MAX_VAR_INT_SIZE",function(){return E}),s.export(r,"MIN_HEADER_SIZE",function(){return j}),s.export(r,"MAX_HEADER_SIZE",function(){return P}),s.export(r,"readVarIntSize",function(){return C}),s.export(r,"readVarInt",function(){return A}),s.export(r,"readUnsignedInt",function(){return B}),s.export(r,"readUnsignedBigInt",function(){return M}),s.export(r,"readSignedInt",function(){return D}),s.export(r,"readElementId",function(){return F}),s.export(r,"readElementSize",function(){return R}),s.export(r,"readElementHeader",function(){return U}),s.export(r,"readAsciiString",function(){return O}),s.export(r,"readUnicodeString",function(){return N}),s.export(r,"readFloat",function(){return L}),s.export(r,"searchForNextElementId",function(){return z}),s.export(r,"resync",function(){return V}),s.export(r,"CODEC_STRING_MAP",function(){return H}),s.export(r,"assertDefinedSize",function(){return G});var o=e("@swc/helpers/cjs/_async_to_generator.cjs"),c=e("@swc/helpers/cjs/_class_call_check.cjs"),u=e("@swc/helpers/cjs/_create_class.cjs"),l=e("@swc/helpers/cjs/_to_consumable_array.cjs"),d=e("@swc/helpers/cjs/_type_of.cjs"),f=e("@swc/helpers/cjs/_ts_generator.cjs"),h=e("../misc.js"),m=e("../reader.js"),p=function e(t){"use strict";(0,c._)(this,e),this.value=t},g=function e(t){"use strict";(0,c._)(this,e),this.value=t},v=function e(t){"use strict";(0,c._)(this,e),this.value=t},b=function e(t){"use strict";(0,c._)(this,e),this.value=t};(a=i||(i={}))[a.EBML=0x1a45dfa3]="EBML",a[a.EBMLVersion=17030]="EBMLVersion",a[a.EBMLReadVersion=17143]="EBMLReadVersion",a[a.EBMLMaxIDLength=17138]="EBMLMaxIDLength",a[a.EBMLMaxSizeLength=17139]="EBMLMaxSizeLength",a[a.DocType=17026]="DocType",a[a.DocTypeVersion=17031]="DocTypeVersion",a[a.DocTypeReadVersion=17029]="DocTypeReadVersion",a[a.Void=236]="Void",a[a.Segment=0x18538067]="Segment",a[a.SeekHead=0x114d9b74]="SeekHead",a[a.Seek=19899]="Seek",a[a.SeekID=21419]="SeekID",a[a.SeekPosition=21420]="SeekPosition",a[a.Duration=17545]="Duration",a[a.Info=0x1549a966]="Info",a[a.TimestampScale=2807729]="TimestampScale",a[a.MuxingApp=19840]="MuxingApp",a[a.WritingApp=22337]="WritingApp",a[a.Tracks=0x1654ae6b]="Tracks",a[a.TrackEntry=174]="TrackEntry",a[a.TrackNumber=215]="TrackNumber",a[a.TrackUID=29637]="TrackUID",a[a.TrackType=131]="TrackType",a[a.FlagEnabled=185]="FlagEnabled",a[a.FlagDefault=136]="FlagDefault",a[a.FlagForced=21930]="FlagForced",a[a.FlagOriginal=21934]="FlagOriginal",a[a.FlagHearingImpaired=21931]="FlagHearingImpaired",a[a.FlagVisualImpaired=21932]="FlagVisualImpaired",a[a.FlagCommentary=21935]="FlagCommentary",a[a.FlagLacing=156]="FlagLacing",a[a.Name=21358]="Name",a[a.Language=2274716]="Language",a[a.LanguageBCP47=2274717]="LanguageBCP47",a[a.CodecID=134]="CodecID",a[a.CodecPrivate=25506]="CodecPrivate",a[a.CodecDelay=22186]="CodecDelay",a[a.SeekPreRoll=22203]="SeekPreRoll",a[a.DefaultDuration=2352003]="DefaultDuration",a[a.Video=224]="Video",a[a.PixelWidth=176]="PixelWidth",a[a.PixelHeight=186]="PixelHeight",a[a.AlphaMode=21440]="AlphaMode",a[a.Audio=225]="Audio",a[a.SamplingFrequency=181]="SamplingFrequency",a[a.Channels=159]="Channels",a[a.BitDepth=25188]="BitDepth",a[a.SimpleBlock=163]="SimpleBlock",a[a.BlockGroup=160]="BlockGroup",a[a.Block=161]="Block",a[a.BlockAdditions=30113]="BlockAdditions",a[a.BlockMore=166]="BlockMore",a[a.BlockAdditional=165]="BlockAdditional",a[a.BlockAddID=238]="BlockAddID",a[a.BlockDuration=155]="BlockDuration",a[a.ReferenceBlock=251]="ReferenceBlock",a[a.Cluster=0x1f43b675]="Cluster",a[a.Timestamp=231]="Timestamp",a[a.Cues=0x1c53bb6b]="Cues",a[a.CuePoint=187]="CuePoint",a[a.CueTime=179]="CueTime",a[a.CueTrackPositions=183]="CueTrackPositions",a[a.CueTrack=247]="CueTrack",a[a.CueClusterPosition=241]="CueClusterPosition",a[a.Colour=21936]="Colour",a[a.MatrixCoefficients=21937]="MatrixCoefficients",a[a.TransferCharacteristics=21946]="TransferCharacteristics",a[a.Primaries=21947]="Primaries",a[a.Range=21945]="Range",a[a.Projection=30320]="Projection",a[a.ProjectionType=30321]="ProjectionType",a[a.ProjectionPoseRoll=30325]="ProjectionPoseRoll",a[a.Attachments=0x1941a469]="Attachments",a[a.AttachedFile=24999]="AttachedFile",a[a.FileDescription=18046]="FileDescription",a[a.FileName=18030]="FileName",a[a.FileMediaType=18016]="FileMediaType",a[a.FileData=18012]="FileData",a[a.FileUID=18094]="FileUID",a[a.Chapters=0x1043a770]="Chapters",a[a.Tags=0x1254c367]="Tags",a[a.Tag=29555]="Tag",a[a.Targets=25536]="Targets",a[a.TargetTypeValue=26826]="TargetTypeValue",a[a.TargetType=25546]="TargetType",a[a.TagTrackUID=25541]="TagTrackUID",a[a.TagEditionUID=25545]="TagEditionUID",a[a.TagChapterUID=25540]="TagChapterUID",a[a.TagAttachmentUID=25542]="TagAttachmentUID",a[a.SimpleTag=26568]="SimpleTag",a[a.TagName=17827]="TagName",a[a.TagLanguage=17530]="TagLanguage",a[a.TagString=17543]="TagString",a[a.TagBinary=17541]="TagBinary",a[a.ContentEncodings=28032]="ContentEncodings",a[a.ContentEncoding=25152]="ContentEncoding",a[a.ContentEncodingOrder=20529]="ContentEncodingOrder",a[a.ContentEncodingScope=20530]="ContentEncodingScope",a[a.ContentCompression=20532]="ContentCompression",a[a.ContentCompAlgo=16980]="ContentCompAlgo",a[a.ContentCompSettings=16981]="ContentCompSettings",a[a.ContentEncryption=20533]="ContentEncryption";var y=[i.EBML,i.Segment],k=[i.SeekHead,i.Info,i.Cluster,i.Tracks,i.Cues,i.Attachments,i.Chapters,i.Tags],_=(0,l._)(y).concat((0,l._)(k)),w=function(e){if(e<256)return 1;if(e<65536)return 2;if(e<0x1000000)return 3;if(e<0x100000000)return 4;if(e<0x10000000000)return 5;else return 6},S=function(e){if(e<1n<<8n)return 1;if(e<1n<<16n)return 2;if(e<1n<<24n)return 3;if(e<1n<<32n)return 4;if(e<1n<<40n)return 5;else if(e<1n<<48n)return 6;else if(e<1n<<56n)return 7;else return 8},T=function(e){if(e>=-64&&e<64)return 1;if(e>=-8192&&e<8192)return 2;if(e>=-1048576&&e<1048576)return 3;if(e>=-0x8000000&&e<0x8000000)return 4;if(e>=-0x400000000&&e<0x400000000)return 5;else return 6},x=function(e){if(e<127)return 1;if(e<16383)return 2;if(e<2097151)return 3;if(e<0xfffffff)return 4;if(e<0x7ffffffff)return 5;else if(e<0x3ffffffffff)return 6;else throw Error("EBML varint size not supported "+e)},I=function(){"use strict";function e(t){(0,c._)(this,e),this.writer=t,this.helper=new Uint8Array(8),this.helperView=new DataView(this.helper.buffer),this.offsets=new WeakMap,this.dataOffsets=new WeakMap}return(0,u._)(e,[{key:"writeByte",value:function(e){this.helperView.setUint8(0,e),this.writer.write(this.helper.subarray(0,1))}},{key:"writeFloat32",value:function(e){this.helperView.setFloat32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}},{key:"writeFloat64",value:function(e){this.helperView.setFloat64(0,e,!1),this.writer.write(this.helper)}},{key:"writeUnsignedInt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w(e),r=0;switch(t){case 6:this.helperView.setUint8(r++,e/0x10000000000|0);case 5:this.helperView.setUint8(r++,e/0x100000000|0);case 4:this.helperView.setUint8(r++,e>>24);case 3:this.helperView.setUint8(r++,e>>16);case 2:this.helperView.setUint8(r++,e>>8);case 1:this.helperView.setUint8(r++,e);break;default:throw Error("Bad unsigned int size "+t)}this.writer.write(this.helper.subarray(0,r))}},{key:"writeUnsignedBigInt",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S(e),r=0,n=t-1;n>=0;n--)this.helperView.setUint8(r++,Number(e>>BigInt(8*n)&255n));this.writer.write(this.helper.subarray(0,r))}},{key:"writeSignedInt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T(e);e<0&&(e+=Math.pow(2,8*t)),this.writeUnsignedInt(e,t)}},{key:"writeVarInt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x(e),r=0;switch(t){case 1:this.helperView.setUint8(r++,128|e);break;case 2:this.helperView.setUint8(r++,64|e>>8),this.helperView.setUint8(r++,e);break;case 3:this.helperView.setUint8(r++,32|e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;case 4:this.helperView.setUint8(r++,16|e>>24),this.helperView.setUint8(r++,e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;case 5:this.helperView.setUint8(r++,8|e/0x100000000&7),this.helperView.setUint8(r++,e>>24),this.helperView.setUint8(r++,e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;case 6:this.helperView.setUint8(r++,4|e/0x10000000000&3),this.helperView.setUint8(r++,e/0x100000000|0),this.helperView.setUint8(r++,e>>24),this.helperView.setUint8(r++,e>>16),this.helperView.setUint8(r++,e>>8),this.helperView.setUint8(r++,e);break;default:throw Error("Bad EBML varint size "+t)}this.writer.write(this.helper.subarray(0,r))}},{key:"writeAsciiString",value:function(e){this.writer.write(new Uint8Array(e.split("").map(function(e){return e.charCodeAt(0)})))}},{key:"writeEBML",value:function(e){if(null!==e){var t=!0,r=!1,n=void 0;if(e instanceof Uint8Array)this.writer.write(e);else if(Array.isArray(e))try{for(var a,i=e[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;this.writeEBML(s)}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}else if(this.offsets.set(e,this.writer.getPos()),this.writeUnsignedInt(e.id),Array.isArray(e.data)){var o,c=this.writer.getPos(),u=-1===e.size?1:null!=(o=e.size)?o:4;-1===e.size?this.writeByte(255):this.writer.seek(this.writer.getPos()+u);var l=this.writer.getPos();if(this.dataOffsets.set(e,l),this.writeEBML(e.data),-1!==e.size){var f=this.writer.getPos()-l,m=this.writer.getPos();this.writer.seek(c),this.writeVarInt(f,u),this.writer.seek(m)}}else if("number"==typeof e.data){var y,k=null!=(y=e.size)?y:w(e.data);this.writeVarInt(k),this.writeUnsignedInt(e.data,k)}else if("bigint"===(0,d._)(e.data)){var _,x=null!=(_=e.size)?_:S(e.data);this.writeVarInt(x),this.writeUnsignedBigInt(e.data,x)}else if("string"==typeof e.data)this.writeVarInt(e.data.length),this.writeAsciiString(e.data);else if(e.data instanceof Uint8Array)this.writeVarInt(e.data.byteLength,e.size),this.writer.write(e.data);else if(e.data instanceof p)this.writeVarInt(4),this.writeFloat32(e.data.value);else if(e.data instanceof g)this.writeVarInt(8),this.writeFloat64(e.data.value);else if(e.data instanceof v){var I,E=null!=(I=e.size)?I:T(e.data.value);this.writeVarInt(E),this.writeSignedInt(e.data.value,E)}else if(e.data instanceof b){var j=h.textEncoder.encode(e.data.value);this.writeVarInt(j.length),this.writer.write(j)}else(0,h.assertNever)(e.data)}}}]),e}(),E=8,j=2,P=16,C=function(e){var t=(0,m.readU8)(e);if(e.skip(-1),0===t)return null;for(var r=1,n=128;(t&n)==0;)r++,n>>=1;return r},A=function(e){var t=(0,m.readU8)(e);if(0===t)return null;for(var r=1,n=128;(t&n)==0;)r++,n>>=1;for(var a=t&n-1,i=1;i<r;i++)a*=256,a+=(0,m.readU8)(e);return a},B=function(e,t){if(t<1||t>8)throw Error("Bad unsigned int size "+t);for(var r=0,n=0;n<t;n++)r*=256,r+=(0,m.readU8)(e);return r},M=function(e,t){if(t<1)throw Error("Bad unsigned int size "+t);for(var r=0n,n=0;n<t;n++)r<<=8n,r+=BigInt((0,m.readU8)(e));return r},D=function(e,t){var r=B(e,t);return r&1<<8*t-1&&(r-=Math.pow(2,8*t)),r},F=function(e){var t=C(e);return null===t?null:B(e,t)},R=function(e){var t=(0,m.readU8)(e);return 255===t?t=null:(e.skip(-1),0x100000000000000===(t=A(e))&&(t=null)),t},U=function(e){var t=F(e);return null===t?null:{id:t,size:R(e)}},O=function(e,t){for(var r,n=(0,m.readBytes)(e,t),a=0;a<t&&0!==n[a];)a+=1;return(r=String).fromCharCode.apply(r,(0,l._)(n.subarray(0,a)))},N=function(e,t){for(var r=(0,m.readBytes)(e,t),n=0;n<t&&0!==r[n];)n+=1;return h.textDecoder.decode(r.subarray(0,n))},L=function(e,t){if(0===t)return 0;if(4!==t&&8!==t)throw Error("Bad float size "+t);return 4===t?(0,m.readF32Be)(e):(0,m.readF64Be)(e)},z=function(e,t,r,n){return(0,o._)(function(){var a,i,s,o;return(0,f._)(this,function(c){switch(c.label){case 0:a=new Set(r),i=t,c.label=1;case 1:if(!(null===n||i<n))return[3,4];if(!((s=e.requestSliceRange(i,j,P))instanceof Promise))return[3,3];return[4,s];case 2:s=c.sent(),c.label=3;case 3:if(!s||!(o=U(s)))return[3,4];if(a.has(o.id))return[2,{pos:i,found:!0}];return G(o.size),i=s.filePos+o.size,[3,1];case 4:return[2,{pos:null!==n&&n>i?n:i,found:!1}]}})})()},V=function(e,t,r,n){return(0,o._)(function(){var a,i,s,o,c,u;return(0,f._)(this,function(l){switch(l.label){case 0:a=65536,i=new Set(r),s=t,l.label=1;case 1:if(!(s<n))return[3,4];if(!((o=e.requestSliceRange(s,0,Math.min(a,n-s)))instanceof Promise))return[3,3];return[4,o];case 2:o=l.sent(),l.label=3;case 3:if(!o||o.length<E)return[3,4];for(c=0;c<o.length-E;c++){if(o.filePos=s,null!==(u=F(o))&&i.has(u))return[2,s];s++}return[3,1];case 4:return[2,null]}})})()},H={avc:"V_MPEG4/ISO/AVC",hevc:"V_MPEGH/ISO/HEVC",vp8:"V_VP8",vp9:"V_VP9",av1:"V_AV1",aac:"A_AAC",mp3:"A_MPEG/L3",opus:"A_OPUS",vorbis:"A_VORBIS",flac:"A_FLAC","pcm-u8":"A_PCM/INT/LIT","pcm-s16":"A_PCM/INT/LIT","pcm-s16be":"A_PCM/INT/BIG","pcm-s24":"A_PCM/INT/LIT","pcm-s24be":"A_PCM/INT/BIG","pcm-s32":"A_PCM/INT/LIT","pcm-s32be":"A_PCM/INT/BIG","pcm-f32":"A_PCM/FLOAT/IEEE","pcm-f64":"A_PCM/FLOAT/IEEE",webvtt:"S_TEXT/WEBVTT"};function G(e){if(null===e)throw Error("Undefined element size is used in a place where it is not supported.")}},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","@swc/helpers/cjs/_type_of.cjs":"iXhRw","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","../misc.js":"j7iGm","../reader.js":"8KRfO","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],kY1ME:[function(e,t,r,n){var a,i,s,o,c,u,l=e("@parcel/transformer-js/src/esmodule-helpers.js");l.defineInteropFlag(r),l.export(r,"MatroskaDemuxer",function(){return B});var d=e("@swc/helpers/cjs/_async_to_generator.cjs"),f=e("@swc/helpers/cjs/_call_super.cjs"),h=e("@swc/helpers/cjs/_class_call_check.cjs"),m=e("@swc/helpers/cjs/_create_class.cjs"),p=e("@swc/helpers/cjs/_inherits.cjs"),g=e("@swc/helpers/cjs/_object_spread.cjs"),v=e("@swc/helpers/cjs/_sliced_to_array.cjs"),b=e("@swc/helpers/cjs/_to_consumable_array.cjs"),y=e("@swc/helpers/cjs/_ts_generator.cjs"),k=e("@swc/helpers/cjs/_ts_values.cjs"),_=e("../codec-data.js"),w=e("../codec.js"),S=e("../demuxer.js"),T=e("../input-track.js"),x=e("../metadata.js"),I=e("../misc.js"),E=e("../packet.js"),j=e("./ebml.js"),P=e("./matroska-misc.js"),C=e("../reader.js");(a=o||(o={}))[a.None=0]="None",a[a.Xiph=1]="Xiph",a[a.FixedSize=2]="FixedSize",a[a.Ebml=3]="Ebml",(i=c||(c={}))[i.Block=1]="Block",i[i.Private=2]="Private",i[i.Next=4]="Next",(s=u||(u={}))[s.Zlib=0]="Zlib",s[s.Bzlib=1]="Bzlib",s[s.lzo1x=2]="lzo1x",s[s.HeaderStripping=3]="HeaderStripping";var A=[{id:j.EBMLId.SeekHead,flag:"seekHeadSeen"},{id:j.EBMLId.Info,flag:"infoSeen"},{id:j.EBMLId.Tracks,flag:"tracksSeen"},{id:j.EBMLId.Cues,flag:"cuesSeen"}],B=function(e){"use strict";function t(e){var r;return(0,h._)(this,t),(r=(0,f._)(this,t,[e])).readMetadataPromise=null,r.segments=[],r.currentSegment=null,r.currentTrack=null,r.currentCluster=null,r.currentBlock=null,r.currentBlockAdditional=null,r.currentCueTime=null,r.currentDecodingInstruction=null,r.currentTagTargetIsMovie=!0,r.currentSimpleTagName=null,r.currentAttachedFile=null,r.isWebM=!1,r.reader=e._reader,r}return(0,p._)(t,e),(0,m._)(t,[{key:"computeDuration",value:function(){return(0,d._)(function(){var e,t;return(0,y._)(this,function(r){switch(r.label){case 0:return[4,this.getTracks()];case 1:return[4,Promise.all(r.sent().map(function(e){return e.computeDuration()}))];case 2:return t=r.sent(),[2,(e=Math).max.apply(e,[0].concat((0,b._)(t)))]}})}).call(this)}},{key:"getTracks",value:function(){return(0,d._)(function(){return(0,y._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),[2,this.segments.flatMap(function(e){return e.tracks.map(function(e){return e.inputTrack})})]}})}).call(this)}},{key:"getMimeType",value:function(){return(0,d._)(function(){var e;return(0,y._)(this,function(t){switch(t.label){case 0:return[4,this.readMetadata()];case 1:return t.sent(),[4,this.getTracks()];case 2:return[4,Promise.all(t.sent().map(function(e){return e.getCodecParameterString()}))];case 3:return e=t.sent(),[2,(0,P.buildMatroskaMimeType)({isWebM:this.isWebM,hasVideo:this.segments.some(function(e){return e.tracks.some(function(e){var t;return(null==(t=e.info)?void 0:t.type)==="video"})}),hasAudio:this.segments.some(function(e){return e.tracks.some(function(e){var t;return(null==(t=e.info)?void 0:t.type)==="audio"})}),codecStrings:e.filter(Boolean)})]}})}).call(this)}},{key:"getMetadataTags",value:function(){return(0,d._)(function(){var e,t,r,n,a,i,s,o,c,u,l,d,f,h;return(0,y._)(this,function(m){switch(m.label){case 0:return[4,this.readMetadata()];case 1:m.sent(),e=!0,t=!1,r=void 0,m.label=2;case 2:m.trys.push([2,8,9,10]),n=this.segments[Symbol.iterator](),m.label=3;case 3:if(e=(a=n.next()).done)return[3,7];if((i=a.value).metadataTagsCollected)return[3,6];if(null===this.reader.fileSize)return[3,5];return[4,this.loadSegmentMetadata(i)];case 4:m.sent(),m.label=5;case 5:i.metadataTagsCollected=!0,m.label=6;case 6:return e=!0,[3,3];case 7:return[3,10];case 8:return s=m.sent(),t=!0,r=s,[3,10];case 9:try{e||null==n.return||n.return()}finally{if(t)throw r}return[7];case 10:o={},c=!0,u=!1,l=void 0;try{for(d=this.segments[Symbol.iterator]();!(c=(f=d.next()).done);c=!0)h=f.value,o=(0,g._)({},o,h.metadataTags)}catch(e){u=!0,l=e}finally{try{c||null==d.return||d.return()}finally{if(u)throw l}}return[2,o]}})}).call(this)}},{key:"readMetadata",value:function(){var e;return null!=(e=this.readMetadataPromise)?e:this.readMetadataPromise=(0,d._)(function(){var e,t,r,n,a,i,s,o;return(0,y._)(this,function(c){switch(c.label){case 0:e=0,c.label=1;case 1:if(!((t=this.reader.requestSliceRange(e,j.MIN_HEADER_SIZE,j.MAX_HEADER_SIZE))instanceof Promise))return[3,3];return[4,t];case 2:t=c.sent(),c.label=3;case 3:if(!t||!(r=(0,j.readElementHeader)(t)))return[3,12];if(n=r.id,a=r.size,i=t.filePos,n!==j.EBMLId.EBML)return[3,6];if((0,j.assertDefinedSize)(a),!((s=this.reader.requestSlice(i,a))instanceof Promise))return[3,5];return[4,s];case 4:s=c.sent(),c.label=5;case 5:if(!s)return[3,12];return this.readContiguousElements(s),[3,11];case 6:if(n!==j.EBMLId.Segment)return[3,8];return[4,this.readSegment(i,a)];case 7:if(c.sent(),null===a||null===this.reader.fileSize)return[3,12];return[3,11];case 8:if(n!==j.EBMLId.Cluster)return[3,11];if(null===this.reader.fileSize)return[3,12];if(null!==a)return[3,10];return[4,(0,j.searchForNextElementId)(this.reader,i,j.LEVEL_0_AND_1_EBML_IDS,this.reader.fileSize)];case 9:a=c.sent().pos-i,c.label=10;case 10:(o=(0,I.last)(this.segments))&&(o.elementEndPos=i+a),c.label=11;case 11:return(0,j.assertDefinedSize)(a),e=i+a,[3,1];case 12:return[2]}})}).call(this)}},{key:"readSegment",value:function(e,t){return(0,d._)(function(){var r,n,a,i,s,o,c,u,l,d,f,h,m,p,g,v,b,_,w,S,T,x,I,E,P,C,B,M,D,F,R,U,O,N,L,z,V,H,G,q,W,K;return(0,y._)(this,function(X){switch(X.label){case 0:n=function(){var e,t,n,i,s,o,c,u,l,d,f,h;return(0,y._)(this,function(m){switch(m.label){case 0:if(!((e=r.reader.requestSliceRange(a,j.MIN_HEADER_SIZE,j.MAX_HEADER_SIZE))instanceof Promise))return[3,2];return[4,e];case 1:e=m.sent(),m.label=2;case 2:if(!e)return[2,"break"];if(t=a,!(!(n=(0,j.readElementHeader)(e))||!j.LEVEL_1_EBML_IDS.includes(n.id)&&n.id!==j.EBMLId.Void))return[3,4];return[4,(0,j.resync)(r.reader,t,j.LEVEL_1_EBML_IDS,Math.min(null!=(i=r.currentSegment.elementEndPos)?i:1/0,t+0xa00000))];case 3:if(s=m.sent())return a=s,[2,"continue"];return[2,"break"];case 4:if(o=n.id,c=n.size,u=e.filePos,-1===(l=A.findIndex(function(e){return e.id===o})))return[3,7];if(d=A[l].flag,r.currentSegment[d]=!0,(0,j.assertDefinedSize)(c),!((f=r.reader.requestSlice(u,c))instanceof Promise))return[3,6];return[4,f];case 5:f=m.sent(),m.label=6;case 6:return f&&r.readContiguousElements(f),[3,11];case 7:if(o!==j.EBMLId.Tags&&o!==j.EBMLId.Attachments)return[3,10];if(o===j.EBMLId.Tags?r.currentSegment.tagsSeen=!0:r.currentSegment.attachmentsSeen=!0,(0,j.assertDefinedSize)(c),!((h=r.reader.requestSlice(u,c))instanceof Promise))return[3,9];return[4,h];case 8:h=m.sent(),m.label=9;case 9:return h&&r.readContiguousElements(h),[3,11];case 10:if(o===j.EBMLId.Cluster)return r.currentSegment.clusterSeekStartPos=t,[2,"break"];m.label=11;case 11:if(null===c)return[2,"break"];return a=u+c,[2]}})},this.currentSegment={seekHeadSeen:!1,infoSeen:!1,tracksSeen:!1,cuesSeen:!1,tagsSeen:!1,attachmentsSeen:!1,timestampScale:-1,timestampFactor:-1,duration:-1,seekEntries:[],tracks:[],cuePoints:[],dataStartPos:e,elementEndPos:null===t?null:e+t,clusterSeekStartPos:e,lastReadCluster:null,metadataTags:{},metadataTagsCollected:!1},this.segments.push(this.currentSegment),a=e,X.label=1;case 1:if(!(null===this.currentSegment.elementEndPos||a<this.currentSegment.elementEndPos))return[3,3];return r=this,[5,(0,k._)(n())];case 2:if("break"===X.sent())return[3,3];return[3,1];case 3:if(this.currentSegment.seekEntries.sort(function(e,t){return e.segmentPosition-t.segmentPosition}),i=!0,s=!1,o=void 0,null===this.reader.fileSize)return[3,11];X.label=4;case 4:X.trys.push([4,9,10,11]),u=function(){var t,r,n,a,i,s,o;return(0,y._)(this,function(u){switch(u.label){case 0:if(t=d.value,!(r=A.find(function(e){return e.id===t.id}))||c.currentSegment[r.flag])return[2,"continue"];if(!((n=c.reader.requestSliceRange(e+t.segmentPosition,j.MIN_HEADER_SIZE,j.MAX_HEADER_SIZE))instanceof Promise))return[3,2];return[4,n];case 1:n=u.sent(),u.label=2;case 2:if(!n||!(a=(0,j.readElementHeader)(n))||(i=a.id,s=a.size,i!==r.id))return[2,"continue"];if((0,j.assertDefinedSize)(s),c.currentSegment[r.flag]=!0,!((o=c.reader.requestSlice(n.filePos,s))instanceof Promise))return[3,4];return[4,o];case 3:o=u.sent(),u.label=4;case 4:if(!o)return[2,"continue"];return c.readContiguousElements(o),[2]}})},l=this.currentSegment.seekEntries[Symbol.iterator](),X.label=5;case 5:if(i=(d=l.next()).done)return[3,8];return c=this,[5,(0,k._)(u())];case 6:X.sent(),X.label=7;case 7:return i=!0,[3,5];case 8:return[3,11];case 9:return f=X.sent(),s=!0,o=f,[3,11];case 10:try{i||null==l.return||l.return()}finally{if(s)throw o}return[7];case 11:-1===this.currentSegment.timestampScale&&(this.currentSegment.timestampScale=1e6,this.currentSegment.timestampFactor=1e3),this.currentSegment.tracks.sort(function(e,t){return Number(t.disposition.default)-Number(e.disposition.default)}),h=new Map(this.currentSegment.tracks.map(function(e){return[e.id,e]})),m=!0,p=!1,g=void 0;try{for(v=this.currentSegment.cuePoints[Symbol.iterator]();!(m=(b=v.next()).done);m=!0)_=b.value,(w=h.get(_.trackId))&&w.cuePoints.push(_)}catch(e){p=!0,g=e}finally{try{m||null==v.return||v.return()}finally{if(p)throw g}}S=!0,T=!1,x=void 0;try{for(I=this.currentSegment.tracks[Symbol.iterator]();!(S=(E=I.next()).done);S=!0)for((P=E.value).cuePoints.sort(function(e,t){return e.time-t.time}),C=0;C<P.cuePoints.length-1;C++)B=P.cuePoints[C],M=P.cuePoints[C+1],B.time===M.time&&(P.cuePoints.splice(C+1,1),C--)}catch(e){T=!0,x=e}finally{try{S||null==I.return||I.return()}finally{if(T)throw x}}D=null,F=-1/0,R=!0,U=!1,O=void 0;try{for(N=this.currentSegment.tracks[Symbol.iterator]();!(R=(L=N.next()).done);R=!0)(z=L.value).cuePoints.length>F&&(F=z.cuePoints.length,D=z)}catch(e){U=!0,O=e}finally{try{R||null==N.return||N.return()}finally{if(U)throw O}}V=!0,H=!1,G=void 0;try{for(q=this.currentSegment.tracks[Symbol.iterator]();!(V=(W=q.next()).done);V=!0)K=W.value,0===K.cuePoints.length&&(K.cuePoints=D.cuePoints)}catch(e){H=!0,G=e}finally{try{V||null==q.return||q.return()}finally{if(H)throw G}}return this.currentSegment=null,[2]}})}).call(this)}},{key:"readCluster",value:function(e,t){return(0,d._)(function(){var r,n,a,i,s,c,u,l,d,f,h,m,p,g,b,k,_,w,S,T,x,E,P,C,A;return(0,y._)(this,function(y){switch(y.label){case 0:if((null==(r=t.lastReadCluster)?void 0:r.elementStartPos)===e)return[2,t.lastReadCluster];if(!((n=this.reader.requestSliceRange(e,j.MIN_HEADER_SIZE,j.MAX_HEADER_SIZE))instanceof Promise))return[3,2];return[4,n];case 1:n=y.sent(),y.label=2;case 2:if((0,I.assert)(n),a=e,i=(0,j.readElementHeader)(n),(0,I.assert)(i),s=i.id,(0,I.assert)(s===j.EBMLId.Cluster),c=i.size,u=n.filePos,null!==c)return[3,4];return[4,(0,j.searchForNextElementId)(this.reader,u,j.LEVEL_0_AND_1_EBML_IDS,t.elementEndPos)];case 3:c=y.sent().pos-u,y.label=4;case 4:if(!((l=this.reader.requestSlice(u,c))instanceof Promise))return[3,6];return[4,l];case 5:l=y.sent(),y.label=6;case 6:d={segment:t,elementStartPos:a,elementEndPos:u+c,dataStartPos:u,timestamp:-1,trackData:new Map},this.currentCluster=d,l&&(d.elementEndPos=this.readContiguousElements(l,j.LEVEL_0_AND_1_EBML_IDS)),f=!0,h=!1,m=void 0;try{for(p=d.trackData[Symbol.iterator]();!(f=(g=p.next()).done);f=!0){for(k=(b=(0,v._)(g.value,2)[1]).track,(0,I.assert)(b.blocks.length>0),_=!1,w=0;w<b.blocks.length;w++)S=b.blocks[w],S.timestamp+=d.timestamp,_||(_=S.lacing!==o.None);for(T=0,b.presentationTimestamps=b.blocks.map(function(e,t){return{timestamp:e.timestamp,blockIndex:t}}).sort(function(e,t){return e.timestamp-t.timestamp});T<b.presentationTimestamps.length;T++)x=b.presentationTimestamps[T],E=b.blocks[x.blockIndex],null===b.firstKeyFrameTimestamp&&E.isKeyFrame&&(b.firstKeyFrameTimestamp=E.timestamp),T<b.presentationTimestamps.length-1?E.duration=b.presentationTimestamps[T+1].timestamp-E.timestamp:0===E.duration&&null!=k.defaultDuration&&E.lacing===o.None&&(E.duration=k.defaultDuration);_&&(this.expandLacedBlocks(b.blocks,k),b.presentationTimestamps=b.blocks.map(function(e,t){return{timestamp:e.timestamp,blockIndex:t}}).sort(function(e,t){return e.timestamp-t.timestamp})),P=b.blocks[b.presentationTimestamps[0].blockIndex],C=b.blocks[(0,I.last)(b.presentationTimestamps).blockIndex],b.startTimestamp=P.timestamp,b.endTimestamp=C.timestamp+C.duration,A=(0,I.binarySearchLessOrEqual)(k.clusterPositionCache,b.startTimestamp,function(e){return e.startTimestamp}),(-1===A||k.clusterPositionCache[A].elementStartPos!==a)&&k.clusterPositionCache.splice(A+1,0,{elementStartPos:d.elementStartPos,startTimestamp:b.startTimestamp})}}catch(e){h=!0,m=e}finally{try{f||null==p.return||p.return()}finally{if(h)throw m}}return t.lastReadCluster=d,[2,d]}})}).call(this)}},{key:"getTrackDataInCluster",value:function(e,t){var r=e.trackData.get(t);if(!r){var n=e.segment.tracks.find(function(e){return e.id===t});if(!n)return null;r={track:n,startTimestamp:0,endTimestamp:0,firstKeyFrameTimestamp:null,blocks:[],presentationTimestamps:[]},e.trackData.set(t,r)}return r}},{key:"expandLacedBlocks",value:function(e,t){for(var r=0;r<e.length;r++){var n,a=e[r];if(a.lacing!==o.None){a.decoded||(a.data=this.decodeBlockData(t,a.data),a.decoded=!0);var i=C.FileSlice.tempFromBytes(a.data),s=[],c=(0,C.readU8)(i)+1;switch(a.lacing){case o.Xiph:for(var u=0,l=0;l<c-1;l++)for(var d=0;i.bufferPos<i.length;){var f=(0,C.readU8)(i);if(d+=f,f<255){s.push(d),u+=d;break}}s.push(i.length-(i.bufferPos+u));break;case o.FixedSize:for(var h=Math.floor((i.length-1)/c),m=0;m<c;m++)s.push(h);break;case o.Ebml:var p=(0,j.readVarInt)(i);(0,I.assert)(null!==p);var g=p;s.push(g);for(var v=g,b=1;b<c-1;b++){var y=i.bufferPos,k=(0,j.readVarInt)(i);(0,I.assert)(null!==k),g+=k-((1<<7*(i.bufferPos-y)-1)-1),s.push(g),v+=g}s.push(i.length-(i.bufferPos+v));break;default:(0,I.assert)(!1)}(0,I.assert)(s.length===c),e.splice(r,1);for(var _=a.duration||c*(null!=(n=t.defaultDuration)?n:0),w=0;w<c;w++){var S=s[w],T=(0,C.readBytes)(i,S),x=a.timestamp+_*w/c,E=_/c;e.splice(r+w,0,{timestamp:x,duration:E,isKeyFrame:a.isKeyFrame,data:T,lacing:o.None,decoded:!0,mainAdditional:a.mainAdditional})}r+=c,r--}}}},{key:"loadSegmentMetadata",value:function(e){return(0,d._)(function(){var t,r,n,a,i,s,o,c,u,l,d;return(0,y._)(this,function(f){switch(f.label){case 0:t=!0,r=!1,n=void 0,f.label=1;case 1:f.trys.push([1,9,10,11]),a=e.seekEntries[Symbol.iterator](),f.label=2;case 2:if(t=(i=a.next()).done)return[3,8];if(((s=i.value).id!==j.EBMLId.Tags||e.tagsSeen)&&(s.id!==j.EBMLId.Attachments||e.attachmentsSeen))return[3,7];if(!((o=this.reader.requestSliceRange(e.dataStartPos+s.segmentPosition,j.MIN_HEADER_SIZE,j.MAX_HEADER_SIZE))instanceof Promise))return[3,4];return[4,o];case 3:o=f.sent(),f.label=4;case 4:if(!o||!(c=(0,j.readElementHeader)(o))||c.id!==s.id)return[3,7];if(u=c.size,(0,j.assertDefinedSize)(u),(0,I.assert)(!this.currentSegment),this.currentSegment=e,!((l=this.reader.requestSlice(o.filePos,u))instanceof Promise))return[3,6];return[4,l];case 5:l=f.sent(),f.label=6;case 6:l&&this.readContiguousElements(l),this.currentSegment=null,s.id===j.EBMLId.Tags?e.tagsSeen=!0:s.id===j.EBMLId.Attachments&&(e.attachmentsSeen=!0),f.label=7;case 7:return t=!0,[3,2];case 8:return[3,11];case 9:return d=f.sent(),r=!0,n=d,[3,11];case 10:try{t||null==a.return||a.return()}finally{if(r)throw n}return[7];case 11:return[2]}})}).call(this)}},{key:"readContiguousElements",value:function(e,t){for(var r=e.filePos;e.filePos-r<=e.length-j.MIN_HEADER_SIZE;){var n=e.filePos;if(!this.traverseElement(e,t))return n}return e.filePos}},{key:"traverseElement",value:function(e,t){var r,n,a,i,s=(0,j.readElementHeader)(e);if(!s||t&&t.includes(s.id))return!1;var o=s.id,l=s.size,d=e.filePos;switch((0,j.assertDefinedSize)(l),o){case j.EBMLId.DocType:this.isWebM="webm"===(0,j.readAsciiString)(e,l);break;case j.EBMLId.Seek:if(!this.currentSegment)break;var f={id:-1,segmentPosition:-1};this.currentSegment.seekEntries.push(f),this.readContiguousElements(e.slice(d,l)),(-1===f.id||-1===f.segmentPosition)&&this.currentSegment.seekEntries.pop();break;case j.EBMLId.SeekID:var h,m=null==(h=this.currentSegment)?void 0:h.seekEntries[this.currentSegment.seekEntries.length-1];if(!m)break;m.id=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.SeekPosition:var p,v=null==(p=this.currentSegment)?void 0:p.seekEntries[this.currentSegment.seekEntries.length-1];if(!v)break;v.segmentPosition=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.TimestampScale:if(!this.currentSegment)break;this.currentSegment.timestampScale=(0,j.readUnsignedInt)(e,l),this.currentSegment.timestampFactor=1e9/this.currentSegment.timestampScale;break;case j.EBMLId.Duration:if(!this.currentSegment)break;this.currentSegment.duration=(0,j.readFloat)(e,l);break;case j.EBMLId.TrackEntry:if(!this.currentSegment)break;if(this.currentTrack={id:-1,segment:this.currentSegment,demuxer:this,clusterPositionCache:[],cuePoints:[],disposition:(0,g._)({},x.DEFAULT_TRACK_DISPOSITION),inputTrack:null,codecId:null,codecPrivate:null,defaultDuration:null,name:null,languageCode:I.UNDETERMINED_LANGUAGE,decodingInstructions:[],info:null},this.readContiguousElements(e.slice(d,l)),this.currentTrack.decodingInstructions.some(function(e){var t;return(null==(t=e.data)?void 0:t.type)!=="decompress"||e.scope!==c.Block||e.data.algorithm!==u.HeaderStripping})&&(console.warn("Track #".concat(this.currentTrack.id," has an unsupported content encoding; dropping.")),this.currentTrack=null),this.currentTrack&&-1!==this.currentTrack.id&&this.currentTrack.codecId&&this.currentTrack.info){var b=this.currentTrack.codecId.indexOf("/"),y=-1===b?this.currentTrack.codecId:this.currentTrack.codecId.slice(0,b);if("video"===this.currentTrack.info.type&&-1!==this.currentTrack.info.width&&-1!==this.currentTrack.info.height){this.currentTrack.codecId===j.CODEC_STRING_MAP.avc?(this.currentTrack.info.codec="avc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===j.CODEC_STRING_MAP.hevc?(this.currentTrack.info.codec="hevc",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):y===j.CODEC_STRING_MAP.vp8?this.currentTrack.info.codec="vp8":y===j.CODEC_STRING_MAP.vp9?this.currentTrack.info.codec="vp9":y===j.CODEC_STRING_MAP.av1&&(this.currentTrack.info.codec="av1");var k=this.currentTrack,_=new(0,T.InputVideoTrack)(this.input,new D(k));this.currentTrack.inputTrack=_,this.currentSegment.tracks.push(this.currentTrack)}else if("audio"===this.currentTrack.info.type&&-1!==this.currentTrack.info.numberOfChannels&&-1!==this.currentTrack.info.sampleRate){y===j.CODEC_STRING_MAP.aac?(this.currentTrack.info.codec="aac",this.currentTrack.info.aacCodecInfo={isMpeg2:this.currentTrack.codecId.includes("MPEG2")},this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):this.currentTrack.codecId===j.CODEC_STRING_MAP.mp3?this.currentTrack.info.codec="mp3":y===j.CODEC_STRING_MAP.opus?(this.currentTrack.info.codec="opus",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate,this.currentTrack.info.sampleRate=w.OPUS_SAMPLE_RATE):y===j.CODEC_STRING_MAP.vorbis?(this.currentTrack.info.codec="vorbis",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):y===j.CODEC_STRING_MAP.flac?(this.currentTrack.info.codec="flac",this.currentTrack.info.codecDescription=this.currentTrack.codecPrivate):"A_PCM/INT/LIT"===this.currentTrack.codecId?8===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-u8":16===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s16":24===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s24":32===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-s32"):"A_PCM/INT/BIG"===this.currentTrack.codecId?8===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-u8":16===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s16be":24===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-s24be":32===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-s32be"):"A_PCM/FLOAT/IEEE"===this.currentTrack.codecId&&(32===this.currentTrack.info.bitDepth?this.currentTrack.info.codec="pcm-f32":64===this.currentTrack.info.bitDepth&&(this.currentTrack.info.codec="pcm-f64"));var S=this.currentTrack,E=new(0,T.InputAudioTrack)(this.input,new F(S));this.currentTrack.inputTrack=E,this.currentSegment.tracks.push(this.currentTrack)}}this.currentTrack=null;break;case j.EBMLId.TrackNumber:if(!this.currentTrack)break;this.currentTrack.id=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.TrackType:if(!this.currentTrack)break;var P=(0,j.readUnsignedInt)(e,l);1===P?this.currentTrack.info={type:"video",width:-1,height:-1,rotation:0,codec:null,codecDescription:null,colorSpace:null,alphaMode:!1}:2===P&&(this.currentTrack.info={type:"audio",numberOfChannels:-1,sampleRate:-1,bitDepth:-1,codec:null,codecDescription:null,aacCodecInfo:null});break;case j.EBMLId.FlagEnabled:if(!this.currentTrack)break;(0,j.readUnsignedInt)(e,l)||(this.currentSegment.tracks.pop(),this.currentTrack=null);break;case j.EBMLId.FlagDefault:if(!this.currentTrack)break;this.currentTrack.disposition.default=!!(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.FlagForced:if(!this.currentTrack)break;this.currentTrack.disposition.forced=!!(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.FlagOriginal:if(!this.currentTrack)break;this.currentTrack.disposition.original=!!(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.FlagHearingImpaired:if(!this.currentTrack)break;this.currentTrack.disposition.hearingImpaired=!!(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.FlagVisualImpaired:if(!this.currentTrack)break;this.currentTrack.disposition.visuallyImpaired=!!(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.FlagCommentary:if(!this.currentTrack)break;this.currentTrack.disposition.commentary=!!(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.CodecID:if(!this.currentTrack)break;this.currentTrack.codecId=(0,j.readAsciiString)(e,l);break;case j.EBMLId.CodecPrivate:if(!this.currentTrack)break;this.currentTrack.codecPrivate=(0,C.readBytes)(e,l);break;case j.EBMLId.DefaultDuration:if(!this.currentTrack)break;this.currentTrack.defaultDuration=this.currentTrack.segment.timestampFactor*(0,j.readUnsignedInt)(e,l)/1e9;break;case j.EBMLId.Name:if(!this.currentTrack)break;this.currentTrack.name=(0,j.readUnicodeString)(e,l);break;case j.EBMLId.Language:if(!this.currentTrack||this.currentTrack.languageCode!==I.UNDETERMINED_LANGUAGE)break;this.currentTrack.languageCode=(0,j.readAsciiString)(e,l),(0,I.isIso639Dash2LanguageCode)(this.currentTrack.languageCode)||(this.currentTrack.languageCode=I.UNDETERMINED_LANGUAGE);break;case j.EBMLId.LanguageBCP47:if(!this.currentTrack)break;var A=(0,j.readAsciiString)(e,l).split("-")[0];A?this.currentTrack.languageCode=A:this.currentTrack.languageCode=I.UNDETERMINED_LANGUAGE;break;case j.EBMLId.Video:if((null==(M=this.currentTrack)||null==(B=M.info)?void 0:B.type)!=="video")break;this.readContiguousElements(e.slice(d,l));break;case j.EBMLId.PixelWidth:if((null==(U=this.currentTrack)||null==(R=U.info)?void 0:R.type)!=="video")break;this.currentTrack.info.width=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.PixelHeight:if((null==(N=this.currentTrack)||null==(O=N.info)?void 0:O.type)!=="video")break;this.currentTrack.info.height=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.AlphaMode:if((null==(z=this.currentTrack)||null==(L=z.info)?void 0:L.type)!=="video")break;this.currentTrack.info.alphaMode=1===(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.Colour:if((null==(H=this.currentTrack)||null==(V=H.info)?void 0:V.type)!=="video")break;this.currentTrack.info.colorSpace={},this.readContiguousElements(e.slice(d,l));break;case j.EBMLId.MatrixCoefficients:if((null==(q=this.currentTrack)||null==(G=q.info)?void 0:G.type)!=="video"||!this.currentTrack.info.colorSpace)break;var B,M,R,U,O,N,L,z,V,H,G,q,W,K=(0,j.readUnsignedInt)(e,l),X=null!=(W=I.MATRIX_COEFFICIENTS_MAP_INVERSE[K])?W:null;this.currentTrack.info.colorSpace.matrix=X;break;case j.EBMLId.Range:if((null==(Z=this.currentTrack)||null==(Q=Z.info)?void 0:Q.type)!=="video"||!this.currentTrack.info.colorSpace)break;this.currentTrack.info.colorSpace.fullRange=2===(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.TransferCharacteristics:if((null==(J=this.currentTrack)||null==(Y=J.info)?void 0:Y.type)!=="video"||!this.currentTrack.info.colorSpace)break;var Q,Z,Y,J,$,ee=(0,j.readUnsignedInt)(e,l),et=null!=($=I.TRANSFER_CHARACTERISTICS_MAP_INVERSE[ee])?$:null;this.currentTrack.info.colorSpace.transfer=et;break;case j.EBMLId.Primaries:if((null==(en=this.currentTrack)||null==(er=en.info)?void 0:er.type)!=="video"||!this.currentTrack.info.colorSpace)break;var er,en,ea,ei=(0,j.readUnsignedInt)(e,l),es=null!=(ea=I.COLOR_PRIMARIES_MAP_INVERSE[ei])?ea:null;this.currentTrack.info.colorSpace.primaries=es;break;case j.EBMLId.Projection:if((null==(ec=this.currentTrack)||null==(eo=ec.info)?void 0:eo.type)!=="video")break;this.readContiguousElements(e.slice(d,l));break;case j.EBMLId.ProjectionPoseRoll:if((null==(el=this.currentTrack)||null==(eu=el.info)?void 0:eu.type)!=="video")break;var eo,ec,eu,el,ed=(0,j.readFloat)(e,l);try{this.currentTrack.info.rotation=(0,I.normalizeRotation)(-ed)}catch(e){}break;case j.EBMLId.Audio:if((null==(em=this.currentTrack)||null==(eh=em.info)?void 0:eh.type)!=="audio")break;this.readContiguousElements(e.slice(d,l));break;case j.EBMLId.SamplingFrequency:if((null==(eg=this.currentTrack)||null==(ep=eg.info)?void 0:ep.type)!=="audio")break;this.currentTrack.info.sampleRate=(0,j.readFloat)(e,l);break;case j.EBMLId.Channels:if((null==(eb=this.currentTrack)||null==(ev=eb.info)?void 0:ev.type)!=="audio")break;this.currentTrack.info.numberOfChannels=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.BitDepth:if((null==(ek=this.currentTrack)||null==(ey=ek.info)?void 0:ey.type)!=="audio")break;this.currentTrack.info.bitDepth=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.CuePoint:if(!this.currentSegment)break;this.readContiguousElements(e.slice(d,l)),this.currentCueTime=null;break;case j.EBMLId.CueTime:this.currentCueTime=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.CueTrackPositions:if(null===this.currentCueTime)break;(0,I.assert)(this.currentSegment);var ef={time:this.currentCueTime,trackId:-1,clusterPosition:-1};this.currentSegment.cuePoints.push(ef),this.readContiguousElements(e.slice(d,l)),(-1===ef.trackId||-1===ef.clusterPosition)&&this.currentSegment.cuePoints.pop();break;case j.EBMLId.CueTrack:var eh,em,ep,eg,ev,eb,ey,ek,e_,ew=null==(e_=this.currentSegment)?void 0:e_.cuePoints[this.currentSegment.cuePoints.length-1];if(!ew)break;ew.trackId=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.CueClusterPosition:var eS,eT=null==(eS=this.currentSegment)?void 0:eS.cuePoints[this.currentSegment.cuePoints.length-1];if(!eT)break;(0,I.assert)(this.currentSegment),eT.clusterPosition=this.currentSegment.dataStartPos+(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.Timestamp:if(!this.currentCluster)break;this.currentCluster.timestamp=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.SimpleBlock:if(!this.currentCluster)break;var ex,eI=(0,j.readVarInt)(e);if(null===eI)break;var eE=this.getTrackDataInCluster(this.currentCluster,eI);if(!eE)break;var ej=(0,C.readI16Be)(e),eP=(0,C.readU8)(e),eC=!!(128&eP);(null==(ex=eE.track.info)?void 0:ex.type)==="audio"&&eE.track.info.codec&&(eC=!0);var eA=(0,C.readBytes)(e,l-(e.filePos-d)),eB=eE.track.decodingInstructions.length>0;eE.blocks.push({timestamp:ej,duration:0,isKeyFrame:eC,data:eA,lacing:eP>>1&3,decoded:!eB,mainAdditional:null});break;case j.EBMLId.BlockGroup:if(!this.currentCluster)break;this.readContiguousElements(e.slice(d,l)),this.currentBlock=null;break;case j.EBMLId.Block:if(!this.currentCluster)break;var eM=(0,j.readVarInt)(e);if(null===eM)break;var eD=this.getTrackDataInCluster(this.currentCluster,eM);if(!eD)break;var eF=(0,C.readI16Be)(e),eR=(0,C.readU8)(e),eU=(0,C.readBytes)(e,l-(e.filePos-d)),eO=eD.track.decodingInstructions.length>0;this.currentBlock={timestamp:eF,duration:0,isKeyFrame:!0,data:eU,lacing:eR>>1&3,decoded:!eO,mainAdditional:null},eD.blocks.push(this.currentBlock);break;case j.EBMLId.BlockAdditions:this.readContiguousElements(e.slice(d,l));break;case j.EBMLId.BlockMore:if(!this.currentBlock)break;this.currentBlockAdditional={addId:1,data:null},this.readContiguousElements(e.slice(d,l)),this.currentBlockAdditional.data&&1===this.currentBlockAdditional.addId&&(this.currentBlock.mainAdditional=this.currentBlockAdditional.data),this.currentBlockAdditional=null;break;case j.EBMLId.BlockAdditional:if(!this.currentBlockAdditional)break;this.currentBlockAdditional.data=(0,C.readBytes)(e,l);break;case j.EBMLId.BlockAddID:if(!this.currentBlockAdditional)break;this.currentBlockAdditional.addId=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.BlockDuration:if(!this.currentBlock)break;this.currentBlock.duration=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.ReferenceBlock:if(!this.currentBlock)break;this.currentBlock.isKeyFrame=!1;break;case j.EBMLId.Tag:this.currentTagTargetIsMovie=!0,this.readContiguousElements(e.slice(d,l));break;case j.EBMLId.Targets:this.readContiguousElements(e.slice(d,l));break;case j.EBMLId.TargetTypeValue:50!==(0,j.readUnsignedInt)(e,l)&&(this.currentTagTargetIsMovie=!1);break;case j.EBMLId.TagTrackUID:case j.EBMLId.TagEditionUID:case j.EBMLId.TagChapterUID:case j.EBMLId.TagAttachmentUID:this.currentTagTargetIsMovie=!1;break;case j.EBMLId.SimpleTag:if(!this.currentTagTargetIsMovie)break;this.currentSimpleTagName=null,this.readContiguousElements(e.slice(d,l));break;case j.EBMLId.TagName:this.currentSimpleTagName=(0,j.readUnicodeString)(e,l);break;case j.EBMLId.TagString:if(!this.currentSimpleTagName)break;var eN=(0,j.readUnicodeString)(e,l);this.processTagValue(this.currentSimpleTagName,eN);break;case j.EBMLId.TagBinary:if(!this.currentSimpleTagName)break;var eL=(0,C.readBytes)(e,l);this.processTagValue(this.currentSimpleTagName,eL);break;case j.EBMLId.AttachedFile:if(!this.currentSegment)break;this.currentAttachedFile={fileUid:null,fileName:null,fileMediaType:null,fileData:null,fileDescription:null},this.readContiguousElements(e.slice(d,l));var ez=this.currentSegment.metadataTags;if(this.currentAttachedFile.fileUid&&this.currentAttachedFile.fileData&&(null!=ez.raw||(ez.raw={}),ez.raw[this.currentAttachedFile.fileUid.toString()]=new(0,x.AttachedFile)(this.currentAttachedFile.fileData,null!=(eH=this.currentAttachedFile.fileMediaType)?eH:void 0,null!=(eG=this.currentAttachedFile.fileName)?eG:void 0,null!=(eq=this.currentAttachedFile.fileDescription)?eq:void 0)),(null==(eV=this.currentAttachedFile.fileMediaType)?void 0:eV.startsWith("image/"))&&this.currentAttachedFile.fileData){var eV,eH,eG,eq,eW,eK,eX=this.currentAttachedFile.fileName,eQ="unknown";if(eX){var eZ=eX.toLowerCase();eZ.startsWith("cover.")?eQ="coverFront":eZ.startsWith("back.")&&(eQ="coverBack")}null!=ez.images||(ez.images=[]),ez.images.push({data:this.currentAttachedFile.fileData,mimeType:this.currentAttachedFile.fileMediaType,kind:eQ,name:null!=(eW=this.currentAttachedFile.fileName)?eW:void 0,description:null!=(eK=this.currentAttachedFile.fileDescription)?eK:void 0})}this.currentAttachedFile=null;break;case j.EBMLId.FileUID:if(!this.currentAttachedFile)break;this.currentAttachedFile.fileUid=(0,j.readUnsignedBigInt)(e,l);break;case j.EBMLId.FileName:if(!this.currentAttachedFile)break;this.currentAttachedFile.fileName=(0,j.readUnicodeString)(e,l);break;case j.EBMLId.FileMediaType:if(!this.currentAttachedFile)break;this.currentAttachedFile.fileMediaType=(0,j.readAsciiString)(e,l);break;case j.EBMLId.FileData:if(!this.currentAttachedFile)break;this.currentAttachedFile.fileData=(0,C.readBytes)(e,l);break;case j.EBMLId.FileDescription:if(!this.currentAttachedFile)break;this.currentAttachedFile.fileDescription=(0,j.readUnicodeString)(e,l);break;case j.EBMLId.ContentEncodings:if(!this.currentTrack)break;this.readContiguousElements(e.slice(d,l)),this.currentTrack.decodingInstructions.sort(function(e,t){return t.order-e.order});break;case j.EBMLId.ContentEncoding:this.currentDecodingInstruction={order:0,scope:c.Block,data:null},this.readContiguousElements(e.slice(d,l)),this.currentDecodingInstruction.data&&this.currentTrack.decodingInstructions.push(this.currentDecodingInstruction),this.currentDecodingInstruction=null;break;case j.EBMLId.ContentEncodingOrder:if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.order=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.ContentEncodingScope:if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.scope=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.ContentCompression:if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decompress",algorithm:u.Zlib,settings:null},this.readContiguousElements(e.slice(d,l));break;case j.EBMLId.ContentCompAlgo:if((null==(n=this.currentDecodingInstruction)||null==(r=n.data)?void 0:r.type)!=="decompress")break;this.currentDecodingInstruction.data.algorithm=(0,j.readUnsignedInt)(e,l);break;case j.EBMLId.ContentCompSettings:if((null==(i=this.currentDecodingInstruction)||null==(a=i.data)?void 0:a.type)!=="decompress")break;this.currentDecodingInstruction.data.settings=(0,C.readBytes)(e,l);break;case j.EBMLId.ContentEncryption:if(!this.currentDecodingInstruction)break;this.currentDecodingInstruction.data={type:"decrypt"}}return e.filePos=d+l,!0}},{key:"decodeBlockData",value:function(e,t){(0,I.assert)(e.decodingInstructions.length>0);var r=t,n=!0,a=!1,i=void 0;try{for(var s,o=e.decodingInstructions[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var c=s.value;if((0,I.assert)(c.data),"decompress"===c.data.type&&c.data.algorithm===u.HeaderStripping&&c.data.settings&&c.data.settings.length>0){var l=c.data.settings,d=new Uint8Array(l.length+r.length);d.set(l,0),d.set(r,l.length),r=d}}}catch(e){a=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}return r}},{key:"processTagValue",value:function(e,t){if(null==(n=this.currentSegment)?void 0:n.metadataTags){var r=this.currentSegment.metadataTags;if(null!=r.raw||(r.raw={}),null!=(a=r.raw)[e]||(a[e]=t),"string"==typeof t)switch(e.toLowerCase()){case"title":null!=r.title||(r.title=t);break;case"description":null!=r.description||(r.description=t);break;case"artist":null!=r.artist||(r.artist=t);break;case"album":null!=r.album||(r.album=t);break;case"album_artist":null!=r.albumArtist||(r.albumArtist=t);break;case"genre":null!=r.genre||(r.genre=t);break;case"comment":null!=r.comment||(r.comment=t);break;case"lyrics":null!=r.lyrics||(r.lyrics=t);break;case"date":var n,a,i=new Date(t);Number.isNaN(i.getTime())||null!=r.date||(r.date=i);break;case"track_number":case"part_number":var s=t.split("/"),o=Number.parseInt(s[0],10),c=s[1]&&Number.parseInt(s[1],10);Number.isInteger(o)&&o>0&&(null!=r.trackNumber||(r.trackNumber=o)),c&&Number.isInteger(c)&&c>0&&(null!=r.tracksTotal||(r.tracksTotal=c));break;case"disc_number":case"disc":var u=t.split("/"),l=Number.parseInt(u[0],10),d=u[1]&&Number.parseInt(u[1],10);Number.isInteger(l)&&l>0&&(null!=r.discNumber||(r.discNumber=l)),d&&Number.isInteger(d)&&d>0&&(null!=r.discsTotal||(r.discsTotal=d))}}}}]),t}(S.Demuxer),M=function(){"use strict";function e(t){(0,h._)(this,e),this.internalTrack=t,this.packetToClusterLocation=new WeakMap}return(0,m._)(e,[{key:"getId",value:function(){return this.internalTrack.id}},{key:"getCodec",value:function(){throw Error("Not implemented on base class.")}},{key:"getInternalCodecId",value:function(){return this.internalTrack.codecId}},{key:"computeDuration",value:function(){return(0,d._)(function(){var e,t,r;return(0,y._)(this,function(n){switch(n.label){case 0:return[4,this.getPacket(1/0,{metadataOnly:!0})];case 1:return[2,(null!=(t=null==(e=n.sent())?void 0:e.timestamp)?t:0)+(null!=(r=null==e?void 0:e.duration)?r:0)]}})}).call(this)}},{key:"getName",value:function(){return this.internalTrack.name}},{key:"getLanguageCode",value:function(){return this.internalTrack.languageCode}},{key:"getFirstTimestamp",value:function(){return(0,d._)(function(){var e,t;return(0,y._)(this,function(r){switch(r.label){case 0:return[4,this.getFirstPacket({metadataOnly:!0})];case 1:return[2,null!=(t=null==(e=r.sent())?void 0:e.timestamp)?t:0]}})}).call(this)}},{key:"getTimeResolution",value:function(){return this.internalTrack.segment.timestampFactor}},{key:"getDisposition",value:function(){return this.internalTrack.disposition}},{key:"getFirstPacket",value:function(e){return(0,d._)(function(){var t;return(0,y._)(this,function(r){return t=this,[2,this.performClusterLookup(null,function(e){return e.trackData.get(t.internalTrack.id)?{blockIndex:0,correctBlockFound:!0}:{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,e)]})}).call(this)}},{key:"intoTimescale",value:function(e){return(0,I.roundIfAlmostInteger)(e*this.internalTrack.segment.timestampFactor)}},{key:"getPacket",value:function(e,t){return(0,d._)(function(){var r,n;return(0,y._)(this,function(a){return r=this,n=this.intoTimescale(e),[2,this.performClusterLookup(null,function(e){var t=e.trackData.get(r.internalTrack.id);if(!t)return{blockIndex:-1,correctBlockFound:!1};var a=(0,I.binarySearchLessOrEqual)(t.presentationTimestamps,n,function(e){return e.timestamp});return{blockIndex:-1!==a?t.presentationTimestamps[a].blockIndex:-1,correctBlockFound:-1!==a&&n<t.endTimestamp}},n,n,t)]})}).call(this)}},{key:"getNextPacket",value:function(e,t){return(0,d._)(function(){var r,n;return(0,y._)(this,function(a){if(r=this,void 0===(n=this.packetToClusterLocation.get(e)))throw Error("Packet was not created from this track.");return[2,this.performClusterLookup(n.cluster,function(e){if(e===n.cluster){var t=e.trackData.get(r.internalTrack.id);if(n.blockIndex+1<t.blocks.length)return{blockIndex:n.blockIndex+1,correctBlockFound:!0}}else if(e.trackData.get(r.internalTrack.id))return{blockIndex:0,correctBlockFound:!0};return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,t)]})}).call(this)}},{key:"getKeyPacket",value:function(e,t){return(0,d._)(function(){var r,n;return(0,y._)(this,function(a){return r=this,n=this.intoTimescale(e),[2,this.performClusterLookup(null,function(e){var t=e.trackData.get(r.internalTrack.id);if(!t)return{blockIndex:-1,correctBlockFound:!1};var a=(0,I.findLastIndex)(t.presentationTimestamps,function(e){return t.blocks[e.blockIndex].isKeyFrame&&e.timestamp<=n});return{blockIndex:-1!==a?t.presentationTimestamps[a].blockIndex:-1,correctBlockFound:-1!==a&&n<t.endTimestamp}},n,n,t)]})}).call(this)}},{key:"getNextKeyPacket",value:function(e,t){return(0,d._)(function(){var r,n;return(0,y._)(this,function(a){if(r=this,void 0===(n=this.packetToClusterLocation.get(e)))throw Error("Packet was not created from this track.");return[2,this.performClusterLookup(n.cluster,function(e){if(e===n.cluster){var t=e.trackData.get(r.internalTrack.id).blocks.findIndex(function(e,t){return e.isKeyFrame&&t>n.blockIndex});if(-1!==t)return{blockIndex:t,correctBlockFound:!0}}else{var a=e.trackData.get(r.internalTrack.id);if(a&&null!==a.firstKeyFrameTimestamp){var i=a.blocks.findIndex(function(e){return e.isKeyFrame});return(0,I.assert)(-1!==i),{blockIndex:i,correctBlockFound:!0}}}return{blockIndex:-1,correctBlockFound:!1}},-1/0,1/0,t)]})}).call(this)}},{key:"fetchPacketInCluster",value:function(e,t,r){return(0,d._)(function(){var n,a,i,s,o,c,u;return(0,y._)(this,function(l){return -1===t?[2,null]:(a=e.trackData.get(this.internalTrack.id).blocks[t],(0,I.assert)(a),a.decoded||(a.data=this.internalTrack.demuxer.decodeBlockData(this.internalTrack,a.data),a.decoded=!0),i=r.metadataOnly?E.PLACEHOLDER_DATA:a.data,s=a.timestamp/this.internalTrack.segment.timestampFactor,o=a.duration/this.internalTrack.segment.timestampFactor,c={},a.mainAdditional&&(null==(n=this.internalTrack.info)?void 0:n.type)==="video"&&this.internalTrack.info.alphaMode&&(c.alpha=r.metadataOnly?E.PLACEHOLDER_DATA:a.mainAdditional,c.alphaByteLength=a.mainAdditional.byteLength),u=new(0,E.EncodedPacket)(i,a.isKeyFrame?"key":"delta",s,o,e.dataStartPos+t,a.data.byteLength,c),this.packetToClusterLocation.set(u,{cluster:e,blockIndex:t}),[2,u])})}).call(this)}},{key:"performClusterLookup",value:function(e,t,r,n,a){return(0,d._)(function(){var i,s,o,c,u,l,d,f,h,m,p,g,v,b,k,_,w,S,T,x,E,P,C,A,B,M,D,F,R,U,O,N;return(0,y._)(this,function(y){switch(y.label){case 0:if(s=(i=this.internalTrack).demuxer,o=i.segment,c=null,u=null,l=-1,e){if(f=(d=t(e)).blockIndex,d.correctBlockFound)return[2,this.fetchPacketInCluster(e,f,a)];-1!==f&&(u=e,l=f)}m=-1!==(h=(0,I.binarySearchLessOrEqual)(this.internalTrack.cuePoints,r,function(e){return e.time}))?this.internalTrack.cuePoints[h]:null,g=-1!==(p=(0,I.binarySearchLessOrEqual)(this.internalTrack.clusterPositionCache,r,function(e){return e.startTimestamp}))?this.internalTrack.clusterPositionCache[p]:null,k=Math.max(null!=(v=null==m?void 0:m.clusterPosition)?v:0,null!=(b=null==g?void 0:g.elementStartPos)?b:0)||null,e?null===k||e.elementStartPos>=k?(_=e.elementEndPos,c=e):_=k:_=null!=k?k:o.clusterSeekStartPos,y.label=1;case 1:if(!(null===o.elementEndPos||_<=o.elementEndPos-j.MIN_HEADER_SIZE)||c&&(w=c.trackData.get(this.internalTrack.id))&&w.startTimestamp>n)return[3,13];if(!((S=s.reader.requestSliceRange(_,j.MIN_HEADER_SIZE,j.MAX_HEADER_SIZE))instanceof Promise))return[3,3];return[4,S];case 2:S=y.sent(),y.label=3;case 3:if(!S)return[3,13];if(T=_,!(!(x=(0,j.readElementHeader)(S))||!j.LEVEL_1_EBML_IDS.includes(x.id)&&x.id!==j.EBMLId.Void))return[3,5];return[4,(0,j.resync)(s.reader,T,j.LEVEL_1_EBML_IDS,Math.min(null!=(E=o.elementEndPos)?E:1/0,T+0xa00000))];case 4:if(P=y.sent())return _=P,[3,1];return[3,13];case 5:if(C=x.id,A=x.size,B=S.filePos,C!==j.EBMLId.Cluster)return[3,7];return[4,s.readCluster(T,o)];case 6:if(A=(c=y.sent()).elementEndPos-B,D=(M=t(c)).blockIndex,M.correctBlockFound)return[2,this.fetchPacketInCluster(c,D,a)];-1!==D&&(u=c,l=D),y.label=7;case 7:if(null!==A)return[3,9];return(0,I.assert)(C!==j.EBMLId.Cluster),[4,(0,j.searchForNextElementId)(s.reader,B,j.LEVEL_0_AND_1_EBML_IDS,o.elementEndPos)];case 8:A=y.sent().pos-B,y.label=9;case 9:if(F=B+A,null!==o.elementEndPos)return[3,12];if(!((R=s.reader.requestSliceRange(F,j.MIN_HEADER_SIZE,j.MAX_HEADER_SIZE))instanceof Promise))return[3,11];return[4,R];case 10:R=y.sent(),y.label=11;case 11:if(!R)return[3,13];if((0,j.readElementId)(R)===j.EBMLId.Segment)return o.elementEndPos=F,[3,13];y.label=12;case 12:return _=F,[3,1];case 13:if(m&&(!u||u.elementStartPos<m.clusterPosition))return U=this.internalTrack.cuePoints[h-1],(0,I.assert)(!U||U.time<m.time),N=null!=(O=null==U?void 0:U.time)?O:-1/0,[2,this.performClusterLookup(null,t,N,n,a)];if(u)return[2,this.fetchPacketInCluster(u,l,a)];return[2,null]}})}).call(this)}}]),e}(),D=function(e){"use strict";function t(e){var r;return(0,h._)(this,t),(r=(0,f._)(this,t,[e])).decoderConfigPromise=null,r.internalTrack=e,r}return(0,p._)(t,e),(0,m._)(t,[{key:"getCodec",value:function(){return this.internalTrack.info.codec}},{key:"getCodedWidth",value:function(){return this.internalTrack.info.width}},{key:"getCodedHeight",value:function(){return this.internalTrack.info.height}},{key:"getRotation",value:function(){return this.internalTrack.info.rotation}},{key:"getColorSpace",value:function(){return(0,d._)(function(){var e,t,r,n;return(0,y._)(this,function(a){return[2,{primaries:null==(e=this.internalTrack.info.colorSpace)?void 0:e.primaries,transfer:null==(t=this.internalTrack.info.colorSpace)?void 0:t.transfer,matrix:null==(r=this.internalTrack.info.colorSpace)?void 0:r.matrix,fullRange:null==(n=this.internalTrack.info.colorSpace)?void 0:n.fullRange}]})}).call(this)}},{key:"canBeTransparent",value:function(){return(0,d._)(function(){return(0,y._)(this,function(e){return[2,this.internalTrack.info.alphaMode]})}).call(this)}},{key:"getDecoderConfig",value:function(){return(0,d._)(function(){var e,t;return(0,y._)(this,function(r){return(e=this,this.internalTrack.info.codec)?[2,null!=(t=this.decoderConfigPromise)?t:this.decoderConfigPromise=(0,d._)(function(){var e,t,r;return(0,y._)(this,function(n){switch(n.label){case 0:if(e=null,!("vp9"===this.internalTrack.info.codec||"av1"===this.internalTrack.info.codec||"avc"===this.internalTrack.info.codec&&!this.internalTrack.info.codecDescription||"hevc"===this.internalTrack.info.codec&&!this.internalTrack.info.codecDescription))return[3,2];return[4,this.getFirstPacket({})];case 1:e=n.sent(),n.label=2;case 2:return[2,{codec:(0,w.extractVideoCodecString)({width:this.internalTrack.info.width,height:this.internalTrack.info.height,codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,colorSpace:this.internalTrack.info.colorSpace,avcType:1,avcCodecInfo:"avc"===this.internalTrack.info.codec&&e?(0,_.extractAvcDecoderConfigurationRecord)(e.data):null,hevcCodecInfo:"hevc"===this.internalTrack.info.codec&&e?(0,_.extractHevcDecoderConfigurationRecord)(e.data):null,vp9CodecInfo:"vp9"===this.internalTrack.info.codec&&e?(0,_.extractVp9CodecInfoFromPacket)(e.data):null,av1CodecInfo:"av1"===this.internalTrack.info.codec&&e?(0,_.extractAv1CodecInfoFromPacket)(e.data):null}),codedWidth:this.internalTrack.info.width,codedHeight:this.internalTrack.info.height,description:null!=(t=this.internalTrack.info.codecDescription)?t:void 0,colorSpace:null!=(r=this.internalTrack.info.colorSpace)?r:void 0}]}})}).call(e)]:[2,null]})}).call(this)}}]),t}(M),F=function(e){"use strict";function t(e){var r;return(0,h._)(this,t),(r=(0,f._)(this,t,[e])).decoderConfig=null,r.internalTrack=e,r}return(0,p._)(t,e),(0,m._)(t,[{key:"getCodec",value:function(){return this.internalTrack.info.codec}},{key:"getNumberOfChannels",value:function(){return this.internalTrack.info.numberOfChannels}},{key:"getSampleRate",value:function(){return this.internalTrack.info.sampleRate}},{key:"getDecoderConfig",value:function(){return(0,d._)(function(){var e,t;return(0,y._)(this,function(r){return this.internalTrack.info.codec?[2,null!=(t=this.decoderConfig)?t:this.decoderConfig={codec:(0,w.extractAudioCodecString)({codec:this.internalTrack.info.codec,codecDescription:this.internalTrack.info.codecDescription,aacCodecInfo:this.internalTrack.info.aacCodecInfo}),numberOfChannels:this.internalTrack.info.numberOfChannels,sampleRate:this.internalTrack.info.sampleRate,description:null!=(e=this.internalTrack.info.codecDescription)?e:void 0}]:[2,null]})}).call(this)}}]),t}(M)},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_object_spread.cjs":"kyoEj","@swc/helpers/cjs/_sliced_to_array.cjs":"gIQTH","@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","@swc/helpers/cjs/_ts_values.cjs":"94P5Q","../codec-data.js":"kWTYV","../codec.js":"fXWqW","../demuxer.js":"d4thC","../input-track.js":"b22CJ","../metadata.js":"eSjom","../misc.js":"j7iGm","../packet.js":"QfqGG","./ebml.js":"fq2QE","./matroska-misc.js":"jz4IV","../reader.js":"8KRfO","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],jz4IV:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"buildMatroskaMimeType",function(){return s});var i=e("@swc/helpers/cjs/_to_consumable_array.cjs"),s=function(e){var t=(e.hasVideo?"video/":e.hasAudio?"audio/":"application/")+(e.isWebM?"webm":"x-matroska");if(e.codecStrings.length>0){var r=(0,i._)(new Set(e.codecStrings.filter(Boolean)));t+='; codecs="'.concat(r.join(", "),'"')}return t}},{"@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],ifShX:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"Mp3Demuxer",function(){return _});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_call_super.cjs"),o=e("@swc/helpers/cjs/_class_call_check.cjs"),c=e("@swc/helpers/cjs/_create_class.cjs"),u=e("@swc/helpers/cjs/_inherits.cjs"),l=e("@swc/helpers/cjs/_object_spread.cjs"),d=e("@swc/helpers/cjs/_ts_generator.cjs"),f=e("../demuxer.js"),h=e("../input-track.js"),m=e("../metadata.js"),p=e("../misc.js"),g=e("../packet.js"),v=e("../../shared/mp3-misc.js"),b=e("../id3.js"),y=e("./mp3-reader.js"),k=e("../reader.js"),_=function(e){"use strict";function t(e){var r;return(0,o._)(this,t),(r=(0,s._)(this,t,[e])).metadataPromise=null,r.firstFrameHeader=null,r.loadedSamples=[],r.metadataTags=null,r.tracks=[],r.readingMutex=new(0,p.AsyncMutex),r.lastSampleLoaded=!1,r.lastLoadedPos=0,r.nextTimestampInSamples=0,r.reader=e._reader,r}return(0,u._)(t,e),(0,c._)(t,[{key:"readMetadata",value:function(){return(0,i._)(function(){var e,t;return(0,d._)(this,function(r){return e=this,[2,null!=(t=this.metadataPromise)?t:this.metadataPromise=(0,i._)(function(){return(0,d._)(this,function(e){switch(e.label){case 0:if(!(!this.firstFrameHeader&&!this.lastSampleLoaded))return[3,2];return[4,this.advanceReader()];case 1:return e.sent(),[3,0];case 2:if(!this.firstFrameHeader)throw Error("No valid MP3 frame found.");return this.tracks=[new(0,h.InputAudioTrack)(this.input,new w(this))],[2]}})}).call(e)]})}).call(this)}},{key:"advanceReader",value:function(){return(0,i._)(function(){var e,t,r,n,a,i,s,o,c;return(0,d._)(this,function(u){switch(u.label){case 0:if(0!==this.lastLoadedPos)return[3,4];u.label=1;case 1:if(!((e=this.reader.requestSlice(this.lastLoadedPos,b.ID3_V2_HEADER_SIZE))instanceof Promise))return[3,3];return[4,e];case 2:e=u.sent(),u.label=3;case 3:if(!e)return this.lastSampleLoaded=!0,[2];if(!(t=(0,b.readId3V2Header)(e)))return[3,4];return this.lastLoadedPos=e.filePos+t.size,[3,1];case 4:return[4,(0,y.readNextFrameHeader)(this.reader,this.lastLoadedPos,this.reader.fileSize)];case 5:if(!(r=u.sent()))return this.lastSampleLoaded=!0,[2];if(n=r.header,this.lastLoadedPos=r.startPos+n.totalSize-1,a=(0,v.getXingOffset)(n.mpegVersionId,n.channel),!((i=this.reader.requestSlice(r.startPos+a,4))instanceof Promise))return[3,7];return[4,i];case 6:i=u.sent(),u.label=7;case 7:if(i&&((s=(0,k.readU32Be)(i))===v.XING||s===v.INFO))return[2];return this.firstFrameHeader||(this.firstFrameHeader=n),n.sampleRate!==this.firstFrameHeader.sampleRate&&console.warn("MP3 changed sample rate mid-file: ".concat(this.firstFrameHeader.sampleRate," Hz to ").concat(n.sampleRate," Hz.")+" Might be a bug, so please report this file."),o=n.audioSamplesInFrame/this.firstFrameHeader.sampleRate,c={timestamp:this.nextTimestampInSamples/this.firstFrameHeader.sampleRate,duration:o,dataStart:r.startPos,dataSize:n.totalSize},this.loadedSamples.push(c),this.nextTimestampInSamples+=n.audioSamplesInFrame,[2]}})}).call(this)}},{key:"getMimeType",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){return[2,"audio/mpeg"]})})()}},{key:"getTracks",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),[2,this.tracks]}})}).call(this)}},{key:"computeDuration",value:function(){return(0,i._)(function(){var e;return(0,d._)(this,function(t){switch(t.label){case 0:return[4,this.readMetadata()];case 1:return t.sent(),e=this.tracks[0],(0,p.assert)(e),[2,e.computeDuration()]}})}).call(this)}},{key:"getMetadataTags",value:function(){return(0,i._)(function(){var e,t,r,n,a,i,s;return(0,d._)(this,function(o){switch(o.label){case 0:return[4,this.readingMutex.acquire()];case 1:e=o.sent(),o.label=2;case 2:return o.trys.push([2,,13,14]),[4,this.readMetadata()];case 3:if(o.sent(),this.metadataTags)return[2,this.metadataTags];this.metadataTags={},t=0,r=!1,o.label=4;case 4:if(!((n=this.reader.requestSlice(t,b.ID3_V2_HEADER_SIZE))instanceof Promise))return[3,6];return[4,n];case 5:n=o.sent(),o.label=6;case 6:if(!n||!(a=(0,b.readId3V2Header)(n)))return[3,9];if(r=!0,!((i=this.reader.requestSlice(n.filePos,a.size))instanceof Promise))return[3,8];return[4,i];case 7:i=o.sent(),o.label=8;case 8:if(!i)return[3,9];return(0,b.parseId3V2Tag)(i,a,this.metadataTags),t=n.filePos+a.size,[3,4];case 9:if(!(!r&&null!==this.reader.fileSize&&this.reader.fileSize>=b.ID3_V1_TAG_SIZE))return[3,12];if(!((s=this.reader.requestSlice(this.reader.fileSize-b.ID3_V1_TAG_SIZE,b.ID3_V1_TAG_SIZE))instanceof Promise))return[3,11];return[4,s];case 10:s=o.sent(),o.label=11;case 11:(0,p.assert)(s),"TAG"===(0,k.readAscii)(s,3)&&(0,b.parseId3V1Tag)(s,this.metadataTags),o.label=12;case 12:return[2,this.metadataTags];case 13:return e(),[7];case 14:return[2]}})}).call(this)}}]),t}(f.Demuxer),w=function(){"use strict";function e(t){(0,o._)(this,e),this.demuxer=t}return(0,c._)(e,[{key:"getId",value:function(){return 1}},{key:"getFirstTimestamp",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){return[2,0]})})()}},{key:"getTimeResolution",value:function(){return(0,p.assert)(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate/this.demuxer.firstFrameHeader.audioSamplesInFrame}},{key:"computeDuration",value:function(){return(0,i._)(function(){var e,t,r;return(0,d._)(this,function(n){switch(n.label){case 0:return[4,this.getPacket(1/0,{metadataOnly:!0})];case 1:return[2,(null!=(t=null==(e=n.sent())?void 0:e.timestamp)?t:0)+(null!=(r=null==e?void 0:e.duration)?r:0)]}})}).call(this)}},{key:"getName",value:function(){return null}},{key:"getLanguageCode",value:function(){return p.UNDETERMINED_LANGUAGE}},{key:"getCodec",value:function(){return"mp3"}},{key:"getInternalCodecId",value:function(){return null}},{key:"getNumberOfChannels",value:function(){return(0,p.assert)(this.demuxer.firstFrameHeader),3===this.demuxer.firstFrameHeader.channel?1:2}},{key:"getSampleRate",value:function(){return(0,p.assert)(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.sampleRate}},{key:"getDisposition",value:function(){return(0,l._)({},m.DEFAULT_TRACK_DISPOSITION)}},{key:"getDecoderConfig",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){return(0,p.assert)(this.demuxer.firstFrameHeader),[2,{codec:"mp3",numberOfChannels:3===this.demuxer.firstFrameHeader.channel?1:2,sampleRate:this.demuxer.firstFrameHeader.sampleRate}]})}).call(this)}},{key:"getPacketAtIndex",value:function(e,t){return(0,i._)(function(){var r,n,a;return(0,d._)(this,function(i){switch(i.label){case 0:if(-1===e||!(r=this.demuxer.loadedSamples[e]))return[2,null];if(!t.metadataOnly)return[3,1];return n=g.PLACEHOLDER_DATA,[3,4];case 1:if(!((a=this.demuxer.reader.requestSlice(r.dataStart,r.dataSize))instanceof Promise))return[3,3];return[4,a];case 2:a=i.sent(),i.label=3;case 3:if(!a)return[2,null];n=(0,k.readBytes)(a,r.dataSize),i.label=4;case 4:return[2,new(0,g.EncodedPacket)(n,"key",r.timestamp,r.duration,e,r.dataSize)]}})}).call(this)}},{key:"getFirstPacket",value:function(e){return this.getPacketAtIndex(0,e)}},{key:"getNextPacket",value:function(e,t){return(0,i._)(function(){var r,n,a;return(0,d._)(this,function(i){switch(i.label){case 0:return[4,this.demuxer.readingMutex.acquire()];case 1:r=i.sent(),i.label=2;case 2:if(i.trys.push([2,,6,7]),-1===(n=(0,p.binarySearchExact)(this.demuxer.loadedSamples,e.timestamp,function(e){return e.timestamp})))throw Error("Packet was not created from this track.");a=n+1,i.label=3;case 3:if(!(a>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded))return[3,5];return[4,this.demuxer.advanceReader()];case 4:return i.sent(),[3,3];case 5:return[2,this.getPacketAtIndex(a,t)];case 6:return r(),[7];case 7:return[2]}})}).call(this)}},{key:"getPacket",value:function(e,t){return(0,i._)(function(){var r,n;return(0,d._)(this,function(a){switch(a.label){case 0:return[4,this.demuxer.readingMutex.acquire()];case 1:r=a.sent(),a.label=2;case 2:a.trys.push([2,,6,7]),a.label=3;case 3:if(-1===(n=(0,p.binarySearchLessOrEqual)(this.demuxer.loadedSamples,e,function(e){return e.timestamp}))&&this.demuxer.loadedSamples.length>0)return[2,null];if(this.demuxer.lastSampleLoaded||n>=0&&n+1<this.demuxer.loadedSamples.length)return[2,this.getPacketAtIndex(n,t)];return[4,this.demuxer.advanceReader()];case 4:return a.sent(),[3,3];case 5:return[3,7];case 6:return r(),[7];case 7:return[2]}})}).call(this)}},{key:"getKeyPacket",value:function(e,t){return this.getPacket(e,t)}},{key:"getNextKeyPacket",value:function(e,t){return this.getNextPacket(e,t)}}]),e}()},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_object_spread.cjs":"kyoEj","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","../demuxer.js":"d4thC","../input-track.js":"b22CJ","../metadata.js":"eSjom","../misc.js":"j7iGm","../packet.js":"QfqGG","../../shared/mp3-misc.js":"gcure","../id3.js":"42Y2c","./mp3-reader.js":"gFWvE","../reader.js":"8KRfO","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],gcure:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"FRAME_HEADER_SIZE",function(){return i}),a.export(r,"SAMPLING_RATES",function(){return s}),a.export(r,"KILOBIT_RATES",function(){return o}),a.export(r,"XING",function(){return c}),a.export(r,"INFO",function(){return u}),a.export(r,"computeMp3FrameSize",function(){return l}),a.export(r,"getXingOffset",function(){return d}),a.export(r,"readFrameHeader",function(){return f}),a.export(r,"encodeSynchsafe",function(){return h}),a.export(r,"decodeSynchsafe",function(){return m});var i=4,s=[44100,48e3,32e3],o=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1,-1,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1,-1,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1,-1,32,48,56,64,80,96,112,128,144,160,176,192,224,256,-1],c=0x58696e67,u=0x496e666f,l=function(e,t,r,n,a){return 0===t?0:1===t?Math.floor(144*r/(n<<e))+a:2===t?Math.floor(144*r/n)+a:(Math.floor(12*r/n)+a)*4},d=function(e,t){return 3===e?3===t?21:36:3===t?13:21},f=function(e,t){var r,n=e>>>24,a=e>>>16&255,i=e>>>8&255,c=255&e;if(255!==n&&255!==a&&255!==i&&255!==c)return{header:null,bytesAdvanced:4};if(255!==n||(224&a)!=224)return{header:null,bytesAdvanced:1};var u=0,d=0;16&a?u=8&a?0:1:(u=1,d=1);var f=a>>3&3,h=a>>1&3,m=(i>>2&3)%3,p=o[64*u+16*h+(i>>4&15)];if(-1===p)return{header:null,bytesAdvanced:1};var g=1e3*p,v=s[m]>>u+d,b=l(u,h,g,v,i>>1&1);return null!==t&&t<b?{header:null,bytesAdvanced:1}:(r=3===f?3===h?384:1152:3===h?384:2===h?1152:576,{header:{totalSize:b,mpegVersionId:f,layer:h,bitrate:g,frequencyIndex:m,sampleRate:v,channel:c>>6&3,modeExtension:c>>4&3,copyright:c>>3&1,original:c>>2&1,emphasis:3&c,audioSamplesInFrame:r},bytesAdvanced:1})},h=function(e){for(var t=127,r=0,n=e;(0x7fffffff^t)!=0;)r=(n&~t)<<1|n&t,t=(t+1<<8)-1,n=r;return r},m=function(e){for(var t=0x7f000000,r=0;0!==t;)r>>=1,r|=e&t,t>>=8;return r}},{"@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"42Y2c":[function(e,t,r,n){var a,i,s,o,c=e("@parcel/transformer-js/src/esmodule-helpers.js");c.defineInteropFlag(r),c.export(r,"Id3V2HeaderFlags",function(){return s}),c.export(r,"Id3V2TextEncoding",function(){return o}),c.export(r,"ID3_V1_TAG_SIZE",function(){return m}),c.export(r,"ID3_V2_HEADER_SIZE",function(){return p}),c.export(r,"ID3_V1_GENRES",function(){return g}),c.export(r,"parseId3V1Tag",function(){return v}),c.export(r,"readId3V1String",function(){return b}),c.export(r,"readId3V2Header",function(){return y}),c.export(r,"parseId3V2Tag",function(){return k}),c.export(r,"Id3V2Reader",function(){return _}),c.export(r,"Id3V2Writer",function(){return w});var u=e("@swc/helpers/cjs/_class_call_check.cjs"),l=e("@swc/helpers/cjs/_create_class.cjs"),d=e("../shared/mp3-misc.js"),f=e("./misc.js"),h=e("./reader.js");(a=s||(s={}))[a.Unsynchronisation=128]="Unsynchronisation",a[a.ExtendedHeader=64]="ExtendedHeader",a[a.ExperimentalIndicator=32]="ExperimentalIndicator",a[a.Footer=16]="Footer",(i=o||(o={}))[i.ISO_8859_1=0]="ISO_8859_1",i[i.UTF_16_WITH_BOM=1]="UTF_16_WITH_BOM",i[i.UTF_16_BE_NO_BOM=2]="UTF_16_BE_NO_BOM",i[i.UTF_8=3]="UTF_8";var m=128,p=10,g=["Blues","Classic rock","Country","Dance","Disco","Funk","Grunge","Hip-hop","Jazz","Metal","New age","Oldies","Other","Pop","Rhythm and blues","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death metal","Pranks","Soundtrack","Euro-techno","Ambient","Trip-hop","Vocal","Jazz & funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound clip","Gospel","Noise","Alternative rock","Bass","Soul","Punk","Space","Meditative","Instrumental pop","Instrumental rock","Ethnic","Gothic","Darkwave","Techno-industrial","Electronic","Pop-folk","Eurodance","Dream","Southern rock","Comedy","Cult","Gangsta","Top 40","Christian rap","Pop/funk","Jungle music","Native US","Cabaret","New wave","Psychedelic","Rave","Showtunes","Trailer","Lo-fi","Tribal","Acid punk","Acid jazz","Polka","Retro","Musical","Rock 'n' roll","Hard rock","Folk","Folk rock","National folk","Swing","Fast fusion","Bebop","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic rock","Progressive rock","Psychedelic rock","Symphonic rock","Slow rock","Big band","Chorus","Easy listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber music","Sonata","Symphony","Booty bass","Primus","Porn groove","Satire","Slow jam","Club","Tango","Samba","Folklore","Ballad","Power ballad","Rhythmic Soul","Freestyle","Duet","Punk rock","Drum solo","A cappella","Euro-house","Dance hall","Goa music","Drum & bass","Club-house","Hardcore techno","Terror","Indie","Britpop","Negerpunk","Polsk punk","Beat","Christian gangsta rap","Heavy metal","Black metal","Crossover","Contemporary Christian","Christian rock","Merengue","Salsa","Thrash metal","Anime","Jpop","Synthpop","Christmas","Art rock","Baroque","Bhangra","Big beat","Breakbeat","Chillout","Downtempo","Dub","EBM","Eclectic","Electro","Electroclash","Emo","Experimental","Garage","Global","IDM","Illbient","Industro-Goth","Jam Band","Krautrock","Leftfield","Lounge","Math rock","New romantic","Nu-breakz","Post-punk","Post-rock","Psytrance","Shoegaze","Space rock","Trop rock","World music","Neoclassical","Audiobook","Audio theatre","Neue Deutsche Welle","Podcast","Indie rock","G-Funk","Dubstep","Garage rock","Psybient"],v=function(e,t){var r=e.filePos;null!=t.raw||(t.raw={}),null!=(c=t.raw).TAG||(c.TAG=(0,h.readBytes)(e,m-3)),e.filePos=r;var n=b(e,30);n&&(null!=t.title||(t.title=n));var a=b(e,30);a&&(null!=t.artist||(t.artist=a));var i=b(e,30);i&&(null!=t.album||(t.album=i));var s=Number.parseInt(b(e,4),10);Number.isInteger(s)&&s>0&&(null!=t.date||(t.date=new Date(s,0,1)));var o=(0,h.readBytes)(e,30);if(0===o[28]&&0!==o[29]){var c,u,l=o[29];l>0&&(null!=t.trackNumber||(t.trackNumber=l)),e.skip(-30),u=b(e,28),e.skip(2)}else e.skip(-30),u=b(e,30);u&&(null!=t.comment||(t.comment=u));var d=(0,h.readU8)(e);d<g.length&&(null!=t.genre||(t.genre=g[d]))},b=function(e,t){for(var r=(0,h.readBytes)(e,t),n=(0,f.coalesceIndex)(r.indexOf(0),r.length),a=r.subarray(0,n),i="",s=0;s<a.length;s++)i+=String.fromCharCode(a[s]);return i.trimEnd()},y=function(e){var t=e.filePos,r=(0,h.readAscii)(e,3),n=(0,h.readU8)(e),a=(0,h.readU8)(e),i=(0,h.readU8)(e),s=(0,h.readU32Be)(e);return"ID3"!==r||255===n||255===a||(0x80808080&s)!=0?(e.filePos=t,null):{majorVersion:n,revision:a,flags:i,size:(0,d.decodeSynchsafe)(s)}},k=function(e,t,r){if(![2,3,4].includes(t.majorVersion))return void console.warn("Unsupported ID3v2 major version: ".concat(t.majorVersion));var n=(0,h.readBytes)(e,t.size),a=new _(t,n);if(t.flags&s.Footer&&a.removeFooter(),t.flags&s.Unsynchronisation&&3===t.majorVersion&&a.ununsynchronizeAll(),t.flags&s.ExtendedHeader){var i=a.readU32();3===t.majorVersion?a.pos+=i:a.pos+=i-4}for(;a.pos<=a.bytes.length-a.frameHeaderSize();){var o=a.readId3V2Frame();if(!o)break;var c=a.pos,u=a.pos+o.size,l=!1,d=!1,f=!1;if(3===t.majorVersion?(l=!!(64&o.flags),d=!!(128&o.flags)):4===t.majorVersion&&(l=!!(4&o.flags),d=!!(8&o.flags),f=!!(2&o.flags)||!!(t.flags&s.Unsynchronisation)),l){console.warn("Skipping encrypted ID3v2 frame ".concat(o.id)),a.pos=u;continue}if(d){console.warn("Skipping compressed ID3v2 frame ".concat(o.id)),a.pos=u;continue}switch(f&&a.ununsynchronizeRegion(a.pos,u),null!=r.raw||(r.raw={}),"T"===o.id[0]?null!=(m=r.raw)[p=o.id]||(m[p]=a.readId3V2EncodingAndText(u)):null!=(v=r.raw)[b=o.id]||(v[b]=a.readBytes(o.size)),a.pos=c,o.id){case"TIT2":case"TT2":null!=r.title||(r.title=a.readId3V2EncodingAndText(u));break;case"TIT3":case"TT3":null!=r.description||(r.description=a.readId3V2EncodingAndText(u));break;case"TPE1":case"TP1":null!=r.artist||(r.artist=a.readId3V2EncodingAndText(u));break;case"TALB":case"TAL":null!=r.album||(r.album=a.readId3V2EncodingAndText(u));break;case"TPE2":case"TP2":null!=r.albumArtist||(r.albumArtist=a.readId3V2EncodingAndText(u));break;case"TRCK":case"TRK":var m,p,v,b,y=a.readId3V2EncodingAndText(u).split("/"),k=Number.parseInt(y[0],10),w=y[1]&&Number.parseInt(y[1],10);Number.isInteger(k)&&k>0&&(null!=r.trackNumber||(r.trackNumber=k)),w&&Number.isInteger(w)&&w>0&&(null!=r.tracksTotal||(r.tracksTotal=w));break;case"TPOS":case"TPA":var S=a.readId3V2EncodingAndText(u).split("/"),T=Number.parseInt(S[0],10),x=S[1]&&Number.parseInt(S[1],10);Number.isInteger(T)&&T>0&&(null!=r.discNumber||(r.discNumber=T)),x&&Number.isInteger(x)&&x>0&&(null!=r.discsTotal||(r.discsTotal=x));break;case"TCON":case"TCO":var I=a.readId3V2EncodingAndText(u),E=/^\((\d+)\)/.exec(I);if(E){var j=Number.parseInt(E[1]);if(void 0!==g[j]){null!=r.genre||(r.genre=g[j]);break}}if(E=/^\d+$/.exec(I)){var P=Number.parseInt(E[0]);if(void 0!==g[P]){null!=r.genre||(r.genre=g[P]);break}}null!=r.genre||(r.genre=I);break;case"TDRC":case"TDAT":var C=new Date(a.readId3V2EncodingAndText(u));Number.isNaN(C.getTime())||null!=r.date||(r.date=C);break;case"TYER":case"TYE":var A=Number.parseInt(a.readId3V2EncodingAndText(u),10);Number.isInteger(A)&&(null!=r.date||(r.date=new Date(A,0,1)));break;case"USLT":case"ULT":var B=a.readU8();a.pos+=3,a.readId3V2Text(B,u),null!=r.lyrics||(r.lyrics=a.readId3V2Text(B,u));break;case"COMM":case"COM":var M=a.readU8();a.pos+=3,a.readId3V2Text(M,u),null!=r.comment||(r.comment=a.readId3V2Text(M,u));break;case"APIC":case"PIC":var D=a.readId3V2TextEncoding(),F=void 0;if(2===t.majorVersion){var R=a.readAscii(3);F="PNG"===R?"image/png":"JPG"===R?"image/jpeg":"image/*"}else F=a.readId3V2Text(D,u);var U=a.readU8(),O=a.readId3V2Text(D,u).trimEnd(),N=u-a.pos;if(N>=0){var L=a.readBytes(N);r.images||(r.images=[]),r.images.push({data:L,mimeType:F,kind:3===U?"coverFront":4===U?"coverBack":"unknown",description:O})}break;default:a.pos+=o.size}a.pos=u}},_=function(){"use strict";function e(t,r){(0,u._)(this,e),this.header=t,this.bytes=r,this.pos=0,this.view=new DataView(r.buffer,r.byteOffset,r.byteLength)}return(0,l._)(e,[{key:"frameHeaderSize",value:function(){return 2===this.header.majorVersion?6:10}},{key:"ununsynchronizeAll",value:function(){for(var e=[],t=0;t<this.bytes.length;t++){var r=this.bytes[t];e.push(r),255===r&&t!==this.bytes.length-1&&0===this.bytes[t]&&t++}this.bytes=new Uint8Array(e),this.view=new DataView(this.bytes.buffer)}},{key:"ununsynchronizeRegion",value:function(e,t){for(var r=[],n=e;n<t;n++){var a=this.bytes[n];r.push(a),255===a&&n!==t-1&&0===this.bytes[n+1]&&n++}var i=this.bytes.subarray(0,e),s=this.bytes.subarray(t);this.bytes=new Uint8Array(i.length+r.length+s.length),this.bytes.set(i,0),this.bytes.set(r,i.length),this.bytes.set(s,i.length+r.length),this.view=new DataView(this.bytes.buffer)}},{key:"removeFooter",value:function(){this.bytes=this.bytes.subarray(0,this.bytes.length-p),this.view=new DataView(this.bytes.buffer)}},{key:"readBytes",value:function(e){var t=this.bytes.subarray(this.pos,this.pos+e);return this.pos+=e,t}},{key:"readU8",value:function(){var e=this.view.getUint8(this.pos);return this.pos+=1,e}},{key:"readU16",value:function(){var e=this.view.getUint16(this.pos,!1);return this.pos+=2,e}},{key:"readU24",value:function(){var e=this.view.getUint16(this.pos,!1),t=this.view.getUint8(this.pos+1);return this.pos+=3,256*e+t}},{key:"readU32",value:function(){var e=this.view.getUint32(this.pos,!1);return this.pos+=4,e}},{key:"readAscii",value:function(e){for(var t="",r=0;r<e;r++)t+=String.fromCharCode(this.view.getUint8(this.pos+r));return this.pos+=e,t}},{key:"readId3V2Frame",value:function(){var e=this;if(2===this.header.majorVersion){var t=this.readAscii(3);return"\0\0\0"===t?null:{id:t,size:this.readU24(),flags:0}}var r=this.readAscii(4);if("\0\0\0\0"===r)return null;var n=this.readU32(),a=4===this.header.majorVersion?(0,d.decodeSynchsafe)(n):n,i=this.readU16(),s=this.pos,o=function(t){var r=e.pos+t;if(r>e.bytes.length)return!1;if(r<=e.bytes.length-e.frameHeaderSize()){e.pos+=t;var n=e.readAscii(4);if("\0\0\0\0"!==n&&!/[0-9A-Z]{4}/.test(n))return!1}return!0};if(!o(a)){var c=4===this.header.majorVersion?n:(0,d.decodeSynchsafe)(n);o(c)&&(a=c)}return this.pos=s,{id:r,size:a,flags:i}}},{key:"readId3V2TextEncoding",value:function(){var e=this.readU8();if(e>3)throw Error("Unsupported text encoding: ".concat(e));return e}},{key:"readId3V2Text",value:function(e,t){var r=this.pos,n=this.readBytes(t-this.pos);switch(e){case o.ISO_8859_1:for(var a="",i=0;i<n.length;i++){var s=n[i];if(0===s){this.pos=r+i+1;break}a+=String.fromCharCode(s)}return a;case o.UTF_16_WITH_BOM:if(255===n[0]&&254===n[1]){var c=new TextDecoder("utf-16le"),u=(0,f.coalesceIndex)(n.findIndex(function(e,t){return 0===e&&0===n[t+1]&&t%2==0}),n.length);return this.pos=r+Math.min(u+2,n.length),c.decode(n.subarray(2,u))}if(254===n[0]&&255===n[1]){var l=new TextDecoder("utf-16be"),d=(0,f.coalesceIndex)(n.findIndex(function(e,t){return 0===e&&0===n[t+1]&&t%2==0}),n.length);return this.pos=r+Math.min(d+2,n.length),l.decode(n.subarray(2,d))}var h=(0,f.coalesceIndex)(n.findIndex(function(e){return 0===e}),n.length);return this.pos=r+Math.min(h+1,n.length),f.textDecoder.decode(n.subarray(0,h));case o.UTF_16_BE_NO_BOM:var m=new TextDecoder("utf-16be"),p=(0,f.coalesceIndex)(n.findIndex(function(e,t){return 0===e&&0===n[t+1]&&t%2==0}),n.length);return this.pos=r+Math.min(p+2,n.length),m.decode(n.subarray(0,p));case o.UTF_8:var g=(0,f.coalesceIndex)(n.findIndex(function(e){return 0===e}),n.length);return this.pos=r+Math.min(g+1,n.length),f.textDecoder.decode(n.subarray(0,g))}}},{key:"readId3V2EncodingAndText",value:function(e){if(this.pos>=e)return"";var t=this.readId3V2TextEncoding();return this.readId3V2Text(t,e)}}]),e}(),w=function(){"use strict";function e(t){(0,u._)(this,e),this.helper=new Uint8Array(8),this.helperView=(0,f.toDataView)(this.helper),this.writer=t}return(0,l._)(e,[{key:"writeId3V2Tag",value:function(e){var t=this.writer.getPos();this.writeAscii("ID3"),this.writeU8(4),this.writeU8(0),this.writeU8(0),this.writeSynchsafeU32(0);var r=this.writer.getPos(),n=new Set,a=!0,i=!1,s=void 0;try{for(var c,u=(0,f.keyValueIterator)(e)[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value,d=l.key,h=l.value;switch(d){case"title":this.writeId3V2TextFrame("TIT2",h),n.add("TIT2");break;case"description":this.writeId3V2TextFrame("TIT3",h),n.add("TIT3");break;case"artist":this.writeId3V2TextFrame("TPE1",h),n.add("TPE1");break;case"album":this.writeId3V2TextFrame("TALB",h),n.add("TALB");break;case"albumArtist":this.writeId3V2TextFrame("TPE2",h),n.add("TPE2");break;case"trackNumber":var m=void 0!==e.tracksTotal?"".concat(h,"/").concat(e.tracksTotal):h.toString();this.writeId3V2TextFrame("TRCK",m),n.add("TRCK");break;case"discNumber":var p=void 0!==e.discsTotal?"".concat(h,"/").concat(e.discsTotal):h.toString();this.writeId3V2TextFrame("TPOS",p),n.add("TPOS");break;case"genre":this.writeId3V2TextFrame("TCON",h),n.add("TCON");break;case"date":this.writeId3V2TextFrame("TDRC",h.toISOString().slice(0,10)),n.add("TDRC");break;case"lyrics":this.writeId3V2LyricsFrame(h),n.add("USLT");break;case"comment":this.writeId3V2CommentFrame(h),n.add("COMM");break;case"images":var g={coverFront:3,coverBack:4,unknown:0},v=!0,b=!1,y=void 0;try{for(var k,_=h[Symbol.iterator]();!(v=(k=_.next()).done);v=!0){var w,S,T=k.value,x=null!=(w=g[T.kind])?w:0,I=null!=(S=T.description)?S:"";this.writeId3V2ApicFrame(T.mimeType,x,I,T.data)}}catch(e){b=!0,y=e}finally{try{v||null==_.return||_.return()}finally{if(b)throw y}}break;case"tracksTotal":case"discsTotal":case"raw":break;default:(0,f.assertNever)(d)}}}catch(e){i=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}if(e.raw)for(var E in e.raw){var j=e.raw[E];if(!(null==j||4!==E.length||n.has(E))){var P=void 0;if("string"==typeof j){var C=f.textEncoder.encode(j);(P=new Uint8Array(C.byteLength+2))[0]=o.UTF_8,P.set(C,1)}else{if(!(j instanceof Uint8Array))continue;P=j}this.writeAscii(E),this.writeSynchsafeU32(P.byteLength),this.writeU16(0),this.writer.write(P)}}var A=this.writer.getPos(),B=A-r;return this.writer.seek(t+6),this.writeSynchsafeU32(B),this.writer.seek(A),B+10}},{key:"writeU8",value:function(e){this.helper[0]=e,this.writer.write(this.helper.subarray(0,1))}},{key:"writeU16",value:function(e){this.helperView.setUint16(0,e,!1),this.writer.write(this.helper.subarray(0,2))}},{key:"writeU32",value:function(e){this.helperView.setUint32(0,e,!1),this.writer.write(this.helper.subarray(0,4))}},{key:"writeAscii",value:function(e){for(var t=0;t<e.length;t++)this.helper[t]=e.charCodeAt(t);this.writer.write(this.helper.subarray(0,e.length))}},{key:"writeSynchsafeU32",value:function(e){this.writeU32((0,d.encodeSynchsafe)(e))}},{key:"writeIsoString",value:function(e){for(var t=new Uint8Array(e.length+1),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);t[e.length]=0,this.writer.write(t)}},{key:"writeUtf8String",value:function(e){var t=f.textEncoder.encode(e);this.writer.write(t),this.writeU8(0)}},{key:"writeId3V2TextFrame",value:function(e,t){var r=(0,f.isIso88591Compatible)(t),n=r?t.length:f.textEncoder.encode(t).byteLength;this.writeAscii(e),this.writeSynchsafeU32(1+n+1),this.writeU16(0),this.writeU8(r?o.ISO_8859_1:o.UTF_8),r?this.writeIsoString(t):this.writeUtf8String(t)}},{key:"writeId3V2LyricsFrame",value:function(e){var t=(0,f.isIso88591Compatible)(e),r=5+e.length+1;this.writeAscii("USLT"),this.writeSynchsafeU32(r),this.writeU16(0),this.writeU8(t?o.ISO_8859_1:o.UTF_8),this.writeAscii("und"),t?(this.writeIsoString(""),this.writeIsoString(e)):(this.writeUtf8String(""),this.writeUtf8String(e))}},{key:"writeId3V2CommentFrame",value:function(e){var t=(0,f.isIso88591Compatible)(e),r=t?e.length:f.textEncoder.encode(e).byteLength;this.writeAscii("COMM"),this.writeSynchsafeU32(5+r+1),this.writeU16(0),this.writeU8(t?o.ISO_8859_1:o.UTF_8),this.writeU8(117),this.writeU8(110),this.writeU8(100),t?(this.writeIsoString(""),this.writeIsoString(e)):(this.writeUtf8String(""),this.writeUtf8String(e))}},{key:"writeId3V2ApicFrame",value:function(e,t,r,n){var a=(0,f.isIso88591Compatible)(e)&&(0,f.isIso88591Compatible)(r),i=a?r.length:f.textEncoder.encode(r).byteLength,s=1+e.length+1+1+i+1+n.byteLength;this.writeAscii("APIC"),this.writeSynchsafeU32(s),this.writeU16(0),this.writeU8(a?o.ISO_8859_1:o.UTF_8),a?this.writeIsoString(e):this.writeUtf8String(e),this.writeU8(t),a?this.writeIsoString(r):this.writeUtf8String(r),this.writer.write(n)}}]),e}()},{"@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","../shared/mp3-misc.js":"gcure","./misc.js":"j7iGm","./reader.js":"8KRfO","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],gFWvE:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"readNextFrameHeader",function(){return u});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_ts_generator.cjs"),o=e("../../shared/mp3-misc.js"),c=e("../reader.js"),u=function(e,t,r){return(0,i._)(function(){var n,a,i,u;return(0,s._)(this,function(s){switch(s.label){case 0:n=t,s.label=1;case 1:if(!(null===r||n<r))return[3,4];if(!((a=e.requestSlice(n,o.FRAME_HEADER_SIZE))instanceof Promise))return[3,3];return[4,a];case 2:a=s.sent(),s.label=3;case 3:if(!a)return[3,4];if(i=(0,c.readU32Be)(a),(u=(0,o.readFrameHeader)(i,null!==e.fileSize?e.fileSize-n:null)).header)return[2,{header:u.header,startPos:n}];return n+=u.bytesAdvanced,[3,1];case 4:return[2,null]}})})()}},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","../../shared/mp3-misc.js":"gcure","../reader.js":"8KRfO","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],hRJRs:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"OggDemuxer",function(){return S});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_call_super.cjs"),o=e("@swc/helpers/cjs/_class_call_check.cjs"),c=e("@swc/helpers/cjs/_create_class.cjs"),u=e("@swc/helpers/cjs/_inherits.cjs"),l=e("@swc/helpers/cjs/_object_spread.cjs"),d=e("@swc/helpers/cjs/_to_consumable_array.cjs"),f=e("@swc/helpers/cjs/_ts_generator.cjs"),h=e("../codec.js"),m=e("../codec-data.js"),p=e("../demuxer.js"),g=e("../input-track.js"),v=e("../metadata.js"),b=e("../misc.js"),y=e("../packet.js"),k=e("../reader.js"),_=e("./ogg-misc.js"),w=e("./ogg-reader.js"),S=function(e){"use strict";function t(e){var r;return(0,o._)(this,t),(r=(0,s._)(this,t,[e])).metadataPromise=null,r.bitstreams=[],r.tracks=[],r.metadataTags={},r.reader=e._reader,r}return(0,u._)(t,e),(0,c._)(t,[{key:"readMetadata",value:function(){return(0,i._)(function(){var e,t;return(0,f._)(this,function(r){return e=this,[2,null!=(t=this.metadataPromise)?t:this.metadataPromise=(0,i._)(function(){var e,t,r,n,a,i,s,o,c,u,l;return(0,f._)(this,function(d){switch(d.label){case 0:e=0,d.label=1;case 1:if(!((t=this.reader.requestSliceRange(e,w.MIN_PAGE_HEADER_SIZE,w.MAX_PAGE_HEADER_SIZE))instanceof Promise))return[3,3];return[4,t];case 2:t=d.sent(),d.label=3;case 3:if(!t||!(r=(0,w.readPageHeader)(t))||!(2&r.headerType))return[3,4];return this.bitstreams.push({serialNumber:r.serialNumber,bosPage:r,description:null,numberOfChannels:-1,sampleRate:-1,codecInfo:{codec:null,vorbisInfo:null,opusInfo:null},lastMetadataPacket:null}),e=r.headerStartPos+r.totalSize,[3,1];case 4:n=!0,a=!1,i=void 0,d.label=5;case 5:d.trys.push([5,14,15,16]),s=this.bitstreams[Symbol.iterator](),d.label=6;case 6:if(n=(o=s.next()).done)return[3,13];return c=o.value,[4,this.readPacket(c.bosPage,0)];case 7:if(!(u=d.sent()))return[3,12];if(!(u.data.byteLength>=7&&1===u.data[0]&&118===u.data[1]&&111===u.data[2]&&114===u.data[3]&&98===u.data[4]&&105===u.data[5]&&115===u.data[6]))return[3,9];return[4,this.readVorbisMetadata(u,c)];case 8:return d.sent(),[3,11];case 9:if(!(u.data.byteLength>=8&&79===u.data[0]&&112===u.data[1]&&117===u.data[2]&&115===u.data[3]&&72===u.data[4]&&101===u.data[5]&&97===u.data[6]&&100===u.data[7]))return[3,11];return[4,this.readOpusMetadata(u,c)];case 10:d.sent(),d.label=11;case 11:null!==c.codecInfo.codec&&this.tracks.push(new(0,g.InputAudioTrack)(this.input,new T(c,this))),d.label=12;case 12:return n=!0,[3,6];case 13:return[3,16];case 14:return l=d.sent(),a=!0,i=l,[3,16];case 15:try{n||null==s.return||s.return()}finally{if(a)throw i}return[7];case 16:return[2]}})}).call(e)]})}).call(this)}},{key:"readVorbisMetadata",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s,o,c,u;return(0,f._)(this,function(l){switch(l.label){case 0:return[4,this.findNextPacketStart(e)];case 1:case 3:if(!(r=l.sent()))return[2];return[4,this.readPacket(r.startPage,r.startSegmentIndex)];case 2:if(!(n=l.sent()))return[2];return[4,this.findNextPacketStart(n)];case 4:if(!(a=l.sent())||3!==n.data[0]||5!==a.data[0])return[2];return i=[],(s=function(e){for(;i.push(Math.min(255,e)),!(e<255);)e-=255})(e.data.length),s(n.data.length),(o=new Uint8Array(1+i.length+e.data.length+n.data.length+a.data.length))[0]=2,o.set(i,1),o.set(e.data,1+i.length),o.set(n.data,1+i.length+e.data.length),o.set(a.data,1+i.length+e.data.length+n.data.length),t.codecInfo.codec="vorbis",t.description=o,t.lastMetadataPacket=a,t.numberOfChannels=(c=(0,b.toDataView)(e.data)).getUint8(11),t.sampleRate=c.getUint32(12,!0),u=c.getUint8(28),t.codecInfo.vorbisInfo={blocksizes:[1<<(15&u),1<<(u>>4)],modeBlockflags:(0,m.parseModesFromVorbisSetupPacket)(a.data).modeBlockflags},(0,m.readVorbisComments)(n.data.subarray(7),this.metadataTags),[2]}})}).call(this)}},{key:"readOpusMetadata",value:function(e,t){return(0,i._)(function(){var r,n,a;return(0,f._)(this,function(i){switch(i.label){case 0:return[4,this.findNextPacketStart(e)];case 1:if(!(r=i.sent()))return[2];return[4,this.readPacket(r.startPage,r.startSegmentIndex)];case 2:if(!(n=i.sent()))return[2];return t.codecInfo.codec="opus",t.description=e.data,t.lastMetadataPacket=n,t.numberOfChannels=(a=(0,m.parseOpusIdentificationHeader)(e.data)).outputChannelCount,t.sampleRate=h.OPUS_SAMPLE_RATE,t.codecInfo.opusInfo={preSkip:a.preSkip},(0,m.readVorbisComments)(n.data.subarray(8),this.metadataTags),[2]}})}).call(this)}},{key:"readPacket",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s,o,c,u,l,d,h,m,p,g,v,y;return(0,f._)(this,function(f){switch(f.label){case 0:for((0,b.assert)(t<e.lacingValues.length),r=0,n=0;n<t;n++)r+=e.lacingValues[n];a=e,i=r,s=t,o=[],f.label=1;case 1:if(!((c=this.reader.requestSlice(a.dataStartPos,a.dataSize))instanceof Promise))return[3,3];return[4,c];case 2:c=f.sent(),f.label=3;case 3:for((0,b.assert)(c),u=(0,k.readBytes)(c,a.dataSize);;){if(s===a.lacingValues.length){o.push(u.subarray(r,i));break}if(l=a.lacingValues[s],i+=l,l<255)return o.push(u.subarray(r,i)),[3,8];s++}d=a.headerStartPos+a.totalSize,f.label=4;case 4:if(!((h=this.reader.requestSliceRange(d,w.MIN_PAGE_HEADER_SIZE,w.MAX_PAGE_HEADER_SIZE))instanceof Promise))return[3,6];return[4,h];case 5:h=f.sent(),f.label=6;case 6:if(!h||!(m=(0,w.readPageHeader)(h)))return[2,null];if((a=m).serialNumber===e.serialNumber)return[3,7];return d=a.headerStartPos+a.totalSize,[3,4];case 7:return r=0,i=0,s=0,[3,1];case 8:for(v=0,p=new Uint8Array(o.reduce(function(e,t){return e+t.length},0)),g=0;v<o.length;v++)y=o[v],p.set(y,g),g+=y.length;return[2,{data:p,endPage:a,endSegmentIndex:s}]}})}).call(this)}},{key:"findNextPacketStart",value:function(e){return(0,i._)(function(){var t,r,n;return(0,f._)(this,function(a){switch(a.label){case 0:if(e.endSegmentIndex<e.endPage.lacingValues.length-1)return[2,{startPage:e.endPage,startSegmentIndex:e.endSegmentIndex+1}];if(4&e.endPage.headerType)return[2,null];t=e.endPage.headerStartPos+e.endPage.totalSize,a.label=1;case 1:if(!((r=this.reader.requestSliceRange(t,w.MIN_PAGE_HEADER_SIZE,w.MAX_PAGE_HEADER_SIZE))instanceof Promise))return[3,3];return[4,r];case 2:r=a.sent(),a.label=3;case 3:if(!r||!(n=(0,w.readPageHeader)(r)))return[2,null];if(n.serialNumber===e.endPage.serialNumber)return[2,{startPage:n,startSegmentIndex:0}];return t=n.headerStartPos+n.totalSize,[3,1];case 4:return[2]}})}).call(this)}},{key:"getMimeType",value:function(){return(0,i._)(function(){var e;return(0,f._)(this,function(t){switch(t.label){case 0:return[4,this.readMetadata()];case 1:return t.sent(),[4,Promise.all(this.tracks.map(function(e){return e.getCodecParameterString()}))];case 2:return e=t.sent(),[2,(0,_.buildOggMimeType)({codecStrings:e.filter(Boolean)})]}})}).call(this)}},{key:"getTracks",value:function(){return(0,i._)(function(){return(0,f._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),[2,this.tracks]}})}).call(this)}},{key:"computeDuration",value:function(){return(0,i._)(function(){var e,t;return(0,f._)(this,function(r){switch(r.label){case 0:return[4,this.getTracks()];case 1:return[4,Promise.all(r.sent().map(function(e){return e.computeDuration()}))];case 2:return t=r.sent(),[2,(e=Math).max.apply(e,[0].concat((0,d._)(t)))]}})}).call(this)}},{key:"getMetadataTags",value:function(){return(0,i._)(function(){return(0,f._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),[2,this.metadataTags]}})}).call(this)}}]),t}(p.Demuxer),T=function(){"use strict";function e(t,r){(0,o._)(this,e),this.bitstream=t,this.demuxer=r,this.encodedPacketToMetadata=new WeakMap,this.sequentialScanCache=[],this.sequentialScanMutex=new(0,b.AsyncMutex),this.internalSampleRate="opus"===t.codecInfo.codec?h.OPUS_SAMPLE_RATE:t.sampleRate}return(0,c._)(e,[{key:"getId",value:function(){return this.bitstream.serialNumber}},{key:"getNumberOfChannels",value:function(){return this.bitstream.numberOfChannels}},{key:"getSampleRate",value:function(){return this.bitstream.sampleRate}},{key:"getTimeResolution",value:function(){return this.bitstream.sampleRate}},{key:"getCodec",value:function(){return this.bitstream.codecInfo.codec}},{key:"getInternalCodecId",value:function(){return null}},{key:"getDecoderConfig",value:function(){return(0,i._)(function(){var e;return(0,f._)(this,function(t){return(0,b.assert)(this.bitstream.codecInfo.codec),[2,{codec:this.bitstream.codecInfo.codec,numberOfChannels:this.bitstream.numberOfChannels,sampleRate:this.bitstream.sampleRate,description:null!=(e=this.bitstream.description)?e:void 0}]})}).call(this)}},{key:"getName",value:function(){return null}},{key:"getLanguageCode",value:function(){return b.UNDETERMINED_LANGUAGE}},{key:"getDisposition",value:function(){return(0,l._)({},v.DEFAULT_TRACK_DISPOSITION)}},{key:"getFirstTimestamp",value:function(){return(0,i._)(function(){return(0,f._)(this,function(e){return[2,0]})})()}},{key:"computeDuration",value:function(){return(0,i._)(function(){var e,t,r;return(0,f._)(this,function(n){switch(n.label){case 0:return[4,this.getPacket(1/0,{metadataOnly:!0})];case 1:return[2,(null!=(t=null==(e=n.sent())?void 0:e.timestamp)?t:0)+(null!=(r=null==e?void 0:e.duration)?r:0)]}})}).call(this)}},{key:"granulePositionToTimestampInSamples",value:function(e){return"opus"===this.bitstream.codecInfo.codec?((0,b.assert)(this.bitstream.codecInfo.opusInfo),e-this.bitstream.codecInfo.opusInfo.preSkip):e}},{key:"createEncodedPacketFromOggPacket",value:function(e,t,r){if(!e)return null;var n=(0,_.extractSampleMetadata)(e.data,this.bitstream.codecInfo,t.vorbisLastBlocksize),a=n.durationInSamples,i=n.vorbisBlockSize,s=new(0,y.EncodedPacket)(r.metadataOnly?y.PLACEHOLDER_DATA:e.data,"key",Math.max(0,t.timestampInSamples)/this.internalSampleRate,a/this.internalSampleRate,e.endPage.headerStartPos+e.endSegmentIndex,e.data.byteLength);return this.encodedPacketToMetadata.set(s,{packet:e,timestampInSamples:t.timestampInSamples,durationInSamples:a,vorbisLastBlockSize:t.vorbisLastBlocksize,vorbisBlockSize:i}),s}},{key:"getFirstPacket",value:function(e){return(0,i._)(function(){var t,r,n;return(0,f._)(this,function(a){switch(a.label){case 0:return(0,b.assert)(this.bitstream.lastMetadataPacket),[4,this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket)];case 1:if(!(t=a.sent()))return[2,null];return r=0,"opus"===this.bitstream.codecInfo.codec&&((0,b.assert)(this.bitstream.codecInfo.opusInfo),r-=this.bitstream.codecInfo.opusInfo.preSkip),[4,this.demuxer.readPacket(t.startPage,t.startSegmentIndex)];case 2:return n=a.sent(),[2,this.createEncodedPacketFromOggPacket(n,{timestampInSamples:r,vorbisLastBlocksize:null},e)]}})}).call(this)}},{key:"getNextPacket",value:function(e,t){return(0,i._)(function(){var r,n,a,i;return(0,f._)(this,function(s){switch(s.label){case 0:if(!(r=this.encodedPacketToMetadata.get(e)))throw Error("Packet was not created from this track.");return[4,this.demuxer.findNextPacketStart(r.packet)];case 1:if(!(n=s.sent()))return[2,null];return a=r.timestampInSamples+r.durationInSamples,[4,this.demuxer.readPacket(n.startPage,n.startSegmentIndex)];case 2:return i=s.sent(),[2,this.createEncodedPacketFromOggPacket(i,{timestampInSamples:a,vorbisLastBlocksize:r.vorbisBlockSize},t)]}})}).call(this)}},{key:"getPacket",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s,o,c,u,l,d,h,m,p,g,v,S,T,E,j,P,C,A,B,M,D,F,R,U,O,N,L,z,V,H,G,q,W,K,X,Q,Z,Y,J,$,ee;return(0,f._)(this,function(f){switch(f.label){case 0:if(null===this.demuxer.reader.fileSize)return[2,this.getPacketSequential(e,t)];if(0===(r=(0,b.roundIfAlmostInteger)(e*this.internalSampleRate)))return[2,this.getFirstPacket(t)];if(r<0)return[2,null];return(0,b.assert)(this.bitstream.lastMetadataPacket),[4,this.demuxer.findNextPacketStart(this.bitstream.lastMetadataPacket)];case 1:if(!(n=f.sent()))return[2,null];a=n.startPage,i=this.demuxer.reader.fileSize,s=[a],f.label=2;case 2:if(!(a.headerStartPos+a.totalSize<i))return[3,13];c=o=Math.floor((a.headerStartPos+i)/2),f.label=3;case 3:if(u=Math.min(c+w.MAX_PAGE_SIZE,i-w.MIN_PAGE_HEADER_SIZE),!((l=this.demuxer.reader.requestSlice(c,u-c))instanceof Promise))return[3,5];return[4,l];case 4:l=f.sent(),f.label=5;case 5:if((0,b.assert)(l),!(0,w.findNextPageHeader)(l,u))return i=o+w.MIN_PAGE_HEADER_SIZE,[3,2];if(!((d=this.demuxer.reader.requestSliceRange(l.filePos,w.MIN_PAGE_HEADER_SIZE,w.MAX_PAGE_HEADER_SIZE))instanceof Promise))return[3,7];return[4,d];case 6:d=f.sent(),f.label=7;case 7:if((0,b.assert)(d),h=(0,w.readPageHeader)(d),(0,b.assert)(h),m=!1,h.serialNumber!==this.bitstream.serialNumber)return[3,8];return m=!0,[3,11];case 8:if(!((p=this.demuxer.reader.requestSlice(h.headerStartPos,h.totalSize))instanceof Promise))return[3,10];return[4,p];case 9:p=f.sent(),f.label=10;case 10:(0,b.assert)(p),g=(0,k.readBytes)(p,h.totalSize),m=(0,_.computeOggPageCrc)(g)===h.checksum,f.label=11;case 11:if(!m)return c=h.headerStartPos+4,[3,3];if(m&&h.serialNumber!==this.bitstream.serialNumber||-1===h.granulePosition)return c=h.headerStartPos+h.totalSize,[3,3];return this.granulePositionToTimestampInSamples(h.granulePosition)>r?i=h.headerStartPos:(a=h,s.push(h)),[3,2];case 12:return[3,2];case 13:v=n.startPage,S=!0,T=!1,E=void 0;try{for(j=s[Symbol.iterator]();!(S=(P=j.next()).done)&&(C=P.value).granulePosition!==a.granulePosition;S=!0)(!v||C.headerStartPos>v.headerStartPos)&&(v=C)}catch(e){T=!0,E=e}finally{try{S||null==j.return||j.return()}finally{if(T)throw E}}B=[A=v],f.label=14;case 14:if(A.serialNumber===this.bitstream.serialNumber&&A.granulePosition===a.granulePosition)return[3,17];if(M=A.headerStartPos+A.totalSize,!((D=this.demuxer.reader.requestSliceRange(M,w.MIN_PAGE_HEADER_SIZE,w.MAX_PAGE_HEADER_SIZE))instanceof Promise))return[3,16];return[4,D];case 15:D=f.sent(),f.label=16;case 16:return(0,b.assert)(D),F=(0,w.readPageHeader)(D),(0,b.assert)(F),(A=F).serialNumber===this.bitstream.serialNumber&&B.push(A),[3,14];case 17:if((0,b.assert)(-1!==A.granulePosition),R=null,N=A,L=0,A.headerStartPos!==n.startPage.headerStartPos)return[3,18];return U=this.granulePositionToTimestampInSamples(0),O=!0,R=0,[3,20];case 18:for(U=0,O=!1,z=A.lacingValues.length-1;z>=0;z--)if(A.lacingValues[z]<255){R=z+1;break}if(null===R)throw Error("Invalid page with granule position: no packets end on this page.");return L=R-1,V={data:y.PLACEHOLDER_DATA,endPage:N,endSegmentIndex:L},[4,this.demuxer.findNextPacketStart(V)];case 19:if(f.sent())H=I(B,A,R),(0,b.assert)(H),(G=x(B,H.page,H.segmentIndex))&&(A=G.page,R=G.segmentIndex);else for(;(q=I(B,A,R))&&(W=x(B,q.page,q.segmentIndex));)if(A=W.page,R=W.segmentIndex,q.page.headerStartPos!==N.headerStartPos){N=q.page,L=q.segmentIndex;break}f.label=20;case 20:K=null,X=null,f.label=21;case 21:if(null===A)return[3,24];return(0,b.assert)(null!==R),[4,this.demuxer.readPacket(A,R)];case 22:if(!(Q=f.sent())||!(A.headerStartPos===n.startPage.headerStartPos&&R<n.startSegmentIndex)&&(Y=this.createEncodedPacketFromOggPacket(Q,{timestampInSamples:U,vorbisLastBlocksize:null!=(Z=null==X?void 0:X.vorbisBlockSize)?Z:null},t),(0,b.assert)(Y),J=this.encodedPacketToMetadata.get(Y),(0,b.assert)(J),O||Q.endPage.headerStartPos!==N.headerStartPos||Q.endSegmentIndex!==L?U+=J.durationInSamples:(U=this.granulePositionToTimestampInSamples(A.granulePosition),O=!0,Y=this.createEncodedPacketFromOggPacket(Q,{timestampInSamples:U-J.durationInSamples,vorbisLastBlocksize:null!=($=null==X?void 0:X.vorbisBlockSize)?$:null},t),(0,b.assert)(Y),J=this.encodedPacketToMetadata.get(Y),(0,b.assert)(J)),K=Y,X=J,O&&(Math.max(U,0)>r||Math.max(J.timestampInSamples,0)===r)))return[3,24];return[4,this.demuxer.findNextPacketStart(Q)];case 23:if(!(ee=f.sent()))return[3,24];return A=ee.startPage,R=ee.startSegmentIndex,[3,21];case 24:return[2,K]}})}).call(this)}},{key:"getPacketSequential",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s,o,c,u;return(0,f._)(this,function(l){switch(l.label){case 0:return[4,this.sequentialScanMutex.acquire()];case 1:r=l.sent(),l.label=2;case 2:if(l.trys.push([2,,9,10]),e=(n=(0,b.roundIfAlmostInteger)(e*this.internalSampleRate))/this.internalSampleRate,-1===(a=(0,b.binarySearchLessOrEqual)(this.sequentialScanCache,n,function(e){return e.timestampInSamples})))return[3,3];return s=this.sequentialScanCache[a],i=this.createEncodedPacketFromOggPacket(s.packet,{timestampInSamples:s.timestampInSamples,vorbisLastBlocksize:s.vorbisLastBlockSize},t),[3,5];case 3:return[4,this.getFirstPacket(t)];case 4:i=l.sent(),l.label=5;case 5:o=0,l.label=6;case 6:if(!(i&&i.timestamp<e))return[3,8];return[4,this.getNextPacket(i,t)];case 7:if(!(c=l.sent())||c.timestamp>e)return[3,8];return i=c,100==++o&&(o=0,u=this.encodedPacketToMetadata.get(i),(0,b.assert)(u),this.sequentialScanCache.length>0&&(0,b.assert)((0,b.last)(this.sequentialScanCache).timestampInSamples<=u.timestampInSamples),this.sequentialScanCache.push(u)),[3,6];case 8:return[2,i];case 9:return r(),[7];case 10:return[2]}})}).call(this)}},{key:"getKeyPacket",value:function(e,t){return this.getPacket(e,t)}},{key:"getNextKeyPacket",value:function(e,t){return this.getNextPacket(e,t)}}]),e}(),x=function(e,t,r){var n=t,a=r;e:for(;;){for(a--;a>=0;a--)if(n.lacingValues[a]<255){a++;break e}if((0,b.assert)(-1===a),!(1&n.headerType)){a=0;break}var i=(0,b.findLast)(e,function(e){return e.headerStartPos<n.headerStartPos});if(!i)return null;a=(n=i).lacingValues.length}if((0,b.assert)(-1!==a),a===n.lacingValues.length){var s=e[e.indexOf(n)+1];(0,b.assert)(s),n=s,a=0}return{page:n,segmentIndex:a}},I=function(e,t,r){if(r>0)return{page:t,segmentIndex:r-1};var n=(0,b.findLast)(e,function(e){return e.headerStartPos<t.headerStartPos});return n?{page:n,segmentIndex:n.lacingValues.length-1}:null}},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_object_spread.cjs":"kyoEj","@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","../codec.js":"fXWqW","../codec-data.js":"kWTYV","../demuxer.js":"d4thC","../input-track.js":"b22CJ","../metadata.js":"eSjom","../misc.js":"j7iGm","../packet.js":"QfqGG","../reader.js":"8KRfO","./ogg-misc.js":"g1LsD","./ogg-reader.js":"fY5up","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],g1LsD:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"OGGS",function(){return c}),a.export(r,"computeOggPageCrc",function(){return h}),a.export(r,"extractSampleMetadata",function(){return m}),a.export(r,"buildOggMimeType",function(){return p});for(var i=e("@swc/helpers/cjs/_to_consumable_array.cjs"),s=e("../codec-data.js"),o=e("../misc.js"),c=0x5367674f,u=new Uint32Array(256),l=0;l<256;l++){for(var d=l<<24,f=0;f<8;f++)d=0x80000000&d?d<<1^0x4c11db7:d<<1;u[l]=d>>>0}var h=function(e){var t=(0,o.toDataView)(e),r=t.getUint32(22,!0);t.setUint32(22,0,!0);for(var n=0,a=0;a<e.length;a++)n=(n<<8^u[n>>>24^e[a]])>>>0;return t.setUint32(22,r,!0),n},m=function(e,t,r){var n=0,a=null;if(e.length>0)if("vorbis"===t.codec){(0,o.assert)(t.vorbisInfo);var i=t.vorbisInfo.modeBlockflags.length,c=(1<<(0,o.ilog)(i-1))-1<<1,u=(e[0]&c)>>1;if(u>=t.vorbisInfo.modeBlockflags.length)throw Error("Invalid mode number.");var l=r,d=t.vorbisInfo.modeBlockflags[u];if(a=t.vorbisInfo.blocksizes[d],1===d){var f=e[0]&(1|c)+1?1:0;l=t.vorbisInfo.blocksizes[f]}n=null!==l?l+a>>2:0}else"opus"===t.codec&&(n=(0,s.parseOpusTocByte)(e).durationInSamples);return{durationInSamples:n,vorbisBlockSize:a}},p=function(e){var t="audio/ogg";if(e.codecStrings){var r=(0,i._)(new Set(e.codecStrings));t+='; codecs="'.concat(r.join(", "),'"')}return t}},{"@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","../codec-data.js":"kWTYV","../misc.js":"j7iGm","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],fY5up:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"MIN_PAGE_HEADER_SIZE",function(){return o}),a.export(r,"MAX_PAGE_HEADER_SIZE",function(){return c}),a.export(r,"MAX_PAGE_SIZE",function(){return u}),a.export(r,"readPageHeader",function(){return l}),a.export(r,"findNextPageHeader",function(){return d});var i=e("../reader.js"),s=e("./ogg-misc.js"),o=27,c=282,u=65307,l=function(e){var t=e.filePos;if((0,i.readU32Le)(e)!==s.OGGS)return null;e.skip(1);for(var r=(0,i.readU8)(e),n=(0,i.readI64Le)(e),a=(0,i.readU32Le)(e),o=(0,i.readU32Le)(e),c=(0,i.readU32Le)(e),u=(0,i.readU8)(e),l=new Uint8Array(u),d=0;d<u;d++)l[d]=(0,i.readU8)(e);var f=27+u,h=l.reduce(function(e,t){return e+t},0);return{headerStartPos:t,totalSize:f+h,dataStartPos:t+f,dataSize:h,headerType:r,granulePosition:n,serialNumber:a,sequenceNumber:o,checksum:c,lacingValues:l}},d=function(e,t){for(;e.filePos<t-3;){var r=(0,i.readU32Le)(e),n=255&r,a=r>>>8&255,o=r>>>16&255,c=r>>>24&255;if(79===n||79===a||79===o||79===c){if(e.skip(-4),r===s.OGGS)return!0;e.skip(1)}}return!1}},{"../reader.js":"8KRfO","./ogg-misc.js":"g1LsD","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],cokSU:[function(e,t,r,n){var a,i,s=e("@parcel/transformer-js/src/esmodule-helpers.js");s.defineInteropFlag(r),s.export(r,"WaveFormat",function(){return i}),s.export(r,"WaveDemuxer",function(){return w});var o=e("@swc/helpers/cjs/_async_to_generator.cjs"),c=e("@swc/helpers/cjs/_call_super.cjs"),u=e("@swc/helpers/cjs/_class_call_check.cjs"),l=e("@swc/helpers/cjs/_create_class.cjs"),d=e("@swc/helpers/cjs/_inherits.cjs"),f=e("@swc/helpers/cjs/_object_spread.cjs"),h=e("@swc/helpers/cjs/_to_consumable_array.cjs"),m=e("@swc/helpers/cjs/_ts_generator.cjs"),p=e("../demuxer.js"),g=e("../input-track.js"),v=e("../metadata.js"),b=e("../misc.js"),y=e("../packet.js"),k=e("../reader.js"),_=e("../id3.js");(a=i||(i={}))[a.PCM=1]="PCM",a[a.IEEE_FLOAT=3]="IEEE_FLOAT",a[a.ALAW=6]="ALAW",a[a.MULAW=7]="MULAW",a[a.EXTENSIBLE=65534]="EXTENSIBLE";var w=function(e){"use strict";function t(e){var r;return(0,u._)(this,t),(r=(0,c._)(this,t,[e])).metadataPromise=null,r.dataStart=-1,r.dataSize=-1,r.audioInfo=null,r.tracks=[],r.lastKnownPacketIndex=0,r.metadataTags={},r.reader=e._reader,r}return(0,d._)(t,e),(0,l._)(t,[{key:"readMetadata",value:function(){return(0,o._)(function(){var e,t;return(0,m._)(this,function(r){return e=this,[2,null!=(t=this.metadataPromise)?t:this.metadataPromise=(0,o._)(function(){var e,t,r,n,a,i,s,o,c,u,l,d,f,h,p,v,y,_;return(0,m._)(this,function(m){switch(m.label){case 0:if(!((e=this.reader.requestSlice(0,12))instanceof Promise))return[3,2];return[4,e];case 1:e=m.sent(),m.label=2;case 2:if((0,b.assert)(e),r="RIFX"!==(t=(0,k.readAscii)(e,4)),n="RF64"===t,a=(0,k.readU32)(e,r),s=n?this.reader.fileSize:Math.min(a+8,null!=(i=this.reader.fileSize)?i:1/0),"WAVE"!==(0,k.readAscii)(e,4))throw Error("Invalid WAVE file - wrong format");o=0,c=null,u=e.filePos,m.label=3;case 3:if(!(null===s||u<s))return[3,16];if(!((l=this.reader.requestSlice(u,8))instanceof Promise))return[3,5];return[4,l];case 4:l=m.sent(),m.label=5;case 5:if(!l)return[3,16];if(d=(0,k.readAscii)(l,4),f=(0,k.readU32)(l,r),h=l.filePos,n&&0===o&&"ds64"!==d)throw Error('Invalid RF64 file: First chunk must be "ds64".');if("fmt "!==d)return[3,7];return[4,this.parseFmtChunk(h,f,r)];case 6:return m.sent(),[3,15];case 7:if("data"!==d)return[3,8];if(null!=c||(c=f),this.dataStart=l.filePos,this.dataSize=Math.min(c,(null!=s?s:1/0)-this.dataStart),null===this.reader.fileSize)return[3,16];return[3,15];case 8:if("ds64"!==d)return[3,11];if(!((p=this.reader.requestSlice(h,f))instanceof Promise))return[3,10];return[4,p];case 9:p=m.sent(),m.label=10;case 10:if(!p)return[3,16];return v=(0,k.readU64)(p,r),c=(0,k.readU64)(p,r),s=Math.min(v+8,null!=(y=this.reader.fileSize)?y:1/0),[3,15];case 11:if("LIST"!==d)return[3,13];return[4,this.parseListChunk(h,f,r)];case 12:return m.sent(),[3,15];case 13:if("ID3 "!==d&&"id3 "!==d)return[3,15];return[4,this.parseId3Chunk(h,f)];case 14:m.sent(),m.label=15;case 15:return u=h+f+(1&f),o++,[3,3];case 16:if(!this.audioInfo)throw Error('Invalid WAVE file - missing "fmt " chunk');if(-1===this.dataStart)throw Error('Invalid WAVE file - missing "data" chunk');return _=this.audioInfo.blockSizeInBytes,this.dataSize=Math.floor(this.dataSize/_)*_,this.tracks.push(new(0,g.InputAudioTrack)(this.input,new S(this))),[2]}})}).call(e)]})}).call(this)}},{key:"parseFmtChunk",value:function(e,t,r){return(0,o._)(function(){var n,a,s,o,c,u,l;return(0,m._)(this,function(d){switch(d.label){case 0:if(!((n=this.reader.requestSlice(e,t))instanceof Promise))return[3,2];return[4,n];case 1:n=d.sent(),d.label=2;case 2:if(!n)return[2];return a=(0,k.readU16)(n,r),s=(0,k.readU16)(n,r),o=(0,k.readU32)(n,r),n.skip(4),c=(0,k.readU16)(n,r),u=14===t?8:(0,k.readU16)(n,r),t>=18&&357!==a&&Math.min(t-18,(0,k.readU16)(n,r))>=22&&a===i.EXTENSIBLE&&(n.skip(6),a=(l=(0,k.readBytes)(n,16))[0]|l[1]<<8),(a===i.MULAW||a===i.ALAW)&&(u=8),this.audioInfo={format:a,numberOfChannels:s,sampleRate:o,sampleSizeInBytes:Math.ceil(u/8),blockSizeInBytes:c},[2]}})}).call(this)}},{key:"parseListChunk",value:function(e,t,r){return(0,o._)(function(){var n,a,i,s,o,c,u,l,d,f,p,g,v,b,y,_,w,S,T,x,I,E,j,P,C,A;return(0,m._)(this,function(m){switch(m.label){case 0:if(!((n=this.reader.requestSlice(e,t))instanceof Promise))return[3,2];return[4,n];case 1:n=m.sent(),m.label=2;case 2:if(!n||"INFO"!==(a=(0,k.readAscii)(n,4))&&"INF0"!==a)return[2];for(i=n.filePos;i<=e+t-8;){for(f=0,n.filePos=i,c=(0,k.readAscii)(n,4),u=(0,k.readU32)(n,r),l=(0,k.readBytes)(n,u),d=0;f<l.length&&0!==l[f];f++)d++;switch(p=(s=String).fromCharCode.apply(s,(0,h._)(l.subarray(0,d))),null!=(o=this.metadataTags).raw||(o.raw={}),this.metadataTags.raw[c]=p,c){case"INAM":case"TITL":null!=(g=this.metadataTags).title||(g.title=p);break;case"TIT3":null!=(v=this.metadataTags).description||(v.description=p);break;case"IART":null!=(b=this.metadataTags).artist||(b.artist=p);break;case"IPRD":null!=(y=this.metadataTags).album||(y.album=p);break;case"IPRT":case"ITRK":case"TRCK":T=Number.parseInt((S=p.split("/"))[0],10),x=S[1]&&Number.parseInt(S[1],10),Number.isInteger(T)&&T>0&&(null!=(_=this.metadataTags).trackNumber||(_.trackNumber=T)),x&&Number.isInteger(x)&&x>0&&(null!=(w=this.metadataTags).tracksTotal||(w.tracksTotal=x));break;case"ICRD":case"IDIT":Number.isNaN((E=new Date(p)).getTime())||null!=(I=this.metadataTags).date||(I.date=E);break;case"YEAR":Number.isInteger(P=Number.parseInt(p,10))&&P>0&&(null!=(j=this.metadataTags).date||(j.date=new Date(P,0,1)));break;case"IGNR":case"GENR":null!=(C=this.metadataTags).genre||(C.genre=p);break;case"ICMT":case"CMNT":case"COMM":null!=(A=this.metadataTags).comment||(A.comment=p)}i+=8+u+(1&u)}return[2]}})}).call(this)}},{key:"parseId3Chunk",value:function(e,t){return(0,o._)(function(){var r,n,a;return(0,m._)(this,function(i){switch(i.label){case 0:if(!((r=this.reader.requestSlice(e,t))instanceof Promise))return[3,2];return[4,r];case 1:r=i.sent(),i.label=2;case 2:if(!r)return[2];return(n=(0,_.readId3V2Header)(r))&&(a=r.slice(e+10,n.size),(0,_.parseId3V2Tag)(a,n,this.metadataTags)),[2]}})}).call(this)}},{key:"getCodec",value:function(){if((0,b.assert)(this.audioInfo),this.audioInfo.format===i.MULAW)return"ulaw";if(this.audioInfo.format===i.ALAW)return"alaw";if(this.audioInfo.format===i.PCM){if(1===this.audioInfo.sampleSizeInBytes)return"pcm-u8";else if(2===this.audioInfo.sampleSizeInBytes)return"pcm-s16";else if(3===this.audioInfo.sampleSizeInBytes)return"pcm-s24";else if(4===this.audioInfo.sampleSizeInBytes)return"pcm-s32"}return this.audioInfo.format===i.IEEE_FLOAT&&4===this.audioInfo.sampleSizeInBytes?"pcm-f32":null}},{key:"getMimeType",value:function(){return(0,o._)(function(){return(0,m._)(this,function(e){return[2,"audio/wav"]})})()}},{key:"computeDuration",value:function(){return(0,o._)(function(){var e;return(0,m._)(this,function(t){switch(t.label){case 0:return[4,this.readMetadata()];case 1:return t.sent(),e=this.tracks[0],(0,b.assert)(e),[2,e.computeDuration()]}})}).call(this)}},{key:"getTracks",value:function(){return(0,o._)(function(){return(0,m._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),[2,this.tracks]}})}).call(this)}},{key:"getMetadataTags",value:function(){return(0,o._)(function(){return(0,m._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),[2,this.metadataTags]}})}).call(this)}}]),t}(p.Demuxer),S=function(){"use strict";function e(t){(0,u._)(this,e),this.demuxer=t}return(0,l._)(e,[{key:"getId",value:function(){return 1}},{key:"getCodec",value:function(){return this.demuxer.getCodec()}},{key:"getInternalCodecId",value:function(){return(0,b.assert)(this.demuxer.audioInfo),this.demuxer.audioInfo.format}},{key:"getDecoderConfig",value:function(){return(0,o._)(function(){var e;return(0,m._)(this,function(t){return(e=this.demuxer.getCodec())?((0,b.assert)(this.demuxer.audioInfo),[2,{codec:e,numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate}]):[2,null]})}).call(this)}},{key:"computeDuration",value:function(){return(0,o._)(function(){var e,t,r;return(0,m._)(this,function(n){switch(n.label){case 0:return[4,this.getPacket(1/0,{metadataOnly:!0})];case 1:return[2,(null!=(t=null==(e=n.sent())?void 0:e.timestamp)?t:0)+(null!=(r=null==e?void 0:e.duration)?r:0)]}})}).call(this)}},{key:"getNumberOfChannels",value:function(){return(0,b.assert)(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}},{key:"getSampleRate",value:function(){return(0,b.assert)(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}},{key:"getTimeResolution",value:function(){return(0,b.assert)(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}},{key:"getName",value:function(){return null}},{key:"getLanguageCode",value:function(){return b.UNDETERMINED_LANGUAGE}},{key:"getDisposition",value:function(){return(0,f._)({},v.DEFAULT_TRACK_DISPOSITION)}},{key:"getFirstTimestamp",value:function(){return(0,o._)(function(){return(0,m._)(this,function(e){return[2,0]})})()}},{key:"getPacketAtIndex",value:function(e,t){return(0,o._)(function(){var r,n,a,i,s,o,c;return(0,m._)(this,function(u){switch(u.label){case 0:if((0,b.assert)(this.demuxer.audioInfo),(r=2048*e*this.demuxer.audioInfo.blockSizeInBytes)>=this.demuxer.dataSize)return[2,null];if(n=Math.min(2048*this.demuxer.audioInfo.blockSizeInBytes,this.demuxer.dataSize-r),null!==this.demuxer.reader.fileSize)return[3,3];if(!((a=this.demuxer.reader.requestSlice(this.demuxer.dataStart+r,n))instanceof Promise))return[3,2];return[4,a];case 1:a=u.sent(),u.label=2;case 2:if(!a)return[2,null];u.label=3;case 3:if(!t.metadataOnly)return[3,4];return i=y.PLACEHOLDER_DATA,[3,7];case 4:if(!((s=this.demuxer.reader.requestSlice(this.demuxer.dataStart+r,n))instanceof Promise))return[3,6];return[4,s];case 5:s=u.sent(),u.label=6;case 6:(0,b.assert)(s),i=(0,k.readBytes)(s,n),u.label=7;case 7:return o=2048*e/this.demuxer.audioInfo.sampleRate,c=n/this.demuxer.audioInfo.blockSizeInBytes/this.demuxer.audioInfo.sampleRate,this.demuxer.lastKnownPacketIndex=Math.max(e,o),[2,new(0,y.EncodedPacket)(i,"key",o,c,e,n)]}})}).call(this)}},{key:"getFirstPacket",value:function(e){return this.getPacketAtIndex(0,e)}},{key:"getPacket",value:function(e,t){return(0,o._)(function(){var r,n,a,i;return(0,m._)(this,function(s){switch(s.label){case 0:return(0,b.assert)(this.demuxer.audioInfo),r=Math.floor(Math.min(e*this.demuxer.audioInfo.sampleRate/2048,(this.demuxer.dataSize-1)/(2048*this.demuxer.audioInfo.blockSizeInBytes))),[4,this.getPacketAtIndex(r,t)];case 1:if(n=s.sent())return[2,n];if(0===r)return[2,null];return(0,b.assert)(null===this.demuxer.reader.fileSize),[4,this.getPacketAtIndex(this.demuxer.lastKnownPacketIndex,t)];case 2:a=s.sent(),s.label=3;case 3:if(!a)return[3,5];return[4,this.getNextPacket(a,t)];case 4:if(!(i=s.sent()))return[3,5];return a=i,[3,3];case 5:return[2,a]}})}).call(this)}},{key:"getNextPacket",value:function(e,t){(0,b.assert)(this.demuxer.audioInfo);var r=Math.round(e.timestamp*this.demuxer.audioInfo.sampleRate/2048);return this.getPacketAtIndex(r+1,t)}},{key:"getKeyPacket",value:function(e,t){return this.getPacket(e,t)}},{key:"getNextKeyPacket",value:function(e,t){return this.getNextPacket(e,t)}}]),e}()},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_object_spread.cjs":"kyoEj","@swc/helpers/cjs/_to_consumable_array.cjs":"i81N6","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","../demuxer.js":"d4thC","../input-track.js":"b22CJ","../metadata.js":"eSjom","../misc.js":"j7iGm","../packet.js":"QfqGG","../reader.js":"8KRfO","../id3.js":"42Y2c","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"5AUBv":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"MIN_FRAME_HEADER_SIZE",function(){return o}),a.export(r,"MAX_FRAME_HEADER_SIZE",function(){return c}),a.export(r,"readFrameHeader",function(){return u});var i=e("../misc.js"),s=e("../reader.js"),o=7,c=9,u=function(e){var t=e.filePos,r=(0,s.readBytes)(e,9),n=new(0,i.Bitstream)(r);if(4095!==n.readBits(12)||(n.skipBits(1),0!==n.readBits(2)))return null;var a=n.readBits(1),o=n.readBits(2)+1,c=n.readBits(4);if(15===c)return null;n.skipBits(1);var u=n.readBits(3);if(0===u)throw Error("ADTS frames with channel configuration 0 are not supported.");n.skipBits(1),n.skipBits(1),n.skipBits(1),n.skipBits(1);var l=n.readBits(13);n.skipBits(11);var d=n.readBits(2)+1;if(1!==d)throw Error("ADTS frames with more than one AAC frame are not supported.");var f=null;return 1===a?e.filePos-=2:f=n.readBits(16),{objectType:o,samplingFrequencyIndex:c,channelConfiguration:u,frameLength:l,numberOfAacFrames:d,crcCheck:f,startPos:t}}},{"../misc.js":"j7iGm","../reader.js":"8KRfO","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"3t0bF":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"AdtsDemuxer",function(){return k});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_call_super.cjs"),o=e("@swc/helpers/cjs/_class_call_check.cjs"),c=e("@swc/helpers/cjs/_create_class.cjs"),u=e("@swc/helpers/cjs/_inherits.cjs"),l=e("@swc/helpers/cjs/_object_spread.cjs"),d=e("@swc/helpers/cjs/_ts_generator.cjs"),f=e("../codec.js"),h=e("../demuxer.js"),m=e("../input-track.js"),p=e("../misc.js"),g=e("../packet.js"),v=e("../reader.js"),b=e("../metadata.js"),y=e("./adts-reader.js"),k=function(e){"use strict";function t(e){var r;return(0,o._)(this,t),(r=(0,s._)(this,t,[e])).metadataPromise=null,r.firstFrameHeader=null,r.loadedSamples=[],r.tracks=[],r.readingMutex=new(0,p.AsyncMutex),r.lastSampleLoaded=!1,r.lastLoadedPos=0,r.nextTimestampInSamples=0,r.reader=e._reader,r}return(0,u._)(t,e),(0,c._)(t,[{key:"readMetadata",value:function(){return(0,i._)(function(){var e,t;return(0,d._)(this,function(r){return e=this,[2,null!=(t=this.metadataPromise)?t:this.metadataPromise=(0,i._)(function(){return(0,d._)(this,function(e){switch(e.label){case 0:if(!(!this.firstFrameHeader&&!this.lastSampleLoaded))return[3,2];return[4,this.advanceReader()];case 1:return e.sent(),[3,0];case 2:return(0,p.assert)(this.firstFrameHeader),this.tracks=[new(0,m.InputAudioTrack)(this.input,new _(this))],[2]}})}).call(e)]})}).call(this)}},{key:"advanceReader",value:function(){return(0,i._)(function(){var e,t,r,n,a,i;return(0,d._)(this,function(s){switch(s.label){case 0:if(!((e=this.reader.requestSliceRange(this.lastLoadedPos,y.MIN_FRAME_HEADER_SIZE,y.MAX_FRAME_HEADER_SIZE))instanceof Promise))return[3,2];return[4,e];case 1:e=s.sent(),s.label=2;case 2:if(!e||!(t=(0,y.readFrameHeader)(e))||null!==this.reader.fileSize&&t.startPos+t.frameLength>this.reader.fileSize)return this.lastSampleLoaded=!0,[2];return this.firstFrameHeader||(this.firstFrameHeader=t),r=f.aacFrequencyTable[t.samplingFrequencyIndex],(0,p.assert)(void 0!==r),n=1024/r,a=t.crcCheck?y.MAX_FRAME_HEADER_SIZE:y.MIN_FRAME_HEADER_SIZE,i={timestamp:this.nextTimestampInSamples/r,duration:n,dataStart:t.startPos+a,dataSize:t.frameLength-a},this.loadedSamples.push(i),this.nextTimestampInSamples+=1024,this.lastLoadedPos=t.startPos+t.frameLength,[2]}})}).call(this)}},{key:"getMimeType",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){return[2,"audio/aac"]})})()}},{key:"getTracks",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),[2,this.tracks]}})}).call(this)}},{key:"computeDuration",value:function(){return(0,i._)(function(){var e;return(0,d._)(this,function(t){switch(t.label){case 0:return[4,this.readMetadata()];case 1:return t.sent(),e=this.tracks[0],(0,p.assert)(e),[2,e.computeDuration()]}})}).call(this)}},{key:"getMetadataTags",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){return[2,{}]})})()}}]),t}(h.Demuxer),_=function(){"use strict";function e(t){(0,o._)(this,e),this.demuxer=t}return(0,c._)(e,[{key:"getId",value:function(){return 1}},{key:"getFirstTimestamp",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){return[2,0]})})()}},{key:"getTimeResolution",value:function(){return this.getSampleRate()/1024}},{key:"computeDuration",value:function(){return(0,i._)(function(){var e,t,r;return(0,d._)(this,function(n){switch(n.label){case 0:return[4,this.getPacket(1/0,{metadataOnly:!0})];case 1:return[2,(null!=(t=null==(e=n.sent())?void 0:e.timestamp)?t:0)+(null!=(r=null==e?void 0:e.duration)?r:0)]}})}).call(this)}},{key:"getName",value:function(){return null}},{key:"getLanguageCode",value:function(){return p.UNDETERMINED_LANGUAGE}},{key:"getCodec",value:function(){return"aac"}},{key:"getInternalCodecId",value:function(){return(0,p.assert)(this.demuxer.firstFrameHeader),this.demuxer.firstFrameHeader.objectType}},{key:"getNumberOfChannels",value:function(){(0,p.assert)(this.demuxer.firstFrameHeader);var e=f.aacChannelMap[this.demuxer.firstFrameHeader.channelConfiguration];return(0,p.assert)(void 0!==e),e}},{key:"getSampleRate",value:function(){(0,p.assert)(this.demuxer.firstFrameHeader);var e=f.aacFrequencyTable[this.demuxer.firstFrameHeader.samplingFrequencyIndex];return(0,p.assert)(void 0!==e),e}},{key:"getDisposition",value:function(){return(0,l._)({},b.DEFAULT_TRACK_DISPOSITION)}},{key:"getDecoderConfig",value:function(){return(0,i._)(function(){var e,t,r,n,a,i;return(0,d._)(this,function(s){return(0,p.assert)(this.demuxer.firstFrameHeader),e=new Uint8Array(3),t=new(0,p.Bitstream)(e),n=(r=this.demuxer.firstFrameHeader).objectType,a=r.samplingFrequencyIndex,i=r.channelConfiguration,n>31?(t.writeBits(5,31),t.writeBits(6,n-32)):t.writeBits(5,n),t.writeBits(4,a),t.writeBits(4,i),[2,{codec:"mp4a.40.".concat(this.demuxer.firstFrameHeader.objectType),numberOfChannels:this.getNumberOfChannels(),sampleRate:this.getSampleRate(),description:e.subarray(0,Math.ceil((t.pos-1)/8))}]})}).call(this)}},{key:"getPacketAtIndex",value:function(e,t){return(0,i._)(function(){var r,n,a;return(0,d._)(this,function(i){switch(i.label){case 0:if(-1===e||!(r=this.demuxer.loadedSamples[e]))return[2,null];if(!t.metadataOnly)return[3,1];return n=g.PLACEHOLDER_DATA,[3,4];case 1:if(!((a=this.demuxer.reader.requestSlice(r.dataStart,r.dataSize))instanceof Promise))return[3,3];return[4,a];case 2:a=i.sent(),i.label=3;case 3:if(!a)return[2,null];n=(0,v.readBytes)(a,r.dataSize),i.label=4;case 4:return[2,new(0,g.EncodedPacket)(n,"key",r.timestamp,r.duration,e,r.dataSize)]}})}).call(this)}},{key:"getFirstPacket",value:function(e){return this.getPacketAtIndex(0,e)}},{key:"getNextPacket",value:function(e,t){return(0,i._)(function(){var r,n,a;return(0,d._)(this,function(i){switch(i.label){case 0:return[4,this.demuxer.readingMutex.acquire()];case 1:r=i.sent(),i.label=2;case 2:if(i.trys.push([2,,6,7]),-1===(n=(0,p.binarySearchExact)(this.demuxer.loadedSamples,e.timestamp,function(e){return e.timestamp})))throw Error("Packet was not created from this track.");a=n+1,i.label=3;case 3:if(!(a>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded))return[3,5];return[4,this.demuxer.advanceReader()];case 4:return i.sent(),[3,3];case 5:return[2,this.getPacketAtIndex(a,t)];case 6:return r(),[7];case 7:return[2]}})}).call(this)}},{key:"getPacket",value:function(e,t){return(0,i._)(function(){var r,n;return(0,d._)(this,function(a){switch(a.label){case 0:return[4,this.demuxer.readingMutex.acquire()];case 1:r=a.sent(),a.label=2;case 2:a.trys.push([2,,6,7]),a.label=3;case 3:if(-1===(n=(0,p.binarySearchLessOrEqual)(this.demuxer.loadedSamples,e,function(e){return e.timestamp}))&&this.demuxer.loadedSamples.length>0)return[2,null];if(this.demuxer.lastSampleLoaded||n>=0&&n+1<this.demuxer.loadedSamples.length)return[2,this.getPacketAtIndex(n,t)];return[4,this.demuxer.advanceReader()];case 4:return a.sent(),[3,3];case 5:return[3,7];case 6:return r(),[7];case 7:return[2]}})}).call(this)}},{key:"getKeyPacket",value:function(e,t){return this.getPacket(e,t)}},{key:"getNextKeyPacket",value:function(e,t){return this.getNextPacket(e,t)}}]),e}()},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_object_spread.cjs":"kyoEj","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","../codec.js":"fXWqW","../demuxer.js":"d4thC","../input-track.js":"b22CJ","../misc.js":"j7iGm","../packet.js":"QfqGG","../reader.js":"8KRfO","../metadata.js":"eSjom","./adts-reader.js":"5AUBv","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],e0w8C:[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"FlacDemuxer",function(){return k});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_call_super.cjs"),o=e("@swc/helpers/cjs/_class_call_check.cjs"),c=e("@swc/helpers/cjs/_create_class.cjs"),u=e("@swc/helpers/cjs/_inherits.cjs"),l=e("@swc/helpers/cjs/_object_spread.cjs"),d=e("@swc/helpers/cjs/_ts_generator.cjs"),f=e("../codec-data.js"),h=e("../demuxer.js"),m=e("../input-track.js"),p=e("../misc.js"),g=e("../packet.js"),v=e("../reader.js"),b=e("../metadata.js"),y=e("./flac-misc.js"),k=function(e){"use strict";function t(e){var r;return(0,o._)(this,t),(r=(0,s._)(this,t,[e])).loadedSamples=[],r.metadataPromise=null,r.track=null,r.metadataTags={},r.audioInfo=null,r.lastLoadedPos=null,r.blockingBit=null,r.readingMutex=new(0,p.AsyncMutex),r.lastSampleLoaded=!1,r.reader=e._reader,r}return(0,u._)(t,e),(0,c._)(t,[{key:"computeDuration",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),(0,p.assert)(this.track),[2,this.track.computeDuration()]}})}).call(this)}},{key:"getMetadataTags",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),[2,this.metadataTags]}})}).call(this)}},{key:"getTracks",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){switch(e.label){case 0:return[4,this.readMetadata()];case 1:return e.sent(),(0,p.assert)(this.track),[2,[this.track]]}})}).call(this)}},{key:"getMimeType",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){return[2,"audio/flac"]})})()}},{key:"readMetadata",value:function(){return(0,i._)(function(){var e,t,r;return(0,d._)(this,function(n){return e=this,t=4,[2,null!=(r=this.metadataPromise)?r:this.metadataPromise=(0,i._)(function(){var e,r,n,a,i,s,o,c,u,l,h,g,b,y,k,w,S,T,x,I,E,j,P,C,A;return(0,d._)(this,function(d){switch(d.label){case 0:if(!(null===this.reader.fileSize||t<this.reader.fileSize))return[3,14];if(!((e=this.reader.requestSlice(t,4))instanceof Promise))return[3,2];return[4,e];case 1:e=d.sent(),d.label=2;case 2:if(t+=4,null===e)throw Error("Metadata block at position ".concat(t," is too small! Corrupted file."));switch((0,p.assert)(e),r=(0,v.readU8)(e),n=(0,v.readU24Be)(e),a=(128&r)!=0,127&r){case f.FlacBlockType.STREAMINFO:return[3,3];case f.FlacBlockType.VORBIS_COMMENT:return[3,6];case f.FlacBlockType.PICTURE:return[3,9]}return[3,12];case 3:if(!((i=this.reader.requestSlice(t,n))instanceof Promise))return[3,5];return[4,i];case 4:i=d.sent(),d.label=5;case 5:if((0,p.assert)(i),null===i)throw Error("StreamInfo block at position ".concat(t," is too small! Corrupted file."));return s=(0,v.readBytes)(i,34),c=(o=new(0,p.Bitstream)(s)).readBits(16),u=o.readBits(16),l=o.readBits(24),h=o.readBits(24),g=o.readBits(20),b=o.readBits(3)+1,o.readBits(5),y=o.readBits(36),o.skipBits(128),(k=new Uint8Array(42)).set(new Uint8Array([102,76,97,67]),0),k.set(new Uint8Array([128,0,0,34]),4),k.set(s,8),this.audioInfo={numberOfChannels:b,sampleRate:g,totalSamples:y,minimumBlockSize:c,maximumBlockSize:u,minimumFrameSize:l,maximumFrameSize:h,description:k},this.track=new(0,m.InputAudioTrack)(this.input,new _(this)),[3,13];case 6:if(!((w=this.reader.requestSlice(t,n))instanceof Promise))return[3,8];return[4,w];case 7:w=d.sent(),d.label=8;case 8:return(0,p.assert)(w),(0,f.readVorbisComments)((0,v.readBytes)(w,n),this.metadataTags),[3,13];case 9:if(!((T=this.reader.requestSlice(t,n))instanceof Promise))return[3,11];return[4,T];case 10:T=d.sent(),d.label=11;case 11:return(0,p.assert)(T),x=(0,v.readU32Be)(T),I=(0,v.readU32Be)(T),E=p.textDecoder.decode((0,v.readBytes)(T,I)),j=(0,v.readU32Be)(T),P=p.textDecoder.decode((0,v.readBytes)(T,j)),T.skip(16),C=(0,v.readU32Be)(T),A=(0,v.readBytes)(T,C),null!=(S=this.metadataTags).images||(S.images=[]),this.metadataTags.images.push({data:A,mimeType:E,kind:3===x?"coverFront":4===x?"coverBack":"unknown",description:P}),[3,13];case 12:return[3,13];case 13:if(t+=n,a)return this.lastLoadedPos=t,[3,14];return[3,0];case 14:return[2]}})}).call(e)]})}).call(this)}},{key:"readNextFlacFrame",value:function(e){return(0,i._)(function(e){var t,r,n,a,i,s,o,c,u;return(0,d._)(this,function(l){switch(l.label){case 0:return t=e.startPos,r=e.isFirstPacket,(0,p.assert)(this.audioInfo),n=6,a=this.audioInfo.maximumFrameSize+16,[4,this.reader.requestSliceRange(t,this.audioInfo.minimumFrameSize,a)];case 1:if(!(i=l.sent())||!(s=this.readFlacFrameHeader({slice:i,isFirstPacket:r})))return[2,null];for(i.filePos=t+this.audioInfo.minimumFrameSize;;){if(i.filePos>i.end-n)return[2,{num:s.num,blockSize:s.blockSize,sampleRate:s.sampleRate,size:i.end-t,isLastFrame:!0}];if(255===(0,v.readU8)(i)){if(o=i.filePos,(0,v.readU8)(i)!==(1===this.blockingBit?249:248)||(i.skip(-2),c=i.filePos-t,!(u=this.readFlacFrameHeader({slice:i,isFirstPacket:!1})))){i.filePos=o;continue}if(0===this.blockingBit){if(u.num-s.num!=1){i.filePos=o;continue}}else if(u.num-s.num!==s.blockSize){i.filePos=o;continue}return[2,{num:s.num,blockSize:s.blockSize,sampleRate:s.sampleRate,size:c,isLastFrame:!1}]}}return[2]}})}).apply(this,arguments)}},{key:"readFlacFrameHeader",value:function(e){var t=e.slice,r=e.isFirstPacket,n=t.filePos,a=(0,v.readBytes)(t,4),i=new(0,p.Bitstream)(a);if(32764!==i.readBits(15))return null;if(null===this.blockingBit){(0,p.assert)(r);var s=i.readBits(1);this.blockingBit=s}else if(1===this.blockingBit){if((0,p.assert)(!r),1!==i.readBits(1))return null}else if(0===this.blockingBit){if((0,p.assert)(!r),0!==i.readBits(1))return null}else throw Error("Invalid blocking bit");var o=(0,y.getBlockSizeOrUncommon)(i.readBits(4));if(!o)return null;(0,p.assert)(this.audioInfo);var c=(0,y.getSampleRateOrUncommon)(i.readBits(4),this.audioInfo.sampleRate);if(!c||(i.readBits(4),i.readBits(3),0!==i.readBits(1)))return null;var u=(0,y.readCodedNumber)(t),l=(0,y.readBlockSize)(t,o),d=(0,y.readSampleRate)(t,c);if(null===d||d!==this.audioInfo.sampleRate)return null;var f=t.filePos-n,h=(0,v.readU8)(t);return(t.skip(-f),t.skip(-1),h!==(0,y.calculateCrc8)((0,v.readBytes)(t,f)))?null:{num:u,blockSize:l,sampleRate:d}}},{key:"advanceReader",value:function(){return(0,i._)(function(){var e,t,r,n;return(0,d._)(this,function(a){switch(a.label){case 0:return[4,this.readMetadata()];case 1:return a.sent(),(0,p.assert)(null!==this.lastLoadedPos),(0,p.assert)(this.audioInfo),e=this.lastLoadedPos,[4,this.readNextFlacFrame({startPos:e,isFirstPacket:0===this.loadedSamples.length})];case 2:if(!(t=a.sent()))return this.lastSampleLoaded=!0,[2];return n={blockOffset:(r=this.loadedSamples[this.loadedSamples.length-1])?r.blockOffset+r.blockSize:0,blockSize:t.blockSize,byteOffset:e,byteSize:t.size},this.lastLoadedPos=this.lastLoadedPos+t.size,this.loadedSamples.push(n),t.isLastFrame&&(this.lastSampleLoaded=!0),[2]}})}).call(this)}}]),t}(h.Demuxer),_=function(){"use strict";function e(t){(0,o._)(this,e),this.demuxer=t}return(0,c._)(e,[{key:"getId",value:function(){return 1}},{key:"getCodec",value:function(){return"flac"}},{key:"getInternalCodecId",value:function(){return null}},{key:"getNumberOfChannels",value:function(){return(0,p.assert)(this.demuxer.audioInfo),this.demuxer.audioInfo.numberOfChannels}},{key:"computeDuration",value:function(){return(0,i._)(function(){var e,t,r;return(0,d._)(this,function(n){switch(n.label){case 0:return[4,this.getPacket(1/0,{metadataOnly:!0})];case 1:return[2,(null!=(t=null==(e=n.sent())?void 0:e.timestamp)?t:0)+(null!=(r=null==e?void 0:e.duration)?r:0)]}})}).call(this)}},{key:"getSampleRate",value:function(){return(0,p.assert)(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}},{key:"getName",value:function(){return null}},{key:"getLanguageCode",value:function(){return p.UNDETERMINED_LANGUAGE}},{key:"getTimeResolution",value:function(){return(0,p.assert)(this.demuxer.audioInfo),this.demuxer.audioInfo.sampleRate}},{key:"getDisposition",value:function(){return(0,l._)({},b.DEFAULT_TRACK_DISPOSITION)}},{key:"getFirstTimestamp",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){return[2,0]})})()}},{key:"getDecoderConfig",value:function(){return(0,i._)(function(){return(0,d._)(this,function(e){return(0,p.assert)(this.demuxer.audioInfo),[2,{codec:"flac",numberOfChannels:this.demuxer.audioInfo.numberOfChannels,sampleRate:this.demuxer.audioInfo.sampleRate,description:this.demuxer.audioInfo.description}]})}).call(this)}},{key:"getPacket",value:function(e,t){return(0,i._)(function(){var r,n,a,i;return(0,d._)(this,function(s){switch(s.label){case 0:if(r=this,(0,p.assert)(this.demuxer.audioInfo),e<0)throw Error("Timestamp cannot be negative");return[4,this.demuxer.readingMutex.acquire()];case 1:n=s.sent(),s.label=2;case 2:s.trys.push([2,,9,10]),s.label=3;case 3:if(-1!==(a=(0,p.binarySearchLessOrEqual)(this.demuxer.loadedSamples,e,function(e){return e.blockOffset/r.demuxer.audioInfo.sampleRate})))return[3,5];return[4,this.demuxer.advanceReader()];case 4:case 6:return s.sent(),[3,3];case 5:if(!((i=this.demuxer.loadedSamples[a]).blockOffset/this.demuxer.audioInfo.sampleRate+i.blockSize/this.demuxer.audioInfo.sampleRate<=e))return[3,7];if(this.demuxer.lastSampleLoaded)return[2,this.getPacketAtIndex(this.demuxer.loadedSamples.length-1,t)];return[4,this.demuxer.advanceReader()];case 7:return[2,this.getPacketAtIndex(a,t)];case 8:return[3,10];case 9:return n(),[7];case 10:return[2]}})}).call(this)}},{key:"getNextPacket",value:function(e,t){return(0,i._)(function(){var r,n;return(0,d._)(this,function(a){switch(a.label){case 0:return[4,this.demuxer.readingMutex.acquire()];case 1:r=a.sent(),a.label=2;case 2:if(a.trys.push([2,,6,7]),n=e.sequenceNumber+1,this.demuxer.lastSampleLoaded&&n>=this.demuxer.loadedSamples.length)return[2,null];a.label=3;case 3:if(!(n>=this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded))return[3,5];return[4,this.demuxer.advanceReader()];case 4:return a.sent(),[3,3];case 5:return[2,this.getPacketAtIndex(n,t)];case 6:return r(),[7];case 7:return[2]}})}).call(this)}},{key:"getKeyPacket",value:function(e,t){return this.getPacket(e,t)}},{key:"getNextKeyPacket",value:function(e,t){return this.getNextPacket(e,t)}},{key:"getPacketAtIndex",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s;return(0,d._)(this,function(o){switch(o.label){case 0:if(!(r=this.demuxer.loadedSamples[e]))return[2,null];if(!t.metadataOnly)return[3,1];return n=g.PLACEHOLDER_DATA,[3,4];case 1:if(!((a=this.demuxer.reader.requestSlice(r.byteOffset,r.byteSize))instanceof Promise))return[3,3];return[4,a];case 2:a=o.sent(),o.label=3;case 3:if(!a)return[2,null];n=(0,v.readBytes)(a,r.byteSize),o.label=4;case 4:return(0,p.assert)(this.demuxer.audioInfo),i=r.blockOffset/this.demuxer.audioInfo.sampleRate,s=r.blockSize/this.demuxer.audioInfo.sampleRate,[2,new(0,g.EncodedPacket)(n,"key",i,s,e,r.byteSize)]}})}).call(this)}},{key:"getFirstPacket",value:function(e){return(0,i._)(function(){return(0,d._)(this,function(t){switch(t.label){case 0:if(!(0===this.demuxer.loadedSamples.length&&!this.demuxer.lastSampleLoaded))return[3,2];return[4,this.demuxer.advanceReader()];case 1:return t.sent(),[3,0];case 2:return[2,this.getPacketAtIndex(0,e)]}})}).call(this)}}]),e}()},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_call_super.cjs":"clpdF","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_inherits.cjs":"jtSwf","@swc/helpers/cjs/_object_spread.cjs":"kyoEj","@swc/helpers/cjs/_ts_generator.cjs":"eltGh","../codec-data.js":"kWTYV","../demuxer.js":"d4thC","../input-track.js":"b22CJ","../misc.js":"j7iGm","../packet.js":"QfqGG","../reader.js":"8KRfO","../metadata.js":"eSjom","./flac-misc.js":"4iR5P","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"4iR5P":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"getBlockSizeOrUncommon",function(){return o}),a.export(r,"getSampleRateOrUncommon",function(){return c}),a.export(r,"readCodedNumber",function(){return u}),a.export(r,"readBlockSize",function(){return l}),a.export(r,"readSampleRate",function(){return d}),a.export(r,"calculateCrc8",function(){return f});var i=e("../misc.js"),s=e("../reader.js"),o=function(e){if(0===e)return null;if(1===e)return 192;if(e>=2&&e<=5)return 144*Math.pow(2,e);if(6===e)return"uncommon-u8";if(7===e)return"uncommon-u16";else if(e>=8&&e<=15)return Math.pow(2,e);else return null},c=function(e,t){switch(e){case 0:return t;case 1:return 88200;case 2:return 176400;case 3:return 192e3;case 4:return 8e3;case 5:return 16e3;case 6:return 22050;case 7:return 24e3;case 8:return 32e3;case 9:return 44100;case 10:return 48e3;case 11:return 96e3;case 12:return"uncommon-u8";case 13:return"uncommon-u16";case 14:return"uncommon-u16-10";default:return null}},u=function(e){for(var t=0,r=new(0,i.Bitstream)((0,s.readBytes)(e,1));1===r.readBits(1);)t++;if(0===t)return r.readBits(7);for(var n=[],a=t-1,o=new(0,i.Bitstream)((0,s.readBytes)(e,a)),c=8-t-1,u=0;u<c;u++)n.unshift(r.readBits(1));for(var l=0;l<a;l++)for(var d=0;d<8;d++){var f=o.readBits(1);d<2||n.unshift(f)}return n.reduce(function(e,t,r){return e|t<<r},0)},l=function(e,t){return"uncommon-u16"===t?(0,s.readU16Be)(e)+1:"uncommon-u8"===t?(0,s.readU8)(e)+1:"number"==typeof t?t:void((0,i.assertNever)(t),(0,i.assert)(!1))},d=function(e,t){return"uncommon-u16"===t?(0,s.readU16Be)(e):"uncommon-u16-10"===t?10*(0,s.readU16Be)(e):"uncommon-u8"===t?(0,s.readU8)(e):"number"==typeof t?t:null},f=function(e){var t=0,r=!0,n=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value;t^=o;for(var c=0;c<8;c++)(128&t)!=0?t=t<<1^7:t<<=1,t&=255}}catch(e){n=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw a}}return t}},{"../misc.js":"j7iGm","../reader.js":"8KRfO","@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}],"952uz":[function(e,t,r,n){var a=e("@parcel/transformer-js/src/esmodule-helpers.js");a.defineInteropFlag(r),a.export(r,"default",function(){return l});var i=e("@swc/helpers/cjs/_async_to_generator.cjs"),s=e("@swc/helpers/cjs/_class_call_check.cjs"),o=e("@swc/helpers/cjs/_create_class.cjs"),c=e("@swc/helpers/cjs/_ts_generator.cjs"),u=e("mediabunny"),l=function(){"use strict";function e(t){var r=t.canvas,n=t.ctx,a=t.events,i=t.timeupdateInterval,o=t.avSyncTolerance,c=t.dropLateFrames,u=t.poster,l=t.preflightRange;(0,s._)(this,e),this.canvas=r,this.ctx=n,this.events=a,this.timeupdateInterval=void 0===i?250:i,this.avSyncTolerance=void 0===o?.12:o,this.dropLateFrames=void 0!==c&&c,this.poster=void 0===u?"":u,this.preflightRange=void 0!==l&&l,this.input=null,this.videoSink=null,this.videoIterator=null,this.nextFrame=null,this.rafId=0,this.asyncId=0,this.width=0,this.height=0,this.duration=NaN,this.audioClock=null,this.lastTimeUpdate=0,this.stalled=!1,this.playbackRate=1,this.posterDrawn=!1,this.isFetching=!1}return(0,o._)(e,[{key:"normalizeSource",value:function(e){return"string"==typeof e?new(0,u.UrlSource)(e):e instanceof Blob?new(0,u.BlobSource)(e):"u">typeof ReadableStream&&e instanceof ReadableStream?new(0,u.ReadableStreamSource)(e):e}},{key:"preflight",value:function(e){return(0,i._)(function(){var t;return(0,c._)(this,function(r){switch(r.label){case 0:if(!this.preflightRange||"string"!=typeof e)return[2,!0];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch(e,{method:"HEAD"})];case 2:if(!(t=r.sent().headers.get("accept-ranges"))||"none"===t)return this.events.emit("error",new Event("RangeNotSupported")),[2,!1];return[2,!0];case 3:return console.warn("Preflight check failed:",r.sent()),[2,!0];case 4:return[2]}})}).call(this)}},{key:"drawPoster",value:function(){var e=this;if(this.poster&&!this.posterDrawn){var t=new Image;t.onload=function(){e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height),e.canvas.width=t.naturalWidth||e.canvas.width,e.canvas.height=t.naturalHeight||e.canvas.height,e.ctx.drawImage(t,0,0,e.canvas.width,e.canvas.height),e.posterDrawn=!0},t.src=this.poster}}},{key:"stopIterator",value:function(){return(0,i._)(function(){var e;return(0,c._)(this,function(t){switch(t.label){case 0:return[4,null==(e=this.videoIterator)?void 0:e.return()];case 1:return t.sent(),this.videoIterator=null,[2]}})}).call(this)}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"load",value:function(e,t){return(0,i._)(function(){var r,n,a,i,s,o;return(0,c._)(this,function(c){switch(c.label){case 0:return r=++this.asyncId,[4,this.stopIterator()];case 1:return c.sent(),this.clear(),this.posterDrawn=!1,[4,this.preflight(e)];case 2:if(!c.sent())return[2];if(!(n=this.normalizeSource(e)))return this.drawPoster(),[2];return this.input=new(0,u.Input)({source:n,formats:u.ALL_FORMATS}),a=this,[4,this.input.computeDuration()];case 3:if(a.duration=c.sent(),r!==this.asyncId)return[2];return[4,this.input.getPrimaryVideoTrack()];case 4:if(!(i=c.sent()))return this.handleNoVideoTrack(),null==t||t(),[2];if(s=null===i.codec)return[3,6];return[4,i.canDecode()];case 5:s=!c.sent(),c.label=6;case 6:if(s)return this.handleNoVideoTrack(),null==t||t(),[2];return[4,i.canBeTransparent()];case 7:return o=c.sent(),this.videoSink=new(0,u.CanvasSink)(i,{poolSize:2,fit:"contain",alpha:o}),this.width=i.displayWidth,this.height=i.displayHeight,this.canvas.width=this.width,this.canvas.height=this.height,null==t||t(),[4,this.resetIterator(0)];case 8:return c.sent(),[2]}})}).call(this)}},{key:"handleNoVideoTrack",value:function(){this.videoSink=null,this.width=0,this.height=0,this.canvas.width=0,this.canvas.height=0,this.clear(),this.drawPoster()}},{key:"resetIterator",value:function(e){return(0,i._)(function(){var t,r,n,a;return(0,c._)(this,function(i){switch(i.label){case 0:return[4,this.stopIterator()];case 1:if(i.sent(),!this.videoSink)return[2];return this.videoIterator=this.videoSink.canvases(e),[4,this.videoIterator.next()];case 2:return r=null!=(t=i.sent().value)?t:null,[4,this.videoIterator.next()];case 3:return a=null!=(n=i.sent().value)?n:null,this.nextFrame=a,r?(this.ctx.drawImage(r.canvas,0,0),this.events.emit("loadeddata")):this.drawPoster(),[2]}})}).call(this)}},{key:"updateNextFrame",value:function(e){return(0,i._)(function(){var t,r,n,a;return(0,c._)(this,function(i){switch(i.label){case 0:if(!this.videoIterator||this.isFetching)return[2];this.isFetching=!0,i.label=1;case 1:i.trys.push([1,,5,6]),i.label=2;case 2:return[4,this.videoIterator.next()];case 3:if(!(r=null!=(t=i.sent().value)?t:null)||e!==this.asyncId)return[2];if(n=this.audioClock.currentTime,a=this.dropLateFrames?Math.max(.06,this.avSyncTolerance/Math.max(1,this.playbackRate)):0,this.dropLateFrames&&r.timestamp<n-a)return[3,2];if(!(r.timestamp<=n+a))return this.nextFrame=r,[2];if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(r.canvas,0,0),!this.dropLateFrames&&r.timestamp>n)return this.nextFrame=null,[2];return[3,2];case 4:return[3,6];case 5:return this.isFetching=!1,[7];case 6:return[2]}})}).call(this)}},{key:"render",value:function(){var e=this;if(this.audioClock){var t=this.audioClock.currentTime,r=Date.now();if(r-this.lastTimeUpdate>=this.timeupdateInterval&&(this.events.emit("timeupdate"),this.lastTimeUpdate=r),Number.isFinite(this.duration)&&t>=this.duration){this.stop(),this.stalled=!1,this.events.emit("ended"),this.events.emit("pause"),this.events.emit("canplay");return}this.nextFrame&&this.nextFrame.timestamp<=t?(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.nextFrame.canvas,0,0),this.nextFrame=null,this.updateNextFrame(this.asyncId),this.stalled&&(this.events.emit("canplay"),this.events.emit("playing"),this.stalled=!1)):!this.nextFrame&&(this.updateNextFrame(this.asyncId),!this.nextFrame&&Number.isFinite(this.duration)&&t<this.duration&&!this.stalled&&(this.stalled=!0,this.events.emit("waiting"))),this.rafId=requestAnimationFrame(function(){return e.render()})}}},{key:"start",value:function(e){var t=this;this.audioClock=e,this.asyncId++,this.stalled=!1,this.updateNextFrame(this.asyncId),this.rafId=requestAnimationFrame(function(){return t.render()})}},{key:"stop",value:function(){cancelAnimationFrame(this.rafId)}},{key:"seek",value:function(e){return(0,i._)(function(){return(0,c._)(this,function(t){switch(t.label){case 0:return this.asyncId++,[4,this.resetIterator(e)];case 1:return t.sent(),[2]}})}).call(this)}},{key:"setPlaybackRate",value:function(e){this.playbackRate=Math.max(.1,Number(e)||1)}},{key:"destroy",value:function(){this.asyncId++,this.stop(),this.stopIterator(),this.posterDrawn=!1,this.input=null,this.videoSink=null}}]),e}()},{"@swc/helpers/cjs/_async_to_generator.cjs":"cZn0e","@swc/helpers/cjs/_class_call_check.cjs":"4Uf9M","@swc/helpers/cjs/_create_class.cjs":"igUuK","@swc/helpers/cjs/_ts_generator.cjs":"eltGh",mediabunny:[["ALL_FORMATS","1jhAI"],["BlobSource","7vKle"],["ReadableStreamSource","7vKle"],["UrlSource","7vKle"],["CanvasSink","k0V9R"],["Input","3sapy"]],"@parcel/transformer-js/src/esmodule-helpers.js":"qpMMf"}]},["OIaIB"],"OIaIB","parcelRequire4dc0",{});