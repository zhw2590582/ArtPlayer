
/*!
 * artplayer-proxy-canvas.js v1.0.0
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2024 Harvey Zack
 * Released under the MIT License.
 */
!function(e,t,o,r,n){var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},a="function"==typeof i[r]&&i[r],l=a.cache||{},d="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function c(t,o){if(!l[t]){if(!e[t]){var n="function"==typeof i[r]&&i[r];if(!o&&n)return n(t,!0);if(a)return a(t,!0);if(d&&"string"==typeof t)return d(t);var u=Error("Cannot find module '"+t+"'");throw u.code="MODULE_NOT_FOUND",u}s.resolve=function(o){var r=e[t][1][o];return null!=r?r:o},s.cache={};var f=l[t]=new c.Module(t);e[t][0].call(f.exports,s,f,f.exports,this)}return l[t].exports;function s(e){var t=s.resolve(e);return!1===t?{}:c(t)}}c.isParcelRequire=!0,c.Module=function(e){this.id=e,this.bundle=c,this.exports={}},c.modules=e,c.cache=l,c.parent=a,c.register=function(t,o){e[t]=[function(e,t){t.exports=o},{}]},Object.defineProperty(c,"root",{get:function(){return i[r]}}),i[r]=c;for(var u=0;u<t.length;u++)c(t[u]);if(o){var f=c(o);"object"==typeof exports&&"undefined"!=typeof module?module.exports=f:"function"==typeof define&&define.amd&&define(function(){return f})}}({"16i3K":[function(e,t,o){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");function n(e){return t=>{let o;let{option:r,constructor:n}=t,{createElement:i,def:a,append:l,sleep:d}=n.utils,c=i("canvas"),u=c.getContext("2d"),f=i("video"),s=i("track");s.default=!0,s.kind="metadata",l(f,s);let p=null,{propertys:m,methods:h,prototypes:y,events:g}=n.config,v=[...m,...h,...y],b={};["width","height"].forEach(e=>{b[e]=Object.getOwnPropertyDescriptor(HTMLCanvasElement.prototype,e)}),v.forEach(e=>{"width"===e||"height"===e?a(c,e,{get(){return b[e].get.call(this)},set(t){b[e].set.call(this,t),f[e]=t}}):a(c,e,{get(){let t=f[e];return"function"==typeof t?t.bind(f):t},set(t){f[e]=t}})}),setTimeout(()=>{for(let e=0;e<g.length;e++){let o=g[e];t.proxy(f,o,e=>{t.emit(`video:${e.type}`,e)})}});let w=async()=>{if(!f.videoWidth||!f.videoHeight){console.log("Video dimensions not ready yet");return}try{if(f.readyState>=2){let e=await createImageBitmap(f);u.drawImage(e,0,0,c.width,c.height),e.close()}else console.log("Video not ready for frame extraction")}catch(e){console.error("Error drawing video frame:",e)}};"requestVideoFrameCallback"in HTMLVideoElement.prototype?o=()=>{w(),f.requestVideoFrameCallback(o)}:o=()=>{w(),p=requestAnimationFrame(o)};let x=()=>{try{let e,o;let n=t.template?.$player;if(!n||r.autoSize)return;let i=f.videoWidth/f.videoHeight,a=n.clientWidth,l=n.clientHeight;a/l>i?e=(o=l)*i:o=(e=a)/i,c.width=e,c.height=o;let d=(a-e)/2,u=(l-o)/2;Object.assign(c.style,{padding:`${u}px ${d}px`})}catch(e){console.error("Error in resize function:",e)}};return t.on("video:loadedmetadata",async()=>{c.width=f.videoWidth,c.height=f.videoHeight,await d(300),x(),w()}),t.on("video:play",()=>{"requestVideoFrameCallback"in HTMLVideoElement.prototype?f.requestVideoFrameCallback(o):(cancelAnimationFrame(p),p=requestAnimationFrame(o))}),t.on("video:pause",()=>{"requestVideoFrameCallback"in HTMLVideoElement.prototype||cancelAnimationFrame(p)}),t.on("resize",x),t.on("destroy",()=>{"requestVideoFrameCallback"in HTMLVideoElement.prototype?f.cancelVideoFrameCallback(o):cancelAnimationFrame(p)}),"function"==typeof e?e.call(t,f,r.url,t):f.src=r.url,c}}r.defineInteropFlag(o),r.export(o,"default",()=>n),"undefined"!=typeof window&&(window.artplayerProxyCanvas=n)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9pCYc"}],"9pCYc":[function(e,t,o){o.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},o.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.exportAll=function(e,t){return Object.keys(e).forEach(function(o){"default"===o||"__esModule"===o||Object.prototype.hasOwnProperty.call(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:function(){return e[o]}})}),t},o.export=function(e,t,o){Object.defineProperty(e,t,{enumerable:!0,get:o})}},{}]},["16i3K"],"16i3K","parcelRequire4dc0");