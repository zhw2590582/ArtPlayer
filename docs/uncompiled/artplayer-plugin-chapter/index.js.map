{"mappings":"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","sources":["packages/artplayer-plugin-chapter/src/index.js","node_modules/@parcel/runtime-js/lib/bundles/runtime-3c6e83237a7eb6ba.js","node_modules/@parcel/transformer-js/src/esmodule-helpers.js"],"sourcesContent":["import style from 'bundle-text:./style.less'\n\nexport default function artplayerPluginChapter(option = {}) {\n  return (art) => {\n    const { $player } = art.template\n    const { setStyle, append, clamp, query, addClass, removeClass } = art.constructor.utils\n\n    const html = `\n                <div class=\"art-chapter\">\n                    <div class=\"art-chapter-inner\">\n                        <div class=\"art-progress-hover\"></div>\n                        <div class=\"art-progress-loaded\"></div>\n                        <div class=\"art-progress-played\"></div>\n                    </div>\n                </div>\n        `\n\n    let $chapters = []\n\n    const $inner = art.query('.art-control-progress-inner')\n    const $control = append($inner, '<div class=\"art-chapters\"></div>')\n    const $title = append($inner, '<div class=\"art-chapter-title\"></div>')\n\n    function showTitle({ $chapter, width }) {\n      const title = $chapter.dataset.title.trim()\n      if (title) {\n        $title.textContent = title\n        const titleWidth = $title.clientWidth\n        if (width <= titleWidth / 2) {\n          setStyle($title, 'left', 0)\n        }\n        else if (width > $inner.clientWidth - titleWidth / 2) {\n          setStyle($title, 'left', `${$inner.clientWidth - titleWidth}px`)\n        }\n        else {\n          setStyle($title, 'left', `${width - titleWidth / 2}px`)\n        }\n      }\n    }\n\n    function update(chapters = []) {\n      $chapters = []\n      $control.textContent = ''\n      removeClass($player, 'artplayer-plugin-chapter')\n\n      if (!Array.isArray(chapters))\n        return\n      if (!chapters.length)\n        return\n      if (!art.duration)\n        return\n\n      chapters = chapters.sort((a, b) => a.start - b.start)\n\n      for (let i = 0; i < chapters.length; i++) {\n        const chapter = chapters[i]\n        const nextChapter = chapters[i + 1]\n\n        if (chapter.end === Infinity) {\n          chapter.end = art.duration\n        }\n\n        if (\n          typeof chapter.start !== 'number'\n          || typeof chapter.end !== 'number'\n          || typeof chapter.title !== 'string'\n        ) {\n          throw new TypeError('Illegal chapter data type')\n        }\n\n        if (chapter.start < 0 || chapter.end > art.duration || chapter.start >= chapter.end) {\n          throw new Error('Illegal chapter time point')\n        }\n\n        if (nextChapter && chapter.end > nextChapter.start) {\n          throw new Error('Illegal chapter time point')\n        }\n      }\n\n      if (chapters[0].start > 0) {\n        chapters.unshift({ start: 0, end: chapters[0].start, title: '' })\n      }\n\n      if (chapters[chapters.length - 1].end < art.duration) {\n        chapters.push({ start: chapters[chapters.length - 1].end, end: art.duration, title: '' })\n      }\n\n      for (let i = 0; i < chapters.length - 1; i++) {\n        if (chapters[i].end !== chapters[i + 1].start) {\n          chapters.splice(i + 1, 0, {\n            start: chapters[i].end,\n            end: chapters[i + 1].start,\n            title: '',\n          })\n        }\n      }\n\n      $chapters = chapters.map((chapter) => {\n        const $chapter = append($control, html)\n        const start = clamp(chapter.start, 0, art.duration)\n        const end = clamp(chapter.end, 0, art.duration)\n        const duration = end - start\n        const percentage = duration / art.duration\n        $chapter.dataset.start = start\n        $chapter.dataset.end = end\n        $chapter.dataset.duration = duration\n        $chapter.dataset.title = chapter.title.trim()\n        $chapter.style.width = `${percentage * 100}%`\n\n        return {\n          $chapter,\n          $hover: query('.art-progress-hover', $chapter),\n          $loaded: query('.art-progress-loaded', $chapter),\n          $played: query('.art-progress-played', $chapter),\n        }\n      })\n\n      addClass($player, 'artplayer-plugin-chapter')\n      art.emit('setBar', 'loaded', art.loaded || 0)\n    }\n\n    art.on('setBar', (type, percentage) => {\n      if (!$chapters.length)\n        return\n\n      for (let i = 0; i < $chapters.length; i++) {\n        const { $chapter, $loaded, $played, $hover } = $chapters[i]\n\n        const $target = {\n          hover: $hover,\n          loaded: $loaded,\n          played: $played,\n        }[type]\n\n        if (!$target)\n          return\n\n        const width = $control.clientWidth * percentage\n        const currentTime = art.duration * percentage\n        const duration = Number.parseFloat($chapter.dataset.duration)\n        const start = Number.parseFloat($chapter.dataset.start)\n        const end = Number.parseFloat($chapter.dataset.end)\n\n        if (currentTime < start) {\n          setStyle($target, 'width', 0)\n        }\n\n        if (currentTime > end) {\n          setStyle($target, 'width', '100%')\n        }\n\n        if (currentTime >= start && currentTime <= end) {\n          const percentage = (currentTime - start) / duration\n          setStyle($target, 'width', `${percentage * 100}%`)\n\n          if (type === 'hover' && width > 0) {\n            showTitle({ $chapter, width })\n          }\n        }\n      }\n    })\n\n    art.once('video:loadedmetadata', () => update(option.chapters))\n\n    return {\n      name: 'artplayerPluginChapter',\n      update: ({ chapters }) => update(chapters),\n    }\n  }\n}\n\nif (typeof document !== 'undefined') {\n  const id = 'artplayer-plugin-chapter'\n  let $style = document.getElementById(id)\n  if (!$style) {\n    $style = document.createElement('style')\n    $style.id = id\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', () => {\n        document.head.appendChild($style)\n      })\n    }\n    else {\n      (document.head || document.documentElement).appendChild($style)\n    }\n  }\n  $style.textContent = style\n}\n\nif (typeof window !== 'undefined') {\n  window.artplayerPluginChapter = artplayerPluginChapter\n}\n","module.exports = \"71df1ebf262c9f10\";","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n"],"names":[],"version":3,"file":"index.js.map","sourceRoot":"../../../"}