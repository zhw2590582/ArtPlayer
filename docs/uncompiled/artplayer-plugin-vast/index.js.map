{"mappings":"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","sources":["packages/artplayer-plugin-vast/src/index.js","node_modules/@parcel/transformer-js/src/esmodule-helpers.js"],"sourcesContent":["const DEFAULT_SDK_URL = 'https://imasdk.googleapis.com/js/sdkloader/ima3.js'\n\nconst STATES = Object.freeze({\n  IDLE: 'idle',\n  SDK_LOADING: 'sdk_loading',\n  READY: 'ready',\n  REQUESTING: 'requesting',\n  AD_PLAYING: 'ad_playing',\n  AD_PAUSED: 'ad_paused',\n  COMPLETED: 'completed',\n  ERROR: 'error',\n  DESTROYED: 'destroyed',\n})\n\nconst EVENTS = Object.freeze({\n  READY: 'ready',\n  SDK_LOADED: 'sdkLoaded',\n  ADS_MANAGER_LOADED: 'adsManagerLoaded',\n  AD_LOADED: 'adLoaded',\n  AD_STARTED: 'adStarted',\n  AD_PAUSED: 'adPaused',\n  AD_RESUMED: 'adResumed',\n  AD_SKIPPED: 'adSkipped',\n  AD_COMPLETE: 'adComplete',\n  ALL_ADS_COMPLETED: 'allAdsCompleted',\n  AD_ERROR: 'adError',\n  AD_CLICK: 'adClick',\n  CONTENT_PAUSE_REQUESTED: 'contentPauseRequested',\n  CONTENT_RESUME_REQUESTED: 'contentResumeRequested',\n})\n\nconst globalImaLoaderKey = '__ARTPLAYER_IMA_SDK_PROMISE__'\n\nfunction getGlobal() {\n  // eslint-disable-next-line no-new-func\n  return new Function('return this')()\n}\n\nfunction once(fn) {\n  let called = false\n  let result\n  return function (...args) {\n    if (called)\n      return result\n    called = true\n    result = fn.apply(this, args)\n    return result\n  }\n}\n\n// 优化工具：防抖函数\nfunction debounce(fn, ms = 200) {\n  let timer\n  return (...args) => {\n    if (timer)\n      clearTimeout(timer)\n    timer = setTimeout(() => fn.apply(this, args), ms)\n  }\n}\n\nfunction safeCall(fn) {\n  try {\n    return fn()\n  }\n  catch (e) {\n    return undefined\n  }\n}\n\nfunction clampZIndex(v) {\n  const n = Number(v)\n  if (!Number.isFinite(n))\n    return 150\n  return Math.max(1, Math.min(2147483647, Math.floor(n)))\n}\n\n/**\n * SDK loader (全局单例模式，防止多次加载)\n */\nfunction loadImaSdk(sdkUrl) {\n  const g = getGlobal()\n  if (g.google && g.google.ima)\n    return Promise.resolve(g.google.ima)\n\n  if (!g[globalImaLoaderKey]) {\n    g[globalImaLoaderKey] = new Promise((resolve, reject) => {\n      const script = document.createElement('script')\n      script.src = sdkUrl || DEFAULT_SDK_URL\n      script.async = true\n      script.onload = () => {\n        if (g.google && g.google.ima)\n          resolve(g.google.ima)\n        else reject(new Error('IMA SDK loaded but window.google.ima is missing'))\n      }\n      script.onerror = () => reject(new Error('Failed to load IMA SDK script'))\n      document.head.appendChild(script)\n    })\n  }\n\n  return g[globalImaLoaderKey]\n}\n\nexport default function artplayerPluginVast(userOption = {}) {\n  return (art) => {\n    const {\n      template: { $player, $video },\n      constructor: {\n        utils: { setStyle, setStyles, append, remove },\n      },\n    } = art\n\n    const option = {\n      sdkUrl: DEFAULT_SDK_URL,\n      url: '',\n      adsResponse: '',\n      // UI 配置\n      zIndex: 150,\n      showBigPlayOnPause: true,\n      // IMA 设置\n      disableVpaid: true,\n      disableCustomPlaybackForIOS10Plus: true,\n      restoreCustomPlaybackStateOnAdBreakComplete: true,\n      // 行为配置\n      autoInit: true, // 是否自动绑定用户交互事件\n      debug: false,\n      ...userOption,\n    }\n\n    let state = STATES.IDLE\n    let ima = null\n\n    let adDisplayContainer = null\n    let adsLoader = null\n    let adsManager = null\n\n    let adContainerEl = null\n    let bigPlayEl = null\n\n    let initializedByUserGesture = false\n    let destroyed = false\n\n    // 记录广告前的状态\n    let contentWasPlayingBeforeAd = false\n\n    // ===== 辅助函数 =====\n    function log(...args) {\n      if (option.debug)\n        console.log('[artplayer-plugin-vast]', ...args)\n    }\n\n    function emit(name, payload) {\n      art.emit(`vast:${name}`, payload)\n    }\n\n    function setState(next) {\n      state = next\n    }\n\n    function getPlayerRect() {\n      const rect = $player.getBoundingClientRect()\n      const width = Math.max(1, Math.floor(rect.width))\n      const height = Math.max(1, Math.floor(rect.height))\n      return { width, height }\n    }\n\n    function ensureUi() {\n      if (adContainerEl)\n        return\n\n      // 广告容器\n      adContainerEl = document.createElement('div')\n      adContainerEl.className = 'artplayer-ima-ad-container'\n      setStyles(adContainerEl, {\n        position: 'absolute',\n        inset: '0',\n        width: '100%',\n        height: '100%',\n        display: 'none',\n        pointerEvents: 'auto',\n        zIndex: String(clampZIndex(option.zIndex)),\n      })\n      append($player, adContainerEl)\n\n      // 大播放按钮 (用于广告暂停或移动端手势触发)\n      bigPlayEl = document.createElement('button')\n      bigPlayEl.type = 'button'\n      bigPlayEl.className = 'artplayer-ima-bigplay'\n      bigPlayEl.setAttribute('aria-label', 'Play Ad')\n      setStyles(bigPlayEl, {\n        position: 'absolute',\n        left: '50%',\n        top: '50%',\n        transform: 'translate(-50%, -50%)',\n        width: '72px',\n        height: '72px',\n        border: '0',\n        padding: '0',\n        borderRadius: '50%',\n        background: 'rgba(0,0,0,0.35)',\n        cursor: 'pointer',\n        display: 'none',\n        zIndex: String(clampZIndex(option.zIndex) + 1),\n      })\n      bigPlayEl.innerHTML = `\n                <svg viewBox=\"0 0 24 24\" width=\"42\" height=\"42\" fill=\"rgba(255,255,255,0.92)\" style=\"margin-left:3px;\">\n                    <path d=\"M8 5v14l11-7z\"></path>\n                </svg>\n            `\n      append($player, bigPlayEl)\n\n      bigPlayEl.addEventListener('click', () => {\n        if (destroyed)\n          return\n        // 点击按钮算作一次用户手势，尝试初始化 AdContainer\n        initializedByUserGesture = true\n        if (!adDisplayContainer)\n          safeCall(() => init())\n        if (adsManager)\n          safeCall(() => adsManager.resume())\n      })\n    }\n\n    function showAdLayer(show) {\n      if (!adContainerEl)\n        return\n      setStyle(adContainerEl, 'display', show ? 'block' : 'none')\n    }\n\n    function showBigPlay(show) {\n      if (!bigPlayEl)\n        return\n      setStyle(bigPlayEl, 'display', show ? 'block' : 'none')\n    }\n\n    function lockContentForAd() {\n      // 记录当前播放状态\n      contentWasPlayingBeforeAd = !art.paused\n\n      if (!art.paused)\n        art.pause()\n      showAdLayer(true)\n      if (option.showBigPlayOnPause)\n        showBigPlay(false)\n    }\n\n    function releaseContentAfterAd() {\n      showAdLayer(false)\n      showBigPlay(false)\n\n      if (contentWasPlayingBeforeAd) {\n        // 优化点：捕获自动播放失败的错误\n        const playPromise = art.play()\n        if (playPromise && typeof playPromise.catch === 'function') {\n          playPromise.catch((e) => {\n            log('Resume content failed (likely autoplay policy):', e)\n          })\n        }\n      }\n    }\n\n    function cleanupAdsObjects() {\n      if (adsManager) {\n        safeCall(() => adsManager.destroy())\n        adsManager = null\n      }\n      if (adsLoader) {\n        safeCall(() => adsLoader.destroy && adsLoader.destroy())\n        adsLoader = null\n      }\n      if (adDisplayContainer) {\n        safeCall(() => adDisplayContainer.destroy())\n        adDisplayContainer = null\n      }\n    }\n\n    // 优化点：音量同步逻辑\n    function syncVolume() {\n      if (!adsManager || destroyed)\n        return\n      // Artplayer volume 是 0-1，IMA 也是 0-1\n      const vol = art.muted ? 0 : art.volume\n      safeCall(() => adsManager.setVolume(vol))\n    }\n\n    // ===== IMA 事件处理 =====\n    function onAdError(event) {\n      const err = event && event.getError ? event.getError() : event\n      setState(STATES.ERROR)\n      emit(EVENTS.AD_ERROR, err)\n      log('Ad error:', err)\n      cleanupAdsObjects()\n      releaseContentAfterAd()\n    }\n\n    function onContentPauseRequested() {\n      emit(EVENTS.CONTENT_PAUSE_REQUESTED)\n      lockContentForAd()\n    }\n\n    function onContentResumeRequested() {\n      emit(EVENTS.CONTENT_RESUME_REQUESTED)\n      releaseContentAfterAd()\n    }\n\n    function onAdEvent(e) {\n      if (!ima || !ima.AdEvent || !ima.AdEvent.Type)\n        return\n      const t = e.type\n\n      switch (t) {\n        case ima.AdEvent.Type.LOADED:\n          emit(EVENTS.AD_LOADED, e)\n          break\n        case ima.AdEvent.Type.STARTED:\n          setState(STATES.AD_PLAYING)\n          emit(EVENTS.AD_STARTED, e)\n          showBigPlay(false)\n          break\n        case ima.AdEvent.Type.PAUSED:\n          setState(STATES.AD_PAUSED)\n          emit(EVENTS.AD_PAUSED, e)\n          if (option.showBigPlayOnPause)\n            showBigPlay(true)\n          break\n        case ima.AdEvent.Type.RESUMED:\n          setState(STATES.AD_PLAYING)\n          emit(EVENTS.AD_RESUMED, e)\n          showBigPlay(false)\n          break\n        case ima.AdEvent.Type.COMPLETE:\n          emit(EVENTS.AD_COMPLETE, e)\n          break\n        case ima.AdEvent.Type.SKIPPED:\n          emit(EVENTS.AD_SKIPPED, e)\n          break\n        case ima.AdEvent.Type.CLICK:\n          emit(EVENTS.AD_CLICK, e)\n          break\n        case ima.AdEvent.Type.ALL_ADS_COMPLETED:\n          setState(STATES.COMPLETED)\n          emit(EVENTS.ALL_ADS_COMPLETED, e)\n          break\n        default:\n          break\n      }\n    }\n\n    function initAdsManager(adsManagerLoadedEvent) {\n      if (destroyed)\n        return\n      emit(EVENTS.ADS_MANAGER_LOADED, adsManagerLoadedEvent)\n\n      const adsRenderingSettings = new ima.AdsRenderingSettings()\n      adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete\n        = !!option.restoreCustomPlaybackStateOnAdBreakComplete\n\n      if (adsManager)\n        safeCall(() => adsManager.destroy())\n\n      adsManager = adsManagerLoadedEvent.getAdsManager($video, adsRenderingSettings)\n\n      // 绑定事件\n      adsManager.addEventListener(ima.AdErrorEvent.Type.AD_ERROR, onAdError)\n      adsManager.addEventListener(ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED, onContentPauseRequested)\n      adsManager.addEventListener(ima.AdEvent.Type.CONTENT_RESUME_REQUESTED, onContentResumeRequested)\n\n      const adEvents = [\n        ima.AdEvent.Type.LOADED,\n        ima.AdEvent.Type.STARTED,\n        ima.AdEvent.Type.PAUSED,\n        ima.AdEvent.Type.RESUMED,\n        ima.AdEvent.Type.COMPLETE,\n        ima.AdEvent.Type.SKIPPED,\n        ima.AdEvent.Type.CLICK,\n        ima.AdEvent.Type.ALL_ADS_COMPLETED,\n      ]\n      adEvents.forEach(type => adsManager.addEventListener(type, onAdEvent))\n\n      // 初始化 AdsManager\n      try {\n        const { width, height } = getPlayerRect()\n        adsManager.init(width, height, ima.ViewMode.NORMAL)\n\n        // 优化点：初始化时立即同步音量\n        syncVolume()\n\n        adsManager.start()\n      }\n      catch (e) {\n        onAdError({ getError: () => e })\n      }\n    }\n\n    // ===== 核心逻辑 =====\n    const init = once(() => {\n      if (destroyed)\n        return Promise.reject(new Error('Plugin destroyed'))\n      ensureUi()\n      setState(STATES.SDK_LOADING)\n\n      return loadImaSdk(option.sdkUrl)\n        .then((loadedIma) => {\n          if (destroyed)\n            return\n          ima = loadedIma\n          emit(EVENTS.SDK_LOADED)\n          log('IMA SDK loaded')\n\n          // SDK 全局配置\n          if (option.disableVpaid && ima.ImaSdkSettings && ima.ImaSdkSettings.VpaidMode) {\n            safeCall(() => ima.settings.setVpaidMode(ima.ImaSdkSettings.VpaidMode.DISABLED))\n          }\n          if (option.disableCustomPlaybackForIOS10Plus) {\n            safeCall(() => ima.settings.setDisableCustomPlaybackForIOS10Plus(true))\n          }\n\n          if (!adDisplayContainer) {\n            adDisplayContainer = new ima.AdDisplayContainer(adContainerEl, $video)\n          }\n          if (!adsLoader) {\n            adsLoader = new ima.AdsLoader(adDisplayContainer)\n            adsLoader.addEventListener(\n              ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,\n              initAdsManager,\n              false,\n            )\n            adsLoader.addEventListener(ima.AdErrorEvent.Type.AD_ERROR, onAdError, false)\n          }\n\n          setState(STATES.READY)\n          emit(EVENTS.READY)\n        })\n        .catch((e) => {\n          setState(STATES.ERROR)\n          emit(EVENTS.AD_ERROR, e)\n          throw e\n        })\n    })\n\n    function initializeAdDisplayContainerFromUserGesture() {\n      if (destroyed)\n        return\n      if (!ima || !adDisplayContainer)\n        return\n      if (initializedByUserGesture)\n        return\n\n      initializedByUserGesture = true\n      // 移动端核心：必须在手势回调中同步调用 initialize()\n      safeCall(() => adDisplayContainer.initialize())\n      log('AdDisplayContainer.initialize() called (user gesture)')\n    }\n\n    function requestAds(adsRequest) {\n      if (destroyed)\n        return Promise.reject(new Error('Plugin destroyed'))\n      return init().then(() => {\n        if (destroyed)\n          return\n        setState(STATES.REQUESTING)\n        ensureUi()\n        safeCall(() => adsLoader.requestAds(adsRequest))\n      })\n    }\n\n    function playAdTag(url) {\n      if (!url)\n        return Promise.reject(new Error('Missing adTagUrl'))\n      return init().then(() => {\n        const req = new ima.AdsRequest()\n        req.adTagUrl = url\n        return requestAds(req)\n      })\n    }\n\n    function playAdsResponse(response) {\n      if (!response)\n        return Promise.reject(new Error('Missing adsResponse'))\n      return init().then(() => {\n        const req = new ima.AdsRequest()\n        req.adsResponse = response\n        return requestAds(req)\n      })\n    }\n\n    // 优化点：使用 debounce 包裹 resize 逻辑\n    const resize = debounce(() => {\n      if (!adsManager || destroyed)\n        return\n      const { width, height } = getPlayerRect()\n      safeCall(() => adsManager.resize(width, height, ima.ViewMode.NORMAL))\n    }, 100)\n\n    function destroy() {\n      if (destroyed)\n        return\n      destroyed = true\n      setState(STATES.DESTROYED)\n\n      cleanupAdsObjects()\n\n      if (adContainerEl)\n        remove(adContainerEl)\n      if (bigPlayEl)\n        remove(bigPlayEl)\n\n      adContainerEl = null\n      bigPlayEl = null\n\n      // 优化点：清理音量监听\n      art.off('video:volume', syncVolume)\n      art.off('video:muted', syncVolume)\n    }\n\n    // ===== 自动初始化逻辑 (User Gesture) =====\n    const onUserGesture = () => {\n      if (destroyed)\n        return\n      // 即使未播放广告，也尝试尽早初始化容器，以便后续播放无需手势\n      init().then(() => initializeAdDisplayContainerFromUserGesture()).catch(() => { })\n      detachUserGestureHooks()\n    }\n\n    function attachUserGestureHooks() {\n      $player.addEventListener('pointerdown', onUserGesture, { capture: true, passive: true })\n      $player.addEventListener('touchend', onUserGesture, { capture: true, passive: true })\n      $player.addEventListener('click', onUserGesture, { capture: true, passive: true })\n    }\n\n    function detachUserGestureHooks() {\n      $player.removeEventListener('pointerdown', onUserGesture, { capture: true })\n      $player.removeEventListener('touchend', onUserGesture, { capture: true })\n      $player.removeEventListener('click', onUserGesture, { capture: true })\n    }\n\n    // ===== ArtPlayer 生命周期集成 =====\n\n    // 优化点：绑定音量变化\n    art.on('video:volume', syncVolume)\n    art.on('video:muted', syncVolume)\n\n    art.on('resize', resize)\n    window.addEventListener('resize', resize, { passive: true })\n\n    art.on('destroy', () => {\n      window.removeEventListener('resize', resize)\n      detachUserGestureHooks()\n      destroy()\n    })\n\n    // ===== 自动执行 =====\n    ensureUi()\n    if (option.autoInit)\n      attachUserGestureHooks()\n\n    if (option.url) {\n      playAdTag(option.url).catch(e => log('playAdTag failed:', e))\n    }\n    else if (option.adsResponse) {\n      playAdsResponse(option.adsResponse).catch(e => log('playAdsResponse failed:', e))\n    }\n\n    // ===== Public API =====\n    return {\n      name: 'artplayerPluginVast',\n      get state() { return state },\n      get isAdPlaying() { return state === STATES.AD_PLAYING || state === STATES.AD_PAUSED },\n      get ima() { return ima },\n      get adsLoader() { return adsLoader },\n      get adsManager() { return adsManager },\n      get adDisplayContainer() { return adDisplayContainer },\n      init,\n      requestAds,\n      playAdTag,\n      playAdsResponse,\n      resize,\n      destroy,\n      initializeFromUserGesture() {\n        init().then(() => initializeAdDisplayContainerFromUserGesture()).catch(() => { })\n      },\n      EVENTS,\n      STATES,\n    }\n  }\n}\n\nif (typeof window !== 'undefined') {\n  window.artplayerPluginVast = artplayerPluginVast\n}\n","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n"],"names":[],"version":3,"file":"index.js.map","sourceRoot":"../../../"}