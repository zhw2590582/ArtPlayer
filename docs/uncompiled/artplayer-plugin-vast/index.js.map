{"mappings":"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","sources":["packages/artplayer-plugin-vast/src/index.js","node_modules/@parcel/transformer-js/src/esmodule-helpers.js"],"sourcesContent":["/**\n * ArtPlayer Plugin VAST (Google IMA SDK)\n *\n * Production-ready refactor:\n * - SDK singleton loader (deduped)\n * - Correct user-gesture init for AdDisplayContainer.initialize()\n * - Explicit state machine\n * - Safer content hijack/release (no blind art.play())\n * - Better lifecycle cleanup\n * - Public API: init(), requestAds(), playAdTag(), playAdsResponse(), destroy()\n * - Robust resize handling\n *\n * Notes / constraints (explicit, not hidden):\n * - This plugin is for VAST/IMA linear ads; VMAP/mid-roll scheduling is not implemented here.\n * - On mobile, you MUST call init() from a user gesture OR allow the plugin to auto-init on the first user interaction on the player.\n *\n * @license MIT\n */\n\nconst DEFAULT_SDK_URL = 'https://imasdk.googleapis.com/js/sdkloader/ima3.js';\n\nconst STATES = Object.freeze({\n  IDLE: 'idle',\n  SDK_LOADING: 'sdk_loading',\n  READY: 'ready',\n  REQUESTING: 'requesting',\n  AD_PLAYING: 'ad_playing',\n  AD_PAUSED: 'ad_paused',\n  COMPLETED: 'completed',\n  ERROR: 'error',\n  DESTROYED: 'destroyed',\n});\n\nconst EVENTS = Object.freeze({\n  READY: 'ready',\n  SDK_LOADED: 'sdkLoaded',\n  ADS_MANAGER_LOADED: 'adsManagerLoaded',\n\n  AD_LOADED: 'adLoaded',\n  AD_STARTED: 'adStarted',\n  AD_PAUSED: 'adPaused',\n  AD_RESUMED: 'adResumed',\n  AD_SKIPPED: 'adSkipped',\n  AD_COMPLETE: 'adComplete',\n  ALL_ADS_COMPLETED: 'allAdsCompleted',\n  AD_ERROR: 'adError',\n  AD_CLICK: 'adClick',\n\n  CONTENT_PAUSE_REQUESTED: 'contentPauseRequested',\n  CONTENT_RESUME_REQUESTED: 'contentResumeRequested',\n});\n\nconst globalImaLoaderKey = '__ARTPLAYER_IMA_SDK_PROMISE__';\n\nfunction getGlobal() {\n  // eslint-disable-next-line no-new-func\n  return Function('return this')();\n}\n\nfunction once(fn) {\n  let called = false;\n  let result;\n  return function (...args) {\n    if (called) return result;\n    called = true;\n    result = fn.apply(this, args);\n    return result;\n  };\n}\n\nfunction safeCall(fn) {\n  try {\n    return fn();\n  } catch (e) {\n    return undefined;\n  }\n}\n\nfunction clampZIndex(v) {\n  const n = Number(v);\n  if (!Number.isFinite(n)) return 150;\n  return Math.max(1, Math.min(2147483647, Math.floor(n)));\n}\n\n/**\n * SDK loader (deduped globally across plugin instances)\n */\nfunction loadImaSdk(sdkUrl) {\n  const g = getGlobal();\n  if (g.google && g.google.ima) return Promise.resolve(g.google.ima);\n\n  if (!g[globalImaLoaderKey]) {\n    g[globalImaLoaderKey] = new Promise((resolve, reject) => {\n      const script = document.createElement('script');\n      script.src = sdkUrl || DEFAULT_SDK_URL;\n      script.async = true;\n      script.onload = () => {\n        if (g.google && g.google.ima) resolve(g.google.ima);\n        else reject(new Error('IMA SDK loaded but window.google.ima is missing'));\n      };\n      script.onerror = () => reject(new Error('Failed to load IMA SDK script'));\n      document.head.appendChild(script);\n    });\n  }\n\n  return g[globalImaLoaderKey];\n}\n\nexport default function artplayerPluginVast(userOption = {}) {\n  return (art) => {\n    const {\n      template: { $player, $video },\n      constructor: {\n        utils: { setStyle, setStyles, append, remove },\n      },\n    } = art;\n\n    const option = {\n      sdkUrl: DEFAULT_SDK_URL,\n      url: '',\n      adsResponse: '',\n      // UI\n      zIndex: 150,\n      showBigPlayOnPause: true,\n      // IMA settings\n      disableVpaid: true,\n      disableCustomPlaybackForIOS10Plus: true,\n      restoreCustomPlaybackStateOnAdBreakComplete: true,\n      // behavior\n      autoInit: true, // attach user-gesture listeners to init automatically\n      debug: false,\n      ...userOption,\n    };\n\n    let state = STATES.IDLE;\n\n    let ima = null;\n\n    let adDisplayContainer = null;\n    let adsLoader = null;\n    let adsManager = null;\n\n    let adContainerEl = null;\n    let bigPlayEl = null;\n\n    let initializedByUserGesture = false;\n    let destroyed = false;\n\n    // Track content state to restore safely\n    let contentWasPlayingBeforeAd = false;\n    let contentTimeBeforeAd = 0;\n\n    // ===== helpers =====\n    function log(...args) {\n      if (option.debug) console.log('[artplayer-plugin-vast]', ...args);\n    }\n\n    function emit(name, payload) {\n      art.emit(`vast:${name}`, payload);\n    }\n\n    function setState(next) {\n      state = next;\n    }\n\n    function getPlayerRect() {\n      const rect = $player.getBoundingClientRect();\n      const width = Math.max(1, Math.floor(rect.width));\n      const height = Math.max(1, Math.floor(rect.height));\n      return { width, height };\n    }\n\n    function ensureUi() {\n      if (adContainerEl) return;\n\n      adContainerEl = document.createElement('div');\n      adContainerEl.className = 'artplayer-ima-ad-container';\n      setStyles(adContainerEl, {\n        position: 'absolute',\n        inset: '0',\n        width: '100%',\n        height: '100%',\n        display: 'none',\n        pointerEvents: 'auto',\n        zIndex: String(clampZIndex(option.zIndex)),\n      });\n      append($player, adContainerEl);\n\n      bigPlayEl = document.createElement('button');\n      bigPlayEl.type = 'button';\n      bigPlayEl.className = 'artplayer-ima-bigplay';\n      bigPlayEl.setAttribute('aria-label', 'Play Ad');\n      setStyles(bigPlayEl, {\n        position: 'absolute',\n        left: '50%',\n        top: '50%',\n        transform: 'translate(-50%, -50%)',\n        width: '72px',\n        height: '72px',\n        border: '0',\n        padding: '0',\n        borderRadius: '50%',\n        background: 'rgba(0,0,0,0.35)',\n        cursor: 'pointer',\n        display: 'none',\n        zIndex: String(clampZIndex(option.zIndex) + 1),\n      });\n      bigPlayEl.innerHTML = `\n                <svg viewBox=\"0 0 24 24\" width=\"42\" height=\"42\" fill=\"rgba(255,255,255,0.92)\" style=\"margin-left:3px;\">\n                    <path d=\"M8 5v14l11-7z\"></path>\n                </svg>\n            `;\n      append($player, bigPlayEl);\n\n      bigPlayEl.addEventListener('click', () => {\n        if (destroyed) return;\n        // Resume ad if paused; also counts as user gesture for initialize()\n        initializedByUserGesture = true;\n        if (!adDisplayContainer) safeCall(() => init()); // best effort\n        if (adsManager) safeCall(() => adsManager.resume());\n      });\n    }\n\n    function showAdLayer(show) {\n      if (!adContainerEl) return;\n      setStyle(adContainerEl, 'display', show ? 'block' : 'none');\n    }\n\n    function showBigPlay(show) {\n      if (!bigPlayEl) return;\n      setStyle(bigPlayEl, 'display', show ? 'block' : 'none');\n    }\n\n    function lockContentForAd() {\n      // do not blindly mutate art.option (runtime may not fully apply)\n      // Use operational safety: pause content and block click-to-toggle by overlaying ad layer.\n      contentWasPlayingBeforeAd = !art.paused;\n      contentTimeBeforeAd = $video.currentTime || 0;\n\n      if (!art.paused) art.pause();\n\n      showAdLayer(true);\n      if (option.showBigPlayOnPause) showBigPlay(false);\n    }\n\n    function releaseContentAfterAd() {\n      showAdLayer(false);\n      showBigPlay(false);\n\n      // restore to previous content behavior safely:\n      // - if user was watching (playing) before the ad, resume\n      // - if user was paused, stay paused\n      if (contentWasPlayingBeforeAd) {\n        // Some integrations prefer not to auto-resume after ad errors; we only resume if we paused for the ad.\n        art.play();\n      }\n    }\n\n    function cleanupAdsObjects() {\n      if (adsManager) {\n        safeCall(() => adsManager.destroy());\n        adsManager = null;\n      }\n      if (adsLoader) {\n        // AdsLoader has no destroy in some IMA builds; safe-call anyway\n        safeCall(() => adsLoader.destroy && adsLoader.destroy());\n        adsLoader = null;\n      }\n      if (adDisplayContainer) {\n        safeCall(() => adDisplayContainer.destroy());\n        adDisplayContainer = null;\n      }\n    }\n\n    // ===== IMA event handlers =====\n    function onAdError(event) {\n      const err = event && event.getError ? event.getError() : event;\n      setState(STATES.ERROR);\n      emit(EVENTS.AD_ERROR, err);\n      log('Ad error:', err);\n\n      cleanupAdsObjects();\n      // Only release to content; do not force seek.\n      releaseContentAfterAd();\n    }\n\n    function onContentPauseRequested() {\n      emit(EVENTS.CONTENT_PAUSE_REQUESTED);\n      lockContentForAd();\n    }\n\n    function onContentResumeRequested() {\n      emit(EVENTS.CONTENT_RESUME_REQUESTED);\n      // Do not auto-seek back; IMA handles it if restoreCustomPlaybackStateOnAdBreakComplete is true\n      releaseContentAfterAd();\n    }\n\n    function onAdEvent(e) {\n      if (!ima || !ima.AdEvent || !ima.AdEvent.Type) return;\n\n      const t = e.type;\n\n      switch (t) {\n        case ima.AdEvent.Type.LOADED:\n          emit(EVENTS.AD_LOADED, e);\n          break;\n\n        case ima.AdEvent.Type.STARTED:\n          setState(STATES.AD_PLAYING);\n          emit(EVENTS.AD_STARTED, e);\n          showBigPlay(false);\n          break;\n\n        case ima.AdEvent.Type.PAUSED:\n          setState(STATES.AD_PAUSED);\n          emit(EVENTS.AD_PAUSED, e);\n          if (option.showBigPlayOnPause) showBigPlay(true);\n          break;\n\n        case ima.AdEvent.Type.RESUMED:\n          setState(STATES.AD_PLAYING);\n          emit(EVENTS.AD_RESUMED, e);\n          showBigPlay(false);\n          break;\n\n        case ima.AdEvent.Type.COMPLETE:\n          emit(EVENTS.AD_COMPLETE, e);\n          break;\n\n        case ima.AdEvent.Type.SKIPPED:\n          emit(EVENTS.AD_SKIPPED, e);\n          break;\n\n        case ima.AdEvent.Type.CLICK:\n          emit(EVENTS.AD_CLICK, e);\n          break;\n\n        case ima.AdEvent.Type.ALL_ADS_COMPLETED:\n          setState(STATES.COMPLETED);\n          emit(EVENTS.ALL_ADS_COMPLETED, e);\n          // Do NOT call release here unconditionally; CONTENT_RESUME_REQUESTED is the right signal.\n          break;\n\n        default:\n          break;\n      }\n    }\n\n    function initAdsManager(adsManagerLoadedEvent) {\n      if (destroyed) return;\n\n      emit(EVENTS.ADS_MANAGER_LOADED, adsManagerLoadedEvent);\n\n      const adsRenderingSettings = new ima.AdsRenderingSettings();\n      adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete =\n        !!option.restoreCustomPlaybackStateOnAdBreakComplete;\n\n      if (adsManager) safeCall(() => adsManager.destroy());\n\n      // Bind ads to the content video element\n      adsManager = adsManagerLoadedEvent.getAdsManager($video, adsRenderingSettings);\n\n      adsManager.addEventListener(ima.AdErrorEvent.Type.AD_ERROR, onAdError);\n      adsManager.addEventListener(ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED, onContentPauseRequested);\n      adsManager.addEventListener(ima.AdEvent.Type.CONTENT_RESUME_REQUESTED, onContentResumeRequested);\n\n      const adEvents = [\n        ima.AdEvent.Type.LOADED,\n        ima.AdEvent.Type.STARTED,\n        ima.AdEvent.Type.PAUSED,\n        ima.AdEvent.Type.RESUMED,\n        ima.AdEvent.Type.COMPLETE,\n        ima.AdEvent.Type.SKIPPED,\n        ima.AdEvent.Type.CLICK,\n        ima.AdEvent.Type.ALL_ADS_COMPLETED,\n      ];\n\n      adEvents.forEach((type) => adsManager.addEventListener(type, onAdEvent));\n\n      try {\n        const { width, height } = getPlayerRect();\n        adsManager.init(width, height, ima.ViewMode.NORMAL);\n        adsManager.start();\n      } catch (e) {\n        onAdError({ getError: () => e });\n      }\n    }\n\n    // ===== public core =====\n\n    const init = once(() => {\n      if (destroyed) return Promise.reject(new Error('Plugin destroyed'));\n\n      ensureUi();\n\n      setState(STATES.SDK_LOADING);\n\n      return loadImaSdk(option.sdkUrl)\n        .then((loadedIma) => {\n          if (destroyed) return;\n          ima = loadedIma;\n\n          emit(EVENTS.SDK_LOADED);\n          log('IMA SDK loaded');\n\n          // Global IMA settings (optional)\n          if (option.disableVpaid && ima.ImaSdkSettings && ima.ImaSdkSettings.VpaidMode) {\n            safeCall(() => ima.settings.setVpaidMode(ima.ImaSdkSettings.VpaidMode.DISABLED));\n          }\n          if (option.disableCustomPlaybackForIOS10Plus) {\n            safeCall(() => ima.settings.setDisableCustomPlaybackForIOS10Plus(true));\n          }\n\n          // Create AdDisplayContainer / AdsLoader once\n          if (!adDisplayContainer) {\n            adDisplayContainer = new ima.AdDisplayContainer(adContainerEl, $video);\n          }\n          if (!adsLoader) {\n            adsLoader = new ima.AdsLoader(adDisplayContainer);\n            adsLoader.addEventListener(\n              ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,\n              initAdsManager,\n              false,\n            );\n            adsLoader.addEventListener(ima.AdErrorEvent.Type.AD_ERROR, onAdError, false);\n          }\n\n          setState(STATES.READY);\n          emit(EVENTS.READY);\n        })\n        .catch((e) => {\n          setState(STATES.ERROR);\n          emit(EVENTS.AD_ERROR, e);\n          throw e;\n        });\n    });\n\n    function initializeAdDisplayContainerFromUserGesture() {\n      if (destroyed) return;\n      if (!ima || !adDisplayContainer) return;\n\n      if (initializedByUserGesture) return;\n      initializedByUserGesture = true;\n\n      // MUST be called in a user gesture handler on mobile browsers.\n      safeCall(() => adDisplayContainer.initialize());\n      log('AdDisplayContainer.initialize() called (user gesture)');\n    }\n\n    function requestAds(adsRequest) {\n      if (destroyed) return Promise.reject(new Error('Plugin destroyed'));\n\n      return init().then(() => {\n        if (destroyed) return;\n\n        setState(STATES.REQUESTING);\n        ensureUi();\n\n        // If not initialized via user gesture yet, we still request;\n        // On mobile, playback may fail until initialize() happens via gesture.\n        // We set up auto-init hooks to call it as soon as possible.\n        safeCall(() => adsLoader.requestAds(adsRequest));\n      });\n    }\n\n    function playAdTag(url) {\n      if (!url) return Promise.reject(new Error('Missing adTagUrl'));\n      return init().then(() => {\n        const req = new ima.AdsRequest();\n        req.adTagUrl = url;\n        return requestAds(req);\n      });\n    }\n\n    function playAdsResponse(response) {\n      if (!response) return Promise.reject(new Error('Missing adsResponse'));\n      return init().then(() => {\n        const req = new ima.AdsRequest();\n        req.adsResponse = response;\n        return requestAds(req);\n      });\n    }\n\n    function resize() {\n      if (!adsManager || destroyed) return;\n      const { width, height } = getPlayerRect();\n      safeCall(() => adsManager.resize(width, height, ima.ViewMode.NORMAL));\n    }\n\n    function destroy() {\n      if (destroyed) return;\n      destroyed = true;\n      setState(STATES.DESTROYED);\n\n      cleanupAdsObjects();\n\n      if (adContainerEl) remove(adContainerEl);\n      if (bigPlayEl) remove(bigPlayEl);\n\n      adContainerEl = null;\n      bigPlayEl = null;\n    }\n\n    // ===== user gesture init hooks =====\n    const onUserGesture = (e) => {\n      if (destroyed) return;\n\n      // Ensure core objects exist\n      // init() loads SDK & creates AdDisplayContainer; we need initialize() inside this handler.\n      init()\n        .then(() => {\n          initializeAdDisplayContainerFromUserGesture();\n        })\n        .catch(() => {\n          // ignore\n        });\n\n      // Only need once; remove listeners\n      detachUserGestureHooks();\n    };\n\n    function attachUserGestureHooks() {\n      // Capture phase increases chance to run before other handlers stopPropagation\n      $player.addEventListener('pointerdown', onUserGesture, { capture: true, passive: true });\n      $player.addEventListener('touchend', onUserGesture, { capture: true, passive: true });\n      $player.addEventListener('click', onUserGesture, { capture: true, passive: true });\n    }\n\n    function detachUserGestureHooks() {\n      $player.removeEventListener('pointerdown', onUserGesture, { capture: true });\n      $player.removeEventListener('touchend', onUserGesture, { capture: true });\n      $player.removeEventListener('click', onUserGesture, { capture: true });\n    }\n\n    // ===== ArtPlayer lifecycle =====\n    art.on('resize', resize);\n    // Defensive: some layouts don't trigger art.resize reliably\n    window.addEventListener('resize', resize, { passive: true });\n\n    art.on('destroy', () => {\n      window.removeEventListener('resize', resize);\n      detachUserGestureHooks();\n      destroy();\n    });\n\n    // ===== auto behavior =====\n    ensureUi();\n\n    if (option.autoInit) attachUserGestureHooks();\n\n    // Auto play initial ad if provided\n    if (option.url) {\n      // Do not force initialize(); request may succeed on desktop, and on mobile will wait for gesture.\n      playAdTag(option.url).catch((e) => log('playAdTag failed:', e));\n    } else if (option.adsResponse) {\n      playAdsResponse(option.adsResponse).catch((e) => log('playAdsResponse failed:', e));\n    }\n\n    // ===== Public API =====\n    return {\n      name: 'artplayerPluginVast',\n\n      // state\n      get state() {\n        return state;\n      },\n      get isAdPlaying() {\n        return state === STATES.AD_PLAYING || state === STATES.AD_PAUSED;\n      },\n\n      // raw IMA objects\n      get ima() {\n        return ima;\n      },\n      get adsLoader() {\n        return adsLoader;\n      },\n      get adsManager() {\n        return adsManager;\n      },\n      get adDisplayContainer() {\n        return adDisplayContainer;\n      },\n\n      // methods\n      init,\n      requestAds,\n      playAdTag,\n      playAdsResponse,\n      resize,\n      destroy,\n\n      // manually mark/perform user-gesture init (if you want explicit control)\n      initializeFromUserGesture() {\n        init()\n          .then(() => initializeAdDisplayContainerFromUserGesture())\n          .catch(() => { });\n      },\n\n      EVENTS,\n      STATES,\n    };\n  };\n}\n\nif (typeof window !== 'undefined') {\n  window.artplayerPluginVast = artplayerPluginVast;\n}\n","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n"],"names":[],"version":3,"file":"index.js.map","sourceRoot":"../../../"}