{"mappings":"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","sources":["packages/artplayer-tool-thumbnail/src/index.js","packages/artplayer-tool-thumbnail/src/emitter.js","node_modules/@parcel/transformer-js/src/esmodule-helpers.js","packages/artplayer-tool-thumbnail/src/utils.js"],"sourcesContent":["import Emitter from './emitter'\nimport { clamp, getFileName, runPromisesInSeries, sleep } from './utils'\n\nexport default class ArtplayerToolThumbnail extends Emitter {\n  constructor(option = {}) {\n    super()\n    this.processing = false\n    this.option = {}\n    this.setup(Object.assign({}, ArtplayerToolThumbnail.DEFAULTS, option))\n    this.video = ArtplayerToolThumbnail.creatVideo()\n    this.duration = 0\n    this.inputChange = this.inputChange.bind(this)\n    this.ondrop = this.ondrop.bind(this)\n    this.option.fileInput.addEventListener('change', this.inputChange)\n    this.option.fileInput.addEventListener('dragover', ArtplayerToolThumbnail.ondragover)\n    this.option.fileInput.addEventListener('drop', ArtplayerToolThumbnail.ondrop)\n  }\n\n  static get DEFAULTS() {\n    return {\n      number: 60,\n      width: 160,\n      height: 90,\n      column: 10,\n      begin: 0,\n      end: Number.NaN,\n    }\n  }\n\n  static ondragover(event) {\n    event.preventDefault()\n  }\n\n  ondrop(event) {\n    event.preventDefault()\n    const file = event.dataTransfer.files[0]\n    this.loadVideo(file)\n  }\n\n  setup(option = {}) {\n    this.option = Object.assign({}, this.option, option)\n    const { fileInput, number, width, column } = this.option\n\n    this.errorHandle(fileInput instanceof Element, 'The \\'fileInput\\' is not a Element')\n\n    if (!(fileInput.tagName === 'INPUT' && fileInput.type === 'file')) {\n      fileInput.style.position = 'relative'\n      const newFileInput = document.createElement('input')\n      newFileInput.type = 'file'\n      newFileInput.style.position = 'absolute'\n      newFileInput.style.width = '100%'\n      newFileInput.style.height = '100%'\n      newFileInput.style.left = '0'\n      newFileInput.style.top = '0'\n      newFileInput.style.right = '0'\n      newFileInput.style.bottom = '0'\n      newFileInput.style.opacity = '0'\n      fileInput.appendChild(newFileInput)\n      this.option.fileInput = newFileInput\n    }\n\n    ['number', 'width', 'column', 'begin', 'end'].forEach((item) => {\n      this.errorHandle(typeof this.option[item] === 'number', `The '${item}' is not a number`)\n    })\n\n    this.option.number = clamp(number, 10, 1000)\n    this.option.width = clamp(width, 10, 1000)\n    this.option.column = clamp(column, 1, 1000)\n    return this\n  }\n\n  static creatVideo() {\n    const video = document.createElement('video')\n    video.style.position = 'absolute'\n    video.style.top = '-9999px'\n    video.style.left = '-9999px'\n    video.muted = true\n    video.controls = true\n    document.body.appendChild(video)\n    return video\n  }\n\n  inputChange(event) {\n    const file = this.option.fileInput.files[0]\n    this.loadVideo(file)\n    event.target.value = ''\n  }\n\n  loadVideo(file) {\n    if (file) {\n      const canPlayType = this.video.canPlayType(file.type)\n      this.errorHandle(\n        canPlayType === 'maybe' || canPlayType === 'probably',\n        `Playback of this file format is not supported: ${file.type}`,\n      )\n      const videoUrl = URL.createObjectURL(file)\n      this.videoUrl = videoUrl\n      this.file = file\n      this.emit('file', this.file)\n      this.video.src = videoUrl\n      this.emit('video', this.video)\n    }\n  }\n\n  start() {\n    if (!this.video.duration)\n      return sleep(1000).then(() => this.start())\n    const { width, number, begin, end } = this.option\n    const height = (this.video.videoHeight / this.video.videoWidth) * width\n    this.option.height = height\n    this.option.begin = clamp(begin, 0, this.video.duration)\n    this.option.end = clamp(end || this.video.duration, begin, this.video.duration)\n    this.errorHandle(this.option.end > this.option.begin, `End time must be greater than the start time`)\n    this.duration = this.option.end - this.option.begin\n    this.density = number / this.duration\n    this.errorHandle(this.file && this.video, 'Please select the video file first')\n    this.errorHandle(!this.processing, 'There is currently a task in progress, please wait a moment...')\n    this.errorHandle(this.density <= 1, `The preview density cannot be greater than 1, but got ${this.density}`)\n    const screenshotDate = this.creatScreenshotDate()\n    const canvas = this.creatCanvas()\n    const context2D = canvas.getContext('2d')\n    this.emit('canvas', canvas)\n    const promiseList = screenshotDate.map((item, index) => () => {\n      return new Promise((resolve) => {\n        this.video.oncanplay = () => {\n          context2D.drawImage(this.video, item.x, item.y, width, height)\n          canvas.toBlob((blob) => {\n            if (this.thumbnailUrl) {\n              URL.revokeObjectURL(this.thumbnailUrl)\n            }\n            this.thumbnailUrl = URL.createObjectURL(blob)\n            this.emit('update', this.thumbnailUrl, (index + 1) / number)\n            this.video.oncanplay = null\n            resolve()\n          })\n        }\n        this.video.currentTime = item.time\n      })\n    })\n    this.processing = true\n    return runPromisesInSeries(promiseList)\n      .then(() => {\n        this.processing = false\n        this.emit('done')\n      })\n      .catch((err) => {\n        this.processing = false\n        this.emit('error', err.message)\n        throw err\n      })\n  }\n\n  creatScreenshotDate() {\n    const { number, width, height, column, begin } = this.option\n    const timeGap = this.duration / number\n    const timePoints = [begin + timeGap]\n    while (timePoints.length < number) {\n      const last = timePoints[timePoints.length - 1]\n      timePoints.push(last + timeGap)\n    }\n    return timePoints.map((item, index) => ({\n      time: item - timeGap / 2,\n      x: (index % column) * width,\n      y: Math.floor(index / column) * height,\n    }))\n  }\n\n  creatCanvas() {\n    const { number, width, height, column } = this.option\n    const canvas = document.createElement('canvas')\n    const context2D = canvas.getContext('2d')\n    canvas.width = width * column\n    canvas.height = Math.ceil(number / column) * height + 30\n    context2D.fillStyle = 'black'\n    context2D.fillRect(0, 0, canvas.width, canvas.height)\n    context2D.font = '14px Georgia'\n    context2D.fillStyle = '#fff'\n    context2D.fillText(\n      `From: https://artplayer.org/, Number: ${number}, Width: ${width}, Height: ${height}, Column: ${column}`,\n      10,\n      canvas.height - 11,\n    )\n    return canvas\n  }\n\n  download() {\n    this.errorHandle(\n      this.file && this.thumbnailUrl,\n      'Download does not seem to be ready, please create preview first',\n    )\n    this.errorHandle(!this.processing, 'There is currently a task in progress, please wait a moment...')\n    const elink = document.createElement('a')\n    const name = `${getFileName(this.file.name)}.png`\n    elink.download = name\n    elink.href = this.thumbnailUrl\n    document.body.appendChild(elink)\n    elink.click()\n    document.body.removeChild(elink)\n    this.emit('download', name)\n    return this\n  }\n\n  errorHandle(condition, msg) {\n    if (!condition) {\n      this.emit('error', msg)\n      throw new Error(msg)\n    }\n  }\n\n  destroy() {\n    this.option.fileInput.removeEventListener('change', this.inputChange)\n    this.option.fileInput.removeEventListener('dragover', ArtplayerToolThumbnail.ondragover)\n    this.option.fileInput.removeEventListener('drop', ArtplayerToolThumbnail.ondrop)\n    document.body.removeChild(this.video)\n    if (this.videoUrl) {\n      URL.revokeObjectURL(this.videoUrl)\n    }\n    if (this.thumbnailUrl) {\n      URL.revokeObjectURL(this.thumbnailUrl)\n    }\n    this.emit('destroy')\n  }\n}\n\nwindow.ArtplayerToolThumbnail = ArtplayerToolThumbnail\n","export default class Emitter {\n  on(name, fn, ctx) {\n    const e = this.e || (this.e = {});\n    (e[name] || (e[name] = [])).push({ fn, ctx })\n    return this\n  }\n\n  once(name, fn, ctx) {\n    const self = this\n    function listener(...args) {\n      self.off(name, listener)\n      fn.apply(ctx, args)\n    }\n    listener._ = fn\n    return this.on(name, listener, ctx)\n  }\n\n  emit(name, ...data) {\n    const evtArr = ((this.e || (this.e = {}))[name] || []).slice()\n    for (let i = 0; i < evtArr.length; i += 1) {\n      evtArr[i].fn.apply(evtArr[i].ctx, data)\n    }\n    return this\n  }\n\n  off(name, callback) {\n    const e = this.e || (this.e = {})\n    const evts = e[name]\n    const liveEvents = []\n    if (evts && callback) {\n      for (let i = 0, len = evts.length; i < len; i += 1) {\n        if (evts[i].fn !== callback && evts[i].fn._ !== callback)\n          liveEvents.push(evts[i])\n      }\n    }\n    if (liveEvents.length) {\n      e[name] = liveEvents\n    }\n    else {\n      delete e[name]\n    }\n    return this\n  }\n}\n","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n","export function sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\nexport function runPromisesInSeries(ps) {\n  return ps.reduce((p, next) => p.then(next), Promise.resolve())\n}\n\nexport function getFileName(name) {\n  const nameArray = name.split('.')\n  nameArray.pop()\n  return nameArray.join('.')\n}\n\nexport function clamp(num, a, b) {\n  return Math.max(Math.min(num, Math.max(a, b)), Math.min(a, b))\n}\n"],"names":[],"version":3,"file":"index.js.map","sourceRoot":"../../../"}