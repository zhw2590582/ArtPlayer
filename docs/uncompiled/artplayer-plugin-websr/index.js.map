{"mappings":"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","sources":["packages/artplayer-plugin-websr/src/index.js","packages/artplayer-plugin-websr/src/Upscaler.js","node_modules/@parcel/transformer-js/src/esmodule-helpers.js"],"sourcesContent":["import Upscaler from \"./Upscaler.js\";\r\n\r\nfunction artplayerPluginWebsr(\r\n    option = {\r\n        networkSize: \"medium\",\r\n        compare: false,\r\n        weightsBaseUrl: \"/weights\",\r\n        workerUrl: \"/worker/main.js\",\r\n        videoScale: 2,\r\n    },\r\n) {\r\n    return (art) => {\r\n        const { $video, $player } = art.template;\r\n\r\n        const $canvas = document.createElement(\"canvas\");\r\n        $player.appendChild($canvas);\r\n\r\n        $canvas.style.position = \"absolute\";\r\n        $canvas.style.zIndex = \"11\";\r\n        $canvas.style.pointerEvents = \"none\";\r\n        $canvas.style.top = \"50%\";\r\n        $canvas.style.left = \"50%\";\r\n        $canvas.style.transform = \"translate(-50%, -50%)\";\r\n        $canvas.style.opacity = \"0\";\r\n        $canvas.style.transition = \"opacity 0.2s ease\";\r\n\r\n        function calcCanvasSize() {\r\n            const videoElement = art.video;\r\n            const containerWidth = $player.offsetWidth || 640;\r\n            const containerHeight = $player.offsetHeight || 360;\r\n            const videoWidth = videoElement.videoWidth || 640;\r\n            const videoHeight = videoElement.videoHeight || 360;\r\n            const aspectRatio = videoWidth / videoHeight;\r\n            let displayWidth = containerWidth;\r\n            let displayHeight = containerHeight;\r\n            if (containerWidth / containerHeight > aspectRatio) {\r\n                displayWidth = containerHeight * aspectRatio;\r\n            } else {\r\n                displayHeight = containerWidth / aspectRatio;\r\n            }\r\n            return { displayWidth, displayHeight };\r\n        }\r\n\r\n        if (!Upscaler || !Upscaler.isSupported || !Upscaler.isSupported()) {\r\n            console.warn(\"Upscaler is not supported in this environment\");\r\n            return;\r\n        }\r\n\r\n        const upscaler = new Upscaler({\r\n            networkSize: option.networkSize || \"medium\",\r\n            weightsBaseUrl: option.weightsBaseUrl || \"/weights\",\r\n            workerUrl: option.workerUrl || \"/worker/main.js\",\r\n            videoScale: option.videoScale || 2,\r\n        });\r\n\r\n        let realtimeStarted = false;\r\n\r\n        async function startRealtime() {\r\n            if (realtimeStarted) return;\r\n            realtimeStarted = true;\r\n\r\n            try {\r\n                await new Promise((resolve, reject) => {\r\n                    if ($video.readyState >= 1) {\r\n                        resolve();\r\n                        return;\r\n                    }\r\n                    const onLoaded = () => {\r\n                        cleanup();\r\n                        resolve();\r\n                    };\r\n                    const onError = () => {\r\n                        cleanup();\r\n                        reject(new Error(\"Failed to load video metadata\"));\r\n                    };\r\n                    const cleanup = () => {\r\n                        $video.removeEventListener(\"loadedmetadata\", onLoaded);\r\n                        $video.removeEventListener(\"error\", onError);\r\n                    };\r\n                    $video.addEventListener(\"loadedmetadata\", onLoaded);\r\n                    $video.addEventListener(\"error\", onError);\r\n                });\r\n\r\n                await upscaler.startRealtimeUpscale(\r\n                    $video,\r\n                    $canvas,\r\n                    option.networkSize || upscaler.networkSize,\r\n                );\r\n\r\n                requestAnimationFrame(() => {\r\n                    $canvas.style.opacity = \"1\";\r\n                });\r\n            } catch (e) {\r\n                console.error(\r\n                    \"artplayer-plugin-upscaler: failed to start realtime\",\r\n                    e,\r\n                );\r\n            }\r\n        }\r\n\r\n        const { displayWidth, displayHeight } = calcCanvasSize();\r\n        $canvas.style.width = displayWidth + \"px\";\r\n        $canvas.style.height = displayHeight + \"px\";\r\n\r\n        let comparePosition = 50;\r\n        let isDragging = false;\r\n        let compareEnabled = !!option.compare;\r\n\r\n        const $handler = document.createElement(\"div\");\r\n        $handler.style.position = \"absolute\";\r\n        $handler.style.width = \"3px\";\r\n        $handler.style.backgroundColor = \"rgba(255, 255, 255, 0.75)\";\r\n        $handler.style.cursor = \"ew-resize\";\r\n        $handler.style.zIndex = \"12\";\r\n        $handler.style.pointerEvents = \"auto\";\r\n        $handler.style.display = compareEnabled ? \"block\" : \"none\";\r\n        $handler.style.boxShadow = \"0 0 2px rgba(0, 0, 0, 0.1)\";\r\n\r\n        if (compareEnabled) {\r\n            $player.appendChild($handler);\r\n            $handler.addEventListener(\"mousedown\", handleMouseDown);\r\n            document.addEventListener(\"mousemove\", handleMouseMove);\r\n            document.addEventListener(\"mouseup\", handleMouseUp);\r\n            updateCompareMask();\r\n        }\r\n\r\n        function updateCompareMask() {\r\n            if (compareEnabled) {\r\n                const { displayWidth, displayHeight } = calcCanvasSize();\r\n                const gradient = `linear-gradient(to right, transparent 0%, transparent ${comparePosition}%, black ${comparePosition}%, black 100%)`;\r\n                $canvas.style.maskImage = gradient;\r\n\r\n                const containerWidth = $player.offsetWidth || 640;\r\n                const containerHeight = $player.offsetHeight || 360;\r\n                const canvasLeft = (containerWidth - displayWidth) / 2;\r\n                const canvasTop = (containerHeight - displayHeight) / 2;\r\n                const handlerX =\r\n                    canvasLeft + (displayWidth * comparePosition) / 100;\r\n\r\n                $handler.style.top = canvasTop + \"px\";\r\n                $handler.style.left = handlerX + \"px\";\r\n                $handler.style.height = displayHeight + \"px\";\r\n                $handler.style.transform = \"translateX(-50%)\";\r\n            } else {\r\n                $canvas.style.maskImage = \"none\";\r\n            }\r\n        }\r\n\r\n        function handleMouseDown(e) {\r\n            if (compareEnabled) {\r\n                isDragging = true;\r\n            }\r\n        }\r\n\r\n        function handleMouseMove(e) {\r\n            if (compareEnabled && isDragging) {\r\n                const rect = $player.getBoundingClientRect();\r\n                const { displayWidth } = calcCanvasSize();\r\n                const containerWidth = $player.offsetWidth || 640;\r\n                const canvasLeft = (containerWidth - displayWidth) / 2;\r\n                const x = e.clientX - rect.left;\r\n                const relativeX = x - canvasLeft;\r\n                comparePosition = (relativeX / displayWidth) * 100;\r\n                comparePosition = Math.max(0, Math.min(100, comparePosition));\r\n                updateCompareMask();\r\n            }\r\n        }\r\n\r\n        function handleMouseUp(e) {\r\n            isDragging = false;\r\n        }\r\n\r\n        art.on(\"destroy\", () => {\r\n            if (upscaler && typeof upscaler.dispose === \"function\") {\r\n                upscaler.dispose();\r\n            }\r\n            $handler.removeEventListener(\"mousedown\", handleMouseDown);\r\n            document.removeEventListener(\"mousemove\", handleMouseMove);\r\n            document.removeEventListener(\"mouseup\", handleMouseUp);\r\n        });\r\n\r\n        art.on(\"resize\", () => {\r\n            const { displayWidth, displayHeight } = calcCanvasSize();\r\n            $canvas.style.width = displayWidth + \"px\";\r\n            $canvas.style.height = displayHeight + \"px\";\r\n            updateCompareMask();\r\n        });\r\n\r\n        art.on(\"play\", () => {\r\n            startRealtime();\r\n        });\r\n\r\n        function update(newOption = {}) {\r\n            if (!newOption || typeof newOption !== \"object\") return;\r\n\r\n            if (Object.prototype.hasOwnProperty.call(newOption, \"compare\")) {\r\n                const nextCompare = !!newOption.compare;\r\n                option.compare = nextCompare;\r\n                compareEnabled = nextCompare;\r\n\r\n                if (compareEnabled) {\r\n                    if (!$handler.parentNode) {\r\n                        $player.appendChild($handler);\r\n                    }\r\n                    $handler.style.display = \"block\";\r\n                    $handler.addEventListener(\"mousedown\", handleMouseDown);\r\n                    document.addEventListener(\"mousemove\", handleMouseMove);\r\n                    document.addEventListener(\"mouseup\", handleMouseUp);\r\n                    updateCompareMask();\r\n                } else {\r\n                    $canvas.style.maskImage = \"none\";\r\n                    $handler.style.display = \"none\";\r\n                    $handler.removeEventListener(\"mousedown\", handleMouseDown);\r\n                    document.removeEventListener(\"mousemove\", handleMouseMove);\r\n                    document.removeEventListener(\"mouseup\", handleMouseUp);\r\n                }\r\n            }\r\n\r\n            if (newOption.networkSize) {\r\n                const nextSize = newOption.networkSize;\r\n                option.networkSize = nextSize;\r\n                if (\r\n                    upscaler &&\r\n                    typeof upscaler.stopRealtimeUpscale === \"function\"\r\n                ) {\r\n                    upscaler.stopRealtimeUpscale();\r\n                }\r\n                realtimeStarted = false;\r\n                if (!art.paused) {\r\n                    startRealtime();\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            name: \"artplayerPluginWebsr\",\r\n            upscaler,\r\n            update,\r\n        };\r\n    };\r\n}\r\n\r\nwindow.artplayerPluginWebsr = artplayerPluginWebsr;\r\n","export default class Upscaler {\n  static DEFAULT_TIMEOUTS = { IMAGE: 300000, VIDEO: 3600000, METADATA: 10000 };\n  static DEFAULT_DELAYS = { INIT: 500, NETWORK: 300 };\n\n  static isSupported() {\n    try {\n      const hasWorker = typeof Worker !== \"undefined\";\n      const hasOffscreen =\n        typeof OffscreenCanvas !== \"undefined\" ||\n        (typeof document !== \"undefined\" &&\n          !!document.createElement(\"canvas\").transferControlToOffscreen);\n      const hasBlob = typeof Blob !== \"undefined\";\n      return hasWorker && hasOffscreen && hasBlob;\n    } catch {\n      return false;\n    }\n  }\n\n  static isVideoSupported() {\n    try {\n      return (\n        typeof VideoEncoder !== \"undefined\" &&\n        typeof VideoDecoder !== \"undefined\"\n      );\n    } catch {\n      return false;\n    }\n  }\n\n  constructor(options = {}) {\n    const weightsBaseUrl = options.weightsBaseUrl || \"/weights\";\n\n    this.networks = options.networks || {\n      small: {\n        name: \"anime4k/cnn-2x-l\",\n        weightsUrl: `${weightsBaseUrl}/cnn-8.json`,\n      },\n      medium: {\n        name: \"anime4k/cnn-2x-16\",\n        weightsUrl: `${weightsBaseUrl}/cnn-16.json`,\n      },\n      large: {\n        name: \"anime4k/cnn-2x-28\",\n        weightsUrl: `${weightsBaseUrl}/cnn-28.json`,\n      },\n    };\n\n    this.weightsBaseUrl = weightsBaseUrl;\n    this.networkSize = options.networkSize || \"medium\";\n    this.workerUrl = options.workerUrl || \"/worker/main.js\";\n\n    this.timeouts = {\n      ...Upscaler.DEFAULT_TIMEOUTS,\n      ...(options.timeouts || {}),\n    };\n    this.delays = { ...Upscaler.DEFAULT_DELAYS, ...(options.delays || {}) };\n\n    this.imageScale =\n      typeof options.imageScale === \"number\" && options.imageScale > 0\n        ? options.imageScale\n        : 2;\n    this.videoScale =\n      typeof options.videoScale === \"number\" && options.videoScale > 0\n        ? options.videoScale\n        : 2;\n\n    this.weightsCache = new Map();\n    this.workerInstance = null;\n    this.messageHandlers = {};\n    this.progressCallback = null;\n    this.processingType = null;\n\n    this.realtimeLoopId = null;\n    this.realtimeState = null;\n\n    this.init();\n  }\n\n  init({ prewarm = true } = {}) {\n    if (!Upscaler.isSupported()) {\n      throw new Error(\"Upscaler is not supported in this environment\");\n    }\n    if (prewarm) {\n      this.getWorker().postMessage({ cmd: \"isSupported\" });\n    }\n    return this;\n  }\n\n  getWorker() {\n    if (!this.workerInstance) {\n      this.workerInstance = new Worker(this.workerUrl);\n      this.workerInstance.onmessage = (event) =>\n        this.handleWorkerMessage(event);\n    }\n    return this.workerInstance;\n  }\n\n  static extractProgressValue(data) {\n    const value = data.data ?? data.progress ?? data.value ?? data.percentage;\n    return typeof value === \"number\"\n      ? Math.min(100, Math.max(0, Math.round(value)))\n      : null;\n  }\n\n  handleBlobResponse(data) {\n    const blobType =\n      this.processingType === \"video\" ? \"videoBlob\" : \"imageBlob\";\n    const handler = this.messageHandlers[blobType];\n    if (data.data instanceof Blob && handler) {\n      handler({ [blobType]: data.data });\n    }\n  }\n\n  requestBlob() {\n    const cmd =\n      this.processingType === \"video\" ? \"getVideoBlob\" : \"getImageBlob\";\n    this.getWorker().postMessage({ cmd });\n  }\n\n  handleWorkerMessage(event) {\n    const { data } = event;\n    console.debug(\"Worker message:\", data);\n    if (!data.cmd) return;\n\n    const { cmd } = data;\n\n    if (cmd === \"progress\") {\n      const progress = Upscaler.extractProgressValue(data);\n      if (progress !== null && this.progressCallback) {\n        this.progressCallback(progress);\n      }\n      if (this.messageHandlers.progress) this.messageHandlers.progress(data);\n    } else if (cmd === \"finished\") {\n      if (data.data instanceof Blob) {\n        this.handleBlobResponse(data);\n      } else {\n        this.requestBlob();\n      }\n    } else if (this.messageHandlers[cmd]) {\n      this.messageHandlers[cmd](data);\n    }\n  }\n\n  async loadWeights(networkSize) {\n    this.validateNetworkSize(networkSize);\n    if (this.weightsCache.has(networkSize)) {\n      return this.weightsCache.get(networkSize);\n    }\n    const network = this.networks[networkSize];\n    const response = await fetch(network.weightsUrl);\n    if (!response.ok)\n      throw new Error(`Failed to fetch weights: ${response.statusText}`);\n    const weights = await response.json();\n    this.weightsCache.set(networkSize, weights);\n    return weights;\n  }\n\n  static loadImageMetadata(arrayBuffer, mimeType) {\n    return new Promise((resolve, reject) => {\n      const blob = new Blob([arrayBuffer], { type: mimeType });\n      const url = URL.createObjectURL(blob);\n      const img = new Image();\n\n      img.onload = () => {\n        URL.revokeObjectURL(url);\n        resolve({ width: img.width, height: img.height });\n      };\n\n      img.onerror = () => {\n        URL.revokeObjectURL(url);\n        reject(new Error(\"Failed to load image\"));\n      };\n\n      img.src = url;\n    });\n  }\n\n  static loadVideoMetadata(file, timeoutMs) {\n    return new Promise((resolve, reject) => {\n      const url = URL.createObjectURL(file);\n      const video = document.createElement(\"video\");\n      video.src = url;\n\n      const timeout = setTimeout(() => reject(new Error(\"Timeout\")), timeoutMs);\n\n      video.onloadedmetadata = () => {\n        clearTimeout(timeout);\n        URL.revokeObjectURL(url);\n        resolve({\n          width: video.videoWidth,\n          height: video.videoHeight,\n          duration: video.duration,\n        });\n      };\n\n      video.onerror = () => {\n        clearTimeout(timeout);\n        URL.revokeObjectURL(url);\n        reject(new Error(\"Failed to load video\"));\n      };\n    });\n  }\n\n  createOffscreenCanvas(width, height, scale = 2) {\n    const factor = typeof scale === \"number\" && scale > 0 ? scale : 1;\n    const canvas = document.createElement(\"canvas\");\n    canvas.width = width * factor;\n    canvas.height = height * factor;\n    if (typeof canvas.transferControlToOffscreen !== \"function\") {\n      throw new Error(\"OffscreenCanvas is not supported in this environment\");\n    }\n    return canvas.transferControlToOffscreen();\n  }\n\n  createBlobPromise(blobType, timeout) {\n    return new Promise((resolve, reject) => {\n      const timeoutId = setTimeout(() => {\n        if (this.messageHandlers[blobType]) {\n          delete this.messageHandlers[blobType];\n          reject(new Error(`${blobType} processing timeout`));\n        }\n      }, timeout);\n\n      this.messageHandlers[blobType] = (msg) => {\n        delete this.messageHandlers[blobType];\n        clearTimeout(timeoutId);\n        const blob = msg[blobType] || msg.data;\n        if (blob instanceof Blob) {\n          resolve(blob);\n        } else {\n          reject(new Error(`Invalid ${blobType} format`));\n        }\n      };\n    });\n  }\n\n  validateNetworkSize(size) {\n    if (!this.networks[size]) {\n      throw new Error(\n        \"Invalid networkSize: use one of \" +\n          Object.keys(this.networks).join(\", \"),\n      );\n    }\n  }\n\n  async upscaleImage(imageFile, networkSize, scaleOverride) {\n    if (!imageFile) throw new Error(\"Image file is required\");\n    const size = networkSize || this.networkSize;\n    this.validateNetworkSize(size);\n\n    this.processingType = \"image\";\n    const arrayBuffer = await imageFile.arrayBuffer();\n    const mimeType = imageFile.type || \"image/jpeg\";\n    const { width, height } = await Upscaler.loadImageMetadata(\n      arrayBuffer,\n      mimeType,\n    );\n\n    const weights = await this.loadWeights(size);\n    const network = this.networks[size];\n    const scale =\n      typeof scaleOverride === \"number\" && scaleOverride > 0\n        ? scaleOverride\n        : this.imageScale;\n    const [canvasUp, canvasOrig] = [\n      this.createOffscreenCanvas(width, height, scale),\n      this.createOffscreenCanvas(width, height, 1),\n    ];\n\n    const blobPromise = this.createBlobPromise(\n      \"imageBlob\",\n      this.timeouts.IMAGE,\n    );\n\n    this.getWorker().postMessage(\n      {\n        cmd: \"init\",\n        data: {\n          imageArrayBuffer: arrayBuffer,\n          imageMimeType: mimeType,\n          upscaled: canvasUp,\n          original: canvasOrig,\n          resolution: { width, height },\n          network_name: network.name,\n          weights,\n        },\n      },\n      [canvasUp, canvasOrig],\n    );\n\n    setTimeout(() => {\n      this.getWorker().postMessage({\n        cmd: \"network\",\n        data: {\n          name: network.name,\n          imageArrayBuffer: arrayBuffer,\n          imageMimeType: mimeType,\n          weights,\n        },\n      });\n\n      setTimeout(() => {\n        this.getWorker().postMessage({\n          cmd: \"getImageBlob\",\n          data: { imageArrayBuffer: arrayBuffer, imageMimeType: mimeType },\n        });\n      }, this.delays.NETWORK);\n    }, this.delays.INIT);\n\n    return blobPromise;\n  }\n\n  async upscaleVideo(videoFile, networkSize, scaleOverride) {\n    if (!videoFile) throw new Error(\"Video file is required\");\n    const size = networkSize || this.networkSize;\n    this.validateNetworkSize(size);\n\n    if (!Upscaler.isVideoSupported()) {\n      throw new Error(\"WebCodecs API not supported. Requires Chrome 94+\");\n    }\n\n    this.processingType = \"video\";\n    const { width, height, duration } = await Upscaler.loadVideoMetadata(\n      videoFile,\n      this.timeouts.METADATA,\n    );\n\n    const weights = await this.loadWeights(size);\n    const network = this.networks[size];\n    const scale =\n      typeof scaleOverride === \"number\" && scaleOverride > 0\n        ? scaleOverride\n        : this.videoScale;\n    const [canvasOut, canvasIn] = [\n      this.createOffscreenCanvas(width, height, scale),\n      this.createOffscreenCanvas(width, height, 1),\n    ];\n\n    const blobPromise = this.createBlobPromise(\n      \"videoBlob\",\n      this.timeouts.VIDEO,\n    );\n\n    this.getWorker().postMessage(\n      {\n        cmd: \"process\",\n        file: videoFile,\n        fileSize: videoFile.size,\n        duration,\n        adjustedResolution: {\n          adjustedInputWidth: width,\n          adjustedInputHeight: height,\n          adjustedOutputWidth: width * scale,\n          adjustedOutputHeight: height * scale,\n        },\n        upscaled: canvasOut,\n        original: canvasIn,\n        weights,\n        network_name: network.name,\n        skipDemuxProgress: true,\n      },\n      [canvasOut, canvasIn],\n    );\n\n    return blobPromise;\n  }\n\n  async startRealtimeUpscale(\n    videoElement,\n    canvasElement,\n    networkSize,\n    scaleOverride,\n  ) {\n    if (!videoElement || !canvasElement) {\n      throw new Error(\"videoElement and canvasElement are required\");\n    }\n\n    const size = networkSize || this.networkSize;\n    this.validateNetworkSize(size);\n\n    const network = this.networks[size];\n    const weights = await this.loadWeights(size);\n\n    const scale =\n      typeof scaleOverride === \"number\" && scaleOverride > 0\n        ? scaleOverride\n        : this.videoScale;\n\n    const ensureMetadata = () => {\n      return new Promise((resolve, reject) => {\n        if (videoElement.readyState >= 1) {\n          resolve();\n          return;\n        }\n        const onLoaded = () => {\n          cleanup();\n          resolve();\n        };\n        const onError = () => {\n          cleanup();\n          reject(new Error(\"Failed to load video metadata\"));\n        };\n        const cleanup = () => {\n          videoElement.removeEventListener(\"loadedmetadata\", onLoaded);\n          videoElement.removeEventListener(\"error\", onError);\n        };\n        videoElement.addEventListener(\"loadedmetadata\", onLoaded);\n        videoElement.addEventListener(\"error\", onError);\n      });\n    };\n\n    await ensureMetadata();\n\n    const width = videoElement.videoWidth;\n    const height = videoElement.videoHeight;\n    if (!width || !height) {\n      throw new Error(\"Invalid video dimensions\");\n    }\n\n    const firstInit = !canvasElement._upscalerTransferred;\n\n    let offscreen = null;\n    if (firstInit) {\n      canvasElement.width = width * scale;\n      canvasElement.height = height * scale;\n\n      if (typeof canvasElement.transferControlToOffscreen !== \"function\") {\n        throw new Error(\"OffscreenCanvas is not supported in this environment\");\n      }\n\n      offscreen = canvasElement.transferControlToOffscreen();\n      canvasElement._upscalerTransferred = true;\n    }\n\n    const captureCanvas = document.createElement(\"canvas\");\n    captureCanvas.width = width;\n    captureCanvas.height = height;\n    const captureCtx = captureCanvas.getContext(\"2d\");\n\n    if (this.realtimeLoopId) {\n      cancelAnimationFrame(this.realtimeLoopId);\n      this.realtimeLoopId = null;\n    }\n\n    const initPayload = {\n      cmd: \"realtimeInit\",\n      data: {\n        upscaled: firstInit ? offscreen : null,\n        resolution: {\n          width,\n          height,\n          scale,\n          outputWidth: width * scale,\n          outputHeight: height * scale,\n        },\n        network_name: network.name,\n        weights,\n      },\n    };\n\n    if (firstInit && offscreen) {\n      this.getWorker().postMessage(initPayload, [offscreen]);\n    } else {\n      this.getWorker().postMessage(initPayload);\n    }\n\n    this.realtimeState = {\n      running: true,\n      video: videoElement,\n      canvas: canvasElement,\n      scale,\n      busy: false,\n      frameIndex: 0,\n      captureCanvas,\n      captureCtx,\n    };\n\n    const loop = async () => {\n      if (!this.realtimeState || !this.realtimeState.running) return;\n      const state = this.realtimeState;\n      const v = state.video;\n\n      const haveCurrentData = v.HAVE_CURRENT_DATA || 2;\n\n      if (\n        !v.paused &&\n        !v.ended &&\n        !state.busy &&\n        v.readyState >= haveCurrentData &&\n        v.videoWidth > 0 &&\n        v.videoHeight > 0\n      ) {\n        state.busy = true;\n        try {\n          const captureCanvas = state.captureCanvas;\n          const captureCtx = state.captureCtx;\n          if (!captureCanvas || !captureCtx) {\n            throw new Error(\"Missing capture canvas\");\n          }\n          captureCtx.drawImage(v, 0, 0, captureCanvas.width, captureCanvas.height);\n          const frame = await createImageBitmap(captureCanvas);\n          state.frameIndex += 1;\n\n          this.getWorker().postMessage(\n            {\n              cmd: \"realtimeFrame\",\n              frame,\n            },\n            [frame],\n          );\n        } catch (e) {\n          console.warn(\"realtimeFrame error\", e);\n        } finally {\n          if (this.realtimeState) {\n            this.realtimeState.busy = false;\n          }\n        }\n      }\n\n      this.realtimeLoopId = requestAnimationFrame(loop);\n    };\n\n    this.realtimeLoopId = requestAnimationFrame(loop);\n  }\n\n  stopRealtimeUpscale() {\n    if (this.realtimeLoopId) {\n      cancelAnimationFrame(this.realtimeLoopId);\n      this.realtimeLoopId = null;\n    }\n    if (this.realtimeState) {\n      this.realtimeState.running = false;\n      this.realtimeState = null;\n    }\n  }\n\n  async downloadUpscaled(file, networkSize, filename = null) {\n    const isVideo = file.type.startsWith(\"video\");\n    const size = networkSize || this.networkSize;\n    const blob = isVideo\n      ? await this.upscaleVideo(file, size)\n      : await this.upscaleImage(file, size);\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download =\n      filename || `upscaled_${Date.now()}.${isVideo ? \"mp4\" : \"png\"}`;\n    link.click();\n    URL.revokeObjectURL(url);\n    return blob;\n  }\n\n  getSupportedNetworks() {\n    return Object.keys(this.networks);\n  }\n\n  static async getGPUCapability() {\n    try {\n      if (navigator.gpu) {\n        const adapter = await navigator.gpu.requestAdapter();\n        if (adapter) {\n          const buffer = adapter.limits.maxStorageBufferBindingSize / 512;\n          const texture = 8192 * 8192;\n          return Math.min(buffer, texture);\n        }\n      }\n      const canvas = document.createElement(\"canvas\");\n      const gl = canvas.getContext(\"webgl2\");\n      if (gl) return gl.getParameter(gl.MAX_TEXTURE_SIZE) ** 2;\n      return 8388608;\n    } catch {\n      return 8388608;\n    }\n  }\n\n  static getBackendType() {\n    try {\n      if (navigator.gpu) return \"webgpu\";\n      if (document.createElement(\"canvas\").getContext(\"webgl2\")) return \"webgl\";\n      return \"unknown\";\n    } catch {\n      return \"unknown\";\n    }\n  }\n\n  getAppState() {\n    return {\n      backend: Upscaler.getBackendType(),\n      isProcessing: false,\n      progress: 0,\n      width: 0,\n      height: 0,\n    };\n  }\n\n  onProgress(callback) {\n    if (typeof callback === \"function\") {\n      this.progressCallback = callback;\n    }\n  }\n\n  dispose() {\n    this.stopRealtimeUpscale();\n    if (this.workerInstance) {\n      this.workerInstance.terminate();\n      this.workerInstance = null;\n    }\n    this.messageHandlers = {};\n    this.progressCallback = null;\n    this.processingType = null;\n    this.weightsCache.clear();\n  }\n}","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n"],"names":[],"version":3,"file":"index.js.map","sourceRoot":"../../../"}