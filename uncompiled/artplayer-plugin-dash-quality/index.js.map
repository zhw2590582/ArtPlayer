{"mappings":"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","sources":["packages/artplayer-plugin-dash-quality/src/index.js","node_modules/@parcel/runtime-js/lib/bundles/runtime-64c514a205c07416.js","node_modules/@parcel/transformer-js/src/esmodule-helpers.js"],"sourcesContent":["import image from 'bundle-text:./image.svg';\n\nexport default function artplayerPluginDashQuality(option) {\n    return (art) => {\n        const { $video } = art.template;\n        const { errorHandle } = art.constructor.utils;\n\n        function update() {\n            const dash = art.dash || window.dash;\n            errorHandle(\n                dash && dash.getVideoElement() === $video,\n                'Cannot find instance of Dash from \"art.dash\" or \"window.dash\"',\n            );\n            const auto = option.auto || 'Auto';\n            const title = option.title || 'Quality';\n            const levels = dash.getBitrateInfoListFor('video');\n            const currentLevel = dash.getQualityFor('video');\n            const getResolution = option.getResolution || ((level) => (level.height || 'Unknown ') + 'P');\n            const settings = dash.getSettings();\n            const defaultLevel = levels[currentLevel];\n            const defaultHtml = settings?.streaming?.abr?.autoSwitchBitrate?.video ? auto : getResolution(defaultLevel);\n\n            const cfg = {\n                streaming: {\n                    abr: {\n                        autoSwitchBitrate: {},\n                    },\n                },\n            };\n\n            if (option.control) {\n                art.controls.update({\n                    name: 'dash-quality',\n                    position: 'right',\n                    html: defaultHtml,\n                    style: { padding: '0 10px' },\n                    selector: levels.map((item, index) => {\n                        return {\n                            html: getResolution(item),\n                            level: index,\n                            default: defaultLevel === item,\n                        };\n                    }),\n                    onSelect(item) {\n                        cfg.streaming.abr.autoSwitchBitrate['video'] = false;\n                        dash.updateSettings(cfg);\n                        dash.setQualityFor('video', item.level, true);\n                        return item.html;\n                    },\n                });\n            }\n\n            if (option.setting) {\n                art.setting.update({\n                    name: 'dash-quality',\n                    tooltip: defaultHtml,\n                    html: title,\n                    icon: image,\n                    width: 200,\n                    selector: levels.map((item, index) => {\n                        return {\n                            html: getResolution(item),\n                            level: index,\n                            default: defaultLevel === item,\n                        };\n                    }),\n                    onSelect: function (item) {\n                        cfg.streaming.abr.autoSwitchBitrate['video'] = false;\n                        dash.updateSettings(cfg);\n                        dash.setQualityFor('video', item.level, true);\n                        return item.html;\n                    },\n                });\n            }\n        }\n\n        art.on('ready', update);\n        art.on('restart', update);\n\n        return {\n            name: 'artplayerPluginDashQuality',\n        };\n    };\n}\n\nartplayerPluginDashQuality.env = process.env.NODE_ENV;\nartplayerPluginDashQuality.version = process.env.APP_VER;\nartplayerPluginDashQuality.build = process.env.BUILD_DATE;\n\nif (typeof window !== 'undefined') {\n    window['artplayerPluginDashQuality'] = artplayerPluginDashQuality;\n}\n","module.exports = \"d31e9ff5943c7d76\";","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (key === 'default' || key === '__esModule' || dest.hasOwnProperty(key)) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n"],"names":[],"version":3,"file":"index.js.map","sourceRoot":"../../../"}