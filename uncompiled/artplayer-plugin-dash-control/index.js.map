{"mappings":"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","sources":["packages/artplayer-plugin-dash-control/src/index.js","node_modules/@parcel/runtime-js/lib/bundles/runtime-d9842915446976aa.js","node_modules/@parcel/runtime-js/lib/bundles/runtime-fd32f05dba0c94f1.js","node_modules/@parcel/transformer-js/src/esmodule-helpers.js"],"sourcesContent":["import $quality from 'bundle-text:./quality.svg';\nimport $audio from 'bundle-text:./audio.svg';\n\nfunction uniqBy(array, property) {\n    const seen = new Map();\n    return array.filter((item) => {\n        const key = item[property];\n        if (key === undefined) {\n            return true;\n        }\n        return !seen.has(key) && seen.set(key, 1);\n    });\n}\n\nexport default function artplayerPluginDashControl(option = {}) {\n    return (art) => {\n        const { $video } = art.template;\n        const { errorHandle } = art.constructor.utils;\n\n        function updateQuality(dash) {\n            const qualities = dash.getBitrateInfoListFor('video');\n            if (!qualities || !qualities.length) return;\n\n            const config = option.quality || {};\n            const auto = config.auto || 'Auto';\n            const title = config.title || 'Quality';\n            const getName = config.getName || ((level) => `${level.height}p`);\n            const currentQuality = dash.getQualityFor('video');\n            const currentAuto = dash.getSettings().streaming.abr.autoSwitchBitrate['video'];\n            const defaultHtml = currentAuto ? auto : getName(qualities[currentQuality]);\n\n            const selector = uniqBy(\n                qualities.map((item) => {\n                    return {\n                        html: getName(item),\n                        value: item.qualityIndex,\n                        default: currentQuality === item.qualityIndex && !currentAuto,\n                    };\n                }),\n                'html',\n            ).sort((a, b) => b.value - a.value);\n\n            selector.push({\n                html: auto,\n                value: 'auto',\n                default: currentAuto,\n            });\n\n            const onSelect = (item) => {\n                if (item.value === 'auto') {\n                    dash.updateSettings({\n                        streaming: {\n                            abr: {\n                                autoSwitchBitrate: {\n                                    video: true,\n                                },\n                            },\n                        },\n                    });\n                } else {\n                    dash.updateSettings({\n                        streaming: {\n                            abr: {\n                                autoSwitchBitrate: {\n                                    video: false,\n                                },\n                            },\n                        },\n                    });\n                    dash.setQualityFor('video', item.value);\n                }\n                art.notice.show = `${title}: ${item.html}`;\n                if (config.control) art.controls.check(item);\n                if (config.setting) art.setting.check(item);\n                return item.html;\n            };\n\n            if (config.control) {\n                art.controls.update({\n                    name: 'dash-quality',\n                    position: 'right',\n                    html: defaultHtml,\n                    style: { padding: '0 10px' },\n                    selector: selector,\n                    onSelect: onSelect,\n                });\n            }\n\n            if (config.setting) {\n                art.setting.update({\n                    name: 'dash-quality',\n                    tooltip: defaultHtml,\n                    html: title,\n                    icon: $quality,\n                    width: 200,\n                    selector: selector,\n                    onSelect: onSelect,\n                });\n            }\n        }\n\n        function updateAudio(dash) {\n            const audioTracks = dash.getTracksFor('audio');\n            if (!audioTracks || !audioTracks.length) return;\n\n            const config = option.audio || {};\n            const auto = config.auto || 'Auto';\n            const title = config.title || 'Audio';\n            const getName = config.getName || ((track) => track.lang || track.id);\n            const currentTrack = dash.getCurrentTrackFor('audio') || audioTracks[0];\n            const defaultHtml = currentTrack ? getName(currentTrack) : auto;\n\n            const selector = uniqBy(\n                audioTracks.map((item) => {\n                    return {\n                        html: getName(item),\n                        value: item,\n                        default: currentTrack === item,\n                    };\n                }),\n                'html',\n            );\n\n            const onSelect = (item) => {\n                dash.setCurrentTrack(item.value);\n                art.notice.show = `${title}: ${item.html}`;\n                if (config.control) art.controls.check(item);\n                if (config.setting) art.setting.check(item);\n                return item.html;\n            };\n\n            if (config.control) {\n                art.controls.update({\n                    name: 'dash-audio',\n                    position: 'right',\n                    html: defaultHtml,\n                    style: { padding: '0 10px' },\n                    selector: selector,\n                    onSelect: onSelect,\n                });\n            }\n\n            if (config.setting) {\n                art.setting.update({\n                    name: 'dash-audio',\n                    tooltip: defaultHtml,\n                    html: title,\n                    icon: $audio,\n                    width: 200,\n                    selector: selector,\n                    onSelect: onSelect,\n                });\n            }\n        }\n\n        function update() {\n            errorHandle(art.dash.getVideoElement() === $video, 'Cannot find instance of DASH from \"art.dash\"');\n            updateQuality(art.dash);\n            updateAudio(art.dash);\n        }\n\n        art.on('ready', update);\n        art.on('restart', update);\n\n        return {\n            name: 'artplayerPluginDashControl',\n            update,\n        };\n    };\n}\n\nif (typeof window !== 'undefined') {\n    window['artplayerPluginDashControl'] = artplayerPluginDashControl;\n}\n","module.exports = \"3f2eca634b03c631\";","module.exports = \"5373c3b31536e9b3\";","exports.interopDefault = function (a) {\n  return a && a.__esModule ? a : {default: a};\n};\n\nexports.defineInteropFlag = function (a) {\n  Object.defineProperty(a, '__esModule', {value: true});\n};\n\nexports.exportAll = function (source, dest) {\n  Object.keys(source).forEach(function (key) {\n    if (\n      key === 'default' ||\n      key === '__esModule' ||\n      Object.prototype.hasOwnProperty.call(dest, key)\n    ) {\n      return;\n    }\n\n    Object.defineProperty(dest, key, {\n      enumerable: true,\n      get: function () {\n        return source[key];\n      },\n    });\n  });\n\n  return dest;\n};\n\nexports.export = function (dest, destName, get) {\n  Object.defineProperty(dest, destName, {\n    enumerable: true,\n    get: get,\n  });\n};\n"],"names":[],"version":3,"file":"index.js.map","sourceRoot":"../../../"}